{"version":3,"sources":["containers/SimpleActiveCallCtrlPage/index.js"],"names":["mapToProps","_","phone","activeCallControl","regionSettings","locale","brand","analytics","params","renderContactName","sessionId","activeSession","nameMatches","direction","callDirections","outbound","toMatches","fromMatches","phoneNumber","to","from","fallBackName","i18n","getString","currentLocale","telephonySessionId","fallBackNameFromThirdParty","fallBackNumber","areaCode","countryCode","fullName","controlBusy","busy","mapToFunctions","routerInteraction","onBackButtonClick","goBack","setActiveSessionId","onTransfer","push","muteCtrl","ACTIONS_CTRL_MAP","transferCtrl","holdCtrl","ActiveCallControlPanel","props","state","selectedMatcherIndex","onMute","mute","onUnmute","unmute","onHold","hold","onUnhold","unhold","onHangup","hangUp","track","formatPhone","onSelectMatcherName","option","findIndex","match","id","setState","loadActCall","nextProps","callCtrlLayouts","normalCtrl","startTime","actions","isOnMute","isOnHold","showContactDisplayPlaceholder","Component","propTypes","PropTypes","func","string","isRequired","object","array","bool","defaultProps"],"mappings":"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","sourcesContent":["/**\n * @file simplify active call control page\n * detail: https://jira.ringcentral.com/browse/RCINT-8256\n */\n\nimport { connect } from 'react-redux';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\nimport callDirections from 'ringcentral-integration/enums/callDirections';\n\nimport withPhone from '../../lib/withPhone';\n\nimport CallCtrlPanel from '../../components/CallCtrlPanel';\nimport callCtrlLayouts from '../../enums/callCtrlLayouts';\nimport { ACTIONS_CTRL_MAP } from '../../components/ActiveCallPad';\nimport i18n from './i18n';\nimport { pickFallBackInfo } from './utils';\n\nfunction mapToProps(\n  _,\n  {\n    phone: { activeCallControl, regionSettings, locale, brand, analytics },\n    params,\n    renderContactName,\n  },\n) {\n  const { sessionId } = params;\n  const { activeSession } = activeCallControl;\n  let nameMatches = [];\n  if (activeSession && !renderContactName) {\n    nameMatches =\n      activeSession.direction === callDirections.outbound\n        ? activeSession.toMatches\n        : activeSession.fromMatches;\n  }\n  let phoneNumber;\n  if (activeSession) {\n    phoneNumber =\n      activeSession.direction === callDirections.outbound\n        ? activeSession.to\n        : activeSession.from;\n  }\n  let fallBackName = i18n.getString('Unknown', locale.currentLocale);\n  if (renderContactName) {\n    const {\n      fallBackName: fallBackNameFromThirdParty,\n      fallBackNumber,\n    } = pickFallBackInfo(\n      activeSession,\n      renderContactName({\n        sessionId: activeSession && activeSession.sessionId,\n        telephonySessionId: sessionId,\n      }),\n      locale.currentLocale,\n    );\n    phoneNumber = fallBackNumber;\n    fallBackName = fallBackNameFromThirdParty;\n  }\n  return {\n    currentLocale: locale.currentLocale,\n    activeSession,\n    sessionId,\n    areaCode: regionSettings.areaCode,\n    countryCode: regionSettings.countryCode,\n    nameMatches,\n    phoneNumber,\n    fallBackName,\n    brand: brand.fullName,\n    activeCallControl,\n    controlBusy: activeCallControl.busy,\n    analytics,\n  };\n}\n\nfunction mapToFunctions(\n  _,\n  { phone: { routerInteraction, activeCallControl } },\n) {\n  return {\n    onBackButtonClick() {\n      routerInteraction.goBack();\n    },\n    setActiveSessionId(sessionId) {\n      activeCallControl.setActiveSessionId(sessionId);\n    },\n    onTransfer(sessionId) {\n      routerInteraction.push(`/transfer/${sessionId}/active`);\n    },\n  };\n}\n\nconst { muteCtrl, transferCtrl, holdCtrl } = ACTIONS_CTRL_MAP;\n// const actions = [muteCtrl, transferCtrl, holdCtrl]\nclass ActiveCallControlPanel extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      selectedMatcherIndex: 0,\n    };\n\n    this.onMute = () => this.props.activeCallControl.mute(this.props.sessionId);\n    this.onUnmute = () =>\n      this.props.activeCallControl.unmute(this.props.sessionId);\n    this.onHold = () => this.props.activeCallControl.hold(this.props.sessionId);\n    this.onUnhold = () =>\n      this.props.activeCallControl.unhold(this.props.sessionId);\n    this.onHangup = () => {\n      this.props.activeCallControl.hangUp(this.props.sessionId);\n      this.props.analytics.track('Call Control: Hang up/Small call control');\n    };\n\n    this.formatPhone = (phoneNumber) =>\n      formatNumber({\n        phoneNumber,\n        areaCode: this.props.areaCode,\n        countryCode: this.props.countryCode,\n      });\n\n    this.onSelectMatcherName = (option) => {\n      const nameMatches = this.props.nameMatches || [];\n      let selectedMatcherIndex = nameMatches.findIndex(\n        (match) => match.id === option.id,\n      );\n      if (selectedMatcherIndex < 0) {\n        selectedMatcherIndex = 0;\n      }\n      this.setState({\n        selectedMatcherIndex,\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.loadActCall();\n  }\n\n  loadActCall() {\n    this.props.setActiveSessionId(this.props.sessionId);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (!nextProps.activeSession) {\n      this.props.onBackButtonClick();\n    }\n  }\n\n  render() {\n    if (!this.props.activeSession) {\n      // or using skeleton screen here\n      return null;\n    }\n\n    return (\n      <CallCtrlPanel\n        sessionId={this.props.sessionId}\n        currentLocale={this.props.currentLocale}\n        fallBackName={this.props.fallBackName}\n        phoneNumber={this.props.phoneNumber}\n        onMute={this.onMute}\n        onUnmute={this.onUnmute}\n        onHold={this.onHold}\n        onUnhold={this.onUnhold}\n        onHangup={this.onHangup}\n        onTransfer={this.props.onTransfer}\n        showBackButton\n        backButtonLabel={i18n.getString('allCalls', this.props.currentLocale)}\n        onBackButtonClick={this.props.onBackButtonClick}\n        formatPhone={this.formatPhone}\n        areaCode={this.props.areaCode}\n        countryCode={this.props.countryCode}\n        selectedMatcherIndex={this.state.selectedMatcherIndex}\n        layout={callCtrlLayouts.normalCtrl}\n        startTime={this.props.activeSession.startTime}\n        actions={this.props.actions}\n        isOnMute={this.props.activeSession.isOnMute}\n        isOnHold={this.props.activeSession.isOnHold}\n        nameMatches={this.props.nameMatches}\n        onSelectMatcherName={this.onSelectMatcherName}\n        brand={this.props.brand}\n        showContactDisplayPlaceholder={this.props.showContactDisplayPlaceholder}\n        controlBusy={this.props.controlBusy}\n      />\n    );\n  }\n}\n\nActiveCallControlPanel.propTypes = {\n  setActiveSessionId: PropTypes.func,\n  currentLocale: PropTypes.string,\n  sessionId: PropTypes.string,\n  areaCode: PropTypes.string.isRequired,\n  countryCode: PropTypes.string.isRequired,\n  activeSession: PropTypes.object,\n  onBackButtonClick: PropTypes.func.isRequired,\n  activeCallControl: PropTypes.object,\n  nameMatches: PropTypes.array,\n  fallBackName: PropTypes.string,\n  phoneNumber: PropTypes.string,\n  showContactDisplayPlaceholder: PropTypes.bool,\n  brand: PropTypes.string.isRequired,\n  onTransfer: PropTypes.func.isRequired,\n  controlBusy: PropTypes.bool,\n  actions: PropTypes.array,\n  analytics: PropTypes.object,\n};\n\nActiveCallControlPanel.defaultProps = {\n  setActiveSessionId() {},\n  currentLocale: 'en-US',\n  activeCallControl: {},\n  activeSession: null,\n  sessionId: null,\n  nameMatches: [],\n  fallBackName: '',\n  phoneNumber: '',\n  showContactDisplayPlaceholder: false,\n  controlBusy: false,\n  actions: [muteCtrl, transferCtrl, holdCtrl],\n  analytics: {},\n};\n\nexport default withPhone(\n  connect(mapToProps, mapToFunctions)(ActiveCallControlPanel),\n);\n"],"file":"index.js"}