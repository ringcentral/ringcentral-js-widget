{"version":3,"sources":["lib/fetchList.js"],"names":["parallelFetch","fn","perPage","params","page","data","list","records","slice","paging","totalPages","promises","i","push","Promise","all","output","item","reduce","serialFetch","fetchedPages","fetchList","parallel"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAeA,aAAf,CAA6BC,EAA7B,EAAiCC,OAAjC,EAA0CC,MAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CACqBF,EAAE,mBAChBE,MADgB;AAEnBD,YAAAA,OAAO,EAAPA,OAFmB;AAGnBE,YAAAA,IAAI,EAAE;AAHa,aADvB;;AAAA;AACQC,UAAAA,IADR;AAMQC,UAAAA,IANR,GAMeD,IAAI,CAACE,OAAL,CAAaC,KAAb,EANf;;AAAA,gBAOMH,IAAI,CAACI,MAAL,CAAYC,UAAZ,GAAyB,CAP/B;AAAA;AAAA;AAAA;;AAQUC,UAAAA,QARV,GAQqB,EARrB;;AASI,eAASC,CAAT,GAAaP,IAAI,CAACI,MAAL,CAAYC,UAAzB,EAAqCE,CAAC,GAAG,CAAzC,EAA4CA,CAAC,IAAI,CAAjD,EAAoD;AAClDD,YAAAA,QAAQ,CAACE,IAAT,CACEZ,EAAE,mBACGE,MADH;AAEAD,cAAAA,OAAO,EAAPA,OAFA;AAGAE,cAAAA,IAAI,EAAEQ;AAHN,eADJ;AAOD;;AAjBL;AAAA,0CAkBWE,OAAO,CAACC,GAAR,CAAYJ,QAAZ,CAlBX;;AAAA;AAAA,wBAkByC,UAACK,MAAD,EAASC,IAAT,EAAkB;AACrDD,YAAAA,MAAM,CAACH,IAAP,OAAAG,MAAM,qBAASC,IAAI,CAACV,OAAd,EAAN;AACA,mBAAOS,MAAP;AACD,WArBL;;AAAA,wBAqBOV,IArBP;;AAAA,wBAkBkCY,MAlBlC;;AAAA;AAAA,2CAuBSZ,IAvBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA0BA,SAAea,WAAf,CAA2BlB,EAA3B,EAA+BC,OAA/B,EAAwCC,MAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AACMiB,UAAAA,YADN,GACqB,CADrB;AAEMV,UAAAA,UAFN,GAEmB,CAFnB;AAGQJ,UAAAA,IAHR,GAGe,EAHf;;AAAA;AAAA,gBAKSc,YAAY,GAAGV,UALxB;AAAA;AAAA;AAAA;;AAMIU,UAAAA,YAAY,IAAI,CAAhB;AANJ;AAAA,0CAOuBnB,EAAE,mBAChBE,MADgB;AAEnBD,YAAAA,OAAO,EAAPA,OAFmB;AAGnBE,YAAAA,IAAI,EAAEgB;AAHa,aAPzB;;AAAA;AAOUf,UAAAA,IAPV;;AAYI;AACAK,UAAAA,UAAU,GAAGL,IAAI,CAACI,MAAL,CAAYC,UAAzB;AACAJ,UAAAA,IAAI,CAACO,IAAL,OAAAP,IAAI,qBAASD,IAAI,CAACE,OAAd,EAAJ;AAdJ;AAAA;;AAAA;AAAA,4CAgBSD,IAhBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmBe,SAAee,SAAf,CACbpB,EADa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,4EAEqC,EAFrC;AAAA,8BAEXC,OAFW,EAEXA,OAFW,6BAED,KAFC,sCAEMoB,QAFN,EAEMA,QAFN,8BAEiB,IAFjB,kBAE0BnB,MAF1B;AAAA,4CAINmB,QAAQ,GACXtB,aAAa,CAACC,EAAD,EAAKC,OAAL,EAAcC,MAAd,CADF,GAEXgB,WAAW,CAAClB,EAAD,EAAKC,OAAL,EAAcC,MAAd,CANF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["async function parallelFetch(fn, perPage, params) {\n  const data = await fn({\n    ...params,\n    perPage,\n    page: 1,\n  });\n  const list = data.records.slice();\n  if (data.paging.totalPages > 1) {\n    const promises = [];\n    for (let i = data.paging.totalPages; i > 1; i -= 1) {\n      promises.push(\n        fn({\n          ...params,\n          perPage,\n          page: i,\n        }),\n      );\n    }\n    (await Promise.all(promises)).reduce((output, item) => {\n      output.push(...item.records);\n      return output;\n    }, list);\n  }\n  return list;\n}\n\nasync function serialFetch(fn, perPage, params) {\n  let fetchedPages = 0;\n  let totalPages = 1;\n  const list = [];\n\n  while (fetchedPages < totalPages) {\n    fetchedPages += 1;\n    const data = await fn({\n      ...params,\n      perPage,\n      page: fetchedPages,\n    });\n    /* eslint { \"prefer-destructuring\": 0 } */\n    totalPages = data.paging.totalPages;\n    list.push(...data.records);\n  }\n  return list;\n}\n\nexport default async function fetchList(\n  fn,\n  { perPage = 'MAX', parallel = true, ...params } = {},\n) {\n  return parallel\n    ? parallelFetch(fn, perPage, params)\n    : serialFetch(fn, perPage, params);\n}\n"],"file":"fetchList.js"}