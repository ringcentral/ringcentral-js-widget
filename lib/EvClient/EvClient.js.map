{"version":3,"sources":["lib/EvClient/EvClient.ts"],"names":["EvClient","name","deps","_sdk","_onOpen","_onClose","_Sdk","AgentLibrary","_options","_eventEmitter","EventEmitter","_callbacks","_deps","evClientOptions","options","callbacks","closeResponse","openResponse","res","setAppStatus","evStatus","CONNECTED","emit","EvCallbackTypes","OPEN_SOCKET","terminateStats","CLOSED","CLOSE_SOCKET","window","localStorage","authHost","getItem","type","listener","addListener","once","removeListener","Promise","resolve","loadCurrentCall","status","appStatus","setItem","location","reload","console","log","Sdk","ACK","eventType","callback","_callback","setCallbacks","getCallback","getRefreshedToken","engageAccessToken","LOGIN","authenticateAgentWithEngageAccessToken","response","dialDest","queueIds","chatIds","skillProfileId","dialGroupId","updateFromAdminUI","isForce","loginAgent","messageTypes","CONFIGURE_AGENT","data","dispId","notes","callbackDTS","leadId","requestId","externId","dispositionManualPass","uii","contactForwardNumber","survey","dispositionCall","decodeUii","rcAccessToken","tokenType","authenticateAgentWithRcAccessToken","accessToken","LOGINED","_agents","agents","map","agent","agentId","addListenerByOnce","openSocket","getAgentConfig","authenticateAgent","timeout","onTimeout","authenticateResponse","EvTypeError","CONNECT_TIMEOUT","message","CONNECT_ERROR","length","NO_AGENT","UNEXPECTED_AGENT","hasSupportWebSocket","INVALID_BROWSER","on","LOGIN_PHASE_1","openSocketResult","error","OPEN_SOCKET_ERROR","agentConfig","AGENT_LOGIN","closeSocket","sessionId","resetPendingDisp","hangup","logoutAgent","result","destination","callerId","ringTime","countryId","queueId","manualOutdial","offhookInit","offhookTerm","holdState","hold","state","holdSession","sipHeaders","reject","coldXfer","warmXfer","internationalColdXfer","internationalWarmXfer","warmXferCancel","skillId","maintain","requeueCall","directAgentXferList","_encodeSymbol","encodeUii","split","rejectDirectAgentXfer","targetAgentId","coldDirectAgentXfer","warmDirectAgentXfer","voicemailDirectAgentXfer","cancelDirectAgentXfer","agentState","agentAuxState","setAgentState","multiLoginRequest","GENERIC_NOTIFICATION","messageCode","_multiLoginRequest","rej","Error","sipInit","sipAnswer","sipRegister","sipTerminate","sipHangUp","sipReject","dtmf","sipSendDTMF","sipToggleMute","scriptId","version","getScript","jsonResult","saveScriptResult","fn","e","EvMessageTypes","SCRIPT_RESULT","knowledgeBaseGroupIds","uiModel","_getUIModel","getInstance","HttpService","_HttpService","agentSettings","getAgentSettings","authenticateRequest","httpGet","accountId","headers","Authorization","queryParams","guid","JSON","parse","getCurrentCall","RcModuleV2","START","action"],"mappings":"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","sourcesContent":["import { action, RcModuleV2, state } from '@ringcentral-integration/core';\n// eslint-disable-next-line import/no-unresolved\nimport AgentLibrary from '@SDK';\nimport EventEmitter from 'events';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport { raceTimeout } from 'ringcentral-integration/lib/raceTimeout';\nimport sleep from 'ringcentral-integration/lib/sleep';\n\nimport { messageTypes } from '../../enums';\nimport { _encodeSymbol } from '../constant';\nimport { EvTypeError } from '../EvTypeError';\nimport { EvMessageTypes, evStatus } from './enums';\nimport { EvCallbackTypes } from './enums/callbackTypes';\nimport {\n  Deps,\n  EvACKResponse,\n  EvAddSessionNotification,\n  EvAgentConfig,\n  EvAgentInfo,\n  EvAgentOptions,\n  EvAgentScriptResult,\n  EvAgentSettings,\n  EvAuthenticateAgentWithEngageAccessTokenRes,\n  EvAuthenticateAgentWithRcAccessTokenRes,\n  EvBaseCall,\n  EvClientCallMapping,\n  EvColdTransferCallResponse,\n  EvColdTransferIntlCallResponse,\n  EvConfigureAgentOptions,\n  EvDirectAgentListResponse,\n  EvDispositionCallOptions,\n  EvDispositionManualPassOptions,\n  EvLogoutAgentResponse,\n  EvMessageRes,\n  EvOpenSocketResult,\n  EvRequeueCallResponse,\n  EvRequeueOption,\n  EvScriptResponse,\n  EvTokenType,\n  EvWarmTransferCallResponse,\n  EvWarmTransferIntlCallResponse,\n} from './interfaces';\n\ntype ListenerType = typeof EvCallbackTypes['OPEN_SOCKET' | 'CLOSE_SOCKET'];\n\ntype Listener<\n  T extends keyof EvClientCallMapping,\n  U extends EvClientCallMapping = EvClientCallMapping\n> = (res: U[T]) => void;\n\nexport type EvClientTransferParams = {\n  dialDest: string;\n  callerId?: string;\n  sipHeaders?: string[];\n  countryId?: string;\n};\n\nexport type EvClientHandUpParams = {\n  sessionId: string;\n  resetPendingDisp?: boolean;\n};\n\nexport type EvClientHoldSessionParams = {\n  state: boolean;\n  sessionId: string;\n};\n\nexport type EvClientManualOutdialParams = {\n  destination: string;\n  callerId: string;\n  ringTime: number;\n  queueId: string;\n  countryId: string;\n};\n\n@Module({\n  name: 'EvClient',\n  deps: ['EvClientOptions'],\n})\nclass EvClient extends RcModuleV2<Deps> {\n  /** SDK instance */\n  private _sdk: any;\n\n  private _onOpen: (response: EvClientCallMapping['openResponse']) => void;\n\n  private _onClose: () => void;\n\n  private _Sdk = AgentLibrary;\n\n  private _options: EvAgentOptions;\n\n  private _eventEmitter = new EventEmitter();\n\n  private _callbacks: Record<string, Function> = {};\n\n  @state\n  appStatus: string = evStatus.START;\n\n  constructor(deps: Deps) {\n    super({ deps });\n    this._options = this._deps.evClientOptions.options;\n    const {\n      closeResponse,\n      openResponse,\n    } = this._deps.evClientOptions.callbacks;\n    this._onOpen = (res) => {\n      this.setAppStatus(evStatus.CONNECTED);\n      openResponse(res);\n      this._eventEmitter.emit(EvCallbackTypes.OPEN_SOCKET, res);\n      // ensure for WebSocket keep-alive connection\n      this._sdk.terminateStats();\n    };\n    this._onClose = () => {\n      this.setAppStatus(evStatus.CLOSED);\n      closeResponse();\n      this._eventEmitter.emit(EvCallbackTypes.CLOSE_SOCKET);\n    };\n    // Used for toggle auth host about Engage Voice backend.\n    if (window.localStorage) {\n      const authHost = window.localStorage.getItem('__authHost__');\n      if (authHost) {\n        this._options.authHost = authHost;\n      }\n    }\n  }\n\n  addListener<T extends ListenerType>(type: T, listener: Listener<T>) {\n    this._eventEmitter.addListener(type, listener);\n  }\n\n  addListenerByOnce<T extends ListenerType>(type: T, listener: Listener<T>) {\n    this._eventEmitter.once(type, listener);\n  }\n\n  removeListener<T extends ListenerType>(\n    type: ListenerType,\n    listener: Listener<T>,\n  ) {\n    this._eventEmitter.removeListener(type, listener);\n  }\n\n  loadCurrentCall() {\n    return new Promise<EvBaseCall | void>((resolve) => {\n      this._sdk.loadCurrentCall(resolve);\n    });\n  }\n\n  get currentCall(): EvBaseCall {\n    return this._sdk.getCurrentCall();\n  }\n\n  @action\n  setAppStatus(status: string) {\n    this.appStatus = status;\n  }\n\n  setEnv(authHost: string) {\n    if (window.localStorage) {\n      window.localStorage.setItem('__authHost__', authHost);\n      window.location.reload();\n    }\n  }\n\n  setSIPNoLog(authHost: string) {\n    if (window.localStorage) {\n      window.localStorage.setItem('__SIP_NO_LOG__', authHost);\n      window.location.reload();\n    }\n  }\n\n  initSDK() {\n    console.log('initSDK');\n    const { _Sdk: Sdk } = this;\n    this._sdk = new Sdk({\n      callbacks: {\n        ...this._callbacks,\n        [EvCallbackTypes.CLOSE_SOCKET]: this._onClose,\n        [EvCallbackTypes.OPEN_SOCKET]: this._onOpen,\n        [EvCallbackTypes.ACK]: (res: EvACKResponse) => {\n          this._eventEmitter.emit(EvCallbackTypes.ACK, res);\n        },\n      },\n      ...this._options,\n    });\n  }\n\n  on(eventType: string, callback: (...args: any[]) => void) {\n    const _callback = {\n      [eventType]: (...args: any[]) => callback(...args),\n    };\n\n    this._sdk.setCallbacks(_callback);\n    this._callbacks = {\n      ...this._callbacks,\n      ..._callback,\n    };\n  }\n\n  getEventCallback(eventType: string) {\n    return this._sdk.getCallback(eventType);\n  }\n\n  getRefreshedToken() {\n    this._sdk.getRefreshedToken();\n  }\n\n  authenticateAgentWithEngageAccessToken(engageAccessToken: string) {\n    return new Promise<EvAuthenticateAgentWithEngageAccessTokenRes>(\n      (resolve) => {\n        this.setAppStatus(evStatus.LOGIN);\n        this._sdk.authenticateAgentWithEngageAccessToken(\n          engageAccessToken,\n          (response: EvAuthenticateAgentWithEngageAccessTokenRes) => {\n            resolve(response);\n          },\n        );\n      },\n    );\n  }\n\n  configureAgent({\n    dialDest,\n    queueIds,\n    chatIds,\n    skillProfileId,\n    dialGroupId,\n    updateFromAdminUI = false,\n    isForce = false,\n  }: EvConfigureAgentOptions) {\n    return new Promise<EvMessageRes>((resolve) => {\n      this._sdk.loginAgent(\n        dialDest,\n        queueIds,\n        chatIds,\n        skillProfileId,\n        dialGroupId,\n        updateFromAdminUI,\n        isForce,\n        (res: any) => {\n          resolve({\n            type: messageTypes.CONFIGURE_AGENT,\n            data: res,\n          });\n        },\n      );\n    });\n  }\n\n  dispositionManualPass({\n    dispId,\n    notes,\n    callbackDTS,\n    leadId,\n    requestId,\n    externId,\n  }: EvDispositionManualPassOptions) {\n    return new Promise<EvDispositionManualPassOptions>((resolve) => {\n      this._sdk.dispositionManualPass(\n        dispId,\n        notes,\n        (response: EvDispositionManualPassOptions) => {\n          resolve(response);\n        },\n        callbackDTS,\n        leadId,\n        requestId,\n        externId,\n      );\n    });\n  }\n\n  dispositionCall({\n    uii,\n    dispId = '',\n    notes = '',\n    callback,\n    callbackDTS,\n    contactForwardNumber,\n    survey,\n    externId,\n    leadId,\n    requestId = '',\n  }: EvDispositionCallOptions) {\n    return this._sdk.dispositionCall(\n      this.decodeUii(uii),\n      dispId,\n      notes,\n      callback,\n      callbackDTS,\n      contactForwardNumber,\n      survey,\n      externId,\n      leadId,\n      requestId,\n    );\n  }\n\n  authenticateAgent(rcAccessToken: string, tokenType: EvTokenType) {\n    return new Promise<EvAuthenticateAgentWithRcAccessTokenRes>((resolve) => {\n      this.setAppStatus(evStatus.LOGIN);\n      this._sdk.authenticateAgentWithRcAccessToken(\n        rcAccessToken,\n        tokenType,\n        async (res: EvAuthenticateAgentWithRcAccessTokenRes) => {\n          // here just auth with engage access token, not need handle response data, that handle by Agent SDK.\n          await this.authenticateAgentWithEngageAccessToken(res.accessToken);\n\n          this.setAppStatus(evStatus.LOGINED);\n          const _agents = (res || {}).agents || [];\n          const agents = _agents.map((agent) => ({\n            ...agent,\n            agentId: agent && agent.agentId ? `${agent.agentId}` : '',\n          }));\n          resolve({\n            ...res,\n            agents,\n          });\n        },\n      );\n    });\n  }\n\n  openSocket(agentId: string) {\n    return new Promise<EvOpenSocketResult>((resolve) => {\n      this.addListenerByOnce(EvCallbackTypes.OPEN_SOCKET, (res) => {\n        resolve(res);\n      });\n      this._sdk.openSocket(agentId);\n    });\n  }\n\n  getAgentConfig() {\n    return new Promise<EvAgentConfig>((resolve) => {\n      this._sdk.getAgentConfig((res: EvAgentConfig) => {\n        resolve(res);\n      });\n    });\n  }\n\n  async loginAgent(\n    rcAccessToken: string,\n    tokenType: EvTokenType,\n  ): Promise<EvAgentInfo> {\n    const authenticateResponse = await raceTimeout(\n      this.authenticateAgent(rcAccessToken, tokenType),\n      {\n        timeout: 120 * 1000,\n        onTimeout: (resolve) => resolve(null),\n      },\n    );\n    if (!authenticateResponse) {\n      throw new EvTypeError({\n        type: messageTypes.CONNECT_TIMEOUT,\n      });\n    }\n    if (\n      authenticateResponse.type === 'Authenticate Error' ||\n      authenticateResponse.message\n    ) {\n      throw new EvTypeError({\n        type: messageTypes.CONNECT_ERROR,\n        data: authenticateResponse.message,\n      });\n    }\n    if (\n      !authenticateResponse ||\n      !authenticateResponse.agents ||\n      !authenticateResponse.agents.length\n    ) {\n      throw new EvTypeError({\n        type: messageTypes.NO_AGENT,\n      });\n    }\n    if (\n      !authenticateResponse.agents[0] ||\n      !authenticateResponse.agents[0].agentId\n    ) {\n      throw new EvTypeError({\n        type: messageTypes.UNEXPECTED_AGENT,\n      });\n    }\n    const agentId = authenticateResponse.agents[0].agentId;\n    const hasSupportWebSocket = 'WebSocket' in window;\n    if (!hasSupportWebSocket) {\n      throw new EvTypeError({\n        type: messageTypes.INVALID_BROWSER,\n      });\n    }\n\n    // TODO: here need check time when no message come back, that will block app.\n    const getAgentConfig = new Promise<EvAgentConfig>((resolve) => {\n      this.on(EvCallbackTypes.LOGIN_PHASE_1, (...args) => resolve(...args));\n    });\n    const openSocketResult = await this.openSocket(agentId);\n    // wait for socketOpened\n    // Because instance.socket Opened(); was performed after callback.\n    await sleep(0);\n    if (openSocketResult.error) {\n      throw new EvTypeError({\n        type: messageTypes.OPEN_SOCKET_ERROR,\n      });\n    }\n\n    const agentConfig = await getAgentConfig;\n    // prevent that the WebSocket instance disconnects by server side.\n    return {\n      type: messageTypes.AGENT_LOGIN,\n      data: {\n        authenticateResponse,\n        agentConfig,\n      },\n    };\n  }\n\n  /**\n   * when manual close socket, that closeSocket will auto reconnected by agent SDK\n   */\n  closeSocket() {\n    this._sdk.closeSocket();\n  }\n\n  hangup({ sessionId, resetPendingDisp = false }: EvClientHandUpParams) {\n    return this._sdk.hangup(sessionId, resetPendingDisp);\n  }\n\n  logoutAgent(agentId: string) {\n    return new Promise<EvLogoutAgentResponse>((resolve) => {\n      this._sdk.logoutAgent(agentId, (result: EvLogoutAgentResponse) => {\n        resolve(result);\n      });\n    });\n  }\n\n  manualOutdial({\n    destination,\n    callerId,\n    ringTime,\n    countryId,\n    queueId,\n  }: EvClientManualOutdialParams) {\n    return this._sdk.manualOutdial(\n      destination,\n      callerId,\n      ringTime,\n      countryId,\n      queueId,\n    );\n  }\n\n  offhookInit() {\n    // we using EvCallbackTypes.OFFHOOK_INIT to catch data, do not pass callback,\n    // that will make the message not come back\n    this._sdk.offhookInit();\n  }\n\n  offhookTerm() {\n    this._sdk.offhookTerm();\n  }\n\n  hold(holdState: boolean) {\n    this._sdk.hold(holdState);\n  }\n\n  holdSession({ state, sessionId }: EvClientHoldSessionParams) {\n    this._sdk.holdSession(state, sessionId);\n  }\n\n  coldTransferCall({\n    dialDest,\n    callerId = '',\n    sipHeaders = [],\n  }: EvClientTransferParams) {\n    return new Promise<EvColdTransferCallResponse>((resolve, reject) => {\n      this._sdk.coldXfer(\n        dialDest,\n        callerId,\n        sipHeaders,\n        (data: EvColdTransferCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  warmTransferCall({\n    dialDest,\n    callerId = '',\n    sipHeaders = [],\n  }: EvClientTransferParams) {\n    return new Promise<EvWarmTransferCallResponse>((resolve, reject) => {\n      this._sdk.warmXfer(\n        dialDest,\n        callerId,\n        sipHeaders,\n        (data: EvWarmTransferCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  coldTransferIntlCall({\n    dialDest,\n    callerId = '',\n    sipHeaders = [],\n    countryId = '',\n  }: EvClientTransferParams) {\n    return new Promise<EvColdTransferIntlCallResponse>((resolve, reject) => {\n      this._sdk.internationalColdXfer(\n        dialDest,\n        callerId,\n        sipHeaders,\n        countryId,\n        (data: EvColdTransferIntlCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  warmTransferIntlCall({\n    dialDest,\n    callerId = '',\n    sipHeaders = [],\n    countryId = '',\n  }: EvClientTransferParams) {\n    return new Promise<EvWarmTransferIntlCallResponse>((resolve, reject) => {\n      this._sdk.internationalWarmXfer(\n        dialDest,\n        callerId,\n        sipHeaders,\n        countryId,\n        (data: EvWarmTransferIntlCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  cancelWarmTransferCall(dialDest: string) {\n    this._sdk.warmXferCancel(dialDest);\n  }\n\n  requeueCall({ queueId, skillId = '', maintain = false }: EvRequeueOption) {\n    return new Promise<EvRequeueCallResponse>((resolve, reject) => {\n      this._sdk.requeueCall(\n        queueId,\n        skillId,\n        maintain,\n        (data: EvRequeueCallResponse) => {\n          if (data.status === 'OK') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n        },\n      );\n    });\n  }\n\n  fetchDirectAgentList() {\n    return new Promise<EvDirectAgentListResponse>((resolve) => {\n      this._sdk.directAgentXferList((data: EvDirectAgentListResponse) => {\n        resolve(data);\n      });\n    });\n  }\n\n  encodeUii({ uii, sessionId }: Partial<EvAddSessionNotification>) {\n    return `${uii}${_encodeSymbol}${sessionId}`;\n  }\n\n  /**\n   * replace sessionId with _encodeSymbol when ringing\n   * @param _encodeSymbol '$'\n   */\n  encodeRingingUii({ uii }: EvBaseCall) {\n    return this.encodeUii({\n      uii: this.decodeUii(uii),\n      sessionId: _encodeSymbol,\n    });\n  }\n\n  decodeUii(uii: string) {\n    return uii.split(_encodeSymbol)[0];\n  }\n\n  /**\n   * get a main call session in some call session with some uii\n   * @param uii call uii\n   */\n  getMainId(uii: string) {\n    return this.encodeUii({\n      sessionId: '1',\n      uii,\n    });\n  }\n\n  rejectDirectAgentTransferCall(uii: string) {\n    this._sdk.rejectDirectAgentXfer(this.decodeUii(uii));\n  }\n\n  coldDirectAgentTransfer(targetAgentId: string) {\n    this._sdk.coldDirectAgentXfer(targetAgentId);\n  }\n\n  warmDirectAgentTransfer(targetAgentId: string) {\n    this._sdk.warmDirectAgentXfer(targetAgentId);\n  }\n\n  sendVoicemailDirectAgentTransfer(targetAgentId: string) {\n    this._sdk.voicemailDirectAgentXfer(targetAgentId);\n  }\n\n  cancelDirectAgentTransfer(targetAgentId: string) {\n    this._sdk.cancelDirectAgentXfer(targetAgentId);\n  }\n\n  setAgentState(agentState: string, agentAuxState: string) {\n    return this._sdk.setAgentState(agentState, agentAuxState);\n  }\n\n  private _multiLoginRequest() {\n    return new Promise<any>((resolve, reject) => {\n      this._sdk.multiLoginRequest();\n      this.on(EvCallbackTypes.LOGIN, (data) => {\n        if (data.status === 'SUCCESS') {\n          resolve(data);\n        } else {\n          reject(data);\n        }\n      });\n      this.on(EvCallbackTypes.GENERIC_NOTIFICATION, (data) => {\n        if (data.messageCode === '-99') {\n          reject(data);\n        }\n      });\n    });\n  }\n\n  async multiLoginRequest() {\n    // temp solution, and wait for ev backend enhancement.\n    try {\n      await raceTimeout(this._multiLoginRequest(), {\n        onTimeout: (res, rej) => rej(),\n      });\n    } catch (error) {\n      throw new Error('_multiLoginRequest fail or 30s timeout');\n    }\n  }\n\n  /**\n   * WebRTC related method\n   */\n  sipInit() {\n    this._sdk.sipInit();\n  }\n\n  sipAnswer() {\n    this._sdk.sipAnswer();\n  }\n\n  sipRegister() {\n    this._sdk.sipRegister();\n  }\n\n  sipTerminate() {\n    this._sdk.sipTerminate();\n  }\n\n  sipHangUp() {\n    this._sdk.sipHangUp();\n  }\n\n  sipReject() {\n    this._sdk.sipReject();\n  }\n\n  sipSendDTMF(dtmf: string) {\n    this._sdk.sipSendDTMF(dtmf);\n  }\n\n  sipToggleMute(state: boolean) {\n    this._sdk.sipToggleMute(state);\n  }\n\n  /**\n   * AgentScript related method\n   */\n  getScript(scriptId: string, version: string) {\n    return new Promise<EvScriptResponse>((resolve, reject) => {\n      this._sdk.getScript(scriptId, version, (res: EvScriptResponse) => {\n        if (res.status) {\n          resolve(res);\n        }\n      });\n    });\n  }\n\n  async saveScriptResult(\n    uii: string,\n    scriptId: string,\n    jsonResult: EvAgentScriptResult,\n  ) {\n    let fn: (e: EvACKResponse) => void;\n\n    const res = await raceTimeout(\n      new Promise<EvACKResponse>((resolve) => {\n        this._sdk.saveScriptResult(uii, scriptId, jsonResult);\n\n        fn = (e: EvACKResponse) => {\n          if (e.type === EvMessageTypes.SCRIPT_RESULT) {\n            resolve(e);\n            this._eventEmitter.removeListener(EvCallbackTypes.ACK, fn);\n          }\n        };\n        this._eventEmitter.on(EvCallbackTypes.ACK, fn);\n      }),\n      {\n        timeout: 5 * 1000,\n        onTimeout: (resolve) => resolve(null),\n      },\n    );\n\n    if (!res) {\n      this._eventEmitter.removeListener(EvCallbackTypes.ACK, fn);\n      throw new Error('saveScriptResult fail');\n    }\n    return res;\n  }\n\n  /**\n   * GET - /voice/api/v1/agent/:accountId/knowledgeBaseGroups\n      params:\n      accountId: AgentSvc.agentSettings.accountId,\n      guid: AgentSvc.agentSettings.guid,\n      knowledgeBaseGroupIds: knowledgeBaseGroupIds\n\n      knowledgeBaseGroupIds = comma list of all groups you care about\n   */\n  async getKnowledgeBaseGroups(knowledgeBaseGroupIds: number[]) {\n    this.getRefreshedToken();\n\n    const uiModel = this._sdk._getUIModel().getInstance();\n    const HttpService = this._sdk._HttpService;\n\n    const agentSettings: EvAgentSettings = this._sdk.getAgentSettings();\n    const engageAccessToken = `Bearer ${uiModel.authenticateRequest.engageAccessToken}`;\n\n    try {\n      const { status, response } = await new HttpService(\n        `${uiModel.authHost}/voice/api/v1/`,\n      ).httpGet(`agent/${agentSettings.accountId}/knowledgeBaseGroups`, {\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: engageAccessToken,\n        },\n        queryParams: {\n          guid: agentSettings.guid,\n          knowledgeBaseGroupIds,\n        },\n      });\n\n      if (status === 200) {\n        return JSON.parse(response);\n      }\n    } catch (error) {\n      console.log('getKnowledgeBaseGroups fail');\n    }\n    return null;\n  }\n}\n\nexport { EvClient };\n"],"file":"EvClient.js"}