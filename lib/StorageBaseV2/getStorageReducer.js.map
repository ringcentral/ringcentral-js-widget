{"version":3,"sources":["lib/StorageBaseV2/getStorageReducer.ts"],"names":["calculateInitialState","reducers","initialState","key","undefined","getDataReducer","types","state","action","type","initSuccess","data","sync","value","resetSuccess","newState","hasChange"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,SAASA,qBAAT,CAA+BC,QAA/B,EAA4D;AAC1D,MAAMC,YAAqC,GAAG,EAA9C;AACA;;AACA,OAAK,IAAMC,GAAX,IAAkBF,QAAlB,EAA4B;AAC1BC,IAAAA,YAAY,CAACC,GAAD,CAAZ,GAAoBF,QAAQ,CAACE,GAAD,CAAR,CAAcC,SAAd,EAAyB,EAAzB,CAApB;AACD;;AACD,SAAOF,YAAP;AACD;;AAEM,SAASG,cAAT,OAMK;AAAA,MALVC,KAKU,QALVA,KAKU;AAAA,MAJVL,QAIU,QAJVA,QAIU;AACV,SAAO,YAAqD;AAAA,QAApDM,KAAoD,uEAA5CP,qBAAqB,CAACC,QAAD,CAAuB;AAAA,QAAXO,MAAW;;AAC1D,YAAQA,MAAM,CAACC,IAAf;AACE,WAAKH,KAAK,CAACI,WAAX;AACE,eAAOF,MAAM,CAACG,IAAd;;AACF,WAAKL,KAAK,CAACM,IAAX;AACE,+CACKL,KADL,2BAEGC,MAAM,CAACL,GAFV,EAEgBK,MAAM,CAACK,KAFvB;;AAIF,WAAKP,KAAK,CAACQ,YAAX;AAAyB;AACvB,cAAMC,QAAiC,GAAG,EAA1C,CADuB,CAEvB;;AACA;;AACA,eAAK,IAAMZ,GAAX,IAAkBF,QAAlB,EAA4B;AAC1Bc,YAAAA,QAAQ,CAACZ,GAAD,CAAR,GAAgBF,QAAQ,CAACE,GAAD,CAAR,CAAcC,SAAd,EAAyBI,MAAzB,CAAhB;AACD;;AACD,iBAAOO,QAAP;AACD;;AACD;AAAS;AACP,cAAMA,SAAiC,GAAG,EAA1C;AACA,cAAIC,SAAS,GAAG,KAAhB,CAFO,CAGP;;AACA;;AACA,eAAK,IAAMb,IAAX,IAAkBF,QAAlB,EAA4B;AAC1Bc,YAAAA,SAAQ,CAACZ,IAAD,CAAR,GAAgBF,QAAQ,CAACE,IAAD,CAAR,CAAcI,KAAK,CAACJ,IAAD,CAAnB,EAA0BK,MAA1B,CAAhB;AACA,gBAAIO,SAAQ,CAACZ,IAAD,CAAR,KAAkBI,KAAK,CAACJ,IAAD,CAA3B,EAAkCa,SAAS,GAAG,IAAZ;AACnC;;AACD,iBAAOA,SAAS,GAAGD,SAAH,GAAcR,KAA9B;AACD;AA3BH;AA6BD,GA9BD;AA+BD","sourcesContent":["import { ReducersMapObject, Reducer } from 'redux';\nimport { ActionTypesBase } from './actionTypesBase';\n\nfunction calculateInitialState(reducers: ReducersMapObject) {\n  const initialState: Record<string, unknown> = {};\n  /* eslint-disable guard-for-in */\n  for (const key in reducers) {\n    initialState[key] = reducers[key](undefined, {} as any);\n  }\n  return initialState;\n}\n\nexport function getDataReducer({\n  types,\n  reducers,\n}: {\n  types: ActionTypesBase;\n  reducers: ReducersMapObject;\n}): Reducer {\n  return (state = calculateInitialState(reducers), action) => {\n    switch (action.type) {\n      case types.initSuccess:\n        return action.data;\n      case types.sync:\n        return {\n          ...state,\n          [action.key]: action.value,\n        };\n      case types.resetSuccess: {\n        const newState: Record<string, unknown> = {};\n        // reset the data to initial states\n        /* eslint-disable guard-for-in */\n        for (const key in reducers) {\n          newState[key] = reducers[key](undefined, action);\n        }\n        return newState;\n      }\n      default: {\n        const newState: Record<string, unknown> = {};\n        let hasChange = false;\n        // compute new sub states and check for changes\n        /* eslint-disable guard-for-in */\n        for (const key in reducers) {\n          newState[key] = reducers[key](state[key], action);\n          if (newState[key] !== state[key]) hasChange = true;\n        }\n        return hasChange ? newState : state;\n      }\n    }\n  };\n}\n"],"file":"getStorageReducer.js"}