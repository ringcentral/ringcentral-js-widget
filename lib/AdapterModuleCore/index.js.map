{"version":3,"sources":["lib/AdapterModuleCore/index.js"],"names":["ALL_CALL_PATH","ACTIVE_CALL_PATH","AdapterModuleCore","deps","dep","optional","prefix","storageKey","actionTypes","baseActionTypes","callingSettings","globalStorage","locale","presence","routerInteraction","webphone","callMonitor","userGuide","quickAccess","messageTransport","IframeMessageTransport","targetWindow","window","parent","options","_callingSettings","_webphone","_callMonitor","_userGuide","_quickAccess","_pushRingState","forcePush","ready","_postMessage","type","_messageTypes","pushLocale","strings","localeStrings","callingMode","callingModes","_pushWebRTCRingingState","_pushCallStartTime","_pushIncomingCallPage","_pushRingoutRingingState","Error","ringSession","ringSessionId","_ringSessionId","pushRingState","ringing","ringingSessions","sessions","filter","session","callStatus","direction","length","status","_presence","telephonyStatus","_telephonyStatus","_showIncomingCallPage","minimized","_lastPath","_router","currentPath","_lastShowIncomingCallPage","onCurrentCallPath","activeSessionId","pushOnCurrentCallPath","onAllCallsPath","pushOnAllCallsPath","ringingCallsLength","activeRingCalls","onHoldCallsLength","activeOnHoldCalls","currentStartTime","activeCurrentCalls","startTime","_lastRingCallsLength","_lastOnHoldCallsLength","_lastCurrentStartTime","pushCalls","currentSession","activeSession","currentCallPath","id","push","started","dismiss","entered","exit","toggleMinimized","AdapterModuleCoreBase","selector","_locale","currentLocale","localeReady","ringCallsInfo","headerI18n","getString","numberOf","onHoldCallsInfo","availableBtn","presenceItemI18n","presenceStatus","available","busyBtn","busy","offlineBtn","offline","doNotAcceptAnyCallsBtn","dndStatus","doNotAcceptAnyCalls","currentCallBtn","viewCallsBtn","proxify"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,aAAa,GAAG,QAAtB;AACA,IAAMC,gBAAgB,GAAG,eAAzB;IAgBqBC,iB,WAdpB,gBAAO;AACNC,EAAAA,IAAI,EAAE,CACJ,iBADI,EAEJ,eAFI,EAGJ,QAHI,EAIJ,UAJI,EAKJ,mBALI,EAMJ,SANI,EAOJ,UAPI,EAQJ,aARI,EASJ;AAAEC,IAAAA,GAAG,EAAE,WAAP;AAAoBC,IAAAA,QAAQ,EAAE;AAA9B,GATI,EAUJ;AAAED,IAAAA,GAAG,EAAE,aAAP;AAAsBC,IAAAA,QAAQ,EAAE;AAAhC,GAVI;AADA,CAAP,C;;;;;AAeC,mCAgCG;AAAA;;AAAA,QA/BDC,MA+BC,QA/BDA,MA+BC;AAAA,+BA9BDC,UA8BC;AAAA,QA9BDA,UA8BC,gCA9BY,aA8BZ;AAAA,gCA7BDC,WA6BC;AAAA,QA7BDA,WA6BC,iCA7BaC,2BA6Bb;AAAA,QA5BDC,eA4BC,QA5BDA,eA4BC;AAAA,QA3BDC,aA2BC,QA3BDA,aA2BC;AAAA,QA1BDC,MA0BC,QA1BDA,MA0BC;AAAA,QAzBDC,QAyBC,QAzBDA,QAyBC;AAAA,QAxBDC,iBAwBC,QAxBDA,iBAwBC;AAAA,QAvBDC,QAuBC,QAvBDA,QAuBC;AAAA,QAtBDC,WAsBC,QAtBDA,WAsBC;AAAA,QArBDC,SAqBC,QArBDA,SAqBC;AAAA,QApBDC,WAoBC,QApBDA,WAoBC;AAAA,qCAnBDC,gBAmBC;AAAA,QAnBDA,gBAmBC,sCAnBkB,IAAIC,kCAAJ,CAA2B;AAC5CC,MAAAA,YAAY,EAAEC,MAAM,CAACC;AADuB,KAA3B,CAmBlB;AAAA,QAhBEC,OAgBF;;AAAA;;AACD;AACElB,MAAAA,MAAM,EAANA,MADF;AAEEE,MAAAA,WAAW,EAAXA,WAFF;AAGEI,MAAAA,MAAM,EAANA,MAHF;AAIEO,MAAAA,gBAAgB,EAAhBA,gBAJF;AAKEN,MAAAA,QAAQ,EAARA,QALF;AAMEC,MAAAA,iBAAiB,EAAjBA,iBANF;AAOEH,MAAAA,aAAa,EAAbA,aAPF;AAQEJ,MAAAA,UAAU,EAAVA;AARF,OASKiB,OATL;;AADC;;AAaD,UAAKC,gBAAL,GAAwBf,eAAxB;AACA,UAAKgB,SAAL,GAAiBX,QAAjB;AACA,UAAKY,YAAL,GAAoBX,WAApB;AACA,UAAKY,UAAL,GAAkBX,SAAlB;AACA,UAAKY,YAAL,GAAoBX,WAApB;AAjBC;AAkBF;;;;6CAEwB;AACvB,WAAKY,cAAL;AACD;;;qCAE0C;AAAA,sFAAJ,EAAI;AAAA,kCAA1BC,SAA0B;AAAA,UAA1BA,SAA0B,gCAAd,KAAc;;AACzC,UAAI,CAAC,KAAKC,KAAV,EAAiB,OADwB,CAGzC;AACA;;AACA,UAAID,SAAJ,EAAe;AACb,aAAKE,YAAL,CAAkB;AAChBC,UAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBC,UADT;AAEhBC,UAAAA,OAAO,EAAE,KAAKC;AAFE,SAAlB;AAID;;AACD,UAAI,CAAC,KAAKb,gBAAV,EAA4B;AAXa,UAYjCc,WAZiC,GAYjB,KAAKd,gBAZY,CAYjCc,WAZiC;;AAazC,UAAIA,WAAW,KAAKC,yBAAazB,QAAjC,EAA2C;AACzC,aAAK0B,uBAAL,CAA6BV,SAA7B;;AACA,aAAKW,kBAAL,CAAwBX,SAAxB;;AACA,aAAKY,qBAAL,CAA2BZ,SAA3B;AACD,OAJD,MAIO;AACL,aAAKa,wBAAL;AACD;AACF;;;4CAEuBb,S,EAAW;AACjC,UAAMhB,QAAQ,GAAG,KAAKW,SAAtB;;AACA,UAAI,CAACX,QAAL,EAAe;AACb,cAAM,IAAI8B,KAAJ,CACJ,8DADI,CAAN;AAGD;;AACD,UACE9B,QAAQ,CAAC+B,WAAT,KACC/B,QAAQ,CAACgC,aAAT,KAA2B,KAAKC,cAAhC,IAAkDjB,SADnD,CADF,EAGE;AACA,aAAKiB,cAAL,GAAsBjC,QAAQ,CAACgC,aAA/B;;AACA,aAAKd,YAAL,CAAkB;AAChBC,UAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBc,aADT;AAEhBC,UAAAA,OAAO,EAAE;AAFO,SAAlB;AAID,OAhBgC,CAiBjC;;;AACA,UAAI,KAAKF,cAAT,EAAyB;AACvB,YAAMG,eAAe,GAAGpC,QAAQ,CAACqC,QAAT,CAAkBC,MAAlB,CACtB,UAACC,OAAD;AAAA,iBACEA,OAAO,CAACC,UAAR,KAAuB,6BAAvB,IACAD,OAAO,CAACE,SAAR,KAAsB,SAFxB;AAAA,SADsB,CAAxB;;AAKA,YAAIL,eAAe,CAACM,MAAhB,IAA0B,CAA9B,EAAiC;AAC/B,eAAKxB,YAAL,CAAkB;AAChBC,YAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBc,aADT;AAEhBC,YAAAA,OAAO,EAAE;AAFO,WAAlB;;AAIA,eAAKF,cAAL,GAAsB,IAAtB;AACD;AACF,OAbD,MAaO,IAAI,CAAC,KAAKA,cAAV,EAA0B;AAC/B,aAAKf,YAAL,CAAkB;AAChBC,UAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBc,aADT;AAEhBC,UAAAA,OAAO,EAAE;AAFO,SAAlB;AAID;AACF;;;+CAE0B;AACzB,UAAMQ,MAAM,GAAG,KAAKC,SAAL,CAAeC,eAA9B;;AACA,UAAI,KAAKD,SAAL,CAAeC,eAAf,KAAmC,KAAKC,gBAA5C,EAA8D;AAC5D,aAAK5B,YAAL,CAAkB;AAChBC,UAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBc,aADT;AAEhBC,UAAAA,OAAO,EAAEQ,MAAM,KAAK;AAFJ,SAAlB;;AAIA,aAAKG,gBAAL,GAAwBH,MAAxB;AACD;AACF;;;0CAEqB3B,S,EAAW;AAC/B,WAAK+B,qBAAL,GAA6B,CAAC,EAC5B,KAAKpC,SAAL,IACA,KAAKA,SAAL,CAAeoB,WADf,IAEA,CAAC,KAAKpB,SAAL,CAAeoB,WAAf,CAA2BiB,SAHA,CAA9B;;AAKA,UACEhC,SAAS,IACT,KAAKiC,SAAL,KAAmB,KAAKC,OAAL,CAAaC,WADhC,IAEA,KAAKC,yBAAL,KAAmC,KAAKL,qBAH1C,EAIE;AACA,aAAKE,SAAL,GAAiB,KAAKC,OAAL,CAAaC,WAA9B;AACA,aAAKC,yBAAL,GAAiC,KAAKL,qBAAtC;AACA,YAAMM,iBAAiB,GACrB,CAAC,KAAKH,OAAL,CAAaC,WAAb,KAA6BjE,gBAA7B,IACC,KAAKgE,OAAL,CAAaC,WAAb,eACKjE,gBADL,cACyB,KAAKyB,SAAL,CAAe2C,eADxC,CADF,KAGA,CAAC,KAAKP,qBAJR;;AAKA,YACE/B,SAAS,IACT,KAAKqC,iBAAL,KAA2BA,iBAD3B,IAEA,KAAKD,yBAAL,KAAmC,KAAKL,qBAH1C,EAIE;AACA,eAAKM,iBAAL,GAAyBA,iBAAzB;AACA,eAAKD,yBAAL,GAAiC,KAAKL,qBAAtC;;AACA,eAAK7B,YAAL,CAAkB;AAChBC,YAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBmC,qBADT;AAEhBF,YAAAA,iBAAiB,EAAjBA;AAFgB,WAAlB;AAID;;AACD,YAAMG,cAAc,GAClB,KAAKN,OAAL,CAAaC,WAAb,KAA6BlE,aAA7B,IACA,CAAC,KAAK8D,qBAFR;;AAGA,YAAI/B,SAAS,IAAI,KAAKwC,cAAL,KAAwBA,cAAzC,EAAyD;AACvD,eAAKA,cAAL,GAAsBA,cAAtB;;AACA,eAAKtC,YAAL,CAAkB;AAChBC,YAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBqC,kBADT;AAEhBD,YAAAA,cAAc,EAAdA;AAFgB,WAAlB;AAID;AACF;AACF;;;uCAEkBxC,S,EAAW;AAC5B,UAAM0C,kBAAkB,GAAG,KAAK9C,YAAL,CAAkB+C,eAAlB,CAAkCjB,MAA7D;AACA,UAAMkB,iBAAiB,GAAG,KAAKhD,YAAL,CAAkBiD,iBAAlB,CAAoCnB,MAA9D;AACA,UAAMoB,gBAAgB,GACnB,KAAKlD,YAAL,CAAkBmD,kBAAlB,IACC,KAAKnD,YAAL,CAAkBmD,kBAAlB,CAAqCrB,MAArC,GAA8C,CAD/C,IAEC,KAAK9B,YAAL,CAAkBmD,kBAAlB,CAAqC,CAArC,EAAwCC,SAF1C,IAGA,CAJF;;AAKA,UACEhD,SAAS,IACT,KAAKiD,oBAAL,KAA8BP,kBAD9B,IAEA,KAAKQ,sBAAL,KAAgCN,iBAFhC,IAGA,KAAKO,qBAAL,KAA+BL,gBAJjC,EAKE;AACA,aAAKG,oBAAL,GAA4BP,kBAA5B;AACA,aAAKQ,sBAAL,GAA8BN,iBAA9B;AACA,aAAKO,qBAAL,GAA6BL,gBAA7B;;AACA,aAAK5C,YAAL,CAAkB;AAChBC,UAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBgD,SADT;AAEhBV,UAAAA,kBAAkB,EAAlBA,kBAFgB;AAGhBE,UAAAA,iBAAiB,EAAjBA,iBAHgB;AAIhBE,UAAAA,gBAAgB,EAAhBA;AAJgB,SAAlB;;AAMA,aAAK5C,YAAL,CAAkB;AAChBC,UAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmBC,UADT;AAEhBC,UAAAA,OAAO,EAAE,KAAKC;AAFE,SAAlB;AAID;AACF;;;;;;;;;;AAyDO8C,gBAAAA,c,GAAiB,KAAK1D,SAAL,CAAe2D,a;;AACtC,oBAAID,cAAJ,EAAoB;AACZE,kBAAAA,eADY,aACSrF,gBADT,cAC6BmF,cAAc,CAACG,EAD5C;;AAElB,uBAAKtB,OAAL,CAAauB,IAAb,CAAkBF,eAAlB;AACD;;AACD,oBAAI,KAAK1D,UAAL,IAAmB,KAAKA,UAAL,CAAgB6D,OAAvC,EAAgD;AAC9C,uBAAK7D,UAAL,CAAgB8D,OAAhB;AACD;;AACD,oBAAI,KAAK7D,YAAL,IAAqB,KAAKA,YAAL,CAAkB8D,OAA3C,EAAoD;AAClD,uBAAK9D,YAAL,CAAkB+D,IAAlB;AACD;;AACD,oBACE,KAAKlE,SAAL,IACA,KAAKA,SAAL,CAAeoB,WADf,IAEA,CAAC,KAAKpB,SAAL,CAAeoB,WAAf,CAA2BiB,SAH9B,EAIE;AACA,uBAAKrC,SAAL,CAAemE,eAAf,CAA+B,KAAKnE,SAAL,CAAeoB,WAAf,CAA2ByC,EAA1D;AACD;;;;;;;;;;;;;;;;;;;;;;;;AAKD,qBAAKtB,OAAL,CAAauB,IAAb,CAAkBxF,aAAlB;;AACA,oBAAI,KAAK4B,UAAL,IAAmB,KAAKA,UAAL,CAAgB6D,OAAvC,EAAgD;AAC9C,uBAAK7D,UAAL,CAAgB8D,OAAhB;AACD;;AACD,oBAAI,KAAK7D,YAAL,IAAqB,KAAKA,YAAL,CAAkB8D,OAA3C,EAAoD;AAClD,uBAAK9D,YAAL,CAAkB+D,IAAlB;AACD;;AACD,oBACE,KAAKlE,SAAL,IACA,KAAKA,SAAL,CAAeoB,WADf,IAEA,CAAC,KAAKpB,SAAL,CAAeoB,WAAf,CAA2BiB,SAH9B,EAIE;AACA,uBAAKrC,SAAL,CAAemE,eAAf,CAA+B,KAAKnE,SAAL,CAAeoB,WAAf,CAA2ByC,EAA1D;AACD;;;;;;;;;;;;;;;;;;;EApS0CO,iC,iFA0M5CC,kB;;;;;;;WACe,CACd;AAAA,aAAM,MAAI,CAACC,OAAL,CAAahE,KAAnB;AAAA,KADc,EAEd;AAAA,aAAM,MAAI,CAACgE,OAAL,CAAaC,aAAnB;AAAA,KAFc,EAGd;AAAA,aAAM,MAAI,CAACtE,YAAL,CAAkB+C,eAAlB,CAAkCjB,MAAxC;AAAA,KAHc,EAId;AAAA,aAAM,MAAI,CAAC9B,YAAL,CAAkBiD,iBAAlB,CAAoCnB,MAA1C;AAAA,KAJc,EAKd,UAACyC,WAAD,EAAcD,aAAd,EAA6BxB,kBAA7B,EAAiDE,iBAAjD,EAAuE;AACrE,UAAMwB,aAAa,GACjB1B,kBAAkB,KAAK,CAAvB,GACI,+BAAc2B,iBAAWC,SAAX,CAAqB,cAArB,EAAqCJ,aAArC,CAAd,EAAmE;AACjEK,QAAAA,QAAQ,EAAE7B;AADuD,OAAnE,CADJ,GAII,+BACE2B,iBAAWC,SAAX,CAAqB,eAArB,EAAsCJ,aAAtC,CADF,EAEE;AAAEK,QAAAA,QAAQ,EAAE7B;AAAZ,OAFF,CALN;AASA,UAAM8B,eAAe,GACnB5B,iBAAiB,KAAK,CAAtB,GACI,+BAAcyB,iBAAWC,SAAX,CAAqB,YAArB,EAAmCJ,aAAnC,CAAd,EAAiE;AAC/DK,QAAAA,QAAQ,EAAE3B;AADqD,OAAjE,CADJ,GAII,+BAAcyB,iBAAWC,SAAX,CAAqB,aAArB,EAAoCJ,aAApC,CAAd,EAAkE;AAChEK,QAAAA,QAAQ,EAAE3B;AADsD,OAAlE,CALN;;AAQA,UAAM6B,YAAY,GAAGC,kBAAiBJ,SAAjB,CACnBK,+BAAeC,SADI,EAEnBV,aAFmB,CAArB;;AAIA,UAAMW,OAAO,GAAGH,kBAAiBJ,SAAjB,CACdK,+BAAeG,IADD,EAEdZ,aAFc,CAAhB;;AAIA,UAAMa,UAAU,GAAGL,kBAAiBJ,SAAjB,CACjBK,+BAAeK,OADE,EAEjBd,aAFiB,CAAnB;;AAIA,UAAMe,sBAAsB,GAAGP,kBAAiBJ,SAAjB,CAC7BY,sBAAUC,mBADmB,EAE7BjB,aAF6B,CAA/B;;AAIA,aAAO;AACLkB,QAAAA,cAAc,EAAEf,iBAAWC,SAAX,CAAqB,aAArB,EAAoCJ,aAApC,CADX;AAELmB,QAAAA,YAAY,EAAEhB,iBAAWC,SAAX,CAAqB,WAArB,EAAkCJ,aAAlC,CAFT;AAGLE,QAAAA,aAAa,EAAbA,aAHK;AAILI,QAAAA,eAAe,EAAfA,eAJK;AAKLC,QAAAA,YAAY,EAAZA,YALK;AAMLI,QAAAA,OAAO,EAAPA,OANK;AAOLE,QAAAA,UAAU,EAAVA,UAPK;AAQLE,QAAAA,sBAAsB,EAAtBA;AARK,OAAP;AAUD,KAjDa,C;;8EAoDfK,mB,+KAsBAA,mB","sourcesContent":["import formatMessage from 'format-message';\nimport { Module } from '@ringcentral-integration/commons/lib/di';\nimport proxify from '@ringcentral-integration/commons/lib/proxy/proxify';\nimport { presenceStatus } from '@ringcentral-integration/commons/enums/presenceStatus.enum';\nimport dndStatus from '@ringcentral-integration/commons/modules/Presence/dndStatus';\nimport callingModes from '@ringcentral-integration/commons/modules/CallingSettings/callingModes';\nimport { selector } from '@ringcentral-integration/commons/lib/selector';\n\nimport IframeMessageTransport from '../IframeMessageTransport';\nimport headerI18n from '../../components/CallMonitorBar/i18n';\nimport presenceItemI18n from '../../components/PresenceItem/i18n';\nimport AdapterModuleCoreBase from '../AdapterModuleCoreBase';\nimport baseActionTypes from '../AdapterModuleCoreBase/baseActionTypes';\n\nconst ALL_CALL_PATH = '/calls';\nconst ACTIVE_CALL_PATH = '/calls/active';\n\n@Module({\n  deps: [\n    'CallingSettings',\n    'GlobalStorage',\n    'Locale',\n    'Presence',\n    'RouterInteraction',\n    'Storage',\n    'Webphone',\n    'CallMonitor',\n    { dep: 'UserGuide', optional: true },\n    { dep: 'QuickAccess', optional: true },\n  ],\n})\nexport default class AdapterModuleCore extends AdapterModuleCoreBase {\n  constructor({\n    prefix,\n    storageKey = 'adapterCore',\n    actionTypes = baseActionTypes,\n    callingSettings,\n    globalStorage,\n    locale,\n    presence,\n    routerInteraction,\n    webphone,\n    callMonitor,\n    userGuide,\n    quickAccess,\n    messageTransport = new IframeMessageTransport({\n      targetWindow: window.parent,\n    }),\n    ...options\n  }: {\n    prefix?: string,\n    storageKey?: string,\n    actionTypes?: any,\n    callingSettings?: any,\n    globalStorage?: any,\n    locale?: any,\n    presence?: any,\n    routerInteraction?: any,\n    webphone?: any,\n    callMonitor?: any,\n    userGuide?: any,\n    quickAccess?: any,\n    messageTransport?: any,\n    storage?: any,\n  }) {\n    super({\n      prefix,\n      actionTypes,\n      locale,\n      messageTransport,\n      presence,\n      routerInteraction,\n      globalStorage,\n      storageKey,\n      ...options,\n    });\n\n    this._callingSettings = callingSettings;\n    this._webphone = webphone;\n    this._callMonitor = callMonitor;\n    this._userGuide = userGuide;\n    this._quickAccess = quickAccess;\n  }\n\n  _pushOtherStateChanges() {\n    this._pushRingState();\n  }\n\n  _pushRingState({ forcePush = false } = {}) {\n    if (!this.ready) return;\n\n    // TODO: we should refactor the entire sync logic to be more\n    // declarative and straightforward\n    if (forcePush) {\n      this._postMessage({\n        type: this._messageTypes.pushLocale,\n        strings: this.localeStrings,\n      });\n    }\n    if (!this._callingSettings) return;\n    const { callingMode } = this._callingSettings;\n    if (callingMode === callingModes.webphone) {\n      this._pushWebRTCRingingState(forcePush);\n      this._pushCallStartTime(forcePush);\n      this._pushIncomingCallPage(forcePush);\n    } else {\n      this._pushRingoutRingingState();\n    }\n  }\n\n  _pushWebRTCRingingState(forcePush) {\n    const webphone = this._webphone;\n    if (!webphone) {\n      throw new Error(\n        'webphone is a required dependency for monitoring WebRTC call',\n      );\n    }\n    if (\n      webphone.ringSession &&\n      (webphone.ringSessionId !== this._ringSessionId || forcePush)\n    ) {\n      this._ringSessionId = webphone.ringSessionId;\n      this._postMessage({\n        type: this._messageTypes.pushRingState,\n        ringing: true,\n      });\n    }\n    // Check if ringing is over\n    if (this._ringSessionId) {\n      const ringingSessions = webphone.sessions.filter(\n        (session) =>\n          session.callStatus === 'webphone-session-connecting' &&\n          session.direction === 'Inbound',\n      );\n      if (ringingSessions.length <= 0) {\n        this._postMessage({\n          type: this._messageTypes.pushRingState,\n          ringing: false,\n        });\n        this._ringSessionId = null;\n      }\n    } else if (!this._ringSessionId) {\n      this._postMessage({\n        type: this._messageTypes.pushRingState,\n        ringing: false,\n      });\n    }\n  }\n\n  _pushRingoutRingingState() {\n    const status = this._presence.telephonyStatus;\n    if (this._presence.telephonyStatus !== this._telephonyStatus) {\n      this._postMessage({\n        type: this._messageTypes.pushRingState,\n        ringing: status === 'Ringing',\n      });\n      this._telephonyStatus = status;\n    }\n  }\n\n  _pushIncomingCallPage(forcePush) {\n    this._showIncomingCallPage = !!(\n      this._webphone &&\n      this._webphone.ringSession &&\n      !this._webphone.ringSession.minimized\n    );\n    if (\n      forcePush ||\n      this._lastPath !== this._router.currentPath ||\n      this._lastShowIncomingCallPage !== this._showIncomingCallPage\n    ) {\n      this._lastPath = this._router.currentPath;\n      this._lastShowIncomingCallPage = this._showIncomingCallPage;\n      const onCurrentCallPath =\n        (this._router.currentPath === ACTIVE_CALL_PATH ||\n          this._router.currentPath ===\n            `${ACTIVE_CALL_PATH}/${this._webphone.activeSessionId}`) &&\n        !this._showIncomingCallPage;\n      if (\n        forcePush ||\n        this.onCurrentCallPath !== onCurrentCallPath ||\n        this._lastShowIncomingCallPage !== this._showIncomingCallPage\n      ) {\n        this.onCurrentCallPath = onCurrentCallPath;\n        this._lastShowIncomingCallPage = this._showIncomingCallPage;\n        this._postMessage({\n          type: this._messageTypes.pushOnCurrentCallPath,\n          onCurrentCallPath,\n        });\n      }\n      const onAllCallsPath =\n        this._router.currentPath === ALL_CALL_PATH &&\n        !this._showIncomingCallPage;\n      if (forcePush || this.onAllCallsPath !== onAllCallsPath) {\n        this.onAllCallsPath = onAllCallsPath;\n        this._postMessage({\n          type: this._messageTypes.pushOnAllCallsPath,\n          onAllCallsPath,\n        });\n      }\n    }\n  }\n\n  _pushCallStartTime(forcePush) {\n    const ringingCallsLength = this._callMonitor.activeRingCalls.length;\n    const onHoldCallsLength = this._callMonitor.activeOnHoldCalls.length;\n    const currentStartTime =\n      (this._callMonitor.activeCurrentCalls &&\n        this._callMonitor.activeCurrentCalls.length > 0 &&\n        this._callMonitor.activeCurrentCalls[0].startTime) ||\n      0;\n    if (\n      forcePush ||\n      this._lastRingCallsLength !== ringingCallsLength ||\n      this._lastOnHoldCallsLength !== onHoldCallsLength ||\n      this._lastCurrentStartTime !== currentStartTime\n    ) {\n      this._lastRingCallsLength = ringingCallsLength;\n      this._lastOnHoldCallsLength = onHoldCallsLength;\n      this._lastCurrentStartTime = currentStartTime;\n      this._postMessage({\n        type: this._messageTypes.pushCalls,\n        ringingCallsLength,\n        onHoldCallsLength,\n        currentStartTime,\n      });\n      this._postMessage({\n        type: this._messageTypes.pushLocale,\n        strings: this.localeStrings,\n      });\n    }\n  }\n\n  @selector\n  localeStrings = [\n    () => this._locale.ready,\n    () => this._locale.currentLocale,\n    () => this._callMonitor.activeRingCalls.length,\n    () => this._callMonitor.activeOnHoldCalls.length,\n    (localeReady, currentLocale, ringingCallsLength, onHoldCallsLength) => {\n      const ringCallsInfo =\n        ringingCallsLength === 1\n          ? formatMessage(headerI18n.getString('incomingCall', currentLocale), {\n              numberOf: ringingCallsLength,\n            })\n          : formatMessage(\n              headerI18n.getString('incomingCalls', currentLocale),\n              { numberOf: ringingCallsLength },\n            );\n      const onHoldCallsInfo =\n        onHoldCallsLength === 1\n          ? formatMessage(headerI18n.getString('callOnHold', currentLocale), {\n              numberOf: onHoldCallsLength,\n            })\n          : formatMessage(headerI18n.getString('callsOnHold', currentLocale), {\n              numberOf: onHoldCallsLength,\n            });\n      const availableBtn = presenceItemI18n.getString(\n        presenceStatus.available,\n        currentLocale,\n      );\n      const busyBtn = presenceItemI18n.getString(\n        presenceStatus.busy,\n        currentLocale,\n      );\n      const offlineBtn = presenceItemI18n.getString(\n        presenceStatus.offline,\n        currentLocale,\n      );\n      const doNotAcceptAnyCallsBtn = presenceItemI18n.getString(\n        dndStatus.doNotAcceptAnyCalls,\n        currentLocale,\n      );\n      return {\n        currentCallBtn: headerI18n.getString('currentCall', currentLocale),\n        viewCallsBtn: headerI18n.getString('viewCalls', currentLocale),\n        ringCallsInfo,\n        onHoldCallsInfo,\n        availableBtn,\n        busyBtn,\n        offlineBtn,\n        doNotAcceptAnyCallsBtn,\n      };\n    },\n  ];\n\n  @proxify\n  async _onNavigateToCurrentCall() {\n    const currentSession = this._webphone.activeSession;\n    if (currentSession) {\n      const currentCallPath = `${ACTIVE_CALL_PATH}/${currentSession.id}`;\n      this._router.push(currentCallPath);\n    }\n    if (this._userGuide && this._userGuide.started) {\n      this._userGuide.dismiss();\n    }\n    if (this._quickAccess && this._quickAccess.entered) {\n      this._quickAccess.exit();\n    }\n    if (\n      this._webphone &&\n      this._webphone.ringSession &&\n      !this._webphone.ringSession.minimized\n    ) {\n      this._webphone.toggleMinimized(this._webphone.ringSession.id);\n    }\n  }\n\n  @proxify\n  async _onNavigateToViewCalls() {\n    this._router.push(ALL_CALL_PATH);\n    if (this._userGuide && this._userGuide.started) {\n      this._userGuide.dismiss();\n    }\n    if (this._quickAccess && this._quickAccess.entered) {\n      this._quickAccess.exit();\n    }\n    if (\n      this._webphone &&\n      this._webphone.ringSession &&\n      !this._webphone.ringSession.minimized\n    ) {\n      this._webphone.toggleMinimized(this._webphone.ringSession.id);\n    }\n  }\n}\n"],"file":"index.js"}