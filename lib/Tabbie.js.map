{"version":3,"sources":["lib/Tabbie.ts"],"names":["HEART_BEAT_INTERVAL","HEART_BEAT_EXPIRE","GC_INTERVAL","TabbieEvents","ObjectMap","fromKeys","Tabbie","localStorage","getItem","_mainTabKey","mainTabId","id","_getHeartBeatKeys","tabs","length","_getActualId","firstTabId","enabled","filter","key","Date","now","Math","floor","_heartBeatInterval","prefix","heartBeatInterval","heartBeatExpire","gcInterval","uuid","v4","_emitter","EventEmitter","_heartBeatKey","_heartBeatRegExp","_eventKey","_eventRegExp","_heartBeatExpire","_gcInterval","_heartBeatIntervalId","_gcIntervalId","_heartBeat","setItem","_gc","expiredCut","isMainTabAlive","getMainTabId","i","len","isExpired","isMainTab","removeItem","_setFirstTabAsMainTab","_setAsVisibleTab","document","hidden","_setAsMainTab","window","visibilityState","preFixHeartBeatKey","RegExp","_bindInterval","_bindListener","setInterval","addEventListener","newValue","events","mainTabIdChanged","emit","test","payload","JSON","parse","event","args","clearInterval","stringify","Promise","resolve","once","some","on","replace","results","Set","add","isFirstTab"],"mappings":"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","sourcesContent":["import EventEmitter from 'events';\nimport uuid from 'uuid';\nimport { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\n\nconst HEART_BEAT_INTERVAL = 1000;\n// heartbeat older than HEART_BEAT_EXPIRE will be gc'ed\n// chrome and firefox throttles intervals when inactive expire time of 2000\n// sometimes would kill live heartbeats and cause the mainTabId to change\nconst HEART_BEAT_EXPIRE = 3000;\nconst GC_INTERVAL = 5000;\n\nconst TabbieEvents = ObjectMap.fromKeys(['mainTabIdChanged', 'event']);\n/**\n * @class\n * @description The base active tab and cross tab event handling class.\n */\nexport class Tabbie {\n  id = uuid.v4();\n  enabled: boolean;\n  prefix: string;\n\n  private _emitter = new EventEmitter();\n\n  private _mainTabKey: string;\n\n  private _heartBeatKey: string;\n  private _heartBeatRegExp: RegExp;\n\n  private _eventKey: string;\n  private _eventRegExp: RegExp;\n\n  private _heartBeatExpire: number;\n  private _heartBeatInterval: number;\n  private _gcInterval: number;\n  private _heartBeatIntervalId: NodeJS.Timeout;\n  private _gcIntervalId: NodeJS.Timeout;\n\n  get events() {\n    return TabbieEvents;\n  }\n\n  get mainTabId() {\n    return localStorage.getItem(this._mainTabKey);\n  }\n\n  get isMainTab() {\n    return this.mainTabId === this.id;\n  }\n\n  get tabs() {\n    return this._getHeartBeatKeys();\n  }\n\n  get firstTabId() {\n    const tabs = this.tabs;\n    if (tabs.length) {\n      return this._getActualId(tabs[0]);\n    }\n    return null;\n  }\n\n  get isFirstTab() {\n    return this.id === this.firstTabId;\n  }\n\n  get hasMultipleTabs() {\n    return (\n      this.enabled &&\n      this.tabs.filter(\n        (key) =>\n          Date.now() - Math.floor(+localStorage.getItem(key)) <\n          this._heartBeatInterval * 2 - 100,\n      ).length > 1\n    );\n  }\n\n  constructor({\n    prefix = '',\n    heartBeatInterval = HEART_BEAT_INTERVAL,\n    heartBeatExpire = HEART_BEAT_EXPIRE,\n    gcInterval = GC_INTERVAL,\n  }) {\n    this.prefix = prefix && prefix !== '' ? `${prefix}-` : '';\n    this._heartBeatInterval = heartBeatInterval;\n    this._heartBeatExpire = heartBeatExpire;\n    this._gcInterval = gcInterval;\n\n    this.enabled =\n      typeof window !== 'undefined' &&\n      typeof document.visibilityState !== 'undefined' &&\n      typeof localStorage !== 'undefined';\n\n    const preFixHeartBeatKey = `${this.prefix}tabbie-heartBeat-`;\n    this._heartBeatKey = `${preFixHeartBeatKey}${this.id}`;\n    this._mainTabKey = `${this.prefix}tabbie-mainTab-id`;\n    this._eventKey = `${this.prefix}tabbie-event-`;\n\n    this._heartBeatRegExp = new RegExp(`^${preFixHeartBeatKey}`);\n    this._eventRegExp = new RegExp(`^${this._eventKey}`);\n\n    if (this.enabled) {\n      this._bindInterval();\n\n      this._bindListener();\n\n      if (!document.hidden) {\n        this._setAsMainTab();\n      } else if (!this.mainTabId) {\n        this._setFirstTabAsMainTab();\n      }\n    }\n  }\n\n  private _bindInterval() {\n    this._heartBeat();\n    this._heartBeatIntervalId = setInterval(\n      this._heartBeat,\n      this._heartBeatInterval,\n    );\n\n    this._gcIntervalId = setInterval(this._gc, this._gcInterval);\n  }\n\n  private _bindListener() {\n    document.addEventListener('visibilitychange', this._setAsVisibleTab);\n    window.addEventListener('focus', this._setAsVisibleTab);\n\n    window.addEventListener('storage', async ({ key, newValue }) => {\n      if (key === this._mainTabKey) {\n        // use the newest main tab id from localhost instead of from the event\n        // to avoid race conditions\n        this._emitter.emit(\n          this.events.mainTabIdChanged,\n          await this.getMainTabId(),\n        );\n      } else if (\n        this._heartBeatRegExp.test(key) &&\n        (!newValue || newValue === '')\n      ) {\n        if (this._getActualId(key) === (await this.getMainTabId())) {\n          this._setFirstTabAsMainTab();\n        }\n      } else if (this._eventRegExp.test(key) && newValue && newValue !== '') {\n        const payload = JSON.parse(newValue);\n        const [id, event, ...args] = payload;\n        if (id !== this.id) {\n          // ie fires storage event on original\n          this._emitter.emit(this.events.event, event, ...args);\n        }\n      }\n    });\n\n    window.addEventListener('unload', () => {\n      clearInterval(this._gcIntervalId);\n      clearInterval(this._heartBeatIntervalId);\n      localStorage.removeItem(this._heartBeatKey);\n    });\n  }\n\n  send(event: string, ...args: any[]) {\n    if (!this.enabled) {\n      return;\n    }\n\n    const key = `${this._eventKey}${uuid.v4()}`;\n\n    const payload = [this.id, event, ...args];\n    localStorage.setItem(key, JSON.stringify(payload));\n    localStorage.removeItem(key);\n  }\n\n  /**\n   * @function\n   * @return {Promise} - Resolves to current main tab id\n   */\n  async getMainTabId(): Promise<string> {\n    const mainTabId = this.mainTabId;\n    if (mainTabId) return mainTabId;\n    return new Promise<string>((resolve) => {\n      this._emitter.once(this.events.mainTabIdChanged, resolve);\n    });\n  }\n\n  /**\n   * check current tab is main tab.\n   */\n  async checkIsMain() {\n    // assume main if not enabled\n    // this is to ensure that modules depending on this would function\n    // in node like environments\n    return !this.enabled || (await this.getMainTabId()) === this.id;\n  }\n\n  /**\n   * check tab alive state by tabId\n   * @param id tabId you want to check\n   */\n  checkTabAliveById(id: string) {\n    return this.tabs.some((key) => this._getActualId(key) === id);\n  }\n\n  on(...args: Parameters<EventEmitter['on']>) {\n    return this._emitter.on(...args);\n  }\n\n  private _getActualId(key: string) {\n    return key.replace(this._heartBeatRegExp, '');\n  }\n\n  private _heartBeat = () => {\n    localStorage.setItem(this._heartBeatKey, `${Date.now()}`);\n  };\n\n  // When there is some problem when not remove item from storage, that will remove by gc\n  private _gc = async () => {\n    const expiredCut = Date.now() - this._heartBeatExpire;\n    let isMainTabAlive = false;\n    const mainTabId = await this.getMainTabId();\n    const tabs = this.tabs;\n\n    for (let i = 0, len = tabs.length; i < len; i++) {\n      const key = tabs[i];\n      const isExpired = +localStorage.getItem(key) < expiredCut;\n      const isMainTab = this._getActualId(key) === mainTabId;\n\n      if (isExpired) {\n        localStorage.removeItem(key);\n      }\n\n      if (isMainTab) {\n        isMainTabAlive = !isExpired;\n      }\n    }\n\n    // if mainTab is not alive reset mainTab to firstTab\n    if (!isMainTabAlive) {\n      this._setFirstTabAsMainTab();\n    }\n  };\n\n  private _getHeartBeatKeys() {\n    const results = new Set<string>();\n\n    for (let i = 0; i < localStorage.length; i += 1) {\n      const key = localStorage.key(i);\n      if (key && key !== '' && this._heartBeatRegExp.test(key)) {\n        results.add(key);\n      }\n    }\n    return [...results];\n  }\n\n  private _setAsMainTab() {\n    localStorage.setItem(this._mainTabKey, this.id);\n    this._emitter.emit(this.events.mainTabIdChanged, this.id);\n  }\n\n  private _setAsVisibleTab = () => {\n    // avoid setting mainTabId repeatedly which may result in forced rendering\n    if (!document.hidden && !this.isMainTab) {\n      this._setAsMainTab();\n    }\n  };\n\n  private _setFirstTabAsMainTab() {\n    if (this.isFirstTab) {\n      localStorage.removeItem(this._mainTabKey);\n      this._setAsMainTab();\n    }\n  }\n}\n"],"file":"Tabbie.js"}