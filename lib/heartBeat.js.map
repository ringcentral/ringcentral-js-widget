{"version":3,"sources":["lib/heartBeat.ts"],"names":["HeartBeat","window","localStorage","_getStatusByLocal","_heartBeat","success","key","working","prefix","_heartBeatIntervalTime","intervalId","_setLocalTime","setInterval","clearInterval","setItem","Date","now","toString","statusKey","Number","getItem"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;IAAaA,S;;;wBAYQ;AAAA;;AACjB,wBAAOC,MAAP,4CAAO,QAAQC,YAAf;AACD;;;wBAEsB;AACrB,aAAO,KAAKC,iBAAL,CAAuB,KAAKC,UAAL,CAAgBC,OAAhB,CAAwBC,GAA/C,CAAP;AACD;;;wBAEsB;AACrB,aAAO,KAAKH,iBAAL,CAAuB,KAAKC,UAAL,CAAgBG,OAAhB,CAAwBD,GAA/C,CAAP;AACD;;;AAED,qBAAoBE,MAApB,EAA4CC,sBAA5C,EAA4E;AAAA;;AAAA,SAAxDD,MAAwD,GAAxDA,MAAwD;AAAA,SAAhCC,sBAAgC,GAAhCA,sBAAgC;AAAA,SAvBpEL,UAuBoE,GAvBvD;AACnBC,MAAAA,OAAO,EAAE;AACPC,QAAAA,GAAG,YAAK,KAAKE,MAAV,aADI;AAEPE,QAAAA,UAAU,EAAE;AAFL,OADU;AAKnBH,MAAAA,OAAO,EAAE;AACPD,QAAAA,GAAG,YAAK,KAAKE,MAAV,aADI;AAEPE,QAAAA,UAAU,EAAE;AAFL;AALU,KAuBuD;AAAE;;;;yCAEzD;AAAA;;AACnB,UAAI,OAAO,KAAKN,UAAL,CAAgBG,OAAvB,KAAmC,QAAvC,EAAiD;;AAEjD,WAAKI,aAAL,CAAmB,KAAKP,UAAL,CAAgBG,OAAhB,CAAwBD,GAA3C;;AAEA,WAAKF,UAAL,CAAgBG,OAAhB,CAAwBG,UAAxB,GAAqCE,WAAW,CAAC,YAAM;AACrD,QAAA,KAAI,CAACD,aAAL,CAAmB,KAAI,CAACP,UAAL,CAAgBG,OAAhB,CAAwBD,GAA3C;AACD,OAF+C,EAE7C,KAAKG,sBAFwC,CAAhD;AAGD;;;yCAEoB;AAAA;;AACnB,UAAI,OAAO,KAAKL,UAAL,CAAgBC,OAAvB,KAAmC,QAAvC,EAAiD;AAEjD,WAAKD,UAAL,CAAgBC,OAAhB,CAAwBK,UAAxB,GAAqCE,WAAW,CAAC,YAAM;AACrD,QAAA,MAAI,CAACD,aAAL,CAAmB,MAAI,CAACP,UAAL,CAAgBC,OAAhB,CAAwBC,GAA3C;AACD,OAF+C,EAE7C,KAAKG,sBAFwC,CAAhD;AAGD;;;8BAES;AACR,UAAI,KAAKL,UAAL,CAAgBC,OAAhB,CAAwBK,UAA5B,EAAwC;AACtCG,QAAAA,aAAa,CAAC,KAAKT,UAAL,CAAgBC,OAAhB,CAAwBK,UAAzB,CAAb;AACA,aAAKN,UAAL,CAAgBC,OAAhB,CAAwBK,UAAxB,GAAqC,IAArC;AACD;;AAED,UAAI,KAAKN,UAAL,CAAgBG,OAAhB,CAAwBG,UAA5B,EAAwC;AACtCG,QAAAA,aAAa,CAAC,KAAKT,UAAL,CAAgBG,OAAhB,CAAwBG,UAAzB,CAAb;AACA,aAAKN,UAAL,CAAgBG,OAAhB,CAAwBG,UAAxB,GAAqC,IAArC;AACD;AACF;;;kCAEqBJ,G,EAAa;AACjC,WAAKJ,YAAL,CAAkBY,OAAlB,CAA0BR,GAA1B,EAA+BS,IAAI,CAACC,GAAL,GAAWC,QAAX,EAA/B;AACD;;;sCAEyBC,S,EAAmB;AAC3C,aACE,KAAKhB,YAAL,IACAa,IAAI,CAACC,GAAL,KAAaG,MAAM,CAAC,KAAKjB,YAAL,CAAkBkB,OAAlB,CAA0BF,SAA1B,CAAD,CAAnB,GACE,KAAKT,sBAAL,GAA8B,CAA9B,GAAkC,GAHtC;AAKD","sourcesContent":["export class HeartBeat {\n  private _heartBeat = {\n    success: {\n      key: `${this.prefix}_success`,\n      intervalId: null,\n    },\n    working: {\n      key: `${this.prefix}_working`,\n      intervalId: null,\n    },\n  };\n\n  get localStorage() {\n    return window?.localStorage;\n  }\n\n  get isSuccessByLocal() {\n    return this._getStatusByLocal(this._heartBeat.success.key);\n  }\n\n  get isWorkingByLocal() {\n    return this._getStatusByLocal(this._heartBeat.working.key);\n  }\n\n  constructor(private prefix: string, private _heartBeatIntervalTime: number) {}\n\n  heartBeatOnWorking() {\n    if (typeof this._heartBeat.working === 'number') return;\n\n    this._setLocalTime(this._heartBeat.working.key);\n\n    this._heartBeat.working.intervalId = setInterval(() => {\n      this._setLocalTime(this._heartBeat.working.key);\n    }, this._heartBeatIntervalTime);\n  }\n\n  heartBeatOnSuccess() {\n    if (typeof this._heartBeat.success === 'number') return;\n\n    this._heartBeat.success.intervalId = setInterval(() => {\n      this._setLocalTime(this._heartBeat.success.key);\n    }, this._heartBeatIntervalTime);\n  }\n\n  destroy() {\n    if (this._heartBeat.success.intervalId) {\n      clearInterval(this._heartBeat.success.intervalId);\n      this._heartBeat.success.intervalId = null;\n    }\n\n    if (this._heartBeat.working.intervalId) {\n      clearInterval(this._heartBeat.working.intervalId);\n      this._heartBeat.working.intervalId = null;\n    }\n  }\n\n  private _setLocalTime(key: string) {\n    this.localStorage.setItem(key, Date.now().toString());\n  }\n\n  private _getStatusByLocal(statusKey: string) {\n    return (\n      this.localStorage &&\n      Date.now() - Number(this.localStorage.getItem(statusKey)) <\n        this._heartBeatIntervalTime * 2 - 100\n    );\n  }\n}\n"],"file":"heartBeat.js"}