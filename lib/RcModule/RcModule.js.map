{"version":3,"sources":["lib/RcModule/RcModule.ts"],"names":["globalStorage","target","name","descriptor","_globalStorageSubKeys","storage","_storageSubKeys","track","trackEvent","value","initializer","Error","fn","trackedFn","parentModule","analytics","args","event","trackProps","call","apply","enumerable","configurable","getStorageSubKey","storageKey","key","RcModuleV2","options","__$$state$$__","_once","__key__","__subscriptions__","_modulePath","_initialized","_suppressInit","_deps","_modules","enableStorage","forEach","reducer","state","_initialValue","type","states","indexOf","actionTypes","registerReducer","properties","reduce","propertiesMap","get","set","_store","Object","defineProperties","enableGlobalStorage","params","modules","deps","rest","module","prototype","hasOwnProperty","defineProperty","modulePath","reducers","entries","Array","isArray","_state","getItem","assign","onInitOnce","_shouldInit","__initModule__","_onInitOnce","onInit","__initSuccessModule__","onInitSuccess","_shouldReset","__resetModule__","onReset","__resetSuccessModule__","store","subscribe","onStateChange","_checkStatusChange","subModule","subRcModule","initModule","areAllReady","noReadyModulesLength","pending","areNotReady","ready","_getState","getState","__status__","moduleStatuses","initializing","resetting","enableCache","process","env","NODE_ENV","console","error","length","_arguments","enableGlobalCache","_getStorageState","_getGlobalStorageState","values","filter","noReadyModules","BaseModule","action"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/* eslint-disable func-names */\nimport { Reducer, ReducersMapObject, Action, AnyAction, Store } from 'redux';\nimport { Storage as StorageV2 } from 'ringcentral-integration/modules/StorageV2';\nimport { GlobalStorage as GlobalStorageV2 } from 'ringcentral-integration/modules/GlobalStorageV2';\nimport Storage from 'ringcentral-integration/modules/Storage';\nimport GlobalStorage from 'ringcentral-integration/modules/GlobalStorage';\nimport { Analytics } from 'ringcentral-integration/modules/Analytics';\nimport BaseModule, { state, action } from '../usm-redux';\nimport { moduleStatuses } from '../../enums/moduleStatuses';\nimport { Params } from '../usm/core/module';\nimport { Properties } from '../usm/utils/flatten';\n\nexport interface Descriptor<T> extends TypedPropertyDescriptor<T> {\n  initializer?(): T;\n}\n\n/**\n * decorate global storage state with `GlobalStorage` Module\n */\nfunction globalStorage(\n  target: RcModuleV2,\n  name: string,\n  descriptor?: Descriptor<any>,\n): any {\n  target._globalStorageSubKeys = [\n    ...(target._globalStorageSubKeys || []),\n    name,\n  ];\n  return descriptor;\n}\n\n/**\n * decorate storage state with `Storage` Module\n */\nfunction storage(\n  target: RcModuleV2,\n  name: string,\n  descriptor?: Descriptor<any>,\n): any {\n  target._storageSubKeys = [...(target._storageSubKeys || []), name];\n  return descriptor;\n}\n\ntype TrackEvent = string | ((...args: any) => [string, object?]);\n\n/**\n * decorate a method with `Analytics` Module\n *\n * @param trackEvent define trackEvent for tracking\n */\nfunction track(trackEvent: TrackEvent) {\n  return (target: RcModuleV2, name: string, descriptor?: Descriptor<any>) => {\n    if (\n      typeof descriptor.value !== 'function' &&\n      typeof descriptor.initializer !== 'function'\n    ) {\n      throw new Error(`@track decorated '${name}' is not a method`);\n    }\n    let fn: (...args: any) => any = descriptor.value;\n    const initializer = descriptor.initializer;\n    const trackedFn = function (this: RcModuleV2, ...args: any) {\n      const { analytics } = this.parentModule as RcModuleV2<Properties<any>> & {\n        analytics: Analytics;\n      };\n      if (\n        typeof analytics !== 'undefined' &&\n        typeof analytics.track === 'function'\n      ) {\n        if (typeof trackEvent === 'string') {\n          analytics.track(trackEvent);\n        } else {\n          const [event, trackProps] = trackEvent(this, ...args);\n          analytics.track(event, trackProps);\n        }\n      }\n      if (typeof initializer === 'function') {\n        fn = initializer.call(this);\n      }\n      return fn.apply(this, args);\n    };\n    // the any type is just to be compatible with babel and tsc.\n    return {\n      enumerable: true,\n      configurable: true,\n      value: trackedFn,\n    } as any;\n  };\n}\n\nconst getStorageSubKey = (storageKey: string, key: string) =>\n  `${storageKey}-${key}`;\n\ninterface RcModuleV2 {\n  _storageSubKeys: string[];\n  _globalStorageSubKeys: string[];\n}\n\ntype ReducersMap = ReducersMapObject<\n  any,\n  Action & { states: Record<string, any> }\n>;\n\ntype Options = {\n  deps?: Record<string, any>;\n  enableCache?: boolean;\n  enableGlobalCache?: boolean;\n  storageKey?: string;\n};\n\nclass RcModuleV2<\n  T extends {\n    storage?: Storage | StorageV2;\n    globalStorage?: GlobalStorage | GlobalStorageV2;\n  } & Record<string, any> = {},\n  S extends Record<string, any> = {}\n> extends BaseModule<T> {\n  __$$state$$__: any;\n  /**\n   * `onInit` life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInit?(): Promise<void> | void;\n  /**\n   * `onInitOnce` once life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInitOnce?(): Promise<void> | void;\n  /**\n   * `onInitSuccess` life cycle for current initialization after this module is ready.\n   */\n  protected onInitSuccess?(): Promise<void> | void;\n  /**\n   * `onReset` life cycle for current reset before one of deps modules is not ready.\n   */\n  protected onReset?(): Promise<void> | void;\n  /**\n   * `onStateChange` each Redux dispatch action will trigger it once.\n   */\n  protected onStateChange?(): Promise<void> | void;\n  protected _once = false;\n  public __key__?: string;\n  public __subscriptions__?: (() => void)[];\n  public storageKey: string;\n  public _modulePath?: string;\n  public _initialized = false;\n  public _suppressInit?: boolean;\n  protected _deps: T;\n\n  constructor(options: Options, ...args: any[]) {\n    super(options as any, ...args);\n    this._modulePath = 'root';\n    this._deps = this._modules;\n    if (this.enableStorage) {\n      // TODO replace new way for `storageKey` definition\n      this.storageKey = options.storageKey;\n      this._storageSubKeys.forEach((key) => {\n        const reducer: Reducer<any, AnyAction> = (\n          state = this._initialValue[key],\n          { type, states },\n        ) => {\n          if (\n            type &&\n            type.indexOf((this.actionTypes as Record<string, string>)[key]) > -1\n          ) {\n            return states[key];\n          }\n          return state;\n        };\n        this._modules.storage.registerReducer({\n          key: getStorageSubKey(this.storageKey, key),\n          reducer,\n        });\n      });\n      const properties = this._storageSubKeys.reduce(\n        (propertiesMap: Record<string, PropertyDescriptor>, key) => {\n          propertiesMap[key] = {\n            enumerable: true,\n            configurable: true,\n            get(this: BaseModule) {\n              return this.state[key];\n            },\n            set(this: BaseModule, value: unknown) {\n              if (this._store) {\n                this.state[key] = value;\n              } else {\n                // Support for synchronous updating of initialized state values while in the constructor.\n                this._initialValue[key] = value;\n              }\n            },\n          };\n          return propertiesMap;\n        },\n        {},\n      );\n      Object.defineProperties(this, properties);\n    }\n    if (this.enableGlobalStorage) {\n      this.storageKey = options.storageKey;\n      this._globalStorageSubKeys.forEach((key) => {\n        const reducer: Reducer<any, AnyAction> = (\n          state = this._initialValue[key],\n          { type, states },\n        ) => {\n          if (\n            type &&\n            type.indexOf((this.actionTypes as Record<string, string>)[key]) > -1\n          ) {\n            return states[key];\n          }\n          return state;\n        };\n        this._modules.globalStorage.registerReducer({\n          key: getStorageSubKey(this.storageKey, key),\n          reducer,\n        });\n      });\n      const properties = this._globalStorageSubKeys.reduce(\n        (propertiesMap: Record<string, PropertyDescriptor>, key) => {\n          propertiesMap[key] = {\n            enumerable: true,\n            configurable: true,\n            get(this: BaseModule) {\n              return this.state[key];\n            },\n            set(this: BaseModule, value: unknown) {\n              if (this._store) {\n                this.state[key] = value;\n              } else {\n                // Support for synchronous updating of initialized state values while in the constructor.\n                this._initialValue[key] = value;\n              }\n            },\n          };\n          return propertiesMap;\n        },\n        {},\n      );\n      Object.defineProperties(this, properties);\n    }\n  }\n\n  public _handleArgs(params?: any): Params<T> {\n    if (typeof params === 'undefined') {\n      return {\n        modules: {} as T,\n      };\n    }\n    const { deps, ...rest } = params;\n    return {\n      modules: deps,\n      ...rest,\n    };\n  }\n\n  get modulePath() {\n    return this._modulePath;\n  }\n\n  /**\n   * harmony with RcModule V1 for modules initialization\n   * @param name module key\n   * @param module RcModule\n   */\n  addModule(name: string, module: unknown) {\n    if (Object.prototype.hasOwnProperty.call(this, name)) {\n      throw new Error(`Property '${name}' already exists...`);\n    }\n    Object.defineProperty(this, name, {\n      get() {\n        return module;\n      },\n      enumerable: true,\n    });\n    if ((this as any)[name]._modulePath === 'root') {\n      (this as any)[name]._modulePath = `${this.modulePath}.${name}`;\n    }\n  }\n\n  get enableStorage() {\n    if (\n      this.enableCache &&\n      (typeof this._modules.storage === 'undefined' ||\n        this._modules.storage === null)\n    ) {\n      if (process.env.NODE_ENV === 'development') {\n        console.error(\n          `Dependent 'Storage' module was not imported in the ${this.__key__} module.`,\n        );\n      }\n    }\n    return (\n      this.enableCache &&\n      !!this._modules.storage &&\n      Array.isArray(this._storageSubKeys) &&\n      this._storageSubKeys.length > 0\n    );\n  }\n\n  get enableCache(): boolean {\n    return (this._arguments as any).enableCache;\n  }\n\n  get enableGlobalStorage() {\n    if (\n      this.enableGlobalCache &&\n      (typeof this._modules.globalStorage === 'undefined' ||\n        this._modules.globalStorage === null)\n    ) {\n      if (process.env.NODE_ENV === 'development') {\n        console.error(\n          `Dependent 'GlobalStorage' module was not imported in the module.`,\n        );\n      }\n    }\n    return (\n      this.enableGlobalCache &&\n      !!this._modules.globalStorage &&\n      Array.isArray(this._globalStorageSubKeys) &&\n      this._globalStorageSubKeys.length > 0\n    );\n  }\n\n  get enableGlobalCache(): boolean {\n    return (this._arguments as any).enableGlobalCache;\n  }\n\n  public getReducers(actionTypes: any) {\n    const reducers = super.getReducers(actionTypes);\n    if (!this.enableStorage && !this.enableGlobalStorage) return reducers;\n    return Object.entries(reducers).reduce(\n      (reducers: Properties<Reducer<any, AnyAction>>, [key, reducer]) => {\n        if (\n          (!Array.isArray(this._storageSubKeys) ||\n            this._storageSubKeys.indexOf(key) === -1 ||\n            !this.enableStorage) &&\n          (!Array.isArray(this._globalStorageSubKeys) ||\n            this._globalStorageSubKeys.indexOf(key) === -1 ||\n            !this.enableGlobalStorage)\n        ) {\n          reducers[key] = reducer;\n        }\n        return reducers;\n      },\n      {},\n    );\n  }\n\n  public get state(): S & { __status__: string } {\n    if (this.__$$state$$__) {\n      return this.__$$state$$__;\n    }\n    if (!this.enableStorage && !this.enableGlobalStorage) {\n      return {\n        ...this._getState(),\n      };\n    }\n    return {\n      ...this._getState(),\n      ...this._getStorageState(),\n      ...this._getGlobalStorageState(),\n    };\n  }\n\n  _getStorageState() {\n    if (!this._storageSubKeys || !this.enableStorage) return {};\n    return this._storageSubKeys.reduce((_state, key) => {\n      let value;\n      if (this.enableStorage) {\n        value =\n          this._modules.storage.getItem(\n            getStorageSubKey(this.storageKey, key),\n          ) ?? this._initialValue[key];\n      } else {\n        value = this.state[key];\n      }\n      return Object.assign(_state, {\n        [key]: value,\n      });\n    }, {});\n  }\n\n  _getGlobalStorageState() {\n    if (!this._globalStorageSubKeys || !this.enableGlobalStorage) return {};\n    return this._globalStorageSubKeys.reduce((_state, key) => {\n      let value;\n      if (this.enableGlobalStorage) {\n        value =\n          this._modules.globalStorage.getItem(\n            getStorageSubKey(this.storageKey, key),\n          ) ?? this._initialValue[key];\n      } else {\n        value = this.state[key];\n      }\n      return Object.assign(_state, {\n        [key]: value,\n      });\n    }, {});\n  }\n\n  async _onInitOnce() {\n    if (!this._once) {\n      this._once = true;\n      if (typeof this.onInitOnce === 'function') {\n        await this.onInitOnce();\n      }\n    }\n  }\n\n  protected async _checkStatusChange() {\n    if (this._shouldInit()) {\n      this.__initModule__();\n      await this._onInitOnce();\n      if (typeof this.onInit === 'function') {\n        await this.onInit();\n      }\n      this.__initSuccessModule__();\n      if (typeof this.onInitSuccess === 'function') {\n        await this.onInitSuccess();\n      }\n    } else if (this._shouldReset()) {\n      this.__resetModule__();\n      if (typeof this.onReset === 'function') {\n        await this.onReset();\n      }\n      this.__resetSuccessModule__();\n    }\n  }\n\n  async initModule() {\n    this.parentModule.store.subscribe(async () => {\n      if (typeof this.onStateChange === 'function') {\n        this.onStateChange();\n      }\n      await this._checkStatusChange();\n    });\n    if (Array.isArray(this.__subscriptions__)) {\n      this.__subscriptions__.forEach((subscribe) => subscribe());\n    }\n    await this._checkStatusChange();\n    if (typeof this.__key__ !== 'undefined') return;\n    for (const subModule in this) {\n      if (\n        Object.prototype.hasOwnProperty.call(this, subModule) &&\n        this[subModule] instanceof RcModuleV2 &&\n        !((this[subModule] as any) as RcModuleV2)._initialized &&\n        !((this[subModule] as any) as RcModuleV2)._suppressInit\n      ) {\n        const subRcModule: RcModuleV2 = this[subModule] as any;\n        subRcModule._initialized = true;\n        subRcModule.initModule();\n      }\n    }\n  }\n\n  protected _onStateChange(): void {}\n\n  get noReadyModules() {\n    const modules = Object.values(this._modules || {}).filter(\n      // In order to be compatible with RcModuleV1\n      (module: any) => module && typeof module.ready !== 'undefined',\n    );\n    return modules.filter((module: any) => !module.ready);\n  }\n\n  get noReadyModulesLength() {\n    return this.noReadyModules.length;\n  }\n\n  _shouldInit() {\n    const areAllReady = this.noReadyModulesLength === 0;\n    return areAllReady && this.pending;\n  }\n\n  _shouldReset() {\n    const areNotReady = this.noReadyModulesLength > 0;\n    return areNotReady && this.ready;\n  }\n\n  get _store() {\n    return this.parentModule?.store;\n  }\n\n  protected _setStore(store: Store) {\n    // Compatibility about Factory ModuleV1 and ModuleV2\n    if (typeof this.parentModule === 'undefined') {\n      this.parentModule = {\n        store,\n      } as RcModuleV2;\n    }\n  }\n\n  get reducer() {\n    return this.reducers as Reducer;\n  }\n\n  get _reducer() {\n    return this.reducer;\n  }\n\n  _getState(): S & { __status__: string } {\n    return (this.parentModule as RcModuleV2)._getState\n      ? ((this.parentModule as RcModuleV2)._getState() as Record<string, any>)[\n          this.__key__\n        ]\n      : this.parentModule.store.getState();\n  }\n\n  get __name__() {\n    return this.__key__;\n  }\n\n  @state __status__: string = moduleStatuses.pending;\n\n  @action\n  __initModule__() {\n    this.state.__status__ = moduleStatuses.initializing;\n  }\n\n  @action\n  __initSuccessModule__() {\n    this.state.__status__ = moduleStatuses.ready;\n  }\n\n  @action\n  __resetModule__() {\n    this.state.__status__ = moduleStatuses.resetting;\n  }\n\n  @action\n  __resetSuccessModule__() {\n    this.state.__status__ = moduleStatuses.pending;\n  }\n\n  public get status() {\n    return this.__status__;\n  }\n\n  public get pending() {\n    return this.__status__ === moduleStatuses.pending;\n  }\n\n  public get ready() {\n    return this.__status__ === moduleStatuses.ready;\n  }\n\n  public get resetting() {\n    return this.__status__ === moduleStatuses.resetting;\n  }\n\n  /**\n   * @deprecated make it compatible with proxy state in RcModuleV1\n   */\n  get proxyReady() {\n    return this.ready;\n  }\n}\n\nexport { RcModuleV2, globalStorage, storage, state, action, track };\n"],"file":"RcModule.js"}