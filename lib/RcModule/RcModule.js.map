{"version":3,"sources":["lib/RcModule/RcModule.ts"],"names":["globalStorage","target","name","descriptor","_globalStorageSubKeys","storage","_storageSubKeys","RcModuleV2","args","__$$state$$__","_once","__key__","storageKey","_modulePath","enableStorage","reducer","reduce","reducerMap","key","state","_initialValue","type","states","indexOf","actionTypes","_modules","registerReducer","properties","propertiesMap","enumerable","configurable","get","getItem","Object","defineProperties","enableGlobalStorage","module","prototype","hasOwnProperty","call","Error","defineProperty","modulePath","reducers","entries","Array","isArray","_state","value","assign","onInitOnce","parentModule","store","subscribe","onStateChange","_shouldInit","__initModule__","_onInitOnce","onInit","__initSuccessModule__","onInitSuccess","_shouldReset","__resetModule__","onReset","__resetSuccessModule__","modules","areAllReady","values","filter","ready","length","pending","areNotReady","_getState","__status__","moduleStatuses","initializing","resetting","enableCache","console","error","_arguments","enableGlobalCache","_getStorageState","_getGlobalStorageState","BaseModule","action"],"mappings":"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","sourcesContent":["import BaseModule, { state, action } from 'usm-redux';\nimport { combineReducers, Reducer } from 'redux';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport Storage from 'ringcentral-integration/modules/Storage';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport GlobalStorage from 'ringcentral-integration/modules/GlobalStorage';\nimport { moduleStatuses } from '../../enums/moduleStatuses';\n\n// TODO: `_getProxyState`.\n\ninterface Descriptor<T> extends TypedPropertyDescriptor<T> {\n  initializer(): T;\n}\n\n/**\n * decorate global storage state with `GlobalStorage` Module\n * @param target rc module\n * @param name sate key\n * @param descriptor descriptor\n */\nfunction globalStorage(\n  target: RcModuleV2,\n  name: string,\n  descriptor?: Descriptor<any>,\n): any {\n  target._globalStorageSubKeys = [\n    ...(target._globalStorageSubKeys || []),\n    name,\n  ];\n  return descriptor;\n}\n\n/**\n * decorate storage state with `Storage` Module\n * @param target RcModule\n * @param name state key\n * @param descriptor descriptor\n */\nfunction storage(\n  target: RcModuleV2,\n  name: string,\n  descriptor?: Descriptor<any>,\n): any {\n  target._storageSubKeys = [...(target._storageSubKeys || []), name];\n  return descriptor;\n}\n\ninterface RcModuleV2 {\n  _storageSubKeys: string[];\n  _globalStorageSubKeys: string[];\n}\n\nclass RcModuleV2<\n  T extends { storage?: Storage; globalStorage?: GlobalStorage } & Record<\n    string,\n    any\n  > = {},\n  S = {}\n> extends BaseModule<T> {\n  __$$state$$__: any;\n  /**\n   * `onInit` life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInit?(): Promise<void> | void;\n  /**\n   * `onInitSuccess` life cycle for current initialization after this module is ready.\n   */\n  protected onInitSuccess?(): Promise<void> | void;\n  /**\n   * `onReset` life cycle for current reset before one of deps modules is not ready.\n   */\n  protected onReset?(): Promise<void> | void;\n  /**\n   * `onInitOnce` once life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInitOnce?(): Promise<void> | void;\n  protected _once = false;\n  public __key__?: string;\n  public storageKey: string;\n  public _modulePath?: string;\n\n  constructor(...args: any[]) {\n    super(...args);\n    this._modulePath = 'root';\n    if (this.enableStorage) {\n      // TODO replace new way for `storageKey` definition\n      this.storageKey = args[0].storageKey;\n      const reducer = combineReducers(\n        this._storageSubKeys.reduce((reducerMap, key) => {\n          reducerMap[key] = (\n            state = this._initialValue[key],\n            { type, states },\n          ) => {\n            if (type && type.indexOf(this.actionTypes[key]) > -1) {\n              return states[key];\n            }\n            return state;\n          };\n          return reducerMap;\n        }, {}),\n      );\n      this._modules.storage.registerReducer({\n        key: this.storageKey,\n        reducer,\n      });\n      const properties = this._storageSubKeys.reduce((propertiesMap, key) => {\n        propertiesMap[key] = {\n          enumerable: true,\n          configurable: true,\n          get() {\n            return this.enableStorage &&\n              this._modules.storage.getItem(this.storageKey)\n              ? this._modules.storage.getItem(this.storageKey)[key]\n              : this.state[key];\n          },\n        };\n        return propertiesMap;\n      }, {});\n      Object.defineProperties(this, properties);\n    }\n    if (this.enableGlobalStorage) {\n      this.storageKey = args[0].storageKey;\n      const reducer = combineReducers(\n        this._globalStorageSubKeys.reduce((reducerMap, key) => {\n          reducerMap[key] = (\n            state = this._initialValue[key],\n            { type, states },\n          ) => {\n            if (type && type.indexOf(this.actionTypes[key]) > -1) {\n              return states[key];\n            }\n            return state;\n          };\n          return reducerMap;\n        }, {}),\n      );\n      this._modules.globalStorage.registerReducer({\n        key: this.storageKey,\n        reducer,\n      });\n      const properties = this._globalStorageSubKeys.reduce(\n        (propertiesMap, key) => {\n          propertiesMap[key] = {\n            enumerable: true,\n            configurable: true,\n            get() {\n              return this.enableGlobalStorage &&\n                this._modules.globalStorage.getItem(this.storageKey)\n                ? this._modules.globalStorage.getItem(this.storageKey)[key]\n                : this.state[key];\n            },\n          };\n          return propertiesMap;\n        },\n        {},\n      );\n      Object.defineProperties(this, properties);\n    }\n  }\n\n  get modulePath() {\n    return this._modulePath;\n  }\n\n  /**\n   * harmony with RcModule V1 for modules initialization\n   * @param name module key\n   * @param module RcModule\n   */\n  addModule(name, module) {\n    if (Object.prototype.hasOwnProperty.call(this, name)) {\n      throw new Error(`Property '${name}' already exists...`);\n    }\n    Object.defineProperty(this, name, {\n      get() {\n        return module;\n      },\n      enumerable: true,\n    });\n    if (this[name]._modulePath === 'root') {\n      this[name]._modulePath = `${this.modulePath}.${name}`;\n    }\n  }\n\n  get enableStorage() {\n    if (\n      this.enableCache &&\n      (typeof this._modules.storage === 'undefined' ||\n        this._modules.storage === null)\n    ) {\n      console.error(\n        `Dependent 'Storage' module was not imported in the ${this.__key__} module.`,\n      );\n    }\n    return (\n      this.enableCache &&\n      !!this._modules.storage &&\n      Array.isArray(this._storageSubKeys) &&\n      this._storageSubKeys.length > 0\n    );\n  }\n\n  get enableCache(): boolean {\n    return (this._arguments as any).enableCache;\n  }\n\n  get enableGlobalStorage() {\n    if (\n      this.enableGlobalCache &&\n      (typeof this._modules.globalStorage === 'undefined' ||\n        this._modules.globalStorage === null)\n    ) {\n      console.error(\n        `Dependent 'GlobalStorage' module was not imported in the module.`,\n      );\n    }\n    return (\n      this.enableGlobalCache &&\n      !!this._modules.globalStorage &&\n      Array.isArray(this._globalStorageSubKeys) &&\n      this._globalStorageSubKeys.length > 0\n    );\n  }\n\n  get enableGlobalCache(): boolean {\n    return (this._arguments as any).enableGlobalCache;\n  }\n\n  public getReducers(actionTypes: any) {\n    const reducers = super.getReducers(actionTypes);\n    if (!this.enableStorage && !this.enableGlobalStorage) return reducers;\n    return Object.entries(reducers).reduce((reducers, [key, reducer]) => {\n      if (\n        (!Array.isArray(this._storageSubKeys) ||\n          this._storageSubKeys.indexOf(key) === -1 ||\n          !this.enableStorage) &&\n        (!Array.isArray(this._globalStorageSubKeys) ||\n          this._globalStorageSubKeys.indexOf(key) === -1 ||\n          !this.enableGlobalStorage)\n      ) {\n        reducers[key] = reducer;\n      }\n      return reducers;\n    }, {});\n  }\n\n  public get state(): S & { __status__: string } {\n    if (this.__$$state$$__) {\n      return this.__$$state$$__;\n    }\n    if (!this.enableStorage && !this.enableGlobalStorage) {\n      return this._getState() || {};\n    }\n    return {\n      ...this._getState(),\n      ...this._getStorageState(),\n      ...this._getGlobalStorageState(),\n    };\n  }\n\n  _getStorageState() {\n    if (!this._storageSubKeys || !this.enableStorage) return {};\n    return this._storageSubKeys.reduce((_state, key) => {\n      let value;\n      if (this.enableStorage) {\n        value = this._modules.storage.getItem(this.storageKey)\n          ? this._modules.storage.getItem(this.storageKey)[key]\n          : this._initialValue[key];\n      } else {\n        value = this.state[key];\n      }\n      return Object.assign(_state, {\n        [key]: value,\n      });\n    }, {});\n  }\n\n  _getGlobalStorageState() {\n    if (!this._globalStorageSubKeys || !this.enableGlobalStorage) return {};\n    return this._globalStorageSubKeys.reduce((_state, key) => {\n      let value;\n      if (this.enableGlobalStorage) {\n        value = this._modules.globalStorage.getItem(this.storageKey)\n          ? this._modules.globalStorage.getItem(this.storageKey)[key]\n          : this._initialValue[key];\n      } else {\n        value = this.state[key];\n      }\n      return Object.assign(_state, {\n        [key]: value,\n      });\n    }, {});\n  }\n\n  async _onInitOnce() {\n    if (!this._once) {\n      this._once = true;\n      if (typeof this.onInitOnce === 'function') {\n        await this.onInitOnce();\n      }\n    }\n  }\n\n  initModule() {\n    this.parentModule.store.subscribe(async () => {\n      if (typeof this.onStateChange === 'function') {\n        this.onStateChange();\n      }\n      if (this._shouldInit()) {\n        this.__initModule__();\n        await this._onInitOnce();\n        if (typeof this.onInit === 'function') {\n          await this.onInit();\n        }\n        this.__initSuccessModule__();\n        if (typeof this.onInitSuccess === 'function') {\n          await this.onInitSuccess();\n        }\n      } else if (this._shouldReset()) {\n        this.__resetModule__();\n        if (typeof this.onReset === 'function') {\n          await this.onReset();\n        }\n        this.__resetSuccessModule__();\n      }\n    });\n  }\n\n  _shouldInit() {\n    const modules = this._modules || {};\n    const areAllReady =\n      modules &&\n      Object.values(modules).filter((module: any) => !module.ready).length ===\n        0;\n    return areAllReady && this.pending;\n  }\n\n  _shouldReset() {\n    const modules = this._modules || {};\n    const areNotReady =\n      modules &&\n      Object.values(modules).filter((module: any) => !module.ready).length > 0;\n    return areNotReady && this.ready;\n  }\n\n  get _store() {\n    return this.parentModule.store;\n  }\n\n  get reducer() {\n    return this.reducers as Reducer;\n  }\n\n  get _reducer() {\n    return this.reducer;\n  }\n\n  _getState() {\n    return (this.parentModule as any)._getState()[this.__key__];\n  }\n\n  get __name__() {\n    return this.__key__;\n  }\n\n  @state __status__: string = moduleStatuses.pending;\n\n  @action\n  __initModule__() {\n    this.state.__status__ = moduleStatuses.initializing;\n  }\n\n  @action\n  __initSuccessModule__() {\n    this.state.__status__ = moduleStatuses.ready;\n  }\n\n  @action\n  __resetModule__() {\n    this.state.__status__ = moduleStatuses.resetting;\n  }\n\n  @action\n  __resetSuccessModule__() {\n    this.state.__status__ = moduleStatuses.pending;\n  }\n\n  public get status() {\n    return this.__status__;\n  }\n\n  public get pending() {\n    return this.__status__ === moduleStatuses.pending;\n  }\n\n  public get ready() {\n    return this.__status__ === moduleStatuses.ready;\n  }\n\n  public get resetting() {\n    return this.__status__ === moduleStatuses.resetting;\n  }\n}\n\nexport { RcModuleV2, globalStorage, storage, state, action };\n"],"file":"RcModule.js"}