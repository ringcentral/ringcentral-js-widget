{"version":3,"sources":["lib/RcModule/RcModule.ts"],"names":["globalStorage","target","name","descriptor","_globalStorageSubKeys","storage","_storageSubKeys","track","trackEvent","value","initializer","Error","fn","trackedFn","parentModule","analytics","args","event","trackProps","call","apply","enumerable","configurable","RcModuleV2","options","__$$state$$__","_once","__key__","__subscriptions__","storageKey","_modulePath","_initialized","_suppressInit","_deps","_modules","enableStorage","reducer","reduce","reducerMap","key","state","_initialValue","type","states","indexOf","actionTypes","registerReducer","properties","propertiesMap","get","set","Object","defineProperties","enableGlobalStorage","params","modules","deps","rest","module","prototype","hasOwnProperty","defineProperty","modulePath","reducers","entries","Array","isArray","_state","getItem","assign","onInitOnce","store","subscribe","onStateChange","_shouldInit","__initModule__","_onInitOnce","onInit","__initSuccessModule__","onInitSuccess","_shouldReset","__resetModule__","onReset","__resetSuccessModule__","forEach","areAllReady","noReadyModulesLength","pending","areNotReady","ready","_getState","getState","__status__","moduleStatuses","initializing","resetting","enableCache","process","env","NODE_ENV","console","error","length","_arguments","enableGlobalCache","_getStorageState","_getGlobalStorageState","values","filter","BaseModule","action"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\n/* eslint-disable func-names */\nimport {\n  combineReducers,\n  Reducer,\n  ReducersMapObject,\n  Action,\n  AnyAction,\n} from 'redux';\nimport Storage from 'ringcentral-integration/modules/Storage';\nimport GlobalStorage from 'ringcentral-integration/modules/GlobalStorage';\nimport { Analytics } from 'ringcentral-integration/modules/Analytics';\nimport BaseModule, { state, action } from '../usm-redux';\nimport { moduleStatuses } from '../../enums/moduleStatuses';\nimport { Store, Params } from '../usm/core/module';\nimport { Properties } from '../usm/utils/flatten';\n\n// TODO: `_getProxyState`.\n\nexport interface Descriptor<T> extends TypedPropertyDescriptor<T> {\n  initializer?(): T;\n}\n\n/**\n * decorate global storage state with `GlobalStorage` Module\n * @param target rc module\n * @param name sate key\n * @param descriptor descriptor\n */\nfunction globalStorage(\n  target: RcModuleV2,\n  name: string,\n  descriptor?: Descriptor<any>,\n): any {\n  target._globalStorageSubKeys = [\n    ...(target._globalStorageSubKeys || []),\n    name,\n  ];\n  return descriptor;\n}\n\n/**\n * decorate storage state with `Storage` Module\n * @param target RcModule\n * @param name state key\n * @param descriptor descriptor\n */\nfunction storage(\n  target: RcModuleV2,\n  name: string,\n  descriptor?: Descriptor<any>,\n): any {\n  target._storageSubKeys = [...(target._storageSubKeys || []), name];\n  return descriptor;\n}\n\ntype TrackEvent = string | ((...args: any) => [string, object?]);\n\nfunction track(trackEvent: TrackEvent) {\n  return (target: RcModuleV2, name: string, descriptor?: Descriptor<any>) => {\n    if (\n      typeof descriptor.value !== 'function' &&\n      typeof descriptor.initializer !== 'function'\n    ) {\n      throw new Error(`@track decorated '${name}' is not a method`);\n    }\n    let fn: (...args: any) => any = descriptor.value;\n    const initializer = descriptor.initializer;\n    const trackedFn = function(this: RcModuleV2, ...args: any) {\n      const { analytics } = this.parentModule as RcModuleV2<Properties<any>> & {\n        analytics: Analytics;\n      };\n      if (typeof analytics !== 'undefined') {\n        if (typeof trackEvent === 'string') {\n          analytics.track(trackEvent);\n        } else {\n          const [event, trackProps] = trackEvent(this, ...args);\n          analytics.track(event, trackProps);\n        }\n      }\n      if (typeof initializer === 'function') {\n        fn = initializer.call(this);\n      }\n      return fn.apply(this, args);\n    };\n    // the any type is just to be compatible with babel and tsc.\n    return {\n      enumerable: true,\n      configurable: true,\n      value: trackedFn,\n    } as any;\n  };\n}\n\ninterface RcModuleV2 {\n  _storageSubKeys: string[];\n  _globalStorageSubKeys: string[];\n}\n\ntype ReducersMap = ReducersMapObject<\n  any,\n  Action & { states: Record<string, any> }\n>;\n\ntype Options = {\n  deps?: Record<string, any>;\n  enableCache?: boolean;\n  enableGlobalCache?: boolean;\n  storageKey?: string;\n};\n\nclass RcModuleV2<\n  T extends { storage?: Storage; globalStorage?: GlobalStorage } & Record<\n    string,\n    any\n  > = {},\n  S extends Record<string, any> = {}\n> extends BaseModule<T> {\n  __$$state$$__: any;\n  /**\n   * `onInit` life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInit?(): Promise<void> | void;\n  /**\n   * `onInitSuccess` life cycle for current initialization after this module is ready.\n   */\n  protected onInitSuccess?(): Promise<void> | void;\n  /**\n   * `onReset` life cycle for current reset before one of deps modules is not ready.\n   */\n  protected onReset?(): Promise<void> | void;\n  /**\n   * `onInitOnce` once life cycle for current initialization before all deps modules are all ready.\n   */\n  protected onInitOnce?(): Promise<void> | void;\n  protected _once = false;\n  public __key__?: string;\n  public __subscriptions__?: (() => void)[];\n  public storageKey: string;\n  public _modulePath?: string;\n  public _initialized = false;\n  public _suppressInit?: boolean;\n  protected _deps: T;\n\n  constructor(options: Options, ...args: any[]) {\n    super(options as any, ...args);\n    this._modulePath = 'root';\n    this._deps = this._modules;\n    if (this.enableStorage) {\n      // TODO replace new way for `storageKey` definition\n      this.storageKey = options.storageKey;\n      const reducer = combineReducers(\n        this._storageSubKeys.reduce((reducerMap: ReducersMap, key) => {\n          reducerMap[key] = (\n            state = this._initialValue[key],\n            { type, states },\n          ) => {\n            if (\n              type &&\n              type.indexOf((this.actionTypes as Record<string, string>)[key]) >\n                -1\n            ) {\n              return states[key];\n            }\n            return state;\n          };\n          return reducerMap;\n        }, {}),\n      );\n      this._modules.storage.registerReducer({\n        key: this.storageKey,\n        reducer,\n      });\n      const properties = this._storageSubKeys.reduce(\n        (propertiesMap: Record<string, PropertyDescriptor>, key) => {\n          propertiesMap[key] = {\n            enumerable: true,\n            configurable: true,\n            get(this: BaseModule) {\n              return this.state[key];\n            },\n            set(this: BaseModule, value: unknown) {\n              this.state[key] = value;\n            },\n          };\n          return propertiesMap;\n        },\n        {},\n      );\n      Object.defineProperties(this, properties);\n    }\n    if (this.enableGlobalStorage) {\n      this.storageKey = options.storageKey;\n      const reducer = combineReducers(\n        this._globalStorageSubKeys.reduce((reducerMap: ReducersMap, key) => {\n          reducerMap[key] = (\n            state = this._initialValue[key],\n            { type, states },\n          ) => {\n            if (\n              type &&\n              type.indexOf((this.actionTypes as Record<string, string>)[key]) >\n                -1\n            ) {\n              return states[key];\n            }\n            return state;\n          };\n          return reducerMap;\n        }, {}),\n      );\n      this._modules.globalStorage.registerReducer({\n        key: this.storageKey,\n        reducer,\n      });\n      const properties = this._globalStorageSubKeys.reduce(\n        (propertiesMap: Record<string, PropertyDescriptor>, key) => {\n          propertiesMap[key] = {\n            enumerable: true,\n            configurable: true,\n            get(this: BaseModule) {\n              return this.state[key];\n            },\n            set(this: BaseModule, value: unknown) {\n              this.state[key] = value;\n            },\n          };\n          return propertiesMap;\n        },\n        {},\n      );\n      Object.defineProperties(this, properties);\n    }\n  }\n\n  public _handleArgs(params?: any): Params<T> {\n    if (typeof params === 'undefined') {\n      return {\n        modules: {} as T,\n      };\n    }\n    const { deps, ...rest } = params;\n    return {\n      modules: deps,\n      ...rest,\n    };\n  }\n\n  get modulePath() {\n    return this._modulePath;\n  }\n\n  /**\n   * harmony with RcModule V1 for modules initialization\n   * @param name module key\n   * @param module RcModule\n   */\n  addModule(name: string, module: unknown) {\n    if (Object.prototype.hasOwnProperty.call(this, name)) {\n      throw new Error(`Property '${name}' already exists...`);\n    }\n    Object.defineProperty(this, name, {\n      get() {\n        return module;\n      },\n      enumerable: true,\n    });\n    if ((this as any)[name]._modulePath === 'root') {\n      (this as any)[name]._modulePath = `${this.modulePath}.${name}`;\n    }\n  }\n\n  get enableStorage() {\n    if (\n      this.enableCache &&\n      (typeof this._modules.storage === 'undefined' ||\n        this._modules.storage === null)\n    ) {\n      if (process.env.NODE_ENV === 'development') {\n        console.error(\n          `Dependent 'Storage' module was not imported in the ${this.__key__} module.`,\n        );\n      }\n    }\n    return (\n      this.enableCache &&\n      !!this._modules.storage &&\n      Array.isArray(this._storageSubKeys) &&\n      this._storageSubKeys.length > 0\n    );\n  }\n\n  get enableCache(): boolean {\n    return (this._arguments as any).enableCache;\n  }\n\n  get enableGlobalStorage() {\n    if (\n      this.enableGlobalCache &&\n      (typeof this._modules.globalStorage === 'undefined' ||\n        this._modules.globalStorage === null)\n    ) {\n      if (process.env.NODE_ENV === 'development') {\n        console.error(\n          `Dependent 'GlobalStorage' module was not imported in the module.`,\n        );\n      }\n    }\n    return (\n      this.enableGlobalCache &&\n      !!this._modules.globalStorage &&\n      Array.isArray(this._globalStorageSubKeys) &&\n      this._globalStorageSubKeys.length > 0\n    );\n  }\n\n  get enableGlobalCache(): boolean {\n    return (this._arguments as any).enableGlobalCache;\n  }\n\n  public getReducers(actionTypes: any) {\n    const reducers = super.getReducers(actionTypes);\n    if (!this.enableStorage && !this.enableGlobalStorage) return reducers;\n    return Object.entries(reducers).reduce(\n      (reducers: Properties<Reducer<any, AnyAction>>, [key, reducer]) => {\n        if (\n          (!Array.isArray(this._storageSubKeys) ||\n            this._storageSubKeys.indexOf(key) === -1 ||\n            !this.enableStorage) &&\n          (!Array.isArray(this._globalStorageSubKeys) ||\n            this._globalStorageSubKeys.indexOf(key) === -1 ||\n            !this.enableGlobalStorage)\n        ) {\n          reducers[key] = reducer;\n        }\n        return reducers;\n      },\n      {},\n    );\n  }\n\n  public get state(): S & { __status__: string } {\n    if (this.__$$state$$__) {\n      return this.__$$state$$__;\n    }\n    if (!this.enableStorage && !this.enableGlobalStorage) {\n      return {\n        ...this._getState(),\n      };\n    }\n    return {\n      ...this._getState(),\n      ...this._getStorageState(),\n      ...this._getGlobalStorageState(),\n    };\n  }\n\n  _getStorageState() {\n    if (!this._storageSubKeys || !this.enableStorage) return {};\n    return this._storageSubKeys.reduce((_state, key) => {\n      let value;\n      if (this.enableStorage) {\n        value = this._modules.storage.getItem(this.storageKey)\n          ? this._modules.storage.getItem(this.storageKey)[key]\n          : this._initialValue[key];\n      } else {\n        value = this.state[key];\n      }\n      return Object.assign(_state, {\n        [key]: value,\n      });\n    }, {});\n  }\n\n  _getGlobalStorageState() {\n    if (!this._globalStorageSubKeys || !this.enableGlobalStorage) return {};\n    return this._globalStorageSubKeys.reduce((_state, key) => {\n      let value;\n      if (this.enableGlobalStorage) {\n        value = this._modules.globalStorage.getItem(this.storageKey)\n          ? this._modules.globalStorage.getItem(this.storageKey)[key]\n          : this._initialValue[key];\n      } else {\n        value = this.state[key];\n      }\n      return Object.assign(_state, {\n        [key]: value,\n      });\n    }, {});\n  }\n\n  async _onInitOnce() {\n    if (!this._once) {\n      this._once = true;\n      if (typeof this.onInitOnce === 'function') {\n        await this.onInitOnce();\n      }\n    }\n  }\n\n  initModule() {\n    this.parentModule.store.subscribe(async () => {\n      if (typeof this.onStateChange === 'function') {\n        this.onStateChange();\n      }\n      if (this._shouldInit()) {\n        this.__initModule__();\n        await this._onInitOnce();\n        if (typeof this.onInit === 'function') {\n          await this.onInit();\n        }\n        this.__initSuccessModule__();\n        if (typeof this.onInitSuccess === 'function') {\n          await this.onInitSuccess();\n        }\n      } else if (this._shouldReset()) {\n        this.__resetModule__();\n        if (typeof this.onReset === 'function') {\n          await this.onReset();\n        }\n        this.__resetSuccessModule__();\n      }\n    });\n    if (Array.isArray(this.__subscriptions__)) {\n      this.__subscriptions__.forEach((subscribe) => subscribe());\n    }\n  }\n\n  protected _onStateChange(): void {}\n\n  get noReadyModulesLength() {\n    const modules = Object.values(this._modules || {}).filter(\n      // In order to be compatible with RcModuleV1\n      (module: any) => module && typeof module.ready !== 'undefined',\n    );\n    return modules.filter((module: any) => !module.ready).length;\n  }\n\n  _shouldInit() {\n    const areAllReady = this.noReadyModulesLength === 0;\n    return areAllReady && this.pending;\n  }\n\n  _shouldReset() {\n    const areNotReady = this.noReadyModulesLength > 0;\n    return areNotReady && this.ready;\n  }\n\n  get _store() {\n    return this.parentModule?.store;\n  }\n\n  protected _setStore(store: Store) {\n    // Compatibility about Factory ModuleV1 and ModuleV2\n    if (typeof this.parentModule === 'undefined') {\n      this.parentModule = {\n        store,\n      } as RcModuleV2;\n    }\n  }\n\n  get reducer() {\n    return this.reducers as Reducer;\n  }\n\n  get _reducer() {\n    return this.reducer;\n  }\n\n  _getState(): S & { __status__: string } {\n    return (this.parentModule as RcModuleV2)._getState\n      ? ((this.parentModule as RcModuleV2)._getState() as Record<string, any>)[\n          this.__key__\n        ]\n      : this.parentModule.store.getState();\n  }\n\n  get __name__() {\n    return this.__key__;\n  }\n\n  @state __status__: string = moduleStatuses.pending;\n\n  @action\n  __initModule__() {\n    this.state.__status__ = moduleStatuses.initializing;\n  }\n\n  @action\n  __initSuccessModule__() {\n    this.state.__status__ = moduleStatuses.ready;\n  }\n\n  @action\n  __resetModule__() {\n    this.state.__status__ = moduleStatuses.resetting;\n  }\n\n  @action\n  __resetSuccessModule__() {\n    this.state.__status__ = moduleStatuses.pending;\n  }\n\n  public get status() {\n    return this.__status__;\n  }\n\n  public get pending() {\n    return this.__status__ === moduleStatuses.pending;\n  }\n\n  public get ready() {\n    return this.__status__ === moduleStatuses.ready;\n  }\n\n  public get resetting() {\n    return this.__status__ === moduleStatuses.resetting;\n  }\n}\n\nexport { RcModuleV2, globalStorage, storage, state, action, track };\n"],"file":"RcModule.js"}