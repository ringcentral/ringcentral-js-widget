{"version":3,"sources":["lib/track.ts"],"names":["track","trackEvent","target","name","descriptor","value","initializer","Error","fn","trackedFn","parentModule","analytics","call","args","result","apply","trackReturn","Array","isArray","event","trackProps","e","console","warn","identifierKey","enumerable","configurable"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;AAiBA;AACA;AACA;AACA;AACA;AACO,IAAMA,KAAK,GAAG,SAARA,KAAQ,CAACC,UAAD,EAA4B;AAC/C,SAAO,UAACC,MAAD,EAAqBC,IAArB,EAAmCC,UAAnC,EAAoE;AACzE,QACE,OAAOA,UAAU,CAACC,KAAlB,KAA4B,UAA5B,IACA,OAAOD,UAAU,CAACE,WAAlB,KAAkC,UAFpC,EAGE;AACA,YAAM,IAAIC,KAAJ,6BAA+BJ,IAA/B,uBAAN;AACD;;AACD,QAAIK,EAAyB,GAAGJ,UAAU,CAACC,KAA3C;AACA,QAAMC,WAAW,GAAGF,UAAU,CAACE,WAA/B,CARyE,CASzE;;AACA,QAAMG,SAAS,GAAG,SAAZA,SAAY,GAA0C;AAAA,iBACV,KAAKC,YADK;AAAA,UAClDC,SADkD,QAClDA,SADkD;;AAE1D,UAAI,OAAOL,WAAP,KAAuB,UAA3B,EAAuC;AACrCE,QAAAA,EAAE,GAAGF,WAAW,CAACM,IAAZ,CAAiB,IAAjB,CAAL;AACD;;AACD,UAAI,OAAOJ,EAAP,KAAc,UAAlB,EAA8B;AAC5B,cAAM,IAAID,KAAJ,6BAA+BJ,IAA/B,yBAAN;AACD;;AAPyD,wCAAXU,IAAW;AAAXA,QAAAA,IAAW;AAAA;;AAQ1D,UAAMC,MAAM,GAAGN,EAAE,CAACO,KAAH,CAAS,IAAT,EAAeF,IAAf,CAAf;;AACA,UAAI;AACF,YAAI,QAAOF,SAAP,aAAOA,SAAP,uBAAOA,SAAS,CAAEX,KAAlB,MAA4B,UAAhC,EAA4C;AAC1C,cAAI,OAAOC,UAAP,KAAsB,QAA1B,EAAoC;AAClCU,YAAAA,SAAS,CAACX,KAAV,CAAgBC,UAAhB;AACD,WAFD,MAEO;AACL,gBAAIe,WAAW,GAAGf,UAAU,MAAV,UAAW,IAAX,SAAoBY,IAApB,EAAlB;;AACA,gBAAI,OAAOG,WAAP,KAAuB,UAA3B,EAAuC;AACrCA,cAAAA,WAAW,GAAGA,WAAW,CAACL,SAAD,CAAzB;AACD;;AACD,gBAAIM,KAAK,CAACC,OAAN,CAAcF,WAAd,CAAJ,EAAgC;AAAA,iCACFA,WADE;AAAA;AAAA,kBACvBG,KADuB;AAAA,kBAChBC,UADgB;;AAE9B,kBAAID,KAAJ,EAAW;AACTR,gBAAAA,SAAS,CAACX,KAAV,CAAgBmB,KAAhB,EAAuBC,UAAvB;AACD;AACF;AACF;AACF;AACF,OAjBD,CAiBE,OAAOC,CAAP,EAAU;AACVC,QAAAA,OAAO,CAACC,IAAR,4BAAiCrB,MAAM,CAACsB,uBAAD,CAAvC,cAA0DrB,IAA1D;AACD;;AACD,aAAOW,MAAP;AACD,KA9BD,CAVyE,CAyCzE;;;AACA,WAAO;AACLW,MAAAA,UAAU,EAAE,IADP;AAELC,MAAAA,YAAY,EAAE,IAFT;AAGLrB,MAAAA,KAAK,EAAEI;AAHF,KAAP;AAKD,GA/CD;AAgDD,CAjDM","sourcesContent":["import { Descriptor, identifierKey, RcModuleV2 } from './RcModule';\n\n// TODO: move to `ringcentral-integration` package and import Analytics type\n\ntype Analytics = any;\n\ntype TrackEvent =\n  | string\n  | ((\n      ...args: any\n    ) =>\n      | (\n          | [string, object?]\n          | ((analytics: Analytics) => [string, object?] | void)\n        )\n      | void);\n\n/**\n * decorate a method with `Analytics` Module\n *\n * @param trackEvent define trackEvent for tracking\n */\nexport const track = (trackEvent: TrackEvent) => {\n  return (target: RcModuleV2, name: string, descriptor?: Descriptor<any>) => {\n    if (\n      typeof descriptor.value !== 'function' &&\n      typeof descriptor.initializer !== 'function'\n    ) {\n      throw new Error(`@track decorated '${name}' is not a method`);\n    }\n    let fn: (...args: any) => any = descriptor.value;\n    const initializer = descriptor.initializer;\n    // eslint-disable-next-line func-names\n    const trackedFn = function (this: RcModuleV2, ...args: any) {\n      const { analytics }: { analytics: Analytics } = this.parentModule as any;\n      if (typeof initializer === 'function') {\n        fn = initializer.call(this);\n      }\n      if (typeof fn !== 'function') {\n        throw new Error(`@track decorated '${name}' is not a function`);\n      }\n      const result = fn.apply(this, args);\n      try {\n        if (typeof analytics?.track === 'function') {\n          if (typeof trackEvent === 'string') {\n            analytics.track(trackEvent);\n          } else {\n            let trackReturn = trackEvent(this, ...args);\n            if (typeof trackReturn === 'function') {\n              trackReturn = trackReturn(analytics);\n            }\n            if (Array.isArray(trackReturn)) {\n              const [event, trackProps] = trackReturn;\n              if (event) {\n                analytics.track(event, trackProps);\n              }\n            }\n          }\n        }\n      } catch (e) {\n        console.warn(`Analytics Error: ${target[identifierKey]}.${name}`);\n      }\n      return result;\n    };\n    // the any type is just to be compatible with babel and tsc.\n    return {\n      enumerable: true,\n      configurable: true,\n      value: trackedFn,\n    } as any;\n  };\n};\n"],"file":"track.js"}