{"version":3,"sources":["lib/usm/index.ts"],"names":["createState","target","name","descriptor","_state","initializer","call","undefined","get","state","set","value","enumerable","configurable","action","fn","args","result","event","_events","emit","module","constructor","setComputed","selectors","states","slice","map","selector","computed"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;AAcA,SAASA,WAAT,CACEC,MADF,EAEEC,IAFF,EAGEC,UAHF,EAIE;AACAF,EAAAA,MAAM,CAACG,MAAP,qBACMH,MAAM,CAACG,MAAP,IAAiB,EADvB;AAGAH,EAAAA,MAAM,CAACG,MAAP,CAAcF,IAAd,IACEC,UAAU,IAAIA,UAAU,CAACE,WAAzB,GACIF,UAAU,CAACE,WAAX,CAAuBC,IAAvB,CAA4BL,MAA5B,CADJ,GAEIM,SAHN;;AAIA,MAAMC,GAAG,GAAG,SAANA,GAAM,GAAuB;AACjC,WAAO,KAAKC,KAAL,CAAWP,IAAX,CAAP;AACD,GAFD;;AAGA,MAAMQ,GAAG,GAAG,SAANA,GAAM,CAAuBC,KAAvB,EAAmC;AAC7C,SAAKF,KAAL,CAAWP,IAAX,IAAmBS,KAAnB;AACD,GAFD;;AAGA,SAAO;AACLC,IAAAA,UAAU,EAAE,IADP;AAELC,IAAAA,YAAY,EAAE,IAFT;AAGLL,IAAAA,GAAG,EAAHA,GAHK;AAILE,IAAAA,GAAG,EAAHA;AAJK,GAAP;AAMD;;AAED,SAASI,MAAT,CACEb,MADF,EAEEC,IAFF,EAGEC,UAHF,EAIE;AACA,MAAMY,EAAE,GAAGZ,UAAU,CAACQ,KAAtB;;AACAR,EAAAA,UAAU,CAACQ,KAAX,GAAmB,YAAoC;AAAA,sCAAVK,IAAU;AAAVA,MAAAA,IAAU;AAAA;;AACrD,QAAMC,MAAM,GAAGF,EAAE,CAACT,IAAH,OAAAS,EAAE,GAAM,IAAN,SAAeC,IAAf,EAAjB;;AACA,QAAIE,kBAAMC,OAAN,CAAcV,KAAlB,EAAyB;AACvBS,wBAAME,IAAN,CAAW,OAAX,EAAoB;AAAEN,QAAAA,MAAM,EAAEZ,IAAV;AAAgBmB,QAAAA,MAAM,EAAEpB,MAAM,CAACqB,WAAP,CAAmBpB;AAA3C,OAApB;AACD;;AACD,WAAOe,MAAP;AACD,GAND;;AAOA,SAAOd,UAAP;AACD;;AAED,SAASoB,WAAT,CACEtB,MADF,EAEEC,IAFF,EAGEC,UAHF,EAIE;AACA,SAAO;AACLS,IAAAA,UAAU,EAAE,IADP;AAELC,IAAAA,YAAY,EAAE,IAFT;AAGLL,IAAAA,GAHK,iBAGC;AACJ,UAAIL,UAAU,IAAI,OAAOA,UAAU,CAACE,WAAlB,KAAkC,UAApD,EAAgE;AAAA;;AAC9D,YAAMmB,SAAS,GAAGrB,UAAU,CAACE,WAAX,CAAuBC,IAAvB,CAA4B,IAA5B,CAAlB;AACA,YAAMmB,MAAM,GAAGD,SAAS,CACrBE,KADY,CACN,CADM,EACH,CAAC,CADE,EAEZC,GAFY,CAER,UAACC,QAAD;AAAA,iBAAwBA,QAAQ,EAAhC;AAAA,SAFQ,CAAf;AAGA,eAAO,oBAAAJ,SAAS,CAACE,KAAV,CAAgB,CAAC,CAAjB,GAAoB,CAApB,6CAA0BD,MAA1B,EAAP;AACD;AACF;AAXI,GAAP;AAaD;;AAED,IAAMhB,KAAmB,GAAGT,WAA5B;;AAEA,IAAM6B,QAAyB,GAAGN,WAAlC","sourcesContent":["/* eslint-disable func-names */\nimport Module from './core/module';\nimport event, { Event } from './utils/event';\n\ntype Selector = () => any;\ninterface Descriptor<T> extends TypedPropertyDescriptor<T> {\n  initializer(): T;\n}\n\ninterface ComputedFactory {\n  (target: Module, name: string, descriptor?: Descriptor<any>): any;\n}\ninterface StateFactory {\n  (target: Module, name: string, descriptor?: Descriptor<any>): any;\n}\n\nfunction createState(\n  target: Module,\n  name: string,\n  descriptor?: Descriptor<any>,\n) {\n  target._state = {\n    ...(target._state || {}),\n  };\n  target._state[name] =\n    descriptor && descriptor.initializer\n      ? descriptor.initializer.call(target)\n      : undefined;\n  const get = function(this: Module) {\n    return this.state[name];\n  };\n  const set = function(this: Module, value: any) {\n    this.state[name] = value;\n  };\n  return {\n    enumerable: true,\n    configurable: true,\n    get,\n    set,\n  };\n}\n\nfunction action(\n  target: Module,\n  name: string,\n  descriptor: TypedPropertyDescriptor<any>,\n) {\n  const fn = descriptor.value;\n  descriptor.value = function(this: Module, ...args: []) {\n    const result = fn.call(this, ...args);\n    if (event._events.state) {\n      event.emit('state', { action: name, module: target.constructor.name });\n    }\n    return result;\n  };\n  return descriptor;\n}\n\nfunction setComputed(\n  target: Module,\n  name: string,\n  descriptor?: Descriptor<any>,\n) {\n  return {\n    enumerable: true,\n    configurable: true,\n    get() {\n      if (descriptor && typeof descriptor.initializer === 'function') {\n        const selectors = descriptor.initializer.call(this);\n        const states = selectors\n          .slice(0, -1)\n          .map((selector: Selector) => selector());\n        return selectors.slice(-1)[0](...states);\n      }\n    },\n  };\n}\n\nconst state: StateFactory = createState;\n\nconst computed: ComputedFactory = setComputed;\n\nexport { Module as default, action, state, computed, event, Event };\n"],"file":"index.js"}