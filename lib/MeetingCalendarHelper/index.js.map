{"version":3,"sources":["lib/MeetingCalendarHelper/index.ts"],"names":["f1","str","length","slice","formatMeetingId","current","nextSlices","getPasswordTpl","password","currentLocale","passwordLiteral","i18n","getString","getBaseRcmTpl","brand","meeting","serviceInfo","extensionInfo","accountName","name","meetingId","id","joinUri","links","mobileDialingNumberTpl","phoneDialingNumberTpl","passwordTpl","teleconference","brandConfig","formattedMsg","brandName","formatTextToHtml","newLine","indentation","replace","repeat","getRcmEventTpl","mainInfo","getRcmHtmlEventTpl","rcvAttTeleconference","rcvTeleconference","attBrandId","getBaseRcvTpl","dialInNumber","pinNumber","shortId","productName","meetingContent","smartphones","dialNumber","getRcvEventTpl","getRcvHtmlEventTpl","getMeetingId","meetingUri","regs","REG_EXP","MEETING","RCV","i","matches","exec","match0","link","indexOf","substring","split"],"mappings":"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","sourcesContent":["import formatMessage from 'format-message';\nimport i18n from './i18n';\nimport { REG_EXP } from './config';\n\nfunction f1(str) {\n  if (str.length > 8 || str.length % 3 !== 2) {\n    return [str.slice(0, 3), str.slice(3)];\n  }\n  return [str.slice(0, 4), str.slice(4)];\n}\n\nexport function formatMeetingId(str) {\n  const [current, nextSlices] = f1(str);\n  if (!nextSlices) {\n    return current;\n  }\n  if (nextSlices.length === 1) {\n    return `${current}${nextSlices}`;\n  }\n  return `${current} ${formatMeetingId(nextSlices)}`;\n}\n\nfunction getPasswordTpl(password: string, currentLocale: string): string {\n  const passwordLiteral = i18n.getString('password', currentLocale);\n  return password\n    ? `\n    ${passwordLiteral}: ${password}`\n    : '';\n}\n\ninterface rcmMeeting {\n  id: string;\n  password: string;\n  links: { joinUri: string };\n}\n\ninterface rcvMeeting {\n  joinUri: string;\n  shortId: string;\n  links: { joinUri: string };\n}\n\ninterface rcmServiceInfo {\n  mobileDialingNumberTpl: string;\n  phoneDialingNumberTpl: string;\n}\n\ninterface commonExtensionInfo {\n  name: string;\n}\n\ninterface commonBrand {\n  name: string;\n  id: string;\n  brandConfig: {\n    teleconference: string;\n  };\n}\n\ninterface tplResult {\n  formattedMsg: string;\n  links: {\n    joinUri: string;\n    teleconference: string;\n  };\n}\n\ninterface rcmMainParams {\n  meeting: rcmMeeting;\n  serviceInfo: rcmServiceInfo;\n  extensionInfo: commonExtensionInfo;\n}\n\ninterface rcvMainParams {\n  meeting: rcvMeeting;\n  extensionInfo: commonExtensionInfo;\n  dialInNumber: string;\n}\n\nfunction getBaseRcmTpl(\n  { meeting, serviceInfo, extensionInfo }: rcmMainParams,\n  brand: commonBrand,\n  currentLocale: string,\n): tplResult {\n  const accountName = extensionInfo.name;\n  const meetingId = meeting.id;\n  const joinUri = meeting.links.joinUri;\n  const password = meeting.password;\n\n  const mobileDialingNumberTpl = serviceInfo.mobileDialingNumberTpl;\n  const phoneDialingNumberTpl = serviceInfo.phoneDialingNumberTpl;\n  const passwordTpl = getPasswordTpl(password, currentLocale);\n  const teleconference = brand.brandConfig.teleconference;\n\n  return {\n    formattedMsg: formatMessage(\n      i18n.getString('inviteMeetingContent', currentLocale),\n      {\n        accountName,\n        brandName: brand.name,\n        joinUri,\n        passwordTpl,\n        mobileDialingNumberTpl,\n        phoneDialingNumberTpl,\n        meetingId: formatMeetingId(meetingId),\n        teleconference,\n      },\n    ),\n    links: {\n      joinUri,\n      teleconference,\n    },\n  };\n}\n\nfunction formatTextToHtml({\n  formattedMsg,\n  links: { joinUri, teleconference },\n}: tplResult): string {\n  const newLine: string = '<br>';\n  const indentation: string = '&nbsp;';\n\n  return `<section>${newLine}${formattedMsg\n    .replace(/\\r\\n|\\n|\\r/g, newLine)\n    .replace(joinUri, `<a target=\"_blank\" href=\"${joinUri}\">${joinUri}</a>`)\n    .replace(\n      teleconference,\n      `<a target=\"_blank\" href=\"${teleconference}\">${teleconference}</a>`,\n    )\n    .replace(/\\t/g, indentation.repeat(4))}${newLine}</section>`;\n}\n\nexport function getRcmEventTpl(\n  mainInfo: rcmMainParams,\n  brand: commonBrand,\n  currentLocale: string,\n): string {\n  return getBaseRcmTpl(mainInfo, brand, currentLocale).formattedMsg;\n}\n\nexport function getRcmHtmlEventTpl(\n  mainInfo: rcmMainParams,\n  brand: commonBrand,\n  currentLocale: string,\n): string {\n  return formatTextToHtml(getBaseRcmTpl(mainInfo, brand, currentLocale));\n}\n\nconst rcvAttTeleconference: string =\n  'https://meetings.officeathand.att.com/teleconference';\nconst rcvTeleconference: string = 'https://v.ringcentral.com/teleconference/';\nconst attBrandId = '3420';\n\nfunction getBaseRcvTpl(\n  { meeting, extensionInfo, dialInNumber }: rcvMainParams,\n  brand: commonBrand,\n  currentLocale: string,\n): tplResult {\n  const accountName = extensionInfo.name;\n  const joinUri = meeting.joinUri;\n  const pinNumber = meeting.shortId;\n  let productName;\n  let meetingContent;\n  if (brand.name === 'RingCentral') {\n    productName = 'RingCentral Video';\n    meetingContent = i18n.getString(\n      'rcvRCBrandInviteMeetingContent',\n      currentLocale,\n    );\n  } else {\n    productName = brand.name;\n    meetingContent = i18n.getString('rcvInviteMeetingContent', currentLocale);\n  }\n  if (dialInNumber) {\n    meetingContent = `${meetingContent}${i18n.getString(\n      'rcvInviteMeetingContentDial',\n      currentLocale,\n    )}`;\n  }\n  meetingContent = `${meetingContent}\\n\\n${i18n.getString(\n    'rcvTeleconference',\n    currentLocale,\n  )}`;\n  const teleconference =\n    brand.id === attBrandId ? rcvAttTeleconference : rcvTeleconference;\n  const brandName = brand.id === attBrandId ? `AT&T ${brand.name}` : brand.name;\n  return {\n    formattedMsg: formatMessage(meetingContent, {\n      accountName,\n      brandName,\n      joinUri,\n      smartphones: `${dialInNumber},,${pinNumber}#`,\n      dialNumber: dialInNumber,\n      pinNumber: formatMeetingId(pinNumber),\n      teleconference,\n      productName,\n    }),\n    links: {\n      joinUri,\n      teleconference,\n    },\n  };\n}\n\nexport function getRcvEventTpl(\n  mainInfo: rcvMainParams,\n  brand: commonBrand,\n  currentLocale: string,\n): string {\n  return getBaseRcvTpl(mainInfo, brand, currentLocale).formattedMsg;\n}\n\nexport function getRcvHtmlEventTpl(\n  mainInfo: rcvMainParams,\n  brand: commonBrand,\n  currentLocale: string,\n): string {\n  return formatTextToHtml(getBaseRcvTpl(mainInfo, brand, currentLocale));\n}\n\nexport function getMeetingId(meetingUri: string) {\n  if (meetingUri) {\n    const regs = [REG_EXP.MEETING, REG_EXP.RCV];\n    for (let i = 0; i < regs.length; i += 1) {\n      const matches = regs[i].exec(meetingUri);\n      if (matches && matches.length > 0) {\n        const match0 = matches[0];\n        const link = (match0.indexOf('?') > -1\n          ? matches[0].substring(0, matches[0].indexOf('?'))\n          : match0\n        ).split('/');\n\n        const id = link[link.length - 1];\n\n        return id;\n      }\n    }\n  }\n\n  return null;\n}\n"],"file":"index.js"}