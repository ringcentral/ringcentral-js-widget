{"version":3,"sources":["lib/callLogHelpers.js"],"names":["isInbound","call","direction","callDirections","inbound","isOutbound","outbound","isRinging","telephonyStatus","telephonyStatuses","ringing","isRingingInboundCall","callResultsToMissedMap","ObjectMap","fromObject","result","key","callResults","item","missed","hangUp","busy","voicemail","rejected","Object","keys","isMissed","hasRingingCalls","calls","find","isEnded","noCall","terminationType","terminationTypes","hasEndedCalls","isOnHold","onHold","isIntermediateCall","intermediate","isSelfCall","to","from","phoneNumber","sortBySessionId","a","b","sessionId","sortByStartTime","startTime","normalizeStartTime","valueOf","normalizeFromTo","areTwoLegs","Math","abs","action","callActions","phoneCall","ringOutWeb","ringOutPC","ringOutMobile","extensionNumber","removeInboundRingOutLegs","output","outbounds","filter","forEach","outboundIndex","findIndex","splice","outboundLeg","inboundLeg","push","concat","removeDuplicateIntermediateCalls","resultCalls","indexMap","isIntermediate","sessionid","index","length","removeDuplicateSelfCalls","isSelf","getPhoneNumberMatches","toMatches","fromMatches","isOutboundCall","isInboundCall","matches"],"mappings":"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","sourcesContent":["import { find, isEmpty, reduce } from 'ramda';\nimport moment from 'moment';\nimport {\n  isValidNumber,\n  isSameLocalNumber,\n} from '@ringcentral-integration/phone-number';\nimport { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap'\nimport callActions from '../enums/callActions';\nimport callDirections from '../enums/callDirections';\nimport callResults from '../enums/callResults';\nimport telephonyStatuses from '../enums/telephonyStatus';\nimport terminationTypes from '../enums/terminationTypes';\n// import i18n from './i18n';\n\n/* call direction helpers */\nexport function isInbound(call = {}) {\n  return call.direction === callDirections.inbound;\n}\n\nexport function isOutbound(call = {}) {\n  return call.direction === callDirections.outbound;\n}\n\n/* status helpers */\nexport function isRinging(call = {}) {\n  return call.telephonyStatus === telephonyStatuses.ringing;\n}\nexport function isRingingInboundCall(call) {\n  return isRinging(call) && isInbound(call);\n}\n\nconst callResultsToMissedMap = ObjectMap.fromObject(\n  reduce(\n    (result, key) => {\n      result[callResults[key]] = !!find((item) => item === callResults[key], [\n        callResults.missed,\n        callResults.hangUp,\n        // callResults.HangUp,\n        callResults.busy,\n        callResults.voicemail,\n        callResults.rejected,\n      ]);\n      return result;\n    },\n    {},\n    Object.keys(callResults),\n  ),\n);\n\nexport function isMissed(call = {}) {\n  return !!callResultsToMissedMap[call.result];\n}\n\nexport function hasRingingCalls(calls = []) {\n  return !!calls.find(isRinging);\n}\n\nexport function isEnded(call = {}) {\n  return (\n    call.telephonyStatus === telephonyStatuses.noCall &&\n    call.terminationType === terminationTypes.final\n  );\n}\n\nexport function hasEndedCalls(calls) {\n  return !!calls.find(isEnded);\n}\n\nexport function isOnHold(call = {}) {\n  return call.telephonyStatus === telephonyStatuses.onHold;\n}\n\nexport function isIntermediateCall(call = {}) {\n  return call.terminationType === terminationTypes.intermediate;\n}\n\nexport function isSelfCall(call = {}) {\n  if (call.to && call.from) {\n    return call.to.phoneNumber === call.from.phoneNumber;\n  }\n  return false;\n}\n\n/* sort functions */\n\nexport function sortBySessionId(a, b) {\n  if (a.sessionId === b.sessionId) return 0;\n  return a.sessionId > b.sessionId ? 1 : -1;\n}\nexport function sortByStartTime(a, b) {\n  if (a.startTime === b.startTime) return 0;\n  return a.startTime > b.startTime ? -1 : 1;\n}\n\nexport function normalizeStartTime(call) {\n  const result = {\n    ...call,\n  };\n  if (call.startTime) {\n    // Fix: Safari doesn't support timezone offset\n    // `startTime` might switch between `2019-10-18T08:18:47.972+0000`\n    // and `2019-10-18T08:18:47.972Z`\n    result.startTime = moment(call.startTime).valueOf();\n  }\n  return result;\n}\n\nexport function normalizeFromTo(call) {\n  return {\n    ...call,\n    from:\n      typeof call.from === 'object' ? call.from : { phoneNumber: call.from },\n    to: typeof call.to === 'object' ? call.to : { phoneNumber: call.to },\n  };\n}\n\n/* ringout leg helpers */\nexport function areTwoLegs(inbound, outbound) {\n  if (isInbound(inbound) && isOutbound(outbound)) {\n    switch (Math.abs(inbound.sessionId - outbound.sessionId)) {\n      case 1000:\n      case 2000:\n      case 3000:\n      case 4000: {\n        // presence\n        if (\n          inbound.from &&\n          inbound.to &&\n          outbound.from &&\n          outbound.to &&\n          isSameLocalNumber(\n            inbound.from.phoneNumber,\n            outbound.to.phoneNumber,\n          ) &&\n          isSameLocalNumber(inbound.to.phoneNumber, outbound.from.phoneNumber)\n        ) {\n          return true;\n        }\n        // call-log\n        if (\n          inbound.from &&\n          inbound.to &&\n          outbound.from &&\n          outbound.to &&\n          inbound.action === callActions.phoneCall &&\n          (outbound.action === callActions.ringOutWeb ||\n            outbound.action === callActions.ringOutPC ||\n            outbound.action === callActions.ringOutMobile) &&\n          (inbound.from.phoneNumber === outbound.from.phoneNumber ||\n            inbound.from.extensionNumber === outbound.from.extensionNumber) &&\n          inbound.to.phoneNumber === outbound.to.phoneNumber\n        ) {\n          return true;\n        }\n        break;\n      }\n      default:\n        return false;\n    }\n  }\n  return false;\n}\n\nexport function removeInboundRingOutLegs(calls) {\n  const output = [];\n  const outbounds = calls.filter(isOutbound);\n  calls.filter(isInbound).forEach((inbound) => {\n    const outboundIndex = outbounds.findIndex((call) =>\n      areTwoLegs(inbound, call),\n    );\n    if (outboundIndex > -1) {\n      const outbound = outbounds.splice(outboundIndex, 1)[0];\n\n      if (inbound.action && outbound.action) {\n        // from call-log\n        const call = {\n          ...outbound,\n          outboundLeg: outbound,\n          inboundLeg: inbound,\n          from: {\n            ...inbound.from,\n          },\n          to: {\n            ...inbound.to,\n          },\n          result: inbound.result,\n        };\n        output.push(call);\n      } else {\n        const call = {\n          ...outbound,\n          outboundLeg: outbound,\n          inboundLeg: inbound,\n        };\n        // Handle inboundLeg.from is '+19072028624', but outboundLeg.to is '9072028624'\n        // https://jira.ringcentral.com/browse/RCINT-3127\n        if (\n          isValidNumber(inbound.from && inbound.from.phoneNumber) &&\n          isSameLocalNumber(\n            inbound.from.phoneNumber,\n            outbound.to && outbound.to.phoneNumber,\n          )\n        ) {\n          call.to = {\n            ...outbound.to,\n            phoneNumber: inbound.from.phoneNumber,\n          };\n          outbound.to.phoneNumber = inbound.from.phoneNumber;\n        }\n        if (isOnHold(inbound)) {\n          call.telephonyStatus = telephonyStatuses.onHold;\n        }\n        output.push(call);\n      }\n\n      // output.push(outbound);\n    } else {\n      output.push(inbound);\n    }\n  });\n  return output.concat(outbounds);\n}\n\nexport function removeDuplicateIntermediateCalls(calls) {\n  const resultCalls = [];\n  const indexMap = {};\n  calls.forEach((call) => {\n    const isIntermediate = isIntermediateCall(call);\n    if (!indexMap[call.sessionId]) {\n      indexMap[call.sessionid] = {\n        index: resultCalls.length,\n        isIntermediate,\n      };\n      resultCalls.push(call);\n    } else if (!isIntermediate) {\n      indexMap[call.sessionId].isIntermediate = false;\n      resultCalls[indexMap[call.sessionId].index] = call;\n    }\n  });\n  return resultCalls;\n}\n\n// there are two active calls with same sessionId when user call self.\nexport function removeDuplicateSelfCalls(calls) {\n  const resultCalls = [];\n  const indexMap = {};\n  calls.forEach((call) => {\n    const isSelf = isSelfCall(call);\n    if (!indexMap[call.sessionId]) {\n      indexMap[call.sessionid] = {\n        index: resultCalls.length,\n        isSelf,\n      };\n      resultCalls.push(call);\n    } else if (!isSelf) {\n      indexMap[call.sessionId].isSelf = false;\n      resultCalls[indexMap[call.sessionId].index] = call;\n    }\n  });\n  return resultCalls;\n}\n\n// Get phone number and matches.\nexport function getPhoneNumberMatches(call = {}) {\n  const {\n    to = {},\n    from = {},\n    // sessionId,\n    toMatches,\n    fromMatches,\n  } = call;\n  if (isEmpty(call)) {\n    return {};\n  }\n  const isOutboundCall = isOutbound(call);\n  const isInboundCall = isInbound(call);\n  let phoneNumber = null;\n  let matches = null;\n  if (isOutboundCall) {\n    phoneNumber = to.phoneNumber || to.extensionNumber;\n    matches = toMatches;\n  } else if (isInboundCall) {\n    phoneNumber = from.phoneNumber || from.extensionNumber;\n    matches = fromMatches;\n  }\n  // if (!phoneNumber || !matches) {\n  //   console.warn(`Call sessionId: ${sessionId} is abnormal data.`);\n  // }\n  return {\n    phoneNumber,\n    matches,\n  };\n}\n"],"file":"callLogHelpers.js"}