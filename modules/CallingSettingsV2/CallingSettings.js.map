{"version":3,"sources":["modules/CallingSettingsV2/CallingSettings.ts"],"names":["LOCATION_NUMBER_ORDER","CallingSettings","name","deps","dep","optional","that","_deps","extensionPhoneNumber","directNumbers","mainCompanyNumber","extensionInfo","extensionNumber","forwardingNumber","flipNumbers","callerIdNumbers","rolesAndPermissions","ringoutEnabled","webphoneEnabled","otherPhoneNumbers","length","numbers","myPhoneNumbers","availableNumbers","enableCache","storageKey","_myPhoneNumbers","_onFirstLogin","_ringoutEnabled","_otherPhoneNumbers","_webphoneEnabled","initRingoutPrompt","_showCallWithJupiter","_emergencyCallAvailable","_availableNumbers","callingSettingsOptions","onFirstLogin","defaultRingoutPrompt","showCallWithJupiter","emergencyCallAvailable","callWith","ringoutPrompt","myLocation","timestamp","isCustomLocation","number","fromNumber","phoneNumber","_shouldReset","__resetSuccessModule__","_shouldValidate","_validateSettings","ready","_init","resetSuccess","callingEnabled","defaultCallWith","callWithOptions","setDataAction","Date","now","_warningEmergencyCallingNotAvailable","deprecatedCallingOptions","myphone","otherphone","customphone","callingOptions","ringout","_initFromNumber","browser","alert","info","message","callingSettingsMessages","emergencyCallingNotAvailable","ttl","_hasWebphonePermissionRemoved","_setSoftPhoneToCallWith","danger","webphonePermissionRemoved","_hasPermissionChanged","permissionChanged","_hasPhoneNumberChanged","phoneNumberChanged","softphone","webphone","indexOf","devices","extensionDevice","mainPhoneNumber","registedWithDevice","forEach","device","phoneLines","find","phoneLine","phoneInfo","isFlipNumber","flipNumber","label","defaultCallerId","fromNumbers","callerId","ringOut","type","defaultPhoneNumber","defaultEntry","item","updateFromNumber","withPrompt","saveSuccessWithSoftphone","jupiter","saveSuccessWithJupiter","saveSuccess","map","push","filterMapping","filter","sort","a","b","hasExtensionPhoneNumber","brand","code","brandConfig","brandCode","sortedPhoneNumbers","firstItem","lastItem","usageType","concat","result","locationLabel","_getLocationLabel","value","callingMode","callingModes","storage","driver","RcModuleV2","state","action","proxify"],"mappings":"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","sourcesContent":["import {\n  state,\n  action,\n  storage,\n  computed,\n  RcModuleV2,\n} from '@ringcentral-integration/core';\nimport { Deps } from './CallingSettings.interface';\nimport { Module } from '../../lib/di';\nimport { callingModes } from './callingModes';\nimport { CallingOptionsType, callingOptions } from './callingOptions';\nimport proxify from '../../lib/proxy/proxify';\nimport { mapOptionToMode } from './mapOptionToMode';\nimport { callingSettingsMessages } from './callingSettingsMessages';\nimport { deprecatedCallingOptions } from './deprecatedCallingOptions';\n\nconst LOCATION_NUMBER_ORDER = ['Other', 'Main'];\n/**\n * @class\n * @description Call setting managing module\n */\n@Module({\n  name: 'CallingSettings',\n  deps: [\n    'Alert',\n    'Brand',\n    'Storage',\n    'ExtensionInfo',\n    'ExtensionDevice',\n    'ForwardingNumber',\n    'RolesAndPermissions',\n    'ExtensionPhoneNumber',\n    { dep: 'CallerId', optional: true },\n    { dep: 'Webphone', optional: true },\n    { dep: 'TabManager', optional: true },\n    { dep: 'CallingSettingsOptions', optional: true },\n  ],\n})\nclass CallingSettings extends RcModuleV2<Deps> {\n  _myPhoneNumbers: string[];\n  _onFirstLogin?: () => {};\n  _ringoutEnabled: boolean;\n  _otherPhoneNumbers: string[];\n  _webphoneEnabled: boolean;\n  initRingoutPrompt?: boolean;\n  _showCallWithJupiter?: boolean;\n  _emergencyCallAvailable?: boolean;\n  _availableNumbers: string[];\n\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Alert} params.alert - alert module instance\n   * @param {Brand} params.brand - brand module instance\n   * @param {ExtensionInfo} params.extensionInfo - extensionInfo module instance\n   * @param {ExtensionPhoneNumber} params.extensionPhoneNumber - extensionPhoneNumber module instance\n   * @param {ForwardingNumber} params.forwardingNumber - forwardingNumber module instance\n   * @param {Storage} params.storage - storage module instance\n   * @param {RolesAndPermissions} params.rolesAndPermissions - rolesAndPermissions module instance\n   * @param {TabManager} params.tabManager - tabManager module instance\n   * @param {Webphone} params.webphone - webphone module instance\n   * @param {Function} params.onFirstLogin - func on first login\n   */\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'callingSettingsData',\n    });\n    this._onFirstLogin = this._deps.callingSettingsOptions?.onFirstLogin;\n    this.initRingoutPrompt = this._deps.callingSettingsOptions?.defaultRingoutPrompt;\n    this._showCallWithJupiter =\n      this._deps.callingSettingsOptions?.showCallWithJupiter ?? true;\n    this._emergencyCallAvailable =\n      this._deps.callingSettingsOptions?.emergencyCallAvailable ?? false;\n  }\n\n  @storage\n  @state\n  callWith: string = null;\n\n  @storage\n  @state\n  ringoutPrompt: boolean = true;\n\n  @storage\n  @state\n  myLocation: string = '';\n\n  @storage\n  @state\n  fromNumber: string = null;\n\n  @storage\n  @state\n  timestamp: number = null;\n\n  @storage\n  @state\n  isCustomLocation: boolean = false;\n\n  @action\n  setDataAction({\n    callWith = this.callWith,\n    ringoutPrompt = this.ringoutPrompt,\n    myLocation = this.myLocation,\n    timestamp = this.timestamp,\n    isCustomLocation = this.isCustomLocation,\n  }: {\n    callWith?: CallingOptionsType;\n    ringoutPrompt?: boolean;\n    myLocation?: string;\n    timestamp?: number;\n    isCustomLocation?: boolean;\n  }) {\n    this.callWith = callWith;\n    this.ringoutPrompt = ringoutPrompt;\n    this.myLocation = myLocation;\n    this.timestamp = timestamp;\n    this.isCustomLocation = isCustomLocation;\n  }\n\n  @proxify\n  @action\n  async updateFromNumber(number: { phoneNumber?: string }) {\n    this.fromNumber = number && number?.phoneNumber;\n  }\n\n  @action\n  resetSuccess() {\n    this.fromNumber = null;\n  }\n\n  async onStateChange() {\n    if (this._shouldReset()) {\n      this.__resetSuccessModule__();\n    } else if (this._shouldValidate()) {\n      this._ringoutEnabled = this._deps.rolesAndPermissions.ringoutEnabled;\n      this._webphoneEnabled = this._deps.rolesAndPermissions.webphoneEnabled;\n      this._myPhoneNumbers = this.myPhoneNumbers;\n      this._otherPhoneNumbers = this.otherPhoneNumbers;\n      await this._validateSettings();\n    }\n  }\n\n  _shouldValidate() {\n    return (\n      this.ready &&\n      (this._ringoutEnabled !== this._deps.rolesAndPermissions.ringoutEnabled ||\n        this._webphoneEnabled !==\n          this._deps.rolesAndPermissions.webphoneEnabled ||\n        this._myPhoneNumbers !== this.myPhoneNumbers ||\n        this._otherPhoneNumbers !== this.otherPhoneNumbers)\n    );\n  }\n\n  async onInit() {\n    await this._init();\n  }\n\n  onReset() {\n    this.resetSuccess();\n  }\n\n  async _init() {\n    if (!this._deps.rolesAndPermissions.callingEnabled) return;\n    this._myPhoneNumbers = this.myPhoneNumbers;\n    this._otherPhoneNumbers = this.otherPhoneNumbers;\n    this._availableNumbers = this.availableNumbers;\n    this._ringoutEnabled = this._deps.rolesAndPermissions.ringoutEnabled;\n    this._webphoneEnabled = this._deps.rolesAndPermissions.webphoneEnabled;\n    if (!this.timestamp) {\n      // first time login\n      const defaultCallWith = this.callWithOptions && this.callWithOptions[0];\n      this.setDataAction({ callWith: defaultCallWith, timestamp: Date.now() });\n      if (!this._emergencyCallAvailable) {\n        this._warningEmergencyCallingNotAvailable();\n      }\n      if (typeof this._onFirstLogin === 'function') {\n        this._onFirstLogin();\n      }\n    }\n    if (\n      this.callWith === deprecatedCallingOptions.myphone ||\n      this.callWith === deprecatedCallingOptions.otherphone ||\n      this.callWith === deprecatedCallingOptions.customphone\n    ) {\n      this.setDataAction({\n        callWith: callingOptions.ringout,\n        isCustomLocation:\n          this.callWith === deprecatedCallingOptions.customphone,\n      });\n    }\n    await this._validateSettings();\n    await this._initFromNumber();\n  }\n\n  @proxify\n  async _warningEmergencyCallingNotAvailable() {\n    if (this.callWith === callingOptions.browser) {\n      this._deps.alert.info({\n        message: callingSettingsMessages.emergencyCallingNotAvailable,\n        ttl: 0,\n      });\n    }\n  }\n\n  @proxify\n  async _validateSettings() {\n    if (this._hasWebphonePermissionRemoved()) {\n      await this._setSoftPhoneToCallWith();\n      this._deps.alert.danger({\n        message: callingSettingsMessages.webphonePermissionRemoved,\n        ttl: 0,\n      });\n    } else if (this._hasPermissionChanged()) {\n      await this._setSoftPhoneToCallWith();\n      this._deps.alert.danger({\n        message: callingSettingsMessages.permissionChanged,\n        ttl: 0,\n      });\n    } else if (this._hasPhoneNumberChanged()) {\n      this.setDataAction({\n        callWith: callingOptions.ringout,\n        myLocation: this._myPhoneNumbers[0],\n        timestamp: Date.now(),\n      });\n      this._deps.alert.danger({\n        message: callingSettingsMessages.phoneNumberChanged,\n        ttl: 0,\n      });\n    }\n  }\n\n  @proxify\n  async _setSoftPhoneToCallWith() {\n    this.setDataAction({\n      callWith: callingOptions.softphone,\n      timestamp: Date.now(),\n    });\n  }\n\n  _hasWebphonePermissionRemoved() {\n    return (\n      !(this._webphoneEnabled && this._deps.webphone) &&\n      this.callWith === callingOptions.browser\n    );\n  }\n\n  _hasPermissionChanged() {\n    return !this._ringoutEnabled && this.callWith === callingOptions.ringout;\n  }\n\n  _hasPhoneNumberChanged() {\n    return (\n      this.callWith === callingOptions.ringout &&\n      !this.isCustomLocation &&\n      this._availableNumbers.indexOf(this.myLocation) === -1\n    );\n  }\n\n  _getLocationLabel(phoneNumber: string) {\n    const { devices } = this._deps.extensionDevice;\n    const { flipNumbers } = this._deps.forwardingNumber;\n    const { mainCompanyNumber } = this._deps.extensionPhoneNumber;\n    const { extensionNumber } = this._deps.extensionInfo;\n    const mainPhoneNumber = `${mainCompanyNumber.phoneNumber}*${extensionNumber}`;\n    let name = null;\n    if (devices.length) {\n      let registedWithDevice = false;\n      devices.forEach((device) => {\n        const { phoneLines } = device;\n        if (phoneLines.length) {\n          registedWithDevice = phoneLines.find((phoneLine) => {\n            return phoneLine.phoneInfo.phoneNumber === phoneNumber;\n          });\n          if (registedWithDevice) {\n            name = device.name;\n          }\n        }\n      });\n      if (name) return name;\n    }\n    if (flipNumbers.length) {\n      const isFlipNumber = flipNumbers.find(\n        (flipNumber) => flipNumber.phoneNumber === phoneNumber,\n      );\n      if (isFlipNumber) {\n        return isFlipNumber.label || 'Other';\n      }\n    }\n\n    if (phoneNumber === mainPhoneNumber) {\n      return 'Main';\n    }\n    return 'Other';\n  }\n\n  @proxify\n  async _initFromNumber() {\n    const fromNumber = this.fromNumber;\n    if (!fromNumber) {\n      let defaultCallerId = this.fromNumbers[0];\n      if (this._deps.callerId?.ringOut) {\n        if (this._deps.callerId.ringOut.type === 'Blocked') {\n          defaultCallerId = { phoneNumber: 'anonymous' };\n        } else if (this._deps.callerId.ringOut.type === 'PhoneNumber') {\n          const defaultPhoneNumber = this._deps.callerId?.ringOut.phoneInfo\n            ?.phoneNumber;\n          const defaultEntry = this.fromNumbers.find(\n            (item) => item.phoneNumber === defaultPhoneNumber,\n          );\n          if (defaultEntry) {\n            defaultCallerId = defaultEntry;\n          }\n        }\n      }\n      await this.updateFromNumber(defaultCallerId);\n    }\n  }\n\n  @proxify\n  async setData(\n    {\n      callWith,\n      myLocation,\n      ringoutPrompt,\n      isCustomLocation,\n    }: {\n      callWith: CallingOptionsType;\n      myLocation: string;\n      ringoutPrompt: boolean;\n      isCustomLocation: boolean;\n    },\n    withPrompt: boolean,\n  ) {\n    // TODO validate myLocation\n    this.setDataAction({\n      callWith,\n      myLocation,\n      ringoutPrompt,\n      timestamp: Date.now(),\n      isCustomLocation,\n    });\n    if (withPrompt) {\n      if (this.callWith === callingOptions.softphone) {\n        this._deps.alert.info({\n          message: callingSettingsMessages.saveSuccessWithSoftphone,\n        });\n      } else if (this.callWith === callingOptions.jupiter) {\n        this._deps.alert.info({\n          message: callingSettingsMessages.saveSuccessWithJupiter,\n        });\n      } else {\n        this._deps.alert.info({\n          message: callingSettingsMessages.saveSuccess,\n        });\n        if (!this._emergencyCallAvailable) {\n          this._warningEmergencyCallingNotAvailable();\n        }\n      }\n    }\n  }\n\n  @computed((that: CallingSettings) => [\n    that._deps.extensionPhoneNumber.directNumbers,\n    that._deps.extensionPhoneNumber.mainCompanyNumber,\n    that._deps.extensionInfo.extensionNumber,\n  ])\n  get myPhoneNumbers() {\n    const {\n      directNumbers,\n      mainCompanyNumber,\n    } = this._deps.extensionPhoneNumber;\n    const { extensionNumber } = this._deps.extensionInfo;\n    const myPhoneNumbers = directNumbers.map((item) => item.phoneNumber);\n    if (mainCompanyNumber && extensionNumber) {\n      myPhoneNumbers.push(\n        `${mainCompanyNumber.phoneNumber}*${extensionNumber}`,\n      );\n    }\n    return myPhoneNumbers;\n  }\n\n  @computed((that: CallingSettings) => [\n    that._deps.forwardingNumber.flipNumbers,\n    that._deps.extensionPhoneNumber.callerIdNumbers,\n    that._deps.extensionPhoneNumber.directNumbers,\n  ])\n  get otherPhoneNumbers() {\n    const { flipNumbers } = this._deps.forwardingNumber;\n    const { callerIdNumbers, directNumbers } = this._deps.extensionPhoneNumber;\n    const filterMapping: { [k: string]: boolean } = {};\n    callerIdNumbers.forEach((item) => {\n      filterMapping[item.phoneNumber] = true;\n    });\n    directNumbers.forEach((item) => {\n      filterMapping[item.phoneNumber] = true;\n    });\n    return flipNumbers\n      .filter((item) => !filterMapping[item.phoneNumber])\n      .sort((a, b) => (a.label === 'Mobile' && a.label !== b.label ? -1 : 1))\n      .map((item) => item.phoneNumber);\n  }\n\n  @computed((that: CallingSettings) => [\n    that._deps.rolesAndPermissions.ringoutEnabled,\n    that._deps.rolesAndPermissions.webphoneEnabled,\n    that.otherPhoneNumbers.length,\n    that._deps.extensionPhoneNumber.numbers.length,\n  ])\n  get callWithOptions() {\n    const { ringoutEnabled, webphoneEnabled } = this._deps.rolesAndPermissions;\n    const hasExtensionPhoneNumber =\n      this._deps.extensionPhoneNumber.numbers.length > 0;\n    if (!hasExtensionPhoneNumber) {\n      return [callingOptions.softphone];\n    }\n    const callWithOptions = [];\n    if (this._deps.webphone && webphoneEnabled) {\n      callWithOptions.push(callingOptions.browser);\n    }\n    // only rc brand support call with RingCentral App\n    if (\n      this._deps.brand &&\n      (this._deps.brand.code === 'rc' ||\n        (this._deps.brand.brandConfig &&\n          this._deps.brand.brandConfig.brandCode === 'rc')) &&\n      this._showCallWithJupiter\n    ) {\n      callWithOptions.push(callingOptions.jupiter);\n    }\n\n    callWithOptions.push(callingOptions.softphone);\n    if (ringoutEnabled) {\n      callWithOptions.push(callingOptions.ringout);\n    }\n    return callWithOptions;\n  }\n\n  @computed((that: CallingSettings) => [\n    that._deps.extensionPhoneNumber.callerIdNumbers,\n  ])\n  get fromNumbers() {\n    const { callerIdNumbers } = this._deps.extensionPhoneNumber;\n    const sortedPhoneNumbers = callerIdNumbers.sort((firstItem, lastItem) => {\n      if (firstItem.usageType === 'DirectNumber') return -1;\n      if (lastItem.usageType === 'DirectNumber') return 1;\n      if (firstItem.usageType === 'MainCompanyNumber') return -1;\n      if (lastItem.usageType === 'MainCompanyNumber') return 1;\n      if (firstItem.usageType < lastItem.usageType) return -1;\n      if (firstItem.usageType > lastItem.usageType) return 1;\n      return 0;\n    });\n    return sortedPhoneNumbers;\n  }\n\n  @computed((that: CallingSettings) => [\n    that.myPhoneNumbers,\n    that.otherPhoneNumbers,\n  ])\n  get availableNumbers() {\n    return this.myPhoneNumbers.concat(this.otherPhoneNumbers);\n  }\n\n  @computed((that: CallingSettings) => [that.availableNumbers])\n  get availableNumbersWithLabel() {\n    const { availableNumbers } = this;\n    const result: { label: string; value: string }[] = [];\n    if (availableNumbers.length) {\n      availableNumbers.forEach((phoneNumber) => {\n        const locationLabel = this._getLocationLabel(phoneNumber);\n        result.push({\n          label: locationLabel,\n          value: phoneNumber,\n        });\n      });\n    }\n    result.sort(\n      (a, b) =>\n        LOCATION_NUMBER_ORDER.indexOf(a.label) -\n        LOCATION_NUMBER_ORDER.indexOf(b.label),\n    );\n    return result;\n  }\n\n  get callingMode() {\n    return mapOptionToMode(this.callWith);\n  }\n\n  get defaultRingoutPrompt() {\n    return this.initRingoutPrompt;\n  }\n\n  get isWebphoneMode() {\n    return this.callingMode === callingModes.webphone;\n  }\n\n  /* ringtone */\n  get isChangeRingToneAllowed() {\n    return (\n      this._deps.webphone &&\n      (this._deps.storage.driver === 'INDEXEDDB' ||\n        this._deps.storage.driver === 'WEBSQL')\n    );\n  }\n}\nexport { CallingSettings };\n"],"file":"CallingSettings.js"}