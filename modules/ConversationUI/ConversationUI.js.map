{"version":3,"sources":["modules/ConversationUI/ConversationUI.ts"],"names":["ConversationUI","name","deps","dep","optional","params","enableContactFallback","showGroupNumberName","supportAttachment","perPage","inputExpandable","_deps","brand","locale","conversationLogger","dateTimeFormat","contactMatcher","regionSettings","conversations","rateLimiter","connectivityMonitor","disableLinks","throttling","connectivity","showSpinner","ready","currentConversation","hasInputContent","messageText","length","attachments","fullName","currentLocale","conversationId","sendButtonDisabled","pushing","areaCode","countryCode","recipients","messages","conversation","autoLog","loadingNextPage","loadingOldMessages","dateTimeFormatter","onLogConversation","conversationsPath","renderExtraButton","routerInteraction","messageStore","getMatcherContactName","getMatcherContactList","getMatcherContactNameList","phoneNumber","matcherNames","dataMapping","map","matcher","phoneNumbers","phoneType","join","replyToReceivers","text","unloadConversation","loadConversation","id","updateMessageText","addAttachment","attachment","removeAttachment","options","formatDateTime","formatPhone","redirect","logConversation","goBack","push","readMessages","loadPreviousMessages","fetchOldMessages","RcUIModuleV2"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAKA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA2BaA,c,WAjBZ,gBAAO;AACNC,EAAAA,IAAI,EAAE,gBADA;AAENC,EAAAA,IAAI,EAAE,CACJ,OADI,EAEJ,QAFI,EAGJ,gBAHI,EAIJ,gBAJI,EAKJ,eALI,EAMJ,aANI,EAOJ,qBAPI,EAQJ,cARI,EASJ,mBATI,EAUJ;AAAEC,IAAAA,GAAG,EAAE,oBAAP;AAA6BC,IAAAA,QAAQ,EAAE;AAAvC,GAVI,EAWJ;AAAED,IAAAA,GAAG,EAAE,gBAAP;AAAyBC,IAAAA,QAAQ,EAAE;AAAnC,GAXI,EAYJ;AAAED,IAAAA,GAAG,EAAE,uBAAP;AAAgCC,IAAAA,QAAQ,EAAE;AAA1C,GAZI;AAFA,CAAP,C;;;;;AAkBC,0BAAYF,IAAZ,EAAwB;AAAA;;AAAA,6BAChB;AACJA,MAAAA,IAAI,EAAJA;AADI,KADgB;AAIvB;;;;qCAS+D;AAAA,UAN9DG,MAM8D,QAN9DA,MAM8D;AAAA,uCAL9DC,qBAK8D;AAAA,UAL9DA,qBAK8D,sCALtC,KAKsC;AAAA,uCAJ9DC,mBAI8D;AAAA,UAJ9DA,mBAI8D,sCAJxC,KAIwC;AAAA,uCAH9DC,iBAG8D;AAAA,UAH9DA,iBAG8D,sCAH1C,KAG0C;AAAA,8BAF9DC,OAE8D;AAAA,UAF9DA,OAE8D,6BAFpD,EAEoD;AAAA,UAD9DC,eAC8D,QAD9DA,eAC8D;AAAA,wBAW1D,KAAKC,KAXqD;AAAA,UAE5DC,KAF4D,eAE5DA,KAF4D;AAAA,UAG5DC,MAH4D,eAG5DA,MAH4D;AAAA,UAI5DC,kBAJ4D,eAI5DA,kBAJ4D;AAAA,UAK5DC,cAL4D,eAK5DA,cAL4D;AAAA,UAM5DC,cAN4D,eAM5DA,cAN4D;AAAA,UAO5DC,cAP4D,eAO5DA,cAP4D;AAAA,UAQ5DC,aAR4D,eAQ5DA,aAR4D;AAAA,UAS5DC,WAT4D,eAS5DA,WAT4D;AAAA,UAU5DC,mBAV4D,eAU5DA,mBAV4D;AAY9D,UAAMC,YAAY,GAChBF,WAAW,CAACG,UAAZ,IAA0B,CAACF,mBAAmB,CAACG,YADjD;AAEA,UAAMC,WAAW,GAAG,EAClBT,cAAc,CAACU,KAAf,KACC,CAACT,cAAD,IAAmBA,cAAc,CAACS,KADnC,KAEAR,cAAc,CAACQ,KAFf,IAGAP,aAAa,CAACO,KAHd,IAIAN,WAAW,CAACM,KAJZ,IAKAL,mBAAmB,CAACK,KALpB,KAMC,CAACX,kBAAD,IAAuBA,kBAAkB,CAACW,KAN3C,CADkB,CAApB;AASA,UAAMC,mBAAmB,GAAGR,aAAa,CAACQ,mBAA1C;AACA,UAAMC,eAAe,GACnBT,aAAa,CAACU,WAAd,CAA0BC,MAA1B,GAAmC,CAAnC,IACCX,aAAa,CAACY,WAAd,IAA6BZ,aAAa,CAACY,WAAd,CAA0BD,MAA1B,GAAmC,CAFnE;AAGA,aAAO;AACLjB,QAAAA,KAAK,EAAEA,KAAK,CAACmB,QADR;AAELzB,QAAAA,qBAAqB,EAArBA,qBAFK;AAGLC,QAAAA,mBAAmB,EAAnBA,mBAHK;AAILC,QAAAA,iBAAiB,EAAjBA,iBAJK;AAKLwB,QAAAA,aAAa,EAAEnB,MAAM,CAACmB,aALjB;AAMLC,QAAAA,cAAc,EAAE5B,MAAM,CAAC4B,cANlB;AAOLC,QAAAA,kBAAkB,EAChBhB,aAAa,CAACiB,OAAd,IACAd,YADA,IAEA,CAACM,eAFD,IAGAH,WAXG;AAYLY,QAAAA,QAAQ,EAAEnB,cAAc,CAACmB,QAZpB;AAaLC,QAAAA,WAAW,EAAEpB,cAAc,CAACoB,WAbvB;AAcLb,QAAAA,WAAW,EAAXA,WAdK;AAeLc,QAAAA,UAAU,EAAEZ,mBAAmB,CAACY,UAf3B;AAgBLC,QAAAA,QAAQ,EAAEb,mBAAmB,CAACa,QAhBzB;AAiBLX,QAAAA,WAAW,EAAEV,aAAa,CAACU,WAjBtB;AAkBLE,QAAAA,WAAW,EAAEZ,aAAa,CAACY,WAlBtB;AAmBLU,QAAAA,YAAY,EAAEd,mBAnBT;AAoBLL,QAAAA,YAAY,EAAZA,YApBK;AAqBLoB,QAAAA,OAAO,EAAE,CAAC,EAAC3B,kBAAD,aAACA,kBAAD,uBAACA,kBAAkB,CAAE2B,OAArB,CArBL;AAsBLhC,QAAAA,OAAO,EAAPA,OAtBK;AAuBLiC,QAAAA,eAAe,EAAExB,aAAa,CAACyB,kBAvB1B;AAwBLjC,QAAAA,eAAe,EAAfA;AAxBK,OAAP;AA0BD;;;0CAOmE;AAAA,UAJlEkC,iBAIkE,SAJlEA,iBAIkE;AAAA,UAHlEC,iBAGkE,SAHlEA,iBAGkE;AAAA,wCAFlEC,iBAEkE;AAAA,UAFlEA,iBAEkE,sCAF9C,WAE8C;AAAA,UADlEC,iBACkE,SADlEA,iBACkE;AAAA,yBAS9D,KAAKpC,KATyD;AAAA,UAEhEK,cAFgE,gBAEhEA,cAFgE;AAAA,UAGhED,cAHgE,gBAGhEA,cAHgE;AAAA,UAIhEiC,iBAJgE,gBAIhEA,iBAJgE;AAAA,UAKhElC,kBALgE,gBAKhEA,kBALgE;AAAA,UAMhEG,cANgE,gBAMhEA,cANgE;AAAA,UAOhEC,aAPgE,gBAOhEA,aAPgE;AAAA,UAQhE+B,YARgE,gBAQhEA,YARgE;AAUlE,UAAIC,qBAAJ;AACA,UAAIC,qBAAJ;AACA,UAAIC,yBAAJ;;AACA,UAAIpC,cAAc,IAAIA,cAAc,CAACS,KAArC,EAA4C;AAC1C0B,QAAAA,qBAAqB,GAAG,+BAACE,WAAD,EAAiB;AACvC,cAAMC,YAAY,GAAGtC,cAAc,CAACuC,WAAf,CAA2BF,WAA3B,CAArB;;AACA,cAAI,CAAAC,YAAY,SAAZ,IAAAA,YAAY,WAAZ,YAAAA,YAAY,CAAEzB,MAAd,IAAuB,CAA3B,EAA8B;AAC5B,mBAAOyB,YAAY,CAACE,GAAb,CACL,UAACC,OAAD;AAAA,+BACKA,OAAO,CAACxD,IADb,gBACuBwD,OAAO,CAACC,YAAR,CAAqB,CAArB,EAAwBC,SAD/C;AAAA,aADK,CAAP;AAID;;AACD,iBAAO,EAAP;AACD,SATD;;AAUAP,QAAAA,yBAAyB,GAAG,mCAACC,WAAD,EAAiB;AAC3C,cAAMC,YAAY,GAAGtC,cAAc,CAACuC,WAAf,CAA2BF,WAA3B,CAArB;;AACA,cAAI,CAAAC,YAAY,SAAZ,IAAAA,YAAY,WAAZ,YAAAA,YAAY,CAAEzB,MAAd,IAAuB,CAA3B,EAA8B;AAC5B,mBAAOyB,YAAY,CAACE,GAAb,CAAiB,UAACC,OAAD;AAAA,qBAAaA,OAAO,CAACxD,IAArB;AAAA,aAAjB,CAAP;AACD;;AACD,iBAAO,EAAP;AACD,SAND;;AAOAiD,QAAAA,qBAAqB,GAAG,+BAACG,WAAD,EAAiB;AACvC,cAAMC,YAAY,GAAGF,yBAAyB,CAACC,WAAD,CAA9C;AACA,iBAAO,CAAAC,YAAY,SAAZ,IAAAA,YAAY,WAAZ,YAAAA,YAAY,CAAEzB,MAAd,IAAuB,CAAvB,GAA2ByB,YAAY,CAACM,IAAb,CAAkB,GAAlB,CAA3B,GAAoD,IAA3D;AACD,SAHD;AAID;;AAED,aAAO;AACLC,QAAAA,gBAAgB,EAAE,0BAACC,IAAD,EAAehC,WAAf;AAAA,iBAChBZ,aAAa,CAAC2C,gBAAd,CAA+BC,IAA/B,EAAqChC,WAArC,CADgB;AAAA,SADb;AAGLiC,QAAAA,kBAAkB,EAAE;AAAA,iBAAM7C,aAAa,CAAC6C,kBAAd,EAAN;AAAA,SAHf;AAILC,QAAAA,gBAAgB,EAAE,0BAACC,EAAD;AAAA,iBAAgB/C,aAAa,CAAC8C,gBAAd,CAA+BC,EAA/B,CAAhB;AAAA,SAJb;AAKLC,QAAAA,iBAAiB,EAAE,2BAACJ,IAAD;AAAA,iBACjB5C,aAAa,CAACgD,iBAAd,CAAgCJ,IAAhC,CADiB;AAAA,SALd;AAOLK,QAAAA,aAAa,EAAE,uBAACC,UAAD;AAAA,iBACblD,aAAa,CAACiD,aAAd,CAA4BC,UAA5B,CADa;AAAA,SAPV;AASLC,QAAAA,gBAAgB,EAAE,0BAACD,UAAD;AAAA,iBAChBlD,aAAa,CAACmD,gBAAd,CAA+BD,UAA/B,CADgB;AAAA,SATb;AAWLxB,QAAAA,iBAAiB,EACfA,iBADe,aACfA,iBADe,cACfA,iBADe,GAEd,UAAC0B,OAAD;AAAA,iBACCvD,cAAc,CAACwD,cAAf,CAA8BD,OAA9B,CADD;AAAA,SAbE;AAeLE,QAAAA,WAAW,EAAE,qBAACnB,WAAD;AAAA,iBACX,gCAAa;AACXA,YAAAA,WAAW,EAAXA,WADW;AAEXjB,YAAAA,QAAQ,EAAEnB,cAAc,CAACmB,QAFd;AAGXC,YAAAA,WAAW,EAAEpB,cAAc,CAACoB;AAHjB,WAAb,CADW;AAAA,SAfR;AAqBLa,QAAAA,qBAAqB,EAArBA,qBArBK;AAsBLC,QAAAA,qBAAqB,EAArBA,qBAtBK;AAuBLC,QAAAA,yBAAyB,EAAzBA,yBAvBK;AAwBLP,QAAAA,iBAAiB,EACfA,iBAAiB,IAChB/B,kBAAkB;AAAA,8EAChB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,2CACC2D,QADD,EACCA,QADD,+BACY,IADZ,mBAEIH,OAFJ;AAAA;AAAA,2BAIOxD,kBAAkB,CAAC4D,eAAnB,iCACDJ,OADC;AAEJG,sBAAAA,QAAQ,EAARA;AAFI,uBAJP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WADgB;;AAAA;AAAA;AAAA;AAAA,WA1BhB;AAoCLE,QAAAA,MApCK,oBAoCI;AACP3B,UAAAA,iBAAiB,CAAC4B,IAAlB,CAAuB9B,iBAAvB;AACD,SAtCI;AAuCL+B,QAAAA,YAvCK,wBAuCQZ,EAvCR,EAuCoB;AACvBhB,UAAAA,YAAY,CAAC4B,YAAb,CAA0BZ,EAA1B;AACD,SAzCI;AA0CLa,QAAAA,oBA1CK,kCA0CkB;AACrB5D,UAAAA,aAAa,CAAC6D,gBAAd;AACD,SA5CI;AA6CLhC,QAAAA,iBAAiB,EAAjBA;AA7CK,OAAP;AA+CD;;;;EA9JoCiC,kB","sourcesContent":["import {\n  RcUIModuleV2,\n  UIFunctions,\n  UIProps,\n} from '@ringcentral-integration/core';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport { formatNumber } from 'ringcentral-integration/lib/formatNumber';\nimport { Attachment } from 'ringcentral-integration/modules/MessageSenderV2';\nimport { FormatDateTimeOptions } from 'ringcentral-integration/modules/DateTimeFormatV2';\nimport {\n  Deps,\n  ConversationContainerProps,\n  ConversationPanelProps,\n  OnLogConversationOptions,\n} from './ConversationUI.interface';\n\n@Module({\n  name: 'ConversationUI',\n  deps: [\n    'Brand',\n    'Locale',\n    'DateTimeFormat',\n    'RegionSettings',\n    'Conversations',\n    'RateLimiter',\n    'ConnectivityMonitor',\n    'MessageStore',\n    'RouterInteraction',\n    { dep: 'ConversationLogger', optional: true },\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'ConversationUIOptions', optional: true },\n  ],\n})\nexport class ConversationUI<T> extends RcUIModuleV2<Deps & T> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n  }\n\n  getUIProps({\n    params,\n    enableContactFallback = false,\n    showGroupNumberName = false,\n    supportAttachment = false,\n    perPage = 20,\n    inputExpandable,\n  }: ConversationContainerProps): UIProps<ConversationPanelProps> {\n    const {\n      brand,\n      locale,\n      conversationLogger,\n      dateTimeFormat,\n      contactMatcher,\n      regionSettings,\n      conversations,\n      rateLimiter,\n      connectivityMonitor,\n    } = this._deps;\n    const disableLinks =\n      rateLimiter.throttling || !connectivityMonitor.connectivity;\n    const showSpinner = !(\n      dateTimeFormat.ready &&\n      (!contactMatcher || contactMatcher.ready) &&\n      regionSettings.ready &&\n      conversations.ready &&\n      rateLimiter.ready &&\n      connectivityMonitor.ready &&\n      (!conversationLogger || conversationLogger.ready)\n    );\n    const currentConversation = conversations.currentConversation;\n    const hasInputContent =\n      conversations.messageText.length > 0 ||\n      (conversations.attachments && conversations.attachments.length > 0);\n    return {\n      brand: brand.fullName,\n      enableContactFallback,\n      showGroupNumberName,\n      supportAttachment,\n      currentLocale: locale.currentLocale,\n      conversationId: params.conversationId,\n      sendButtonDisabled:\n        conversations.pushing ||\n        disableLinks ||\n        !hasInputContent ||\n        showSpinner,\n      areaCode: regionSettings.areaCode,\n      countryCode: regionSettings.countryCode,\n      showSpinner,\n      recipients: currentConversation.recipients,\n      messages: currentConversation.messages,\n      messageText: conversations.messageText,\n      attachments: conversations.attachments,\n      conversation: currentConversation,\n      disableLinks,\n      autoLog: !!conversationLogger?.autoLog,\n      perPage,\n      loadingNextPage: conversations.loadingOldMessages,\n      inputExpandable,\n    };\n  }\n\n  getUIFunctions({\n    dateTimeFormatter,\n    onLogConversation,\n    conversationsPath = '/messages',\n    renderExtraButton,\n  }: ConversationContainerProps): UIFunctions<ConversationPanelProps> {\n    const {\n      contactMatcher,\n      dateTimeFormat,\n      routerInteraction,\n      conversationLogger,\n      regionSettings,\n      conversations,\n      messageStore,\n    } = this._deps;\n    let getMatcherContactName: ConversationPanelProps['getMatcherContactName'];\n    let getMatcherContactList: ConversationPanelProps['getMatcherContactList'];\n    let getMatcherContactNameList: ConversationPanelProps['getMatcherContactNameList'];\n    if (contactMatcher && contactMatcher.ready) {\n      getMatcherContactList = (phoneNumber) => {\n        const matcherNames = contactMatcher.dataMapping[phoneNumber];\n        if (matcherNames?.length > 0) {\n          return matcherNames.map(\n            (matcher) =>\n              `${matcher.name} | ${matcher.phoneNumbers[0].phoneType}`,\n          );\n        }\n        return [];\n      };\n      getMatcherContactNameList = (phoneNumber) => {\n        const matcherNames = contactMatcher.dataMapping[phoneNumber];\n        if (matcherNames?.length > 0) {\n          return matcherNames.map((matcher) => matcher.name);\n        }\n        return [];\n      };\n      getMatcherContactName = (phoneNumber) => {\n        const matcherNames = getMatcherContactNameList(phoneNumber);\n        return matcherNames?.length > 0 ? matcherNames.join('&') : null;\n      };\n    }\n\n    return {\n      replyToReceivers: (text: string, attachments?: Attachment[]) =>\n        conversations.replyToReceivers(text, attachments),\n      unloadConversation: () => conversations.unloadConversation(),\n      loadConversation: (id: string) => conversations.loadConversation(id),\n      updateMessageText: (text: string) =>\n        conversations.updateMessageText(text),\n      addAttachment: (attachment: Attachment) =>\n        conversations.addAttachment(attachment),\n      removeAttachment: (attachment: Attachment) =>\n        conversations.removeAttachment(attachment),\n      dateTimeFormatter:\n        dateTimeFormatter ??\n        ((options: Partial<FormatDateTimeOptions>) =>\n          dateTimeFormat.formatDateTime(options)),\n      formatPhone: (phoneNumber: string) =>\n        formatNumber({\n          phoneNumber,\n          areaCode: regionSettings.areaCode,\n          countryCode: regionSettings.countryCode,\n        }),\n      getMatcherContactName,\n      getMatcherContactList,\n      getMatcherContactNameList,\n      onLogConversation:\n        onLogConversation ||\n        (conversationLogger &&\n          (async ({\n            redirect = true,\n            ...options\n          }: OnLogConversationOptions) => {\n            await conversationLogger.logConversation({\n              ...options,\n              redirect,\n            });\n          })),\n      goBack() {\n        routerInteraction.push(conversationsPath);\n      },\n      readMessages(id: string) {\n        messageStore.readMessages(id);\n      },\n      loadPreviousMessages() {\n        conversations.fetchOldMessages();\n      },\n      renderExtraButton,\n    };\n  }\n}\n"],"file":"ConversationUI.js"}