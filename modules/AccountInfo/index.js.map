{"version":3,"sources":["modules/AccountInfo/index.js"],"names":["AccountInfo","deps","dep","optional","client","rolesAndPermissions","alert","options","fetchFunction","account","get","readyCheckFn","_rolesAndPermissions","ready","console","warn","ensureExist","call","_alert","_auth","loginStatus","loggedIn","_hasPermission","logout","danger","message","permissionsMessages","insufficientPrivilege","ttl","info","id","serviceInfo","brand","homeCountry","country","isoCode","data","regionalSettings","mainNumber","permissions","ReadCompanyInfo","DataFetcher","selector","servicePlan"],"mappings":"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","sourcesContent":["import { Module } from '../../lib/di';\nimport DataFetcher from '../../lib/DataFetcher';\nimport ensureExist from '../../lib/ensureExist';\nimport { selector } from '../../lib/selector';\n\nimport loginStatus from '../Auth/loginStatus';\nimport permissionsMessages from '../RolesAndPermissions/permissionsMessages';\n\n/**\n * @class\n * @description Accound info managing module.\n */\n@Module({\n  deps: [\n    'Client',\n    'RolesAndPermissions',\n    'Alert',\n    { dep: 'AccountInfoOptions', optional: true },\n  ],\n})\nexport default class AccountInfo extends DataFetcher {\n  /**\n   * @deprecated Please evaluate and use AccountInfoV2\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Client} params.client - client module instance\n   */\n  constructor({ client, rolesAndPermissions, alert, ...options }) {\n    super({\n      client,\n      fetchFunction: async () => client.account().get(),\n      readyCheckFn: () => this._rolesAndPermissions.ready,\n      ...options,\n    });\n    console.warn(\n      'AccountInfo is deprecated, please evaluate and transition to use AccountInfoV2',\n    );\n\n    this._rolesAndPermissions = ensureExist.call(\n      this,\n      rolesAndPermissions,\n      'rolesAndPermissions',\n    );\n    this._alert = alert;\n  }\n\n  get _name() {\n    return 'accountInfo';\n  }\n\n  async _onStateChange() {\n    await super._onStateChange();\n    if (\n      this._auth.loginStatus === loginStatus.loggedIn &&\n      this.ready &&\n      !this._hasPermission\n    ) {\n      await this._auth.logout();\n      if (this._alert) {\n        this._alert.danger({\n          message: permissionsMessages.insufficientPrivilege,\n          ttl: 0,\n        });\n      }\n    }\n  }\n\n  @selector\n  info = [() => this.data, (data) => data || {}];\n\n  @selector\n  serviceInfo = [() => this.info, (info) => info.serviceInfo || {}];\n\n  @selector\n  servicePlan = [\n    () => this.serviceInfo,\n    (serviceInfo) => serviceInfo.servicePlan || {},\n  ];\n\n  get id() {\n    return this.info.id;\n  }\n\n  get country() {\n    return this.info.serviceInfo && this.info.serviceInfo.brand.homeCountry;\n  }\n\n  get countryCode() {\n    return (this.country && this.country.isoCode) || 'US';\n  }\n\n  get regionalSettings() {\n    return this.data.regionalSettings;\n  }\n\n  get mainCompanyNumber() {\n    return this.info.mainNumber;\n  }\n\n  get _hasPermission() {\n    return !!this._rolesAndPermissions.permissions.ReadCompanyInfo;\n  }\n}\n"],"file":"index.js"}