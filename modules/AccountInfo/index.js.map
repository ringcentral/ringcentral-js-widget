{"version":3,"sources":["modules/AccountInfo/index.js"],"names":["AccountInfo","deps","dep","optional","client","rolesAndPermissions","alert","options","fetchFunction","account","get","readyCheckFn","_rolesAndPermissions","ready","ensureExist","_alert","_auth","loginStatus","loggedIn","_hasPermission","logout","danger","message","permissionsMessages","insufficientPrivilege","ttl","info","id","serviceInfo","brand","homeCountry","country","isoCode","mainNumber","permissions","ReadCompanyInfo","DataFetcher","selector","data","servicePlan"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAcqBA,W;AAZrB;;;;OAIC,gBAAO;AACNC,EAAAA,IAAI,EAAE,CACJ,QADI,EAEJ,qBAFI,EAGJ,OAHI,EAIJ;AAAEC,IAAAA,GAAG,EAAE,oBAAP;AAA6BC,IAAAA,QAAQ,EAAE;AAAvC,GAJI;AADA,CAAP,C;;;;;AASC;;;;;AAKA,6BAAgE;AAAA;;AAAA;;AAAA,QAAlDC,MAAkD,QAAlDA,MAAkD;AAAA,QAA1CC,mBAA0C,QAA1CA,mBAA0C;AAAA,QAArBC,KAAqB,QAArBA,KAAqB;AAAA,QAAXC,OAAW;;AAAA;;AAC9D;AACEH,MAAAA,MAAM,EAANA,MADF;AAEEI,MAAAA,aAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,iDAAYJ,MAAM,CAACK,OAAP,GAAiBC,GAAjB,EAAZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAFjB;AAGEC,MAAAA,YAAY,EAAE;AAAA,eAAM,MAAKC,oBAAL,CAA0BC,KAAhC;AAAA;AAHhB,OAIKN,OAJL;;AAD8D;;AAAA;;AAAA;;AAQ9D,UAAKK,oBAAL,GAA4B,4CAAME,uBAAN,kBAC1BT,mBAD0B,EAE1B,qBAF0B,CAA5B;AAIA,UAAKU,MAAL,GAAcT,KAAd;AAZ8D;AAa/D;;;;;;;;;;;;;oBASG,KAAKU,KAAL,CAAWC,WAAX,KAA2BA,wBAAYC,QAAvC,IACA,KAAKL,KADL,IAEA,CAAC,KAAKM,c;;;;;;8CAEA,KAAKH,KAAL,CAAWI,MAAX,E;;;AACN,kBAAI,KAAKL,MAAT,EAAiB;AACf,qBAAKA,MAAL,CAAYM,MAAZ,CAAmB;AACjBC,kBAAAA,OAAO,EAAEC,gCAAoBC,qBADZ;AAEjBC,kBAAAA,GAAG,EAAE;AAFY,iBAAnB;AAID;;;;;;;;;;;wBAjBO;AACV,aAAO,aAAP;AACD;;;wBA+BQ;AACP,aAAO,KAAKC,IAAL,CAAUC,EAAjB;AACD;;;wBAEa;AACZ,aAAO,KAAKD,IAAL,CAAUE,WAAV,IAAyB,KAAKF,IAAL,CAAUE,WAAV,CAAsBC,KAAtB,CAA4BC,WAA5D;AACD;;;wBAEiB;AAChB,aAAQ,KAAKC,OAAL,IAAgB,KAAKA,OAAL,CAAaC,OAA9B,IAA0C,IAAjD;AACD;;;wBAEuB;AACtB,aAAO,KAAKN,IAAL,CAAUO,UAAjB;AACD;;;wBAEoB;AACnB,aAAO,CAAC,CAAC,KAAKrB,oBAAL,CAA0BsB,WAA1B,CAAsCC,eAA/C;AACD;;;;EAxEsCC,wB,gFA0CtCC,kB;;;;;;;WACM,CAAC;AAAA,aAAM,MAAI,CAACC,IAAX;AAAA,KAAD,EAAkB,UAACA,IAAD;AAAA,aAAUA,IAAI,IAAI,EAAlB;AAAA,KAAlB,C;;gFAEND,kB;;;;;;;WACa,CAAC;AAAA,aAAM,MAAI,CAACX,IAAX;AAAA,KAAD,EAAkB,UAACA,IAAD;AAAA,aAAUA,IAAI,CAACE,WAAL,IAAoB,EAA9B;AAAA,KAAlB,C;;gFAEbS,kB;;;;;;;WACa,CACZ;AAAA,aAAM,MAAI,CAACT,WAAX;AAAA,KADY,EAEZ,UAACA,WAAD;AAAA,aAAiBA,WAAW,CAACW,WAAZ,IAA2B,EAA5C;AAAA,KAFY,C","sourcesContent":["import { Module } from '../../lib/di';\nimport DataFetcher from '../../lib/DataFetcher';\nimport ensureExist from '../../lib/ensureExist';\nimport { selector } from '../../lib/selector';\n\nimport loginStatus from '../Auth/loginStatus';\nimport permissionsMessages from '../RolesAndPermissions/permissionsMessages';\n\n/**\n * @class\n * @description Accound info managing module.\n */\n@Module({\n  deps: [\n    'Client',\n    'RolesAndPermissions',\n    'Alert',\n    { dep: 'AccountInfoOptions', optional: true },\n  ],\n})\nexport default class AccountInfo extends DataFetcher {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Client} params.client - client module instance\n   */\n  constructor({ client, rolesAndPermissions, alert, ...options }) {\n    super({\n      client,\n      fetchFunction: async () => client.account().get(),\n      readyCheckFn: () => this._rolesAndPermissions.ready,\n      ...options,\n    });\n\n    this._rolesAndPermissions = this::ensureExist(\n      rolesAndPermissions,\n      'rolesAndPermissions',\n    );\n    this._alert = alert;\n  }\n\n  get _name() {\n    return 'accountInfo';\n  }\n\n  async _onStateChange() {\n    await super._onStateChange();\n    if (\n      this._auth.loginStatus === loginStatus.loggedIn &&\n      this.ready &&\n      !this._hasPermission\n    ) {\n      await this._auth.logout();\n      if (this._alert) {\n        this._alert.danger({\n          message: permissionsMessages.insufficientPrivilege,\n          ttl: 0,\n        });\n      }\n    }\n  }\n\n  @selector\n  info = [() => this.data, (data) => data || {}];\n\n  @selector\n  serviceInfo = [() => this.info, (info) => info.serviceInfo || {}];\n\n  @selector\n  servicePlan = [\n    () => this.serviceInfo,\n    (serviceInfo) => serviceInfo.servicePlan || {},\n  ];\n\n  get id() {\n    return this.info.id;\n  }\n\n  get country() {\n    return this.info.serviceInfo && this.info.serviceInfo.brand.homeCountry;\n  }\n\n  get countryCode() {\n    return (this.country && this.country.isoCode) || 'US';\n  }\n\n  get mainCompanyNumber() {\n    return this.info.mainNumber;\n  }\n\n  get _hasPermission() {\n    return !!this._rolesAndPermissions.permissions.ReadCompanyInfo;\n  }\n}\n"],"file":"index.js"}