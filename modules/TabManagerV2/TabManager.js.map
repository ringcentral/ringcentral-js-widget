{"version":3,"sources":["modules/TabManagerV2/TabManager.ts"],"names":["TabManager","name","deps","dep","optional","enableGlobalCache","tabManagerOptions","enableCache","tabbie","_eventReducer","state","action","_usm","usmAction","_getStateV2","_state","identifierKey","event","Tabbie","prefix","_deps","brand","id","active","args","_setId","enabled","checkIsMain","_setActive","on","events","mainTabIdChanged","_setEvent","send","checkTabAliveById","_reducers","spawnStorageReducersKey","spawnReducersKey","hasMultipleTabs","tabs","isFirstTab","RcModuleV2","proxify"],"mappings":"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","sourcesContent":["import {\n  action,\n  identifierKey,\n  RcModuleV2,\n  spawnReducersKey,\n  spawnStorageReducersKey,\n  state,\n  usmAction,\n} from '@ringcentral-integration/core';\nimport { combineReducers } from 'redux';\nimport { Module } from '../../lib/di';\nimport proxify from '../../lib/proxy/proxify';\nimport { Tabbie } from '../../lib/Tabbie';\nimport { Deps, TabEvent } from './TabManager.interface';\n\n@Module({\n  name: 'TabManager',\n  deps: ['Brand', { dep: 'TabManagerOptions', optional: true }],\n})\nexport class TabManager extends RcModuleV2<Deps> {\n  public tabbie: Tabbie;\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableGlobalCache: deps.tabManagerOptions?.enableCache ?? false,\n    });\n    this.tabbie = new Tabbie({\n      prefix: this._deps.brand.prefix,\n    });\n  }\n\n  @state\n  id: string = null;\n\n  @action\n  protected _setId(id: string) {\n    this.id = id;\n  }\n\n  /**\n   * Default to true. If tabbie cannot be enabled due to env, the runtime\n   * should assume active.\n   */\n  @state\n  active = true;\n\n  @action\n  protected _setActive(active: boolean) {\n    this.active = active;\n  }\n\n  @state\n  event: TabEvent = null;\n\n  @action\n  protected _setEvent(event: string, args: any[]) {\n    this.event = {\n      name: event,\n      args,\n    };\n  }\n\n  _eventReducer = (state: TabEvent = null, action: any) => {\n    if (action._usm === usmAction) {\n      const { event } = this._getStateV2(action._state, this[identifierKey]);\n      if (event && state === null) return event;\n    }\n    return null;\n  };\n\n  get reducer() {\n    if (this._reducers)\n      return combineReducers({\n        ...this._reducers,\n        event: this._eventReducer,\n      });\n    this[spawnStorageReducersKey]();\n    this[spawnReducersKey]();\n    return combineReducers({\n      ...this._reducers,\n      event: this._eventReducer,\n    });\n  }\n\n  async onInitOnce() {\n    this._setId(this.tabbie.id);\n    if (this.tabbie.enabled) {\n      this._setActive(await this.tabbie.checkIsMain());\n      this.tabbie.on(this.tabbie.events.mainTabIdChanged, async () => {\n        this._setActive(await this.tabbie.checkIsMain());\n      });\n      this.tabbie.on(\n        this.tabbie.events.event,\n        (event: string, ...args: any[]) => {\n          this._setEvent(event, args);\n        },\n      );\n    }\n  }\n\n  @proxify\n  async send(event: string, ...args: any[]) {\n    this.tabbie.send(event, ...args);\n  }\n\n  @proxify\n  async checkIsMain() {\n    return this.tabbie.checkIsMain();\n  }\n\n  @proxify\n  async checkTabAliveById(id: string) {\n    return this.tabbie.checkTabAliveById(id);\n  }\n\n  get hasMultipleTabs() {\n    return this.tabbie?.hasMultipleTabs ?? false;\n  }\n\n  get tabs() {\n    return this.tabbie?.tabs ?? [];\n  }\n\n  get isFirstTab() {\n    return this.tabbie?.isFirstTab ?? true;\n  }\n\n  get enable() {\n    return this.tabbie?.enabled;\n  }\n}\n"],"file":"TabManager.js"}