{"version":3,"sources":["modules/EvActiveCallControl/EvActiveCallControl.ts"],"names":["EvActiveCallControl","name","deps","dep","optional","_deps","tabManager","_tabbie","enabled","_sipToggleMute","sessionId","evClient","hangup","console","log","_changeOnHoldState","state","holdSession","uii","id","getMainId","presence","callsMapping","hold","evAgentSession","isIntegratedSoftphone","tabManagerEnabled","send","tabManagerEvents","MUTE","evIntegratedSoftphone","sipToggleMute","RcModuleV2"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;IAmBMA,mB,WAZL,gBAAO;AACNC,EAAAA,IAAI,EAAE,qBADA;AAENC,EAAAA,IAAI,EAAE,CACJ,UADI,EAEJ,YAFI,EAGJ,UAHI,EAIJ,uBAJI,EAKJ,gBALI,EAMJ;AAAEC,IAAAA,GAAG,EAAE,YAAP;AAAqBC,IAAAA,QAAQ,EAAE;AAA/B,GANI,EAOJ;AAAED,IAAAA,GAAG,EAAE,4BAAP;AAAqCC,IAAAA,QAAQ,EAAE;AAA/C,GAPI;AAFA,CAAP,C;;;;;;;wBAcyB;AAAA;;AACtB,sCAAO,KAAKC,KAAL,CAAWC,UAAlB,0DAAO,sBAAuBC,OAAvB,CAA+BC,OAAtC;AACD;;;AAED,+BAAYN,IAAZ,EAAwB;AAAA;;AAAA,6BAChB;AACJA,MAAAA,IAAI,EAAJA;AADI,KADgB;AAIvB;;;;2BAEM;AACL,WAAKO,cAAL,CAAoB,IAApB;AACD;;;6BAEQ;AACP,WAAKA,cAAL,CAAoB,KAApB;AACD;;;2BAEMC,S,EAAmB;AACxB,WAAKL,KAAL,CAAWM,QAAX,CAAoBC,MAApB,CAA2B;AAAEF,QAAAA,SAAS,EAATA;AAAF,OAA3B;AACD;;;6BAEQ;AACPG,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACD;;;2BAEM;AACL,WAAKC,kBAAL,CAAwB,IAAxB;AACD;;;6BAEQ;AACP,WAAKA,kBAAL,CAAwB,KAAxB;AACD;;;wCAEkD;AAAA,UAAnCL,SAAmC,QAAnCA,SAAmC;;AACjD,WAAKL,KAAL,CAAWM,QAAX,CAAoBC,MAApB,CAA2B;AAAEF,QAAAA,SAAS,EAATA;AAAF,OAA3B;AACD;;;uCAE4D;AAAA,UAA/CA,SAA+C,SAA/CA,SAA+C;AAAA,UAApCM,KAAoC,SAApCA,KAAoC;;AAC3D,WAAKX,KAAL,CAAWM,QAAX,CAAoBM,WAApB,CAAgC;AAAED,QAAAA,KAAK,EAALA,KAAF;AAASN,QAAAA,SAAS,EAATA;AAAT,OAAhC;AACD;;;gCAEWQ,G,EAAa;AACvB,UAAMC,EAAE,GAAG,KAAKd,KAAL,CAAWM,QAAX,CAAoBS,SAApB,CAA8BF,GAA9B,CAAX;;AACA,aAAO,KAAKb,KAAL,CAAWgB,QAAX,CAAoBC,YAApB,CAAiCH,EAAjC,CAAP;AACD;;;uCAE0BH,K,EAAgB;AACzC,WAAKX,KAAL,CAAWM,QAAX,CAAoBY,IAApB,CAAyBP,KAAzB;AACD;;;mCAEsBA,K,EAAgB;AACrC,UAAI,KAAKX,KAAL,CAAWmB,cAAX,CAA0BC,qBAA9B,EAAqD;AACnD,YAAI,KAAKC,iBAAT,EAA4B;AAC1B,eAAKrB,KAAL,CAAWC,UAAX,CAAsBqB,IAAtB,CAA2BC,wBAAiBC,IAA5C,EAAkDb,KAAlD;AACD;;AACD,aAAKX,KAAL,CAAWyB,qBAAX,CAAiCC,aAAjC,CAA+Cf,KAA/C;AACD;AACF;;;;EA5D+BgB,gB","sourcesContent":["import { RcModuleV2 } from '@ringcentral-integration/core';\nimport { Module } from 'ringcentral-integration/lib/di';\n\nimport { tabManagerEvents } from '../../enums';\nimport {\n  EvClientHandUpParams,\n  EvClientHoldSessionParams,\n} from '../../lib/EvClient';\nimport { ActiveCallControl, Deps } from './EvActiveCallControl.interface';\n\n@Module({\n  name: 'EvActiveCallControl',\n  deps: [\n    'EvClient',\n    'EvSettings',\n    'Presence',\n    'EvIntegratedSoftphone',\n    'EvAgentSession',\n    { dep: 'TabManager', optional: true },\n    { dep: 'EvActiveCallControlOptions', optional: true },\n  ],\n})\nclass EvActiveCallControl extends RcModuleV2<Deps>\n  implements ActiveCallControl {\n  get tabManagerEnabled() {\n    return this._deps.tabManager?._tabbie.enabled;\n  }\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n  }\n\n  mute() {\n    this._sipToggleMute(true);\n  }\n\n  unmute() {\n    this._sipToggleMute(false);\n  }\n\n  hangUp(sessionId: string) {\n    this._deps.evClient.hangup({ sessionId });\n  }\n\n  reject() {\n    console.log('reject');\n  }\n\n  hold() {\n    this._changeOnHoldState(true);\n  }\n\n  unhold() {\n    this._changeOnHoldState(false);\n  }\n\n  hangupSession({ sessionId }: EvClientHandUpParams) {\n    this._deps.evClient.hangup({ sessionId });\n  }\n\n  holdSession({ sessionId, state }: EvClientHoldSessionParams) {\n    this._deps.evClient.holdSession({ state, sessionId });\n  }\n\n  getMainCall(uii: string) {\n    const id = this._deps.evClient.getMainId(uii);\n    return this._deps.presence.callsMapping[id];\n  }\n\n  private _changeOnHoldState(state: boolean) {\n    this._deps.evClient.hold(state);\n  }\n\n  private _sipToggleMute(state: boolean) {\n    if (this._deps.evAgentSession.isIntegratedSoftphone) {\n      if (this.tabManagerEnabled) {\n        this._deps.tabManager.send(tabManagerEvents.MUTE, state);\n      }\n      this._deps.evIntegratedSoftphone.sipToggleMute(state);\n    }\n  }\n}\n\nexport { EvActiveCallControl };\n"],"file":"EvActiveCallControl.js"}