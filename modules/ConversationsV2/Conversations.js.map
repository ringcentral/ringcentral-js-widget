{"version":3,"sources":["modules/ConversationsV2/Conversations.ts"],"names":["mergeMessages","messages","oldMessages","tmp","currentMessages","forEach","element","push","id","getEarliestTime","newTime","Date","now","message","creationTime","getTime","getUniqueNumbers","conversations","output","numberMap","addIfNotExist","number","from","direction","messageDirection","inbound","fromNumber","phoneNumber","extensionNumber","to","length","outbound","toNumber","toPhoneNumber","DEFAULT_PER_PAGE","DEFAULT_DAY_SPAN","Conversations","name","deps","dep","optional","allUniqueNumbers","currentPage","typeFilter","effectiveSearchString","that","_deps","messageStore","allConversations","oldConversations","pagingConversations","searchInput","typeFilteredConversations","extensionInfo","contactMatcher","dataMapping","conversationLogger","loggingMap","auth","accessToken","formattedConversations","conversationStore","filteredConversations","currentConversationId","inputContents","_olderDataExisted","_olderMessagesExisted","_perPage","_daySpan","_enableLoadOldMessages","_showMMSAttachment","conversationsOptions","perPage","daySpan","enableLoadOldMessages","showMMSAttachment","messageSender","on","events","send","toNumbers","addEntities","map","addQuerySource","getQueriesFn","uniqueNumbers","readyCheckFn","ready","input","status","fetchConversationsStatus","records","isIncreaseCurrentPage","concat","normalizeRecord","conversationsStatus","idle","conversationId","filter","c","String","fetchMessagesStatus","text","existedContent","find","content","attachments","attachment","f","msg","conversationStatus","entities","correspondentMatch","entity","item","rawId","responses","correspondentResponse","reduce","accumulator","response","conversation","messageTypes","all","loggedIn","triggerMatch","_hasPermission","fetchOldConversations","_resetAllStatus","shouldTriggerMatchConditions","newValue","oldValue","_cleanOldConversations","_updateSearchInput","type","_updateTypeFilter","loadNextPage","loadingOldConversations","_updateFetchConversationsStatus","fetching","dateFrom","setDate","getDate","dateTo","earliestTime","params","distinctConversations","toISOString","messageType","sms","pager","client","account","extension","list","recordsLength","_fetchOldConversationsSuccess","_increaseCurrentPage","_resetCurrentPage","_updateCurrentConversationId","loadingOldMessages","_updateFetchMessagesStatus","currentConversation","_fetchOldMessagesSuccess","ttlConfig","messageSenderMessages","noAreaCode","ttl","alert","warning","_alertWarning","textTooLong","_updateMessageText","attachmentCountLimitation","size","prev","curr","ATTACHMENT_SIZE_LIMITATION","attachmentSizeLimitation","_addAttachment","_removeAttachment","_updateConversationStatus","pushing","_getFromNumber","_getToNumbers","replyOnMessageId","_getReplyOnMessageId","pushMessage","_removeInputContent","_onReplyError","messageList","lastMessage","senderNumber","recipients","recipient","deleteConversationMessages","deleteConversation","deleteMessageApi","_deleteOldConversation","console","error","_addCorrespondentMatchEntities","_removeCorrespondentMatchEntity","_addCorrespondentResponses","_removeCorrespondentResponses","addResponses","regionSettings","countryCode","areaCode","formattedCorrespondentMatch","formatted","removeExtension","logConversation","removeEntity","removeResponse","newConversations","conversationMap","pushConversation","cid","messageIsTextMessage","voiceMail","messageIsVoicemail","fax","messageIsFax","rolesAndPermissions","readTextPermissions","voicemailPermissions","readFaxPermissions","contactMapping","conversationLogMapping","self","correspondents","selfNumber","selfMatches","correspondentMatches","matches","contact","conversationLogId","getConversationLogId","isLogging","conversationMatches","voicemailAttachment","faxAttachment","unreadCounts","mmsAttachments","lastMatchedCorrespondentEntity","getLastMatchedCorrespondentEntity","searchResults","cleanRegex","searchString","toLowerCase","searchNumber","replace","cleanedNumber","indexOf","matchOrder","subject","matchedMessage","sort","sortSearchResults","pageNumber","lastIndex","slice","allMessages","m","reverse","myExtensionNumber","myNumber","res","hasReadMessagesPermission","RcModuleV2","state","action","proxify"],"mappings":"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","sourcesContent":["import {\n  RcModuleV2,\n  state,\n  action,\n  watch,\n  computed,\n} from '@ringcentral-integration/core';\nimport { ObjectMapValue } from '@ringcentral-integration/core/lib/ObjectMap';\nimport {\n  ListMessagesParameters,\n  GetMessageList,\n  MessageAttachmentInfo,\n  GetMessageInfoResponse,\n} from '@rc-ex/core/definitions';\n\nimport normalizeNumber from '../../lib/normalizeNumber';\nimport { messageDirection } from '../../enums/messageDirection';\nimport { Module } from '../../lib/di';\nimport proxify from '../../lib/proxy/proxify';\nimport { messageTypes } from '../../enums/messageTypes';\nimport cleanNumber from '../../lib/cleanNumber';\nimport {\n  messageSenderMessages,\n  ATTACHMENT_SIZE_LIMITATION,\n  Attachment,\n} from '../MessageSenderV2';\n\nimport {\n  getNumbersFromMessage,\n  sortSearchResults,\n  messageIsTextMessage,\n  messageIsVoicemail,\n  getVoicemailAttachment,\n  getFaxAttachment,\n  getMMSAttachments,\n  messageIsFax,\n  getMyNumberFromMessage,\n  getRecipientNumbersFromMessage,\n  messageIsUnread,\n  normalizeRecord,\n  NormalizedMessageRecord,\n  Correspondent,\n} from '../../lib/messageHelper';\n\nimport { conversationsStatus } from './conversationsStatus';\n\nimport {\n  Deps,\n  InputContent,\n  CurrentConversation,\n  FormattedConversation,\n  FilteredConversation,\n  CorrespondentMatch,\n  CorrespondentResponse,\n} from './Conversations.interface';\n\nfunction mergeMessages(\n  messages: NormalizedMessageRecord[],\n  oldMessages: NormalizedMessageRecord[],\n): NormalizedMessageRecord[] {\n  const tmp: { [key: string]: number } = {};\n  const currentMessages: NormalizedMessageRecord[] = [];\n  messages.forEach((element) => {\n    currentMessages.push(element);\n    tmp[element.id] = 1;\n  });\n\n  oldMessages.forEach((element) => {\n    if (!tmp[element.id]) {\n      currentMessages.push(element);\n    }\n  });\n  return currentMessages;\n}\n\nfunction getEarliestTime(messages: NormalizedMessageRecord[]) {\n  let newTime = Date.now();\n  messages.forEach((message) => {\n    const creationTime = new Date(message.creationTime).getTime();\n    if (creationTime < newTime) {\n      newTime = creationTime;\n    }\n  });\n  return newTime;\n}\n\nfunction getUniqueNumbers(conversations: NormalizedMessageRecord[]): string[] {\n  const output: string[] = [];\n  const numberMap: { [key: string]: boolean } = {};\n  function addIfNotExist(number: string) {\n    if (number && !numberMap[number]) {\n      output.push(number);\n      numberMap[number] = true;\n    }\n  }\n  conversations.forEach((message) => {\n    if (message.from && message.direction === messageDirection.inbound) {\n      const fromNumber =\n        message.from.phoneNumber || message.from.extensionNumber;\n      addIfNotExist(fromNumber);\n    }\n    if (\n      message.to &&\n      message.to.length > 0 &&\n      message.direction === messageDirection.outbound\n    ) {\n      message.to.forEach((toNumber) => {\n        if (!toNumber) {\n          return;\n        }\n        const toPhoneNumber = toNumber.phoneNumber || toNumber.extensionNumber;\n        addIfNotExist(toPhoneNumber);\n      });\n    }\n  });\n  return output;\n}\n\nexport const DEFAULT_PER_PAGE = 20;\nexport const DEFAULT_DAY_SPAN = 90;\n\n@Module({\n  name: 'Conversations',\n  deps: [\n    'Alert',\n    'Auth',\n    'Client',\n    'MessageSender',\n    'ExtensionInfo',\n    'MessageStore',\n    'RolesAndPermissions',\n    'RegionSettings',\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'ConversationLogger', optional: true },\n    { dep: 'ConversationsOptions', optional: true },\n  ],\n})\nexport class Conversations extends RcModuleV2<Deps> {\n  protected _olderDataExisted: boolean = true;\n  protected _olderMessagesExisted: boolean = true;\n\n  protected _perPage: number;\n  protected _daySpan: number;\n  protected _enableLoadOldMessages: boolean;\n  protected _showMMSAttachment: boolean;\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n\n    this._perPage =\n      this._deps.conversationsOptions?.perPage ?? DEFAULT_PER_PAGE;\n    this._daySpan =\n      this._deps.conversationsOptions?.daySpan ?? DEFAULT_DAY_SPAN;\n    this._enableLoadOldMessages =\n      this._deps.conversationsOptions?.enableLoadOldMessages ?? false;\n    this._showMMSAttachment =\n      this._deps.conversationsOptions?.showMMSAttachment ?? false;\n\n    this._deps.messageSender.on(\n      this._deps.messageSender.events.send,\n      ({ toNumbers }) => {\n        this.addEntities(toNumbers.map((number) => ({ phoneNumber: number })));\n      },\n    );\n\n    if (this._deps.contactMatcher) {\n      this._deps.contactMatcher.addQuerySource({\n        getQueriesFn: () => this.uniqueNumbers,\n        readyCheckFn: () => this._deps.messageStore.ready,\n      });\n    }\n  }\n\n  @state\n  searchInput: string = '';\n\n  @state\n  typeFilter: ObjectMapValue<typeof messageTypes> = messageTypes.all;\n\n  @state\n  oldConversations: NormalizedMessageRecord[] = [];\n\n  @state\n  currentPage: number = 1;\n\n  @state\n  fetchConversationsStatus: ObjectMapValue<typeof conversationsStatus> = conversationsStatus.idle;\n\n  @state\n  currentConversationId?: string = null;\n\n  @state\n  oldMessages: NormalizedMessageRecord[] = [];\n\n  @state\n  fetchMessagesStatus: ObjectMapValue<typeof conversationsStatus> = conversationsStatus.idle;\n\n  @state\n  inputContents: InputContent[] = [];\n\n  @state\n  conversationStatus: ObjectMapValue<typeof conversationsStatus> = conversationsStatus.idle;\n\n  @state\n  correspondentMatch: CorrespondentMatch[] = [];\n\n  @state\n  correspondentResponse: CorrespondentResponse = {};\n\n  @action\n  _updateSearchInput(input: string = '') {\n    this.searchInput = input;\n  }\n\n  @action\n  _updateTypeFilter(typeFilter: ObjectMapValue<typeof messageTypes>) {\n    this.typeFilter = typeFilter;\n    this.currentPage = 1;\n    this.oldConversations = [];\n  }\n\n  @action\n  _updateFetchConversationsStatus(\n    status: ObjectMapValue<typeof conversationsStatus>,\n  ) {\n    this.fetchConversationsStatus = status;\n  }\n\n  @action\n  _fetchOldConversationsSuccess(\n    records: GetMessageInfoResponse[],\n    isIncreaseCurrentPage: boolean,\n  ) {\n    this.oldConversations = this.oldConversations.concat(\n      records.map(normalizeRecord),\n    );\n    this.fetchConversationsStatus = conversationsStatus.idle;\n    if (isIncreaseCurrentPage) {\n      this.currentPage += 1;\n    }\n  }\n\n  @action\n  _deleteOldConversation(conversationId: string) {\n    this.oldConversations = this.oldConversations.filter(\n      (c) => String(c.conversationId) !== String(conversationId),\n    );\n  }\n\n  @action\n  _cleanOldConversations() {\n    this.oldConversations = [];\n  }\n\n  @action\n  _increaseCurrentPage() {\n    this.currentPage += 1;\n  }\n\n  @action\n  _resetCurrentPage() {\n    this.currentPage = 1;\n  }\n\n  @action\n  _updateCurrentConversationId(conversationId?: string) {\n    this.currentConversationId = conversationId;\n    this.oldMessages = [];\n  }\n\n  @action\n  _updateFetchMessagesStatus(\n    status: ObjectMapValue<typeof conversationsStatus>,\n  ) {\n    this.fetchMessagesStatus = status;\n  }\n\n  @action\n  _fetchOldMessagesSuccess(records: GetMessageInfoResponse[]) {\n    this.oldMessages = this.oldMessages.concat(records.map(normalizeRecord));\n    this.fetchMessagesStatus = conversationsStatus.idle;\n  }\n\n  @action\n  _updateMessageText(conversationId: string, text: string) {\n    const existedContent = this.inputContents.find(\n      (content) => content.conversationId === conversationId,\n    );\n    if (existedContent) {\n      existedContent.text = text;\n    } else {\n      this.inputContents.push({ conversationId, text, attachments: [] });\n    }\n  }\n\n  @action\n  _addAttachment(conversationId: string, attachment: Attachment) {\n    const existedContent = this.inputContents.find(\n      (content) => content.conversationId === conversationId,\n    );\n    if (existedContent) {\n      const attachments = (existedContent.attachments || []).filter(\n        (f) => f.name !== attachment.name,\n      );\n      attachments.push(attachment);\n      existedContent.attachments = attachments;\n    } else {\n      this.inputContents.push({\n        conversationId,\n        text: '',\n        attachments: [attachment],\n      });\n    }\n  }\n\n  @action\n  _removeAttachment(conversationId: string, attachment: Attachment) {\n    const existedContent = this.inputContents.find(\n      (content) => content.conversationId === conversationId,\n    );\n    if (existedContent) {\n      existedContent.attachments = existedContent.attachments.filter(\n        (f) => f.name !== attachment.name,\n      );\n    }\n  }\n\n  @action\n  _removeInputContent(conversationId: string) {\n    this.inputContents = this.inputContents.filter(\n      (msg) => typeof msg === 'object' && msg.conversationId !== conversationId,\n    );\n  }\n\n  @action\n  _updateConversationStatus(\n    status: ObjectMapValue<typeof conversationsStatus>,\n  ) {\n    this.conversationStatus = status;\n  }\n\n  @action\n  _addCorrespondentMatchEntities(entities: CorrespondentMatch[]) {\n    this.correspondentMatch = [...entities];\n  }\n\n  @action\n  _removeCorrespondentMatchEntity(entity: CorrespondentMatch) {\n    this.correspondentMatch = this.correspondentMatch.filter(\n      (item) => item.rawId !== entity.id && item.id !== entity.id,\n    );\n  }\n\n  @action\n  _addCorrespondentResponses(\n    responses: NormalizedMessageRecord[] = [],\n    phoneNumber: string = '',\n  ) {\n    this.correspondentResponse = responses.reduce(\n      (accumulator: any, response: any) => {\n        const {\n          to,\n          from,\n          direction,\n          conversation: { id },\n        } = response;\n        const number = direction === 'Inbound' ? from : to[0];\n        phoneNumber = number.phoneNumber || number.extensionNumber;\n        return {\n          ...accumulator,\n          [phoneNumber]: id,\n        };\n      },\n      {},\n    );\n  }\n\n  @action\n  _removeCorrespondentResponses(phoneNumber: string) {\n    delete this.correspondentResponse[phoneNumber];\n  }\n\n  @action\n  _resetAllStatus() {\n    this.searchInput = '';\n    this.typeFilter = messageTypes.all;\n    this.oldConversations = [];\n    this.currentPage = 1;\n    this.fetchConversationsStatus = conversationsStatus.idle;\n    this.currentConversationId = null;\n    this.oldMessages = [];\n    this.fetchMessagesStatus = conversationsStatus.idle;\n    this.inputContents = [];\n    this.conversationStatus = conversationsStatus.idle;\n  }\n\n  _shouldInit() {\n    return !!(super._shouldInit() && this._deps.auth.loggedIn);\n  }\n\n  _shouldReset() {\n    return !!(\n      super._shouldReset() ||\n      (this.ready && !this._deps.auth.loggedIn)\n    );\n  }\n\n  onInit() {\n    if (this._deps.contactMatcher) {\n      this._deps.contactMatcher.triggerMatch();\n    }\n  }\n\n  onInitSuccess() {\n    if (\n      this.allConversations.length <= this._perPage &&\n      this._enableLoadOldMessages &&\n      this._hasPermission\n    ) {\n      this.fetchOldConversations();\n    }\n  }\n\n  onReset() {\n    this._olderDataExisted = true;\n    this._olderMessagesExisted = true;\n    this._resetAllStatus();\n  }\n\n  onInitOnce() {\n    watch(\n      this,\n      () => this.shouldTriggerMatchConditions,\n      () => {\n        if (this._deps.contactMatcher && this.ready) {\n          this._deps.contactMatcher.triggerMatch();\n        }\n      },\n    );\n    watch(\n      this,\n      () => this._deps.messageStore.allConversations,\n      (newValue = [], oldValue = []) => {\n        if (newValue.length < oldValue.length) {\n          if (this.oldConversations.length > 0) {\n            this._cleanOldConversations();\n            this._olderDataExisted = true;\n          }\n        }\n      },\n    );\n  }\n\n  @computed<Conversations>(\n    ({ allUniqueNumbers, currentPage, typeFilter, effectiveSearchString }) => [\n      allUniqueNumbers,\n      currentPage,\n      typeFilter,\n      effectiveSearchString,\n    ],\n  )\n  get shouldTriggerMatchConditions(): any[] {\n    return [\n      this.allUniqueNumbers,\n      this.currentPage,\n      this.typeFilter,\n      this.effectiveSearchString,\n    ];\n  }\n\n  @proxify\n  async updateSearchInput(input: string) {\n    this._updateSearchInput(input);\n  }\n\n  @proxify\n  async updateTypeFilter(type: ObjectMapValue<typeof messageTypes>) {\n    if (this.typeFilter === type) {\n      return;\n    }\n    this._updateTypeFilter(type);\n    this._olderDataExisted = true;\n    this._olderMessagesExisted = true;\n    if (this.pagingConversations.length <= this._perPage) {\n      this.loadNextPage();\n    }\n  }\n\n  @proxify\n  async fetchOldConversations() {\n    if (!this._olderDataExisted) {\n      return;\n    }\n    if (this.loadingOldConversations) {\n      return;\n    }\n    this._updateFetchConversationsStatus(conversationsStatus.fetching);\n    let dateFrom = new Date();\n    dateFrom.setDate(dateFrom.getDate() - this._daySpan);\n    const dateTo = new Date(this.earliestTime);\n    if (dateTo.getTime() < dateFrom.getTime()) {\n      dateFrom = new Date(dateTo.getTime() - 1000 * 3600 * 24);\n    }\n    const typeFilter = this.typeFilter;\n    const currentPage = this.currentPage;\n    const params: ListMessagesParameters = {\n      distinctConversations: true,\n      perPage: this._perPage,\n      dateFrom: dateFrom.toISOString(),\n      dateTo: dateTo.toISOString(),\n    };\n    if (typeFilter === messageTypes.text) {\n      params.messageType = [messageTypes.sms, messageTypes.pager];\n    } else if (typeFilter !== messageTypes.all) {\n      params.messageType = [typeFilter];\n    }\n    try {\n      const { records } : GetMessageList = await this._deps.client\n        .account()\n        .extension()\n        .messageStore()\n        .list(params);\n      const recordsLength = records.length;\n      this._olderDataExisted = recordsLength === this._perPage;\n      if (typeFilter === this.typeFilter && currentPage === this.currentPage) {\n        const isIncreaseCurrentPage =\n          recordsLength &&\n          this._perPage * this.currentPage <\n            recordsLength + this.filteredConversations.length;\n        this._fetchOldConversationsSuccess(records, isIncreaseCurrentPage);\n      }\n    } catch (e) {\n      if (typeFilter === this.typeFilter && currentPage === this.currentPage) {\n        this._updateFetchConversationsStatus(conversationsStatus.idle);\n      }\n    }\n  }\n\n  @proxify\n  async loadNextPage() {\n    const currentPage = this.currentPage;\n    if (currentPage * this._perPage < this.filteredConversations.length) {\n      this._increaseCurrentPage();\n      return;\n    }\n    if (this.effectiveSearchString !== '') {\n      return;\n    }\n    if (!this._enableLoadOldMessages || !this._hasPermission) {\n      return;\n    }\n    await this.fetchOldConversations();\n  }\n\n  @proxify\n  async resetCurrentPage() {\n    this._resetCurrentPage();\n  }\n\n  @proxify\n  async loadConversation(conversationId: string) {\n    if (conversationId === this.currentConversationId) {\n      return;\n    }\n    this._updateCurrentConversationId(conversationId);\n  }\n\n  @proxify\n  async unloadConversation() {\n    this._updateCurrentConversationId(null);\n    this._olderMessagesExisted = true;\n  }\n\n  @proxify\n  async fetchOldMessages(perPage = this._perPage) {\n    if (!this._enableLoadOldMessages) {\n      return;\n    }\n    if (!this._hasPermission) {\n      return;\n    }\n    if (!this._olderMessagesExisted) {\n      return;\n    }\n    if (this.loadingOldMessages) {\n      return;\n    }\n    if (!this.currentConversationId) {\n      return;\n    }\n    this._updateFetchMessagesStatus(conversationsStatus.fetching);\n    const conversationId = this.currentConversationId;\n    const dateFrom = new Date();\n    dateFrom.setDate(dateFrom.getDate() - this._daySpan);\n    const earliestTime = getEarliestTime(this.currentConversation.messages);\n    const dateTo = new Date(earliestTime);\n    if (dateTo.getTime() < dateFrom.getTime()) {\n      dateFrom.setDate(dateFrom.getDate() - 1);\n    }\n    const params: ListMessagesParameters = {\n      conversationId,\n      perPage,\n      dateFrom: dateFrom.toISOString(),\n      dateTo: dateTo.toISOString(),\n    };\n    try {\n      const { records }: GetMessageList = await this._deps.client\n        .account()\n        .extension()\n        .messageStore()\n        .list(params);\n      this._olderMessagesExisted = records.length === perPage;\n      if (conversationId === this.currentConversationId) {\n        this._fetchOldMessagesSuccess(records);\n      }\n    } catch (e) {\n      if (conversationId === this.currentConversationId) {\n        this._updateFetchMessagesStatus(conversationsStatus.idle);\n      }\n    }\n  }\n\n  _alertWarning(message: string) {\n    if (message) {\n      const ttlConfig =\n        message !== messageSenderMessages.noAreaCode ? { ttl: 0 } : null;\n      this._deps.alert.warning({\n        message,\n        ...ttlConfig,\n      });\n      return true;\n    }\n    return false;\n  }\n\n  @proxify\n  async updateMessageText(text: string) {\n    if (text.length > 1000) {\n      return this._alertWarning(messageSenderMessages.textTooLong);\n    }\n    this._updateMessageText(this.currentConversationId, text);\n  }\n\n  @proxify\n  async addAttachment(attachment: Attachment) {\n    const attachments = this.attachments;\n    if (attachments.length >= 10) {\n      this._alertWarning(messageSenderMessages.attachmentCountLimitation);\n      return;\n    }\n    const size = attachments.reduce((prev, curr) => {\n      return prev + curr.size;\n    }, 0);\n    if (size + attachment.size > ATTACHMENT_SIZE_LIMITATION) {\n      this._alertWarning(messageSenderMessages.attachmentSizeLimitation);\n      return;\n    }\n    this._addAttachment(this.currentConversationId, attachment);\n  }\n\n  @proxify\n  async removeAttachment(attachment: Attachment) {\n    this._removeAttachment(this.currentConversationId, attachment);\n  }\n\n  @proxify\n  async replyToReceivers(text: string, attachments: Attachment[] = []) {\n    this._updateConversationStatus(conversationsStatus.pushing);\n    try {\n      const responses = await this._deps.messageSender.send({\n        fromNumber: this._getFromNumber(),\n        toNumbers: this._getToNumbers(),\n        text,\n        attachments,\n        replyOnMessageId: this._getReplyOnMessageId(),\n      });\n      if (responses && responses[0]) {\n        this._deps.messageStore.pushMessage(responses[0]);\n        this._updateConversationStatus(conversationsStatus.idle);\n        this._removeInputContent(this.currentConversationId);\n        return responses[0];\n      }\n      this._onReplyError();\n      return null;\n    } catch (error) {\n      this._onReplyError();\n      throw error;\n    }\n  }\n\n  _onReplyError() {\n    this._updateConversationStatus(conversationsStatus.idle);\n  }\n\n  _getReplyOnMessageId() {\n    const messageList = this.currentConversation.messages;\n    const lastMessage =\n      messageList &&\n      messageList.length > 0 &&\n      messageList[messageList.length - 1];\n    if (lastMessage && lastMessage.id) {\n      return lastMessage.id;\n    }\n    return null;\n  }\n\n  _getFromNumber() {\n    const senderNumber = this.currentConversation.senderNumber;\n    if (!senderNumber) {\n      return null;\n    }\n    return senderNumber.extensionNumber || senderNumber.phoneNumber;\n  }\n\n  _getToNumbers() {\n    const recipients = this.currentConversation.recipients;\n    return recipients.map(\n      (recipient) => recipient.extensionNumber || recipient.phoneNumber,\n    );\n  }\n\n  @proxify\n  async deleteConversation(conversationId: string) {\n    if (!conversationId) {\n      return;\n    }\n    if (this._deps.messageStore.conversationStore[conversationId]) {\n      await this._deps.messageStore.deleteConversationMessages(conversationId);\n      return;\n    }\n    const conversation = this.allConversations.find(\n      (c) => c.conversationId === conversationId,\n    );\n    if (!conversation) {\n      return;\n    }\n    if (messageIsTextMessage(conversation)) {\n      await this._deps.messageStore.deleteConversation(conversationId);\n      return;\n    }\n    try {\n      await this._deps.messageStore.deleteMessageApi(conversationId);\n      this._deleteOldConversation(conversationId);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  @computed<Conversations>((that: Conversations) => [\n    that._deps.messageStore.allConversations,\n    that.oldConversations,\n  ])\n  get allConversations(): NormalizedMessageRecord[] {\n    const conversations = this._deps.messageStore.allConversations;\n    const oldConversations = this.oldConversations;\n    if (oldConversations.length === 0) {\n      return conversations;\n    }\n    const newConversations: NormalizedMessageRecord[] = [];\n    const conversationMap: { [key: string]: number } = {};\n    const pushConversation = (c: NormalizedMessageRecord) => {\n      // use conversationId when available, use id for VoiceMail/Fax/etc..\n      const cid = c.conversationId || c.id;\n      if (conversationMap[cid]) {\n        return;\n      }\n      newConversations.push(c);\n      conversationMap[cid] = 1;\n    };\n    conversations.forEach(pushConversation);\n    oldConversations.forEach(pushConversation);\n    return newConversations;\n  }\n\n  @computed<Conversations>(({ pagingConversations }) => [pagingConversations])\n  get uniqueNumbers() {\n    return getUniqueNumbers(this.pagingConversations);\n  }\n\n  @computed<Conversations>(({ pagingConversations }) => [pagingConversations])\n  get allUniqueNumbers() {\n    return getUniqueNumbers(this.allConversations);\n  }\n\n  @computed<Conversations>(({ searchInput }) => [searchInput])\n  get effectiveSearchString() {\n    if (this.searchInput.length >= 3) {\n      return this.searchInput;\n    };\n    return '';\n  }\n\n  @computed<Conversations>(({ allConversations, typeFilter }) => [\n    allConversations,\n    typeFilter,\n  ])\n  get typeFilteredConversations() {\n    const typeFilter = this.typeFilter;\n    const allConversations = this.allConversations;\n    switch (typeFilter) {\n      case messageTypes.text:\n        return allConversations.filter(messageIsTextMessage);\n      case messageTypes.voiceMail:\n        return allConversations.filter(messageIsVoicemail);\n      case messageTypes.fax:\n        return allConversations.filter(messageIsFax);\n      default:\n        return allConversations.filter(\n          (conversation) =>\n            (this._deps.rolesAndPermissions.readTextPermissions ||\n              !messageIsTextMessage(conversation)) &&\n            (this._deps.rolesAndPermissions.voicemailPermissions ||\n              !messageIsVoicemail(conversation)) &&\n            (this._deps.rolesAndPermissions.readFaxPermissions ||\n              !messageIsFax(conversation)),\n        );\n    }\n  }\n\n  @computed<Conversations>((that: Conversations) => [\n    that.typeFilteredConversations,\n    that._deps.extensionInfo.extensionNumber,\n    that._deps.contactMatcher?.dataMapping,\n    that._deps.conversationLogger?.loggingMap,\n    that._deps.conversationLogger?.dataMapping,\n    that._deps.auth.accessToken,\n  ])\n  get formattedConversations(): FormattedConversation[] {\n    const conversations = this.typeFilteredConversations;\n    const extensionNumber = this._deps.extensionInfo.extensionNumber;\n    const contactMapping =\n      (this._deps.contactMatcher && this._deps.contactMatcher.dataMapping) ||\n      {};\n    const loggingMap =\n      (this._deps.conversationLogger &&\n        this._deps.conversationLogger.loggingMap) ||\n      {};\n    const conversationLogMapping =\n      (this._deps.conversationLogger &&\n        this._deps.conversationLogger.dataMapping) ||\n      {};\n    const accessToken = this._deps.auth.accessToken;\n    return conversations.map((message) => {\n      const { self, correspondents } = getNumbersFromMessage({\n        extensionNumber,\n        message,\n      });\n      const selfNumber = self && (self.phoneNumber || self.extensionNumber);\n      const selfMatches = (selfNumber && contactMapping[selfNumber]) || [];\n      const correspondentMatches: CorrespondentMatch[] = correspondents.reduce(\n        (matches: CorrespondentMatch[], contact: Correspondent) => {\n          const number =\n            contact && (contact.phoneNumber || contact.extensionNumber);\n          return number && contactMapping[number] && contactMapping[number].length\n            ? matches.concat(contactMapping[number])\n            : matches;\n        },\n        [] as CorrespondentMatch[],\n      );\n      const conversationLogId = this._deps.conversationLogger\n        ? this._deps.conversationLogger.getConversationLogId(message)\n        : null;\n      const isLogging = !!(conversationLogId && loggingMap[conversationLogId]);\n      const conversationMatches =\n        conversationLogMapping[conversationLogId] || [];\n      let voicemailAttachment = null;\n      if (messageIsVoicemail(message)) {\n        voicemailAttachment = getVoicemailAttachment(message, accessToken);\n      }\n      let faxAttachment = null;\n      if (messageIsFax(message)) {\n        faxAttachment = getFaxAttachment(message, accessToken);\n      }\n      let unreadCounts = message.unreadCounts;\n      if (typeof unreadCounts === 'undefined') {\n        unreadCounts = messageIsUnread(message) ? 1 : 0;\n      }\n      let mmsAttachments: MessageAttachmentInfo[] = [];\n      if (messageIsTextMessage(message) && this._showMMSAttachment) {\n        mmsAttachments = getMMSAttachments(message, accessToken);\n      }\n      return {\n        ...message,\n        unreadCounts,\n        self,\n        selfMatches,\n        correspondents,\n        correspondentMatches,\n        conversationLogId,\n        isLogging,\n        conversationMatches,\n        voicemailAttachment,\n        faxAttachment,\n        mmsAttachments,\n        lastMatchedCorrespondentEntity:\n          (this._deps.conversationLogger &&\n            this._deps.conversationLogger.getLastMatchedCorrespondentEntity(\n              message,\n            )) ||\n          null,\n      };\n    });\n  }\n\n  @computed<Conversations>((that: Conversations) => [\n    that.formattedConversations,\n    that.effectiveSearchString,\n    that._deps.messageStore.conversationStore,\n  ])\n  get filteredConversations(): FilteredConversation[] {\n    const conversations = this.formattedConversations;\n    const effectiveSearchString = this.effectiveSearchString;\n    if (effectiveSearchString === '') {\n      return conversations;\n    }\n    const searchResults: FilteredConversation[] = [];\n    const cleanRegex = /[^\\d*+#\\s]/g;\n    const searchString = effectiveSearchString.toLowerCase();\n    const searchNumber = effectiveSearchString.replace(cleanRegex, '');\n    conversations.forEach((message) => {\n      if (searchNumber === effectiveSearchString) {\n        const cleanedNumber = cleanNumber(effectiveSearchString);\n        if (\n          message.correspondents.find(\n            (contact) =>\n              cleanNumber(\n                contact.phoneNumber || contact.extensionNumber || '',\n              ).indexOf(cleanedNumber) > -1,\n          )\n        ) {\n          // match by phoneNumber or extensionNumber\n          searchResults.push({\n            ...message,\n            matchOrder: 0,\n          });\n          return;\n        }\n      }\n      if (message.correspondentMatches.length) {\n        if (\n          message.correspondentMatches.find(\n            (entity) =>\n              (entity.name || '').toLowerCase().indexOf(searchString) > -1,\n          )\n        ) {\n          // match by entity's name\n          searchResults.push({\n            ...message,\n            matchOrder: 0,\n          });\n          return;\n        }\n      } else if (\n        message.correspondents.find(\n          (contact) =>\n            (contact.name || '').toLowerCase().indexOf(searchString) > -1,\n        )\n      ) {\n        searchResults.push({\n          ...message,\n          matchOrder: 0,\n        });\n        return;\n      }\n\n      // try match messages of the same conversation\n      if ((message.subject || '').toLowerCase().indexOf(searchString) > -1) {\n        searchResults.push({\n          ...message,\n          matchOrder: 1,\n        });\n        return;\n      }\n      const messageList: NormalizedMessageRecord[] =\n        this._deps.messageStore.conversationStore[message.conversationId] || [];\n      const matchedMessage: NormalizedMessageRecord = messageList.find(\n        (item) => (item.subject || '').toLowerCase().indexOf(searchString) > -1,\n      );\n      if (matchedMessage) {\n        searchResults.push({\n          ...message,\n          matchedMessage,\n          matchOrder: 1,\n        });\n      }\n    });\n    return searchResults.sort(sortSearchResults);\n  }\n\n  @computed<Conversations>(({ filteredConversations, currentPage }) => [\n    filteredConversations,\n    currentPage,\n  ])\n  get pagingConversations() {\n    const pageNumber = this.currentPage;\n    const lastIndex = pageNumber * this._perPage;\n    return this.filteredConversations.slice(0, lastIndex);\n  }\n\n  @computed<Conversations>(({ typeFilteredConversations }) => [\n    typeFilteredConversations,\n  ])\n  get earliestTime() {\n    return getEarliestTime(this.typeFilteredConversations);\n  }\n\n  @computed<Conversations>((that) => [\n    that.currentConversationId,\n    that._deps.extensionInfo.extensionNumber,\n    that._deps.contactMatcher?.dataMapping,\n    that.oldMessages,\n    that._deps.messageStore.conversationStore,\n    that.allConversations,\n    that._deps.auth.accessToken,\n    that._deps.conversationLogger?.dataMapping,\n    that._deps.conversationLogger?.loggingMap,\n  ])\n  get currentConversation(): CurrentConversation {\n    const conversationId = this.currentConversationId;\n    const extensionNumber = this._deps.extensionInfo.extensionNumber;\n    const contactMapping =\n      (this._deps.contactMatcher && this._deps.contactMatcher.dataMapping) ||\n      {};\n    const oldMessages = this.oldMessages;\n    const conversationStore = this._deps.messageStore.conversationStore;\n    const conversations = this.allConversations;\n    const accessToken = this._deps.auth.accessToken;\n    const conversationLogMapping =\n      (this._deps.conversationLogger &&\n        this._deps.conversationLogger.dataMapping) ||\n      {};\n    const loggingMap =\n      (this._deps.conversationLogger &&\n        this._deps.conversationLogger.loggingMap) ||\n      {};\n    const conversation = conversations.find(\n      (c) => c.conversationId === conversationId,\n    );\n    const messages: NormalizedMessageRecord[] = [].concat(\n      conversationStore[conversationId] || [],\n    );\n    const currentConversation = {\n      ...conversation,\n    } as CurrentConversation;\n    const allMessages = mergeMessages(messages, oldMessages).map((m) => {\n      if (!this._showMMSAttachment) {\n        return m;\n      }\n      const mmsAttachments = getMMSAttachments(m, accessToken);\n      return {\n        ...m,\n        mmsAttachments,\n      };\n    });\n    const { correspondents = [] } = getNumbersFromMessage({\n      extensionNumber,\n      message: conversation,\n    });\n    const correspondentMatches: CorrespondentMatch[] = correspondents.reduce(\n      (matches: CorrespondentMatch[], contact: Correspondent) => {\n        const number =\n          contact && (contact.phoneNumber || contact.extensionNumber);\n        return number && contactMapping[number] && contactMapping[number].length\n          ? matches.concat(contactMapping[number])\n          : matches;\n      },\n      [] as CorrespondentMatch[],\n    );\n    const conversationLogId = this._deps.conversationLogger\n      ? this._deps.conversationLogger.getConversationLogId(conversation)\n      : null;\n    const conversationMatches = conversationLogMapping[conversationLogId] || [];\n    currentConversation.correspondents = correspondents;\n    currentConversation.correspondentMatches = correspondentMatches;\n    currentConversation.conversationMatches = conversationMatches;\n    currentConversation.messages = allMessages.reverse();\n    currentConversation.senderNumber = getMyNumberFromMessage({\n      message: conversation,\n      myExtensionNumber: this._deps.extensionInfo.extensionNumber,\n    });\n    currentConversation.recipients = getRecipientNumbersFromMessage({\n      message: conversation,\n      myNumber: currentConversation.senderNumber,\n    });\n    currentConversation.isLogging = !!(\n      conversationLogId && loggingMap[conversationLogId]\n    );\n    return currentConversation;\n  }\n\n  @computed<Conversations>(({ inputContents, currentConversationId }) => [\n    inputContents,\n    currentConversationId,\n  ])\n  get messageText() {\n    const conversationId = this.currentConversationId;\n    const res = this.inputContents.find(\n      (msg) => typeof msg === 'object' && msg.conversationId === conversationId,\n    );\n    return res ? res.text : '';\n  }\n\n  @computed<Conversations>(({ inputContents, currentConversationId }) => [\n    inputContents,\n    currentConversationId,\n  ])\n  get attachments() {\n    const conversationId = this.currentConversationId;\n    const res = this.inputContents.find(\n      (msg) => typeof msg === 'object' && msg.conversationId === conversationId,\n    );\n    return res ? res.attachments : [];\n  }\n\n  get loadingOldConversations() {\n    return this.fetchConversationsStatus === conversationsStatus.fetching;\n  }\n\n  get loadingOldMessages() {\n    return this.fetchMessagesStatus === conversationsStatus.fetching;\n  }\n\n  get pushing() {\n    return this.conversationStatus === conversationsStatus.pushing;\n  }\n\n  get _hasPermission() {\n    return this._deps.rolesAndPermissions.hasReadMessagesPermission;\n  }\n\n  addEntities(entities: CorrespondentMatch[]) {\n    this._addCorrespondentMatchEntities(entities);\n  }\n\n  removeEntity(entity: CorrespondentMatch) {\n    this._removeCorrespondentMatchEntity(entity);\n  }\n\n  addResponses(responses: NormalizedMessageRecord[]) {\n    this._addCorrespondentResponses(responses);\n  }\n\n  removeResponse(phoneNumber: string) {\n    this._removeCorrespondentResponses(phoneNumber);\n  }\n\n  relateCorrespondentEntity(responses: NormalizedMessageRecord[]) {\n    if (\n      !this._deps.contactMatcher ||\n      !this._deps.conversationLogger ||\n      !this.correspondentMatch.length\n    ) {\n      return;\n    }\n    this.addResponses(responses);\n    const { countryCode, areaCode } = this._deps.regionSettings;\n    const formattedCorrespondentMatch = this.correspondentMatch.map((item) => {\n      const formatted = normalizeNumber({\n        phoneNumber: item.phoneNumber,\n        countryCode,\n        areaCode,\n        removeExtension: false,\n      });\n      return {\n        phoneNumber: formatted,\n        id: item.rawId,\n      };\n    });\n    formattedCorrespondentMatch.forEach((item) => {\n      const { phoneNumber } = item;\n      const conversationId = this.correspondentResponse[phoneNumber];\n      this._deps.conversationLogger.logConversation({\n        entity: item,\n        conversationId,\n      });\n      this.removeEntity(item);\n      this.removeResponse(phoneNumber);\n    });\n  }\n}\n"],"file":"Conversations.js"}