{"version":3,"sources":["modules/ActiveCallControl/index.js"],"names":["DEFAULT_TTL","DEFAULT_TIME_TO_RETRY","DEFAULT_BUSY_TIMEOUT","telephonySessionsEndPoint","storageKey","subscribeEvent","subscriptionFilters","telephonySessions","ActiveCallControl","deps","dep","optional","client","auth","ttl","timeToRetry","storage","subscription","connectivityMonitor","availabilityMonitor","tabManager","presence","polling","disableCache","alert","numberValidate","accountInfo","extensionInfo","options","actionTypes","_updateSessionsHandler","store","dispatch","type","updateActiveSessions","timestamp","Date","now","sessionData","_rcCallControl","sessions","map","s","data","_client","_storage","_subscription","ensureExist","call","_connectivityMonitor","_availabilityMonitor","_presence","_tabManager","_ttl","_timeToRetry","_auth","_promise","_lastSubscriptionMessage","_storageKey","_polling","_alert","_numberValidate","_accountInfo","_extensionInfo","_reducer","registerReducer","key","reducer","console","warn","subscribe","_onStateChange","_shouldInit","init","_connectivity","connectivity","_init","initSuccess","_shouldReset","_resetModuleStatus","ready","_hasPermission","_subscriptionHandler","_checkConnectivity","_checkTabActive","loggedIn","pending","resetSuccess","active","_fetchData","_syncData","_startPolling","_retry","t","_clearTimeout","_timeoutId","setTimeout","fetchData","activeCalls","calls","loadSessions","forEach","session","_newSessionHandler","log","RingCentralCallControl","sdk","service","preloadDevices","preloadSessions","info","account","on","_tabActive","_shouldFetch","removeListener","message","test","event","body","onNotificationEvent","removeActiveSession","telephonySessionId","setActiveSessionId","restoreSessions","activeSessions","mute","find","id","muteSuccess","response","_text","clone","text","warning","callControlError","muteConflictError","checkIfHAError","generalError","muteError","unmute","unmuteSuccess","unMuteConflictError","unmuteError","recordingId","getRecordingId","resumeRecord","createRecord","recording","recordings","recodingId","pauseRecord","activeSession","getActiveSession","stopRecord","hangUp","drop","_onCallEndFunc","hangUpSuccess","hangUpError","reject","toVoicemail","rejectSuccess","rejectError","hold","holdSuccess","holdConflictError","holdError","unhold","unholdSuccess","unHoldConflictError","transferNumber","transfer","validateNumbers","validatedResult","result","Promise","all","errors","error","callErrors","payload","phoneNumber","transferError","validPhoneNumber","numbers","e164","indexOf","mainCompanyNumber","join","transferSuccess","flipValue","flip","callFlipId","flipSuccess","flipError","token","scope","getItem","state","activeSessionId","busy","status","moduleStatuses","Pollable","selector","sessionId","_t","accumulator","reduce"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,WAAW,GAAG,KAAK,EAAL,GAAU,IAA9B;AACA,IAAMC,qBAAqB,GAAG,KAAK,IAAnC;AACA,IAAMC,oBAAoB,GAAG,IAAI,IAAjC;AACA,IAAMC,yBAAyB,GAAG,wBAAlC;AACA,IAAMC,UAAU,GAAG,mBAAnB;AACA,IAAMC,cAAc,GAAGC,gCAAoBC,iBAA3C;IAmBqBC,iB,WAjBpB,gBAAO;AACNC,EAAAA,IAAI,EAAE,CACJ,QADI,EAEJ,MAFI,EAGJ,cAHI,EAIJ,qBAJI,EAKJ,UALI,EAMJ,OANI,EAOJ,gBAPI,EAQJ,aARI,EASJ,eATI,EAUJ;AAAEC,IAAAA,GAAG,EAAE,YAAP;AAAqBC,IAAAA,QAAQ,EAAE;AAA/B,GAVI,EAWJ;AAAED,IAAAA,GAAG,EAAE,SAAP;AAAkBC,IAAAA,QAAQ,EAAE;AAA5B,GAXI,EAYJ;AAAED,IAAAA,GAAG,EAAE,0BAAP;AAAmCC,IAAAA,QAAQ,EAAE;AAA7C,GAZI,EAaJ;AAAED,IAAAA,GAAG,EAAE,qBAAP;AAA8BC,IAAAA,QAAQ,EAAE;AAAxC,GAbI;AADA,CAAP,C;;;;;AAkBC,mCAkBG;AAAA;;AAAA,QAjBDC,MAiBC,QAjBDA,MAiBC;AAAA,QAhBDC,IAgBC,QAhBDA,IAgBC;AAAA,wBAfDC,GAeC;AAAA,QAfDA,GAeC,yBAfKd,WAeL;AAAA,gCAdDe,WAcC;AAAA,QAdDA,WAcC,iCAdad,qBAcb;AAAA,QAbDe,OAaC,QAbDA,OAaC;AAAA,QAZDC,YAYC,QAZDA,YAYC;AAAA,QAXDC,mBAWC,QAXDA,mBAWC;AAAA,QAVDC,mBAUC,QAVDA,mBAUC;AAAA,QATDC,UASC,QATDA,UASC;AAAA,QARDC,QAQC,QARDA,QAQC;AAAA,4BAPDC,OAOC;AAAA,QAPDA,OAOC,6BAPS,KAOT;AAAA,iCANDC,YAMC;AAAA,QANDA,YAMC,kCANc,KAMd;AAAA,QALDC,KAKC,QALDA,KAKC;AAAA,QAJDC,cAIC,QAJDA,cAIC;AAAA,QAHDC,WAGC,QAHDA,WAGC;AAAA,QAFDC,aAEC,QAFDA,aAEC;AAAA,QADEC,OACF;;AAAA;;AACD,8DACKA,OADL;AAEEC,MAAAA,WAAW,EAAXA;AAFF;;AADC,UAgNHC,sBAhNG,GAgNsB,YAAM;AAC7B,YAAKC,KAAL,CAAWC,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,MAAKJ,WAAL,CAAiBK,oBADL;AAElBC,QAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EAFO;AAGlBC,QAAAA,WAAW,EAAE,MAAKC,cAAL,CAAoBC,QAApB,CAA6BC,GAA7B,CAAiC,UAACC,CAAD;AAAA,iBAAOA,CAAC,CAACC,IAAT;AAAA,SAAjC;AAHK,OAApB;AAKD,KAtNE;;AAAA;;AAAA;;AAAA;;AAKD,UAAKC,OAAL,GAAehC,MAAf;;AACA,QAAI,CAACW,YAAL,EAAmB;AACjB,YAAKsB,QAAL,GAAgB7B,OAAhB;AACD;;AACD,UAAK8B,aAAL,GAAqBC,wBAAYC,IAAZ,gCAAuB/B,YAAvB,EAAqC,cAArC,CAArB;AACA,UAAKgC,oBAAL,GAA4BF,wBAAYC,IAAZ,gCAE1B9B,mBAF0B,EAG1B,qBAH0B,CAA5B;AAKA,UAAKgC,oBAAL,GAA4B/B,mBAA5B;AACA,UAAKgC,SAAL,GAAiBJ,wBAAYC,IAAZ,gCAAuB3B,QAAvB,EAAiC,UAAjC,CAAjB;AACA,UAAK+B,WAAL,GAAmBhC,UAAnB;AACA,UAAKiC,IAAL,GAAYvC,GAAZ;AACA,UAAKwC,YAAL,GAAoBvC,WAApB;AACA,UAAKwC,KAAL,GAAaR,wBAAYC,IAAZ,gCAAuBnC,IAAvB,EAA6B,MAA7B,CAAb;AACA,UAAK2C,QAAL,GAAgB,IAAhB;AACA,UAAKC,wBAAL,GAAgC,IAAhC;AACA,UAAKC,WAAL,GAAmBtD,UAAnB;AACA,UAAKuD,QAAL,GAAgBrC,OAAhB;AACA,UAAKsC,MAAL,GAAcpC,KAAd;AACA,UAAKqC,eAAL,GAAuBpC,cAAvB;AACA,UAAKqC,YAAL,GAAoBpC,WAApB;AACA,UAAKqC,cAAL,GAAsBpC,aAAtB;AACA,UAAKY,cAAL,GAAsB,IAAtB;;AAEA,QAAI,MAAKM,QAAT,EAAmB;AACjB,YAAKmB,QAAL,GAAgB,6CAA4B,MAAKnC,WAAjC,CAAhB;;AACA,YAAKgB,QAAL,CAAcoB,eAAd,CAA8B;AAC5BC,QAAAA,GAAG,EAAE,MAAKR,WADkB;AAE5BS,QAAAA,OAAO,EAAE,gCAAe,MAAKtC,WAApB;AAFmB,OAA9B;AAID,KAND,MAMO;AACL,YAAKmC,QAAL,GAAgB,6CAA4B,MAAKnC,WAAjC,EAA8C;AAC5Dc,QAAAA,IAAI,EAAE,gCAAe,MAAKd,WAApB;AADsD,OAA9C,CAAhB;AAGD;;AACDuC,IAAAA,OAAO,CAACC,IAAR,CACE,4FADF;AA1CC;AA6CF;;;;iCAEY;AAAA;;AACX,WAAKtC,KAAL,CAAWuC,SAAX,CAAqB;AAAA,eAAM,MAAI,CAACC,cAAL,EAAN;AAAA,OAArB;AACD;;;;;;;;;qBAGK,KAAKC,WAAL,E;;;;;AACF,qBAAKzC,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB4C;AADL,iBAApB;AAGA,qBAAKC,aAAL,GAAqB,KAAKzB,oBAAL,CAA0B0B,YAA/C;;uBACM,KAAKC,KAAL,E;;;AACN,qBAAK7C,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBgD;AADL,iBAApB;;;;;AAGK,oBAAI,KAAKC,YAAL,EAAJ,EAAyB;AAC9B,uBAAKC,kBAAL;AACD,iBAFM,MAEA,IAAI,KAAKC,KAAL,IAAc,KAAKC,cAAvB,EAAuC;AAC5C,uBAAKC,oBAAL;;AACA,uBAAKC,kBAAL;;AACA,uBAAKC,eAAL;AACD;;;;;;;;;;;;;;;;;;kCAGW;AACZ,aACE,KAAK7B,KAAL,CAAW8B,QAAX,IACA,KAAKvB,YAAL,CAAkBkB,KADlB,IAEA,KAAKjB,cAAL,CAAoBiB,KAFpB,KAGC,CAAC,KAAKnC,QAAN,IAAkB,KAAKA,QAAL,CAAcmC,KAHjC,KAIA,KAAKlC,aAAL,CAAmBkC,KAJnB,IAKA,KAAK/B,oBAAL,CAA0B+B,KAL1B,IAMA,KAAK7B,SAAL,CAAe6B,KANf,KAOC,CAAC,KAAK5B,WAAN,IAAqB,KAAKA,WAAL,CAAiB4B,KAPvC,MAQC,CAAC,KAAK9B,oBAAN,IAA8B,KAAKA,oBAAL,CAA0B8B,KARzD,KASA,KAAKM,OAVP;AAYD;;;mCAEc;AACb,aACE,CAAC,CAAC,KAAK/B,KAAL,CAAW8B,QAAZ,IACC,CAAC,KAAKvB,YAAL,CAAkBkB,KADpB,IAEC,CAAC,KAAKjB,cAAL,CAAoBiB,KAFtB,IAGE,CAAC,CAAC,KAAKnC,QAAP,IAAmB,CAAC,KAAKA,QAAL,CAAcmC,KAHpC,IAIC,CAAC,KAAKlC,aAAL,CAAmBkC,KAJrB,IAKE,CAAC,CAAC,KAAK5B,WAAP,IAAsB,CAAC,KAAKA,WAAL,CAAiB4B,KAL1C,IAMC,CAAC,KAAK/B,oBAAL,CAA0B+B,KAN5B,IAOC,CAAC,KAAK7B,SAAL,CAAe6B,KAPjB,IAQE,CAAC,CAAC,KAAK9B,oBAAP,IAA+B,CAAC,KAAKA,oBAAL,CAA0B8B,KAR7D,KASA,KAAKA,KAVP;AAYD;;;yCAEoB;AACnB,WAAKjD,KAAL,CAAWC,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB0D;AADL,OAApB;AAGD,K,CAED;;;;mCAQe;AACb,aAAO,CAAC,KAAKnC,WAAN,IAAqB,KAAKA,WAAL,CAAiBoC,MAA7C;AACD;;;;;;;;;AAGC,oBAAI,CAAC,KAAKhC,QAAV,EAAoB;AAClB,uBAAKA,QAAL,GAAgB,KAAKiC,UAAL,EAAhB;AACD;;;uBACK,KAAKjC,Q;;;;;;;;;;;;;;;;;;;;;;;;;;uBAKH,KAAKkC,SAAL,E;;;AACN,oBAAI,KAAK/B,QAAT,EAAmB;AACjB,uBAAKgC,aAAL;AACD;;AACD,qBAAKnC,QAAL,GAAgB,IAAhB;;;;;;;AAEA,qBAAKA,QAAL,GAAgB,IAAhB;;AACA,oBAAI,KAAKG,QAAT,EAAmB;AACjB,uBAAKgC,aAAL,CAAmB,KAAK5E,WAAxB;AACD,iBAFD,MAEO;AACL,uBAAK6E,MAAL;AACD;;;;;;;;;;;;;;;;;;;;oCAK0D;AAAA;;AAAA,UAAjDC,CAAiD,uEAA7C,KAAK1D,SAAL,GAAiB,KAAKrB,GAAtB,GAA4B,EAA5B,GAAiCsB,IAAI,CAACC,GAAL,EAAY;;AAC7D,WAAKyD,aAAL;;AACA,WAAKC,UAAL,GAAkBC,UAAU,CAAC,YAAM;AACjC,QAAA,MAAI,CAACD,UAAL,GAAkB,IAAlB;;AACA,YAAI,CAAC,MAAI,CAAC3C,WAAN,IAAqB,MAAI,CAACA,WAAL,CAAiBoC,MAA1C,EAAkD;AAChD,cAAI,CAAC,MAAI,CAACrD,SAAN,IAAmBC,IAAI,CAACC,GAAL,KAAa,MAAI,CAACF,SAAlB,GAA8B,MAAI,CAACrB,GAA1D,EAA+D;AAC7D,YAAA,MAAI,CAACmF,SAAL;AACD,WAFD,MAEO;AACL,YAAA,MAAI,CAACN,aAAL;AACD;AACF,SAND,MAMO,IAAI,MAAI,CAACxD,SAAL,IAAkBC,IAAI,CAACC,GAAL,KAAa,MAAI,CAACF,SAAlB,GAA8B,MAAI,CAACrB,GAAzD,EAA8D;AACnE,UAAA,MAAI,CAAC6E,aAAL;AACD,SAFM,MAEA;AACL,UAAA,MAAI,CAACA,aAAL,CAAmB,MAAI,CAAC5E,WAAxB;AACD;AACF,OAb2B,EAazB8E,CAbyB,CAA5B;AAcD;;;;;;;;;;;;;AAISK,gBAAAA,W,GAAc,KAAK/C,SAAL,CAAegD,K;;uBAC7B,KAAK5D,cAAL,CAAoB6D,YAApB,CAAiCF,WAAjC,C;;;AACN,qBAAKnE,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBK,oBADL;AAElBC,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EAFO;AAGlBC,kBAAAA,WAAW,EAAE,KAAKC,cAAL,CAAoBC,QAApB,CAA6BC,GAA7B,CAAiC,UAACC,CAAD;AAAA,2BAAOA,CAAC,CAACC,IAAT;AAAA,mBAAjC;AAHK,iBAApB;;AAKA,qBAAKJ,cAAL,CAAoBC,QAApB,CAA6B6D,OAA7B,CAAqC,UAACC,OAAD,EAAa;AAChD,kBAAA,MAAI,CAACC,kBAAL,CAAwBD,OAAxB;AACD,iBAFD;;;;;;;;AAIAlC,gBAAAA,OAAO,CAACoC,GAAR,CAAY,kBAAZ;;;;;;;;;;;;;;;;;;;;;;;;;;;oBAMG,KAAKvB,c;;;;;;;;AACV,qBAAKnC,aAAL,CAAmBwB,SAAnB,CAA6B,CAACjE,cAAD,CAA7B;;AACA,qBAAKkC,cAAL,GAAsB,IAAIkE,8CAAJ,CAA2B;AAC/CC,kBAAAA,GAAG,EAAE,KAAK9D,OAAL,CAAa+D,OAD6B;AAE/CC,kBAAAA,cAAc,EAAE,KAF+B;AAG/CC,kBAAAA,eAAe,EAAE,KAH8B;AAI/ClF,kBAAAA,aAAa,kCACR,KAAKoC,cAAL,CAAoB+C,IADZ;AAEXC,oBAAAA,OAAO,EAAE,KAAKjD,YAAL,CAAkBgD;AAFhB;AAJkC,iBAA3B,CAAtB;;AASA,qBAAKvE,cAAL,CAAoByE,EAApB,CAAuB,KAAvB,EAA8B,UAACV,OAAD,EAAa;AACzC,kBAAA,MAAI,CAACC,kBAAL,CAAwBD,OAAxB;AACD,iBAFD;;AAGA,qBAAKW,UAAL,GAAkB,KAAK7D,WAAL,CAAiBoC,MAAnC;;qBACI,KAAK0B,YAAL,E;;;;;;;uBAEM,KAAKjB,SAAL,E;;;;;;;;;;AAEN,qBAAKL,MAAL;;;;;;;AAEG,oBAAI,KAAKjC,QAAT,EAAmB;AACxB,uBAAKgC,aAAL;AACD,iBAFM,MAEA;AACL,uBAAKC,MAAL;AACD;;;;;;;;;;;;;;;;;;uCAWgBU,O,EAAS;AAC1B,WAAKxE,sBAAL;;AACAwE,MAAAA,OAAO,CAACa,cAAR,CAAuB,QAAvB,EAAiC,KAAKrF,sBAAtC;AACAwE,MAAAA,OAAO,CAACa,cAAR,CAAuB,OAAvB,EAAgC,KAAKrF,sBAArC;AACAwE,MAAAA,OAAO,CAACa,cAAR,CAAuB,YAAvB,EAAqC,KAAKrF,sBAA1C;AACAwE,MAAAA,OAAO,CAACU,EAAR,CAAW,QAAX,EAAqB,KAAKlF,sBAA1B;AACAwE,MAAAA,OAAO,CAACU,EAAR,CAAW,OAAX,EAAoB,KAAKlF,sBAAzB;AACAwE,MAAAA,OAAO,CAACU,EAAR,CAAW,YAAX,EAAyB,KAAKlF,sBAA9B;AACD;;;2CAEsB;AACrB,UACE,CAAC,KAAKkD,KAAN,IACC,KAAKnC,QAAL,IAAiB,KAAKO,WAAtB,IAAqC,CAAC,KAAKA,WAAL,CAAiBoC,MAF1D,EAGE;AACA;AACD;;AANoB,UAOb4B,OAPa,GAOD,KAAKtE,aAPJ,CAObsE,OAPa;;AAQrB,UACEA,OAAO,IACPA,OAAO,KAAK,KAAK3D,wBADjB,IAEAtD,yBAAyB,CAACkH,IAA1B,CAA+BD,OAAO,CAACE,KAAvC,CAFA,IAGAF,OAAO,CAACG,IAJV,EAKE;AACA,aAAK9D,wBAAL,GAAgC2D,OAAhC;;AACA,YAAI,KAAK7E,cAAT,EAAyB;AACvB,eAAKA,cAAL,CAAoBiF,mBAApB,CAAwCJ,OAAxC;AACD;AACF;AACF;;;0CAEqB;AACpB,WAAKrF,KAAL,CAAWC,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB4F;AADL,OAApB;AAGD,K,CAED;;;;uCACmBC,kB,EAAoB;AACrC,WAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB8F,kBADL;AAElBD,QAAAA,kBAAkB,EAAlBA;AAFkB,OAApB;AAID;;;yCAEoB;AACnB,UACE,KAAKzE,oBAAL,IACA,KAAKA,oBAAL,CAA0B+B,KAD1B,IAEA,KAAKN,aAAL,KAAuB,KAAKzB,oBAAL,CAA0B0B,YAHnD,EAIE;AACA,aAAKD,aAAL,GAAqB,KAAKzB,oBAAL,CAA0B0B,YAA/C;;AACA,YAAI,KAAKD,aAAT,EAAwB;AACtB,eAAKuB,SAAL;AACD;AACF;AACF;;;sCAEiB;AAAA;;AAChB,UAAI,CAAC,KAAK7C,WAAN,IAAqB,CAAC,KAAKP,QAA/B,EAAyC;AACvC;AACD;;AACD,UAAI,KAAKoE,UAAL,KAAoB,KAAK7D,WAAL,CAAiBoC,MAAzC,EAAiD;AAC/C,aAAKyB,UAAL,GAAkB,KAAK7D,WAAL,CAAiBoC,MAAnC;;AACA,YAAI,KAAKpC,WAAL,CAAiBoC,MAAjB,IAA2B,KAAKjD,cAApC,EAAoD;AAClD,eAAKA,cAAL,CAAoBqF,eAApB,CAAoC,KAAKjF,IAAL,CAAUH,QAA9C;;AACA,eAAKD,cAAL,CAAoBC,QAApB,CAA6B6D,OAA7B,CAAqC,UAACC,OAAD,EAAa;AAChD,YAAA,MAAI,CAACC,kBAAL,CAAwBD,OAAxB;AACD,WAFD;AAGD;AACF;AACF;;;qCAEgBoB,kB,EAAoB;AACnC,aAAO,KAAKG,cAAL,CAAoBH,kBAApB,CAAP;AACD;;;;4FAEUA,kB;;;;;;AACT,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBiG,IADL;AAElB3F,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL;AAFO,iBAApB;;AAKQiE,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;;uBAGVpB,OAAO,CAACwB,IAAR,E;;;AACN,qBAAK/F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBoG;AADL,iBAApB;;;;;;;;sBAII,aAAMC,QAAN,IAAkB,CAAC,aAAMA,QAAN,CAAeC,K;;;;;;uBACP,aAAMD,QAAN,CAAeE,KAAf,GAAuBC,IAAvB,E;;;AAA7B,6BAAMH,QAAN,CAAeC,K;;;qBAEb,yC;;;;;AACF,qBAAKvE,MAAL,CAAY0E,OAAZ,CAAoB;AAClBlB,kBAAAA,OAAO,EAAEmB,6BAAiBC;AADR,iBAApB;;;;;;+BAIA,CAAC,KAAKtF,oB;;;;;;;;uBACE,KAAKA,oBAAL,CAA0BuF,cAA1B,c;;;;;;;;;;;AAER,qBAAK7E,MAAL,CAAY0E,OAAZ,CAAoB;AAAElB,kBAAAA,OAAO,EAAEmB,6BAAiBG;AAA5B,iBAApB;;;AAEF,qBAAK3G,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB8G;AADL,iBAApB;;;;;;;;;;;;;;;;;;;8FAMSjB,kB;;;;;;AACX,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB+G,MADL;AAElBzG,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL;AAFO,iBAApB;;AAKQiE,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;;uBAGVpB,OAAO,CAACsC,MAAR,E;;;AACN,qBAAK7G,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBgH;AADL,iBAApB;;;;;;;;sBAII,aAAMX,QAAN,IAAkB,CAAC,aAAMA,QAAN,CAAeC,K;;;;;;uBACP,aAAMD,QAAN,CAAeE,KAAf,GAAuBC,IAAvB,E;;;AAA7B,6BAAMH,QAAN,CAAeC,K;;;qBAEb,yC;;;;;AACF,qBAAKvE,MAAL,CAAY0E,OAAZ,CAAoB;AAClBlB,kBAAAA,OAAO,EAAEmB,6BAAiBO;AADR,iBAApB;;;;;;+BAIA,CAAC,KAAK5F,oB;;;;;;;;uBACE,KAAKA,oBAAL,CAA0BuF,cAA1B,c;;;;;;;;;;;AAER,qBAAK7E,MAAL,CAAY0E,OAAZ,CAAoB;AAAElB,kBAAAA,OAAO,EAAEmB,6BAAiBG;AAA5B,iBAApB;;;AAEF,qBAAK3G,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBkH;AADL,iBAApB;;;;;;;;;;;;;;;;;;;mGAMcrB,kB;;;;;;;AAERpB,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;AAGVsB,gBAAAA,W,GAAc,KAAKC,cAAL,CAAoB3C,OAApB,C;;qBAChB0C,W;;;;;;uBACI1C,OAAO,CAAC4C,YAAR,CAAqBF,WAArB,C;;;;;;;;uBAEA1C,OAAO,CAAC6C,YAAR,CAAqBH,WAArB,C;;;;;;;;;;;;;;;;;;;;;;;;;;mCAUG1C,O,EAAS;AACtB,UAAM8C,SAAS,GAAG9C,OAAO,CAAC+C,UAAR,CAAmB,CAAnB,CAAlB;AACA,UAAMC,UAAU,GAAGF,SAAS,IAAIA,SAAS,CAACpB,EAA1C;AACA,aAAOsB,UAAP;AACD;;;;kGAEgB5B,kB;;;;;;;AAEPpB,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;AAGVsB,gBAAAA,W,GAAc,KAAKC,cAAL,CAAoB3C,OAApB,C;;uBACdA,OAAO,CAACiD,WAAR,CAAoBP,WAApB,C;;;AACAQ,gBAAAA,a,GAAgB,KAAKC,gBAAL,CAAsB/B,kBAAtB,C;AACtB,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB6H,UADL;AAElBF,kBAAAA,aAAa,EAAbA;AAFkB,iBAApB;;;;;;;AAKApF,gBAAAA,OAAO,CAACoC,GAAR,CAAY,oBAAZ;;;;;;;;;;;;;;;;;;;;+FAKSkB,kB;;;;;;AACX,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB8H,MADL;AAElBxH,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL;AAFO,iBAApB;;AAKQiE,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;;uBAGVpB,OAAO,CAACsD,IAAR,E;;;AACN,oBAAI,OAAO,KAAKC,cAAZ,KAA+B,UAAnC,EAA+C;AAC7C,uBAAKA,cAAL;AACD;;AACD,qBAAK9H,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBiI;AADL,iBAApB;;;;;;;gCAKE,CAAC,KAAK5G,oB;;;;;;;;uBACE,KAAKA,oBAAL,CAA0BuF,cAA1B,e;;;;;;;;;;;AAER,qBAAK7E,MAAL,CAAY0E,OAAZ,CAAoB;AAAElB,kBAAAA,OAAO,EAAEmB,6BAAiBG;AAA5B,iBAApB;;;AAGF,qBAAK3G,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBkI;AADL,iBAApB;;;;;;;;;;;;;;;;;;;+FAMSrC,kB;;;;;;AACX,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBmI,MADL;AAElB7H,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL;AAFO,iBAApB;;AAKQiE,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;;uBAGVpB,OAAO,CAAC2D,WAAR,E;;;AACN,qBAAKlI,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBqI;AADL,iBAApB;;;;;;;gCAKE,CAAC,KAAKhH,oB;;;;;;;;uBACE,KAAKA,oBAAL,CAA0BuF,cAA1B,e;;;;;;;;;;;AAER,qBAAK7E,MAAL,CAAY0E,OAAZ,CAAoB;AAAElB,kBAAAA,OAAO,EAAEmB,6BAAiBG;AAA5B,iBAApB;;;AAEF,qBAAK3G,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBsI;AADL,iBAApB;;;;;;;;;;;;;;;;;;;6FAMOzC,kB;;;;;;AACT,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBuI,IADL;AAElBjI,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL;AAFO,iBAApB;;AAKQiE,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;;uBAGVpB,OAAO,CAAC8D,IAAR,E;;;AACN,qBAAKrI,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBwI;AADL,iBAApB;;;;;;;;sBAII,cAAMnC,QAAN,IAAkB,CAAC,cAAMA,QAAN,CAAeC,K;;;;;;uBACP,cAAMD,QAAN,CAAeE,KAAf,GAAuBC,IAAvB,E;;;AAA7B,8BAAMH,QAAN,CAAeC,K;;;qBAEb,0C;;;;;AACF,qBAAKvE,MAAL,CAAY0E,OAAZ,CAAoB;AAClBlB,kBAAAA,OAAO,EAAEmB,6BAAiB+B;AADR,iBAApB;;;;;;gCAIA,CAAC,KAAKpH,oB;;;;;;;;uBACE,KAAKA,oBAAL,CAA0BuF,cAA1B,e;;;;;;;;;;;AAER,qBAAK7E,MAAL,CAAY0E,OAAZ,CAAoB;AAAElB,kBAAAA,OAAO,EAAEmB,6BAAiBG;AAA5B,iBAApB;;;AAGF,qBAAK3G,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB0I;AADL,iBAApB;;;;;;;;;;;;;;;;;;;+FAMS7C,kB;;;;;;AACX,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB2I,MADL;AAElBrI,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL;AAFO,iBAApB;;AAKQiE,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;;uBAGVpB,OAAO,CAACkE,MAAR,E;;;AACN,qBAAKzI,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB4I;AADL,iBAApB;;;;;;;;sBAII,cAAMvC,QAAN,IAAkB,CAAC,cAAMA,QAAN,CAAeC,K;;;;;;uBACP,cAAMD,QAAN,CAAeE,KAAf,GAAuBC,IAAvB,E;;;AAA7B,8BAAMH,QAAN,CAAeC,K;;;qBAEb,0C;;;;;AACF,qBAAKvE,MAAL,CAAY0E,OAAZ,CAAoB;AAClBlB,kBAAAA,OAAO,EAAEmB,6BAAiBmC;AADR,iBAApB;;;;;;gCAIA,CAAC,KAAKxH,oB;;;;;;;;uBACE,KAAKA,oBAAL,CAA0BuF,cAA1B,e;;;;;;;;;;;AAER,qBAAK7E,MAAL,CAAY0E,OAAZ,CAAoB;AAClBlB,kBAAAA,OAAO,EAAEmB,6BAAiBG;AADR,iBAApB;;;AAIF,qBAAK3G,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB0I;AADL,iBAApB;;;;;;;;;;;;;;;;;;;iGAMWI,c,EAAgBjD,kB;;;;;;;;AAC7B,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB+I,QADL;AAElBzI,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL;AAFO,iBAApB;;AAKQiE,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;;uBAGc,KAAK7D,eAAL,CAAqBgH,eAArB,CAAqC,CACjEF,cADiE,CAArC,C;;;AAAxBG,gBAAAA,e;;oBAGDA,eAAe,CAACC,M;;;;;;uBACbC,OAAO,CAACC,GAAR,CACJH,eAAe,CAACI,MAAhB,CAAuBzI,GAAvB;AAAA,sFAA2B,mBAAO0I,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA,4CAEvB,CAAC,MAAI,CAACjI,oBAFiB;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,mCAGf,MAAI,CAACA,oBAAL,CAA0BuF,cAA1B,CAAyC0C,KAAzC,CAHe;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKvB,4BAAA,MAAI,CAACvH,MAAL,CAAY0E,OAAZ,CAAoB;AAClBlB,8BAAAA,OAAO,EAAEgE,uBAAWD,KAAK,CAAClJ,IAAjB,CADS;AAElBoJ,8BAAAA,OAAO,EAAE;AACPC,gCAAAA,WAAW,EAAEH,KAAK,CAACG;AADZ;AAFS,6BAApB;;AALuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA3B;;AAAA;AAAA;AAAA;AAAA,oBADI,C;;;AAeN,qBAAKvJ,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB0J;AADL,iBAApB;;;;AAKIC,gBAAAA,gB,GACJV,eAAe,CAACW,OAAhB,CAAwB,CAAxB,KAA8BX,eAAe,CAACW,OAAhB,CAAwB,CAAxB,EAA2BC,I;AACvDJ,gBAAAA,W,GAAcE,gB;;AAClB,oBAAIA,gBAAgB,CAACG,OAAjB,CAAyB,GAAzB,MAAkC,CAAC,CAAvC,EAA0C;AACxCL,kBAAAA,WAAW,GAAG,CACZ,KAAKxH,YAAL,CAAkB8H,iBADN,EAEZJ,gBAFY,EAGZK,IAHY,CAGP,GAHO,CAAd;AAID;;AACDvF,gBAAAA,OAAO,CAACsE,QAAR,CAAiB;AAAEU,kBAAAA,WAAW,EAAXA;AAAF,iBAAjB;AACA,qBAAKvJ,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBiK;AADL,iBAApB;;;;;;;gCAKE,CAAC,KAAK5I,oB;;;;;;;;uBACE,KAAKA,oBAAL,CAA0BuF,cAA1B,e;;;;;;;;;;;AAER,qBAAK7E,MAAL,CAAY0E,OAAZ,CAAoB;AAAElB,kBAAAA,OAAO,EAAEmB,6BAAiBG;AAA5B,iBAApB;;;AAEF,qBAAK3G,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiB0J;AADL,iBAApB;;;;;;;;;;;;;;;QAMJ;;;;;6FACWQ,S,EAAWrE,kB;;;;;;AACpB,qBAAK3F,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBmK,IADL;AAElB7J,kBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL;AAFO,iBAApB;;AAKQiE,gBAAAA,O,GAAU,KAAK/D,cAAL,CAAoBC,QAApB,CAA6BuF,IAA7B,CACd,UAACrF,CAAD;AAAA,yBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,iBADc,C;;uBAGVpB,OAAO,CAAC0F,IAAR,CAAa;AAAEC,kBAAAA,UAAU,EAAEF;AAAd,iBAAb,C;;;AACN,qBAAKhK,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBqK;AADL,iBAApB;;;;;;;AAIA,qBAAKnK,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKJ,WAAL,CAAiBsK;AADL,iBAApB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;wBA9egB;AAAA;;AAClB,aACE,+BAAK5I,KAAL,CAAW6I,KAAX,CAAiBC,KAAjB,gFAAwBV,OAAxB,CAAgC,aAAhC,KAAiD,CAAC,CAAlD,IACA,gCAAKpI,KAAL,CAAW6I,KAAX,CAAiBC,KAAjB,kFAAwBV,OAAxB,CAAgC,kBAAhC,KAAsD,CAAC,CAFzD;AAID;;;wBAqfU;AACT,aACG,KAAK9I,QAAL,IACC,KAAKA,QAAL,CAAcmC,KADf,IAEC,KAAKnC,QAAL,CAAcyJ,OAAd,CAAsB,KAAK5I,WAA3B,CAFF,IAGA,KAAK6I,KAJP;AAMD;;;wBAEqB;AACpB,aAAO,KAAK5J,IAAL,CAAU6J,eAAV,IAA6B,IAApC;AACD;AAED;AACF;AACA;AACA;AACA;;;;wBACa;AACT,aAAOpK,IAAI,CAACC,GAAL,KAAa,KAAKM,IAAL,CAAU8J,IAAvB,GAA8BvM,oBAArC;AACD;;;wBAEe;AACd,aAAO,KAAKyC,IAAL,CAAUR,SAAjB;AACD;;;wBAEiB;AAChB,aAAO,KAAKmB,YAAZ;AACD;;;wBAES;AACR,aAAO,KAAKD,IAAZ;AACD;;;wBAEY;AACX,aAAO,KAAKkJ,KAAL,CAAWG,MAAlB;AACD;;;wBAEW;AACV,aAAO,KAAKA,MAAL,KAAgBC,2BAAe3H,KAAtC;AACD;;;;EAhqB4C4H,qB,iFAkqB5CC,kB;;;;;;;WACe,CACd;AAAA,aAAM,MAAI,CAACL,eAAX;AAAA,KADc,EAEd;AAAA,aAAM,MAAI,CAAC3E,cAAX;AAAA,KAFc,EAGd,UAACiF,SAAD;AAAA,aAAe,MAAI,CAACrD,gBAAL,CAAsBqD,SAAtB,CAAf;AAAA,KAHc,C;;mFAMfD,kB;;;;;;;WACgB,CACf;AAAA,aAAM,MAAI,CAAC1J,SAAL,CAAegD,KAArB;AAAA,KADe,EAEf;AAAA,aAAM,MAAI,CAACxD,IAAL,CAAUH,QAAhB;AAAA,KAFe,EAGf;AAAA,aAAM,MAAI,CAACL,SAAX;AAAA,KAHe,EAIf,UAACgE,KAAD,EAAQ3D,QAAR,EAAkBuK,EAAlB,EAAyB;AACvB,UAAM5I,OAAO,GAAG,SAAVA,OAAU,CAAC6I,WAAD,EAAchK,IAAd,EAAuB;AAAA,YAC7B0E,kBAD6B,GACN1E,IADM,CAC7B0E,kBAD6B;AAErC,YAAMpB,OAAO,GAAG9D,QAAQ,CAACuF,IAAT,CAAc,UAACrF,CAAD;AAAA,iBAAOA,CAAC,CAACsF,EAAF,KAASN,kBAAhB;AAAA,SAAd,CAAhB;;AACA,YAAI,CAACpB,OAAL,EAAc;AACZ,iBAAO0G,WAAP;AACD;;AACDA,QAAAA,WAAW,CAACtF,kBAAD,CAAX,GAAkC,+BAAiB;AACjD1E,UAAAA,IAAI,EAAJA,IADiD;AAEjDsD,UAAAA,OAAO,EAAPA;AAFiD,SAAjB,CAAlC;AAIA,eAAO0G,WAAP;AACD,OAXD;;AAYA,aAAO7G,KAAK,CAAC8G,MAAN,CAAa9I,OAAb,EAAsB,EAAtB,CAAP;AACD,KAlBc,C;;yGAqBhB0I,kB;;;;;;;WACsC,CACrC;AAAA,aAAM,OAAI,CAAC1J,SAAL,CAAegD,KAArB;AAAA,KADqC,EAErC,UAACA,KAAD,EAAW;AACT,UAAMhC,OAAO,GAAG,SAAVA,OAAU,CAAC6I,WAAD,EAAchK,IAAd,EAAuB;AAAA,YAC7B0E,kBAD6B,GACK1E,IADL,CAC7B0E,kBAD6B;AAAA,YACToF,SADS,GACK9J,IADL,CACT8J,SADS;AAErCE,QAAAA,WAAW,CAACF,SAAD,CAAX,GAAyBpF,kBAAzB;AACA,eAAOsF,WAAP;AACD,OAJD;;AAKA,aAAO7G,KAAK,CAAC8G,MAAN,CAAa9I,OAAb,EAAsB,EAAtB,CAAP;AACD,KAToC,C","sourcesContent":["import { RingCentralCallControl } from 'ringcentral-call-control';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport subscriptionFilters from '../../enums/subscriptionFilters';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport Pollable from '../../lib/Pollable';\nimport { selector } from '../../lib/selector';\nimport callErrors from '../Call/callErrors';\nimport { actionTypes } from './actionTypes';\nimport callControlError from './callControlError';\nimport getActiveCallControlReducer from './getActiveCallControlReducer';\nimport getDataReducer from './getDataReducer';\nimport { conflictError, normalizeSession } from './helpers';\n\nconst DEFAULT_TTL = 30 * 60 * 1000;\nconst DEFAULT_TIME_TO_RETRY = 62 * 1000;\nconst DEFAULT_BUSY_TIMEOUT = 3 * 1000;\nconst telephonySessionsEndPoint = /\\/telephony\\/sessions$/;\nconst storageKey = 'activeCallControl';\nconst subscribeEvent = subscriptionFilters.telephonySessions;\n\n@Module({\n  deps: [\n    'Client',\n    'Auth',\n    'Subscription',\n    'ConnectivityMonitor',\n    'Presence',\n    'Alert',\n    'NumberValidate',\n    'AccountInfo',\n    'ExtensionInfo',\n    { dep: 'TabManager', optional: true },\n    { dep: 'Storage', optional: true },\n    { dep: 'ActiveCallControlOptions', optional: true },\n    { dep: 'AvailabilityMonitor', optional: true },\n  ],\n})\nexport default class ActiveCallControl extends Pollable {\n  constructor({\n    client,\n    auth,\n    ttl = DEFAULT_TTL,\n    timeToRetry = DEFAULT_TIME_TO_RETRY,\n    storage,\n    subscription,\n    connectivityMonitor,\n    availabilityMonitor,\n    tabManager,\n    presence,\n    polling = false,\n    disableCache = false,\n    alert,\n    numberValidate,\n    accountInfo,\n    extensionInfo,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._client = client;\n    if (!disableCache) {\n      this._storage = storage;\n    }\n    this._subscription = ensureExist.call(this, subscription, 'subscription');\n    this._connectivityMonitor = ensureExist.call(\n      this,\n      connectivityMonitor,\n      'connectivityMonitor',\n    );\n    this._availabilityMonitor = availabilityMonitor;\n    this._presence = ensureExist.call(this, presence, 'presence');\n    this._tabManager = tabManager;\n    this._ttl = ttl;\n    this._timeToRetry = timeToRetry;\n    this._auth = ensureExist.call(this, auth, 'auth');\n    this._promise = null;\n    this._lastSubscriptionMessage = null;\n    this._storageKey = storageKey;\n    this._polling = polling;\n    this._alert = alert;\n    this._numberValidate = numberValidate;\n    this._accountInfo = accountInfo;\n    this._extensionInfo = extensionInfo;\n    this._rcCallControl = null;\n\n    if (this._storage) {\n      this._reducer = getActiveCallControlReducer(this.actionTypes);\n      this._storage.registerReducer({\n        key: this._storageKey,\n        reducer: getDataReducer(this.actionTypes),\n      });\n    } else {\n      this._reducer = getActiveCallControlReducer(this.actionTypes, {\n        data: getDataReducer(this.actionTypes),\n      });\n    }\n    console.warn(\n      'ActiveCallControl is deprecated, please evaluate and transition to use ActiveCallControlV2',\n    );\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      this._connectivity = this._connectivityMonitor.connectivity;\n      await this._init();\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this._resetModuleStatus();\n    } else if (this.ready && this._hasPermission) {\n      this._subscriptionHandler();\n      this._checkConnectivity();\n      this._checkTabActive();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.loggedIn &&\n      this._accountInfo.ready &&\n      this._extensionInfo.ready &&\n      (!this._storage || this._storage.ready) &&\n      this._subscription.ready &&\n      this._connectivityMonitor.ready &&\n      this._presence.ready &&\n      (!this._tabManager || this._tabManager.ready) &&\n      (!this._availabilityMonitor || this._availabilityMonitor.ready) &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (!this._auth.loggedIn ||\n        !this._accountInfo.ready ||\n        !this._extensionInfo.ready ||\n        (!!this._storage && !this._storage.ready) ||\n        !this._subscription.ready ||\n        (!!this._tabManager && !this._tabManager.ready) ||\n        !this._connectivityMonitor.ready ||\n        !this._presence.ready ||\n        (!!this._availabilityMonitor && !this._availabilityMonitor.ready)) &&\n      this.ready\n    );\n  }\n\n  _resetModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  // This should reflect on the app permissions setting in DWP\n  get hasPermission() {\n    return (\n      this._auth.token.scope?.indexOf('CallControl') > -1 ||\n      this._auth.token.scope?.indexOf('TelephonySession') > -1\n    );\n  }\n\n  _shouldFetch() {\n    return !this._tabManager || this._tabManager.active;\n  }\n\n  async fetchData() {\n    if (!this._promise) {\n      this._promise = this._fetchData();\n    }\n    await this._promise;\n  }\n\n  async _fetchData() {\n    try {\n      await this._syncData();\n      if (this._polling) {\n        this._startPolling();\n      }\n      this._promise = null;\n    } catch (error) {\n      this._promise = null;\n      if (this._polling) {\n        this._startPolling(this.timeToRetry);\n      } else {\n        this._retry();\n      }\n      throw error;\n    }\n  }\n\n  _startPolling(t = this.timestamp + this.ttl + 10 - Date.now()) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      if (!this._tabManager || this._tabManager.active) {\n        if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n          this.fetchData();\n        } else {\n          this._startPolling();\n        }\n      } else if (this.timestamp && Date.now() - this.timestamp < this.ttl) {\n        this._startPolling();\n      } else {\n        this._startPolling(this.timeToRetry);\n      }\n    }, t);\n  }\n\n  async _syncData() {\n    try {\n      const activeCalls = this._presence.calls;\n      await this._rcCallControl.loadSessions(activeCalls);\n      this.store.dispatch({\n        type: this.actionTypes.updateActiveSessions,\n        timestamp: Date.now(),\n        sessionData: this._rcCallControl.sessions.map((s) => s.data),\n      });\n      this._rcCallControl.sessions.forEach((session) => {\n        this._newSessionHandler(session);\n      });\n    } catch (error) {\n      console.log('sync data error:', error);\n      throw error;\n    }\n  }\n\n  async _init() {\n    if (!this._hasPermission) return;\n    this._subscription.subscribe([subscribeEvent]);\n    this._rcCallControl = new RingCentralCallControl({\n      sdk: this._client.service,\n      preloadDevices: false,\n      preloadSessions: false,\n      extensionInfo: {\n        ...this._extensionInfo.info,\n        account: this._accountInfo.info,\n      },\n    });\n    this._rcCallControl.on('new', (session) => {\n      this._newSessionHandler(session);\n    });\n    this._tabActive = this._tabManager.active;\n    if (this._shouldFetch()) {\n      try {\n        await this.fetchData();\n      } catch (e) {\n        this._retry();\n      }\n    } else if (this._polling) {\n      this._startPolling();\n    } else {\n      this._retry();\n    }\n  }\n\n  _updateSessionsHandler = () => {\n    this.store.dispatch({\n      type: this.actionTypes.updateActiveSessions,\n      timestamp: Date.now(),\n      sessionData: this._rcCallControl.sessions.map((s) => s.data),\n    });\n  };\n\n  _newSessionHandler(session) {\n    this._updateSessionsHandler();\n    session.removeListener('status', this._updateSessionsHandler);\n    session.removeListener('muted', this._updateSessionsHandler);\n    session.removeListener('recordings', this._updateSessionsHandler);\n    session.on('status', this._updateSessionsHandler);\n    session.on('muted', this._updateSessionsHandler);\n    session.on('recordings', this._updateSessionsHandler);\n  }\n\n  _subscriptionHandler() {\n    if (\n      !this.ready ||\n      (this._storage && this._tabManager && !this._tabManager.active)\n    ) {\n      return;\n    }\n    const { message } = this._subscription;\n    if (\n      message &&\n      message !== this._lastSubscriptionMessage &&\n      telephonySessionsEndPoint.test(message.event) &&\n      message.body\n    ) {\n      this._lastSubscriptionMessage = message;\n      if (this._rcCallControl) {\n        this._rcCallControl.onNotificationEvent(message);\n      }\n    }\n  }\n\n  removeActiveSession() {\n    this.store.dispatch({\n      type: this.actionTypes.removeActiveSession,\n    });\n  }\n\n  // count it as load (should only call on container init step)\n  setActiveSessionId(telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.setActiveSessionId,\n      telephonySessionId,\n    });\n  }\n\n  _checkConnectivity() {\n    if (\n      this._connectivityMonitor &&\n      this._connectivityMonitor.ready &&\n      this._connectivity !== this._connectivityMonitor.connectivity\n    ) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n      if (this._connectivity) {\n        this.fetchData();\n      }\n    }\n  }\n\n  _checkTabActive() {\n    if (!this._tabManager || !this._storage) {\n      return;\n    }\n    if (this._tabActive !== this._tabManager.active) {\n      this._tabActive = this._tabManager.active;\n      if (this._tabManager.active && this._rcCallControl) {\n        this._rcCallControl.restoreSessions(this.data.sessions);\n        this._rcCallControl.sessions.forEach((session) => {\n          this._newSessionHandler(session);\n        });\n      }\n    }\n  }\n\n  getActiveSession(telephonySessionId) {\n    return this.activeSessions[telephonySessionId];\n  }\n\n  async mute(telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.mute,\n      timestamp: Date.now(),\n    });\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      await session.mute();\n      this.store.dispatch({\n        type: this.actionTypes.muteSuccess,\n      });\n    } catch (error) {\n      if (error.response && !error.response._text) {\n        error.response._text = await error.response.clone().text();\n      }\n      if (conflictError(error)) {\n        this._alert.warning({\n          message: callControlError.muteConflictError,\n        });\n      } else if (\n        !this._availabilityMonitor ||\n        !(await this._availabilityMonitor.checkIfHAError(error))\n      ) {\n        this._alert.warning({ message: callControlError.generalError });\n      }\n      this.store.dispatch({\n        type: this.actionTypes.muteError,\n      });\n    }\n  }\n\n  async unmute(telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.unmute,\n      timestamp: Date.now(),\n    });\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      await session.unmute();\n      this.store.dispatch({\n        type: this.actionTypes.unmuteSuccess,\n      });\n    } catch (error) {\n      if (error.response && !error.response._text) {\n        error.response._text = await error.response.clone().text();\n      }\n      if (conflictError(error)) {\n        this._alert.warning({\n          message: callControlError.unMuteConflictError,\n        });\n      } else if (\n        !this._availabilityMonitor ||\n        !(await this._availabilityMonitor.checkIfHAError(error))\n      ) {\n        this._alert.warning({ message: callControlError.generalError });\n      }\n      this.store.dispatch({\n        type: this.actionTypes.unmuteError,\n      });\n    }\n  }\n\n  async startRecord(telephonySessionId) {\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      const recordingId = this.getRecordingId(session);\n      if (recordingId) {\n        await session.resumeRecord(recordingId);\n      } else {\n        await session.createRecord(recordingId);\n      }\n    } catch (error) {\n      // this.store.dispatch({\n      //   type: this.actionTypes.recordFail,\n      //   sessionId,\n      // });\n    }\n  }\n\n  getRecordingId(session) {\n    const recording = session.recordings[0];\n    const recodingId = recording && recording.id;\n    return recodingId;\n  }\n\n  async stopRecord(telephonySessionId) {\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      const recordingId = this.getRecordingId(session);\n      await session.pauseRecord(recordingId);\n      const activeSession = this.getActiveSession(telephonySessionId);\n      this.store.dispatch({\n        type: this.actionTypes.stopRecord,\n        activeSession,\n      });\n    } catch (error) {\n      console.log('stop record error:', error);\n      throw error;\n    }\n  }\n\n  async hangUp(telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.hangUp,\n      timestamp: Date.now(),\n    });\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      await session.drop();\n      if (typeof this._onCallEndFunc === 'function') {\n        this._onCallEndFunc();\n      }\n      this.store.dispatch({\n        type: this.actionTypes.hangUpSuccess,\n      });\n    } catch (error) {\n      if (\n        !this._availabilityMonitor ||\n        !(await this._availabilityMonitor.checkIfHAError(error))\n      ) {\n        this._alert.warning({ message: callControlError.generalError });\n      }\n\n      this.store.dispatch({\n        type: this.actionTypes.hangUpError,\n      });\n    }\n  }\n\n  async reject(telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.reject,\n      timestamp: Date.now(),\n    });\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      await session.toVoicemail();\n      this.store.dispatch({\n        type: this.actionTypes.rejectSuccess,\n      });\n    } catch (error) {\n      if (\n        !this._availabilityMonitor ||\n        !(await this._availabilityMonitor.checkIfHAError(error))\n      ) {\n        this._alert.warning({ message: callControlError.generalError });\n      }\n      this.store.dispatch({\n        type: this.actionTypes.rejectError,\n      });\n    }\n  }\n\n  async hold(telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.hold,\n      timestamp: Date.now(),\n    });\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      await session.hold();\n      this.store.dispatch({\n        type: this.actionTypes.holdSuccess,\n      });\n    } catch (error) {\n      if (error.response && !error.response._text) {\n        error.response._text = await error.response.clone().text();\n      }\n      if (conflictError(error)) {\n        this._alert.warning({\n          message: callControlError.holdConflictError,\n        });\n      } else if (\n        !this._availabilityMonitor ||\n        !(await this._availabilityMonitor.checkIfHAError(error))\n      ) {\n        this._alert.warning({ message: callControlError.generalError });\n      }\n\n      this.store.dispatch({\n        type: this.actionTypes.holdError,\n      });\n    }\n  }\n\n  async unhold(telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.unhold,\n      timestamp: Date.now(),\n    });\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      await session.unhold();\n      this.store.dispatch({\n        type: this.actionTypes.unholdSuccess,\n      });\n    } catch (error) {\n      if (error.response && !error.response._text) {\n        error.response._text = await error.response.clone().text();\n      }\n      if (conflictError(error)) {\n        this._alert.warning({\n          message: callControlError.unHoldConflictError,\n        });\n      } else if (\n        !this._availabilityMonitor ||\n        !(await this._availabilityMonitor.checkIfHAError(error))\n      ) {\n        this._alert.warning({\n          message: callControlError.generalError,\n        });\n      }\n      this.store.dispatch({\n        type: this.actionTypes.holdError,\n      });\n    }\n  }\n\n  async transfer(transferNumber, telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.transfer,\n      timestamp: Date.now(),\n    });\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      const validatedResult = await this._numberValidate.validateNumbers([\n        transferNumber,\n      ]);\n      if (!validatedResult.result) {\n        await Promise.all(\n          validatedResult.errors.map(async (error) => {\n            if (\n              !this._availabilityMonitor ||\n              !(await this._availabilityMonitor.checkIfHAError(error))\n            ) {\n              this._alert.warning({\n                message: callErrors[error.type],\n                payload: {\n                  phoneNumber: error.phoneNumber,\n                },\n              });\n            }\n          }),\n        );\n        this.store.dispatch({\n          type: this.actionTypes.transferError,\n        });\n        return;\n      }\n      const validPhoneNumber =\n        validatedResult.numbers[0] && validatedResult.numbers[0].e164;\n      let phoneNumber = validPhoneNumber;\n      if (validPhoneNumber.indexOf('+') === -1) {\n        phoneNumber = [\n          this._accountInfo.mainCompanyNumber,\n          validPhoneNumber,\n        ].join('*');\n      }\n      session.transfer({ phoneNumber });\n      this.store.dispatch({\n        type: this.actionTypes.transferSuccess,\n      });\n    } catch (error) {\n      if (\n        !this._availabilityMonitor ||\n        !(await this._availabilityMonitor.checkIfHAError(error))\n      ) {\n        this._alert.warning({ message: callControlError.generalError });\n      }\n      this.store.dispatch({\n        type: this.actionTypes.transferError,\n      });\n    }\n  }\n\n  // Incomplete Implementation?\n  async flip(flipValue, telephonySessionId) {\n    this.store.dispatch({\n      type: this.actionTypes.flip,\n      timestamp: Date.now(),\n    });\n    try {\n      const session = this._rcCallControl.sessions.find(\n        (s) => s.id === telephonySessionId,\n      );\n      await session.flip({ callFlipId: flipValue });\n      this.store.dispatch({\n        type: this.actionTypes.flipSuccess,\n      });\n    } catch (error) {\n      this.store.dispatch({\n        type: this.actionTypes.flipError,\n      });\n      throw error;\n    }\n  }\n\n  async forward() {\n    // No implement at the moment\n    // Need to check the API document\n  }\n\n  get data() {\n    return (\n      (this._storage &&\n        this._storage.ready &&\n        this._storage.getItem(this._storageKey)) ||\n      this.state\n    );\n  }\n\n  get activeSessionId() {\n    return this.data.activeSessionId || null;\n  }\n\n  /**\n   * Mitigation strategy for avoiding 404/409 on call control endpoings.\n   * This should gradually move towards per session controls rather than\n   * a global busy timeout.\n   */\n  get busy() {\n    return Date.now() - this.data.busy < DEFAULT_BUSY_TIMEOUT;\n  }\n\n  get timestamp() {\n    return this.data.timestamp;\n  }\n\n  get timeToRetry() {\n    return this._timeToRetry;\n  }\n\n  get ttl() {\n    return this._ttl;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  @selector\n  activeSession = [\n    () => this.activeSessionId,\n    () => this.activeSessions,\n    (sessionId) => this.getActiveSession(sessionId),\n  ];\n\n  @selector\n  activeSessions = [\n    () => this._presence.calls,\n    () => this.data.sessions,\n    () => this.timestamp,\n    (calls, sessions, _t) => {\n      const reducer = (accumulator, call) => {\n        const { telephonySessionId } = call;\n        const session = sessions.find((s) => s.id === telephonySessionId);\n        if (!session) {\n          return accumulator;\n        }\n        accumulator[telephonySessionId] = normalizeSession({\n          call,\n          session,\n        });\n        return accumulator;\n      };\n      return calls.reduce(reducer, {});\n    },\n  ];\n\n  @selector\n  sessionIdToTelephonySessionIdMapping = [\n    () => this._presence.calls,\n    (calls) => {\n      const reducer = (accumulator, call) => {\n        const { telephonySessionId, sessionId } = call;\n        accumulator[sessionId] = telephonySessionId;\n        return accumulator;\n      };\n      return calls.reduce(reducer, {});\n    },\n  ];\n}\n"],"file":"index.js"}