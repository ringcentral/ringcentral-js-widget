{"version":3,"sources":["modules/Meeting/meeting.ts"],"names":["Meeting","deps","dep","optional","alert","client","extensionInfo","storage","availabilityMonitor","reducers","showSaveAsDefault","options","actionTypes","_alert","_client","_extensionInfo","_storage","_availabilityMonitor","_lastMeetingSettingKey","_defaultMeetingSettingKey","_showSaveAsDefault","_reducer","registerReducer","key","reducer","store","subscribe","_onStateChange","_shouldInit","_init","_shouldReset","_reset","ready","pending","dispatch","type","init","_initMeeting","initSuccess","resetSuccess","update","currentMeetingSetting","meeting","updateMeeting","isAlertSuccess","opener","isScheduling","schedule","_promise","initScheduling","_validate","formattedMeeting","_format","saveAsDefault","saveAsDefaultSetting","Promise","all","account","extension","post","serviceInfo","get","resp","scheduled","_saved","_createDialingNumberTpl","result","setTimeout","info","message","meetingStatus","scheduledSuccess","resetScheduling","_errorHandle","meetingId","_isUpdating","initUpdating","put","updated","updatedSuccess","resetUpdating","mobileDialingNumberTpl","dialInNumbers","id","phoneDialingNumberTpl","scheduledHook","errors","MeetingErrors","error","warning","apiResponse","json","errorCode","permissionName","danger","insufficientPermissions","payload","checkIfHAError","internalError","state","updatingStatus","obj","topic","meetingType","allowJoinBeforeHost","startHostVideo","startParticipantsVideo","audioOptions","password","recurrence","formatted","MeetingType","RECURRING","_schedule","durationInMinutes","timeZone","UTC_TIMEZONE_ID","startTime","moment","utc","format","until","invalidMeetingInfo","_requireMeetingPassword","length","push","emptyTopic","noPassword","durationIncorrect","notShowAgain","schedulingStatus","scheduleStatus","scheduling","status","getItem","RcModule","background","proxify","selector","initialMeetingSetting","savedSetting","defaultMeetingSetting","lastMeetingSetting","initialSetting","name","extensionName","setting"],"mappings":"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","sourcesContent":["import moment from 'moment';\nimport { find } from 'ramda';\nimport Client from 'ringcentral-client';\n\nimport {\n  getDefaultMeetingSettings,\n  getInitializedStartTime,\n  getMobileDialingNumberTpl,\n  getPhoneDialingNumberTpl,\n  MeetingType,\n  UTC_TIMEZONE_ID,\n} from '../../helpers/meetingHelper';\nimport background from '../../lib/background';\nimport { Module } from '../../lib/di';\nimport proxify from '../../lib/proxy/proxify';\n// eslint-disable-next-line\nimport { selector } from '../../lib/selector';\nimport RcModule from '../../lib/RcModule';\nimport actionTypes, { MeetingActionTypes } from './actionTypes';\nimport getMeetingReducer, {\n  getDefaultMeetingSettingReducer,\n  getMeetingStorageReducer,\n} from './getMeetingReducer';\nimport { MeetingErrors } from './meetingErrors';\nimport meetingStatus from './meetingStatus';\nimport scheduleStatus from './scheduleStatus';\n\n@Module({\n  deps: [\n    'Alert',\n    'Client',\n    'ExtensionInfo',\n    'Storage',\n    { dep: 'AvailabilityMonitor', optional: true },\n    { dep: 'MeetingOptions', optional: true },\n  ],\n})\nexport class Meeting extends RcModule<MeetingActionTypes> {\n  public _alert: any;\n  public _client: Client;\n  private _extensionInfo: any;\n  private _storage: any;\n  private _availabilityMonitor: any;\n  private _lastMeetingSettingKey: any;\n  private _defaultMeetingSettingKey: any;\n  public _showSaveAsDefault: any;\n  constructor({\n    alert,\n    client,\n    extensionInfo,\n    storage,\n    availabilityMonitor,\n    reducers,\n    showSaveAsDefault,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: options.actionTypes || actionTypes,\n    });\n    this._alert = alert;\n    this._client = client;\n    this._storage = storage;\n    this._extensionInfo = extensionInfo;\n    this._showSaveAsDefault = showSaveAsDefault;\n    this._availabilityMonitor = availabilityMonitor;\n    this._lastMeetingSettingKey = 'lastMeetingSetting';\n    this._defaultMeetingSettingKey = 'defaultMeetingSetting';\n    this._reducer = getMeetingReducer(this.actionTypes, reducers);\n    this._storage.registerReducer({\n      key: this._lastMeetingSettingKey,\n      reducer: getMeetingStorageReducer(this.actionTypes),\n    });\n    if (this._showSaveAsDefault) {\n      this._storage.registerReducer({\n        key: this._defaultMeetingSettingKey,\n        reducer: getDefaultMeetingSettingReducer(this.actionTypes),\n      });\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._init();\n    } else if (this._shouldReset()) {\n      this._reset();\n    }\n  }\n\n  private _shouldInit() {\n    return (\n      this._alert.ready &&\n      this._storage.ready &&\n      this._extensionInfo.ready &&\n      (!this._availabilityMonitor || this._availabilityMonitor.ready) &&\n      this.pending\n    );\n  }\n\n  private _init() {\n    this.store.dispatch({\n      type: this.actionTypes.init,\n    });\n\n    this._initMeeting();\n\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n\n  private _shouldReset() {\n    return (\n      (!this._alert.ready ||\n        !this._storage.ready ||\n        !this._extensionInfo.ready ||\n        (this._availabilityMonitor && !this._availabilityMonitor.ready)) &&\n      this.ready\n    );\n  }\n\n  private _reset() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  /**\n   * Init basic meeting information\n   * also load meeting setting from previous one.\n   */\n  @background\n  init() {\n    this._initMeeting();\n  }\n\n  @proxify\n  reload() {\n    this._initMeeting();\n  }\n\n  private _initMeeting() {\n    this.update(this.currentMeetingSetting);\n  }\n\n  @proxify\n  update(meeting) {\n    this.store.dispatch({\n      type: this.actionTypes.updateMeeting,\n      meeting,\n    });\n  }\n\n  @proxify\n  async schedule(meeting, { isAlertSuccess = true } = {}, opener) {\n    if (this.isScheduling) return (this.schedule as any)._promise;\n    meeting = meeting || this.meeting;\n    try {\n      this.store.dispatch({\n        type: this.actionTypes.initScheduling,\n      });\n      // Validate meeting\n      this._validate(meeting);\n      const formattedMeeting = this._format(meeting);\n      if (this._showSaveAsDefault && meeting.saveAsDefault) {\n        this.saveAsDefaultSetting(meeting);\n      }\n\n      (this.schedule as any)._promise = Promise.all([\n        this._client\n          .account()\n          .extension()\n          .meeting()\n          .post(formattedMeeting),\n        this._client\n          .account()\n          .extension()\n          .meeting()\n          .serviceInfo()\n          .get(),\n      ]);\n\n      const [resp, serviceInfo] = await (this.schedule as any)._promise;\n\n      this.store.dispatch({\n        type: this.actionTypes.scheduled,\n        meeting: {\n          ...formattedMeeting,\n          _saved: meeting._saved,\n        },\n      });\n\n      const result = await this._createDialingNumberTpl(\n        serviceInfo,\n        resp,\n        opener,\n      );\n\n      // Reload meeting info\n      this._initMeeting();\n      // Notify user the meeting has been scheduled\n      if (isAlertSuccess) {\n        setTimeout(() => {\n          this._alert.info({\n            message: meetingStatus.scheduledSuccess,\n          });\n        }, 50);\n      }\n      return result;\n    } catch (errors) {\n      this.store.dispatch({\n        type: this.actionTypes.resetScheduling,\n      });\n      this._errorHandle(errors);\n      return null;\n    } finally {\n      delete (this.schedule as any)._promise;\n    }\n  }\n\n  @proxify\n  async getMeeting(meetingId) {\n    return this._client\n      .account()\n      .extension()\n      .meeting(meetingId)\n      .get();\n  }\n\n  @proxify\n  async updateMeeting(\n    meetingId: string,\n    meeting,\n    { isAlertSuccess = false } = {},\n    opener,\n  ) {\n    if (this._isUpdating(meetingId)) {\n      return (this.updateMeeting as any)._promise;\n    }\n    meeting = meeting || this.meeting;\n    try {\n      this.store.dispatch({\n        type: this.actionTypes.initUpdating,\n        meetingId,\n      });\n      // Validate meeting\n      this._validate(meeting);\n      const formattedMeeting = this._format(meeting);\n      if (this._showSaveAsDefault && meeting.saveAsDefault) {\n        this.saveAsDefaultSetting(meeting);\n      }\n\n      (this.updateMeeting as any)._promise = Promise.all([\n        this._client\n          .account()\n          .extension()\n          .meeting(meetingId)\n          .put(formattedMeeting),\n        this._client\n          .account()\n          .extension()\n          .meeting()\n          .serviceInfo()\n          .get(),\n      ]);\n\n      const [resp, serviceInfo] = await (this.updateMeeting as any)._promise;\n\n      this.store.dispatch({\n        type: this.actionTypes.updated,\n        meeting: {\n          ...formattedMeeting,\n          _saved: meeting._saved,\n        },\n        meetingId,\n      });\n\n      const result = await this._createDialingNumberTpl(\n        serviceInfo,\n        resp,\n        opener,\n      );\n\n      // Reload meeting info\n      this._initMeeting();\n      // Notify user the meeting has been updated\n      if (isAlertSuccess) {\n        setTimeout(() => {\n          this._alert.info({\n            message: meetingStatus.updatedSuccess,\n          });\n        }, 50);\n      }\n      return result;\n    } catch (errors) {\n      this.store.dispatch({\n        type: this.actionTypes.resetUpdating,\n        meetingId,\n      });\n      return this._errorHandle(errors);\n    } finally {\n      delete (this.updateMeeting as any)._promise;\n    }\n  }\n\n  async _createDialingNumberTpl(serviceInfo: any, resp: any, opener: any) {\n    serviceInfo.mobileDialingNumberTpl = getMobileDialingNumberTpl(\n      serviceInfo.dialInNumbers,\n      resp.id,\n    );\n    serviceInfo.phoneDialingNumberTpl = getPhoneDialingNumberTpl(\n      serviceInfo.dialInNumbers,\n    );\n    const result = {\n      meeting: resp,\n      serviceInfo,\n      extensionInfo: this.extensionInfo,\n    };\n\n    if (typeof this.scheduledHook === 'function') {\n      await this.scheduledHook(result, opener);\n    }\n    return result;\n  }\n\n  _errorHandle(errors: any) {\n    if (errors instanceof MeetingErrors) {\n      for (const error of errors.all) {\n        this._alert.warning(error);\n      }\n    } else if (errors && errors.apiResponse) {\n      const { errorCode, permissionName } = errors.apiResponse.json();\n      if (errorCode === 'InsufficientPermissions' && permissionName) {\n        this._alert.danger({\n          message: meetingStatus.insufficientPermissions,\n          payload: {\n            permissionName,\n          },\n        });\n      } else if (\n        !this._availabilityMonitor ||\n        !this._availabilityMonitor.checkIfHAError(errors)\n      ) {\n        this._alert.danger({ message: meetingStatus.internalError });\n      }\n    }\n    return null;\n  }\n\n  /**\n   * @param {number} meetingId\n   */\n  _isUpdating(meetingId) {\n    return (\n      this.state.updatingStatus &&\n      find((obj: any) => obj.meetingId === meetingId, this.state.updatingStatus)\n    );\n  }\n\n  /**\n   * Format meeting information.\n   * @param {Object} meeting\n   */\n  _format(meeting: ScheduleMeetingModel) {\n    const {\n      topic,\n      meetingType,\n      allowJoinBeforeHost,\n      startHostVideo,\n      startParticipantsVideo,\n      audioOptions,\n      password,\n      schedule,\n      recurrence,\n    } = meeting;\n    const formatted: ScheduleMeetingModel = {\n      topic,\n      meetingType,\n      allowJoinBeforeHost,\n      startHostVideo,\n      startParticipantsVideo,\n      audioOptions,\n      password,\n      recurrence,\n    };\n    // Recurring meetings do not have schedule info\n    if (meetingType !== MeetingType.RECURRING) {\n      const _schedule: ScheduleModel = {\n        durationInMinutes: schedule.durationInMinutes,\n        timeZone: { id: UTC_TIMEZONE_ID },\n      };\n      if (schedule.startTime) {\n        // Format selected startTime to utc standard time\n        // Timezone information is not included here\n        _schedule.startTime = moment.utc(schedule.startTime).format();\n      }\n      formatted.schedule = _schedule;\n\n      if (recurrence && recurrence.until) {\n        formatted.recurrence.until = moment.utc(recurrence.until).format();\n      }\n    }\n    return formatted;\n  }\n\n  /**\n   * Validate meeting information format.\n   * @param {Object} meeting\n   * @throws\n   */\n  _validate(meeting) {\n    if (!meeting) {\n      throw new MeetingErrors(meetingStatus.invalidMeetingInfo);\n    }\n    const { topic, password, schedule, _requireMeetingPassword } = meeting;\n    const errors = new MeetingErrors();\n    if (topic.length <= 0) {\n      errors.push(meetingStatus.emptyTopic);\n    }\n    if (_requireMeetingPassword && (!password || password.length <= 0)) {\n      errors.push(meetingStatus.noPassword);\n    }\n    if (schedule) {\n      if (schedule.durationInMinutes < 0) {\n        errors.push(meetingStatus.durationIncorrect);\n      }\n    }\n    if (errors.length > 0) {\n      throw errors;\n    }\n  }\n\n  saveAsDefaultSetting(meeting) {\n    const formattedMeeting = this._format(meeting);\n    this.store.dispatch({\n      type: this.actionTypes.saveAsDefaultSetting,\n      meeting: {\n        ...formattedMeeting,\n        _saved: meeting.notShowAgain,\n      },\n    });\n  }\n\n  get extensionInfo() {\n    return this._extensionInfo.info;\n  }\n\n  get meeting() {\n    return this.state.meeting;\n  }\n\n  get isScheduling() {\n    return this.state.schedulingStatus === scheduleStatus.scheduling;\n  }\n\n  get isUpdating() {\n    return this.meeting && this.meeting.id && this._isUpdating(this.meeting.id);\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  @selector\n  currentMeetingSetting: any = [\n    () => this.initialMeetingSetting,\n    () => {\n      const savedSetting = this._showSaveAsDefault\n        ? this.defaultMeetingSetting\n        : this.lastMeetingSetting;\n      return savedSetting;\n    },\n    (initialSetting, savedSetting) => {\n      return {\n        ...initialSetting,\n        ...savedSetting,\n      };\n    },\n  ];\n\n  @selector\n  initialMeetingSetting: any = [\n    () => this._extensionInfo.info.name || '',\n    () => getInitializedStartTime(),\n    (extensionName, startTime) => {\n      const setting = getDefaultMeetingSettings(extensionName, startTime);\n      return setting;\n    },\n  ];\n\n  get defaultMeetingSetting() {\n    return this._storage.getItem(this._defaultMeetingSettingKey);\n  }\n\n  get lastMeetingSetting() {\n    return this._storage.getItem(this._lastMeetingSettingKey);\n  }\n\n  get showSaveAsDefault() {\n    return !!this._showSaveAsDefault;\n  }\n}\n\nexport interface ScheduleModel {\n  durationInMinutes: number;\n  timeZone: { id: string };\n  startTime?: string;\n}\n\nexport interface RecurrenceOptions {\n  frequency: string;\n  interval: string | number;\n  count?: number;\n  until?: string; // \"2030-12-21T12:00:00Z\"\n}\n\nexport interface ScheduleMeetingModel {\n  topic: string;\n  meetingType: any;\n  allowJoinBeforeHost: any;\n  startHostVideo: any;\n  startParticipantsVideo: any;\n  audioOptions: any;\n  password: any;\n  schedule?: ScheduleModel;\n  recurrence?: RecurrenceOptions;\n}\n"],"file":"meeting.js"}