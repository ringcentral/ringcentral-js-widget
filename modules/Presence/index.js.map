{"version":3,"sources":["modules/Presence/index.js"],"names":["presenceRegExp","detailedPresenceRegExp","Presence","deps","dep","optional","detailed","fetchRemainingDelay","ttl","polling","pollingInterval","connectivityMonitor","rolesAndPermissions","options","getDataReducer","fetchFunction","endpoint","_detailed","subscriptionFilters","detailedPresence","presence","_client","service","platform","get","response","json","subscriptionHandler","message","regExp","test","event","body","sequence","store","dispatch","data","type","actionTypes","notification","lastDndStatus","dndStatus","timestamp","Date","now","activeCalls","totalActiveCalls","length","_fetchRemainingCalls","readyCheckFn","_rolesAndPermissions","ready","_connectivityMonitor","ensureExist","call","fetchData","_shouldInit","_connectivity","connectivity","_hasPermission","params","hasEditPresencePermission","ownerId","_auth","put","updateSuccess","updateError","error","userStatusParams","userStatus","takeAllCalls","doNotAcceptDepartmentCalls","lastNotDisturbDndStatus","presenceStatus","available","doNotAcceptAnyCalls","_getUpdateStatusParams","_update","busy","offline","presenceData","setAvailable","setBusy","setDoNotDisturb","setInvisible","ObjectMap","prefixKeys","keys","_name","telephonyStatus","meetingStatus","hasPresencePermission","DataFetcher","proxify","selector","calls","filter","map","sessionId"],"mappings":"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","sourcesContent":["import { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\n\nimport DataFetcher from '../../lib/DataFetcher';\nimport { Module } from '../../lib/di';\nimport { selector } from '../../lib/selector';\nimport { isEnded, removeInboundRingOutLegs } from '../../lib/callLogHelpers';\nimport debounce from '../../lib/debounce';\n\nimport { getDataReducer } from './getPresenceReducer';\nimport subscriptionFilters from '../../enums/subscriptionFilters';\nimport dndStatus from './dndStatus';\nimport { presenceStatus } from '../../enums/presenceStatus.enum';\nimport proxify from '../../lib/proxy/proxify';\nimport ensureExist from '../../lib/ensureExist';\n\nconst presenceRegExp = /.*\\/presence(\\?.*)?/;\nconst detailedPresenceRegExp = /.*\\/presence\\?detailedTelephonyState=true&sipData=true/;\n\n@Module({\n  deps: [\n    'RolesAndPermissions',\n    'ConnectivityMonitor',\n    { dep: 'Storage', optional: true },\n    { dep: 'PresenceOptions', optional: true },\n  ],\n})\nexport default class Presence extends DataFetcher {\n  constructor({\n    detailed = true,\n    fetchRemainingDelay = 2000,\n    ttl = 62 * 1000,\n    polling = false,\n    pollingInterval = 3 * 60 * 1000,\n    connectivityMonitor,\n    rolesAndPermissions,\n    ...options\n  }) {\n    super({\n      ...options,\n      polling,\n      ttl,\n      pollingInterval,\n      getDataReducer,\n      fetchFunction: async () => {\n        const endpoint = this._detailed\n          ? subscriptionFilters.detailedPresence\n          : subscriptionFilters.presence;\n        const response = await this._client.service.platform().get(endpoint);\n        return response.json();\n      },\n      subscriptionFilters: [\n        detailed\n          ? subscriptionFilters.detailedPresence\n          : subscriptionFilters.presence,\n      ],\n      subscriptionHandler: (message) => {\n        const regExp = this._detailed ? detailedPresenceRegExp : presenceRegExp;\n        if (regExp.test(message.event) && message.body) {\n          if (message.body.sequence) {\n            if (message.body.sequence < this.sequence) {\n              return;\n            }\n          }\n          const { body } = message;\n          this.store.dispatch({\n            data: body,\n            type: this.actionTypes.notification,\n            lastDndStatus: this.dndStatus,\n            timestamp: Date.now(),\n          });\n\n          /**\n           * as pointed out by Igor in https://jira.ringcentral.com/browse/PLA-33391,\n           * when the real calls count larger than the active calls returned by the pubnub,\n           * we need to pulling the calls manually.\n           */\n          const { activeCalls = [], totalActiveCalls = 0 } = body;\n          if (activeCalls.length !== totalActiveCalls) {\n            this._fetchRemainingCalls();\n          }\n        }\n      },\n      readyCheckFn: () =>\n        this._rolesAndPermissions.ready && this._connectivityMonitor.ready,\n    });\n    this._detailed = true;\n    this._connectivityMonitor = ensureExist.call(\n      this,\n      connectivityMonitor,\n      'connectivityMonitor',\n    );\n    this._rolesAndPermissions = ensureExist.call(\n      this,\n      rolesAndPermissions,\n      'rolesAndPermissions',\n    );\n    this._fetchRemainingCalls = debounce(\n      () => this.fetchData(),\n      fetchRemainingDelay,\n    );\n  }\n\n  get _name() {\n    return 'presence';\n  }\n\n  get _actionTypes() {\n    return ObjectMap.prefixKeys(\n      [\n        ...ObjectMap.keys(super._actionTypes),\n        'update',\n        'updateSuccess',\n        'updateError',\n        'notification',\n      ],\n      this._name,\n    );\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n    }\n    super._onStateChange();\n    if (\n      this.ready &&\n      this._connectivityMonitor &&\n      this._connectivityMonitor.ready &&\n      this._connectivity !== this._connectivityMonitor.connectivity\n    ) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n      // fetch data on regain connectivity\n      if (this._connectivity && this._hasPermission) {\n        this.fetchData();\n      }\n    }\n  }\n\n  @proxify\n  async _update(params) {\n    if (!this._rolesAndPermissions.hasEditPresencePermission) {\n      return;\n    }\n    try {\n      const { ownerId } = this._auth;\n      const platform = this._client.service.platform();\n      const response = await platform.put(\n        '/restapi/v1.0/account/~/extension/~/presence',\n        params,\n      );\n      const data = await response.json();\n      if (ownerId === this._auth.ownerId) {\n        this.store.dispatch({\n          type: this.actionTypes.updateSuccess,\n          data,\n          lastDndStatus: this.dndStatus,\n        });\n      }\n    } catch (error) {\n      this.store.dispatch({\n        type: this.actionTypes.updateError,\n        error,\n      });\n      throw error;\n    }\n  }\n\n  _getUpdateStatusParams(userStatusParams) {\n    const params = {\n      dndStatus: this.dndStatus,\n      userStatus: userStatusParams,\n    };\n    if (\n      params.dndStatus !== dndStatus.takeAllCalls &&\n      params.dndStatus !== dndStatus.doNotAcceptDepartmentCalls\n    ) {\n      params.dndStatus = this.lastNotDisturbDndStatus || dndStatus.takeAllCalls;\n    }\n    return params;\n  }\n\n  async setAvailable() {\n    if (\n      this.userStatus === presenceStatus.available &&\n      this.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return;\n    }\n    const params = this._getUpdateStatusParams(presenceStatus.available);\n    await this._update(params);\n  }\n\n  async setBusy() {\n    if (\n      this.userStatus === presenceStatus.busy &&\n      this.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return;\n    }\n    const params = this._getUpdateStatusParams(presenceStatus.busy);\n    await this._update(params);\n  }\n\n  async setDoNotDisturb() {\n    if (this.dndStatus === dndStatus.doNotAcceptAnyCalls) {\n      return;\n    }\n    const params = {\n      dndStatus: dndStatus.doNotAcceptAnyCalls,\n    };\n    await this._update(params);\n  }\n\n  async setInvisible() {\n    if (\n      this.userStatus === presenceStatus.offline &&\n      this.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return;\n    }\n    const params = this._getUpdateStatusParams(presenceStatus.offline);\n    await this._update(params);\n  }\n\n  async setPresence(presenceData) {\n    switch (presenceData) {\n      case presenceStatus.available:\n        await this.setAvailable();\n        break;\n      case presenceStatus.busy:\n        await this.setBusy();\n        break;\n      case dndStatus.doNotAcceptAnyCalls:\n        await this.setDoNotDisturb();\n        break;\n      case presenceStatus.offline:\n        await this.setInvisible();\n        break;\n      default:\n        await this.setAvailable();\n        break;\n    }\n  }\n\n  async toggleAcceptCallQueueCalls() {\n    const params = {\n      userStatus: this.userStatus,\n    };\n    if (this.dndStatus === dndStatus.takeAllCalls) {\n      params.dndStatus = dndStatus.doNotAcceptDepartmentCalls;\n    } else if (this.dndStatus === dndStatus.doNotAcceptDepartmentCalls) {\n      params.dndStatus = dndStatus.takeAllCalls;\n    }\n    if (params.dndStatus) {\n      await this._update(params);\n    }\n  }\n\n  /**\n   * @override\n   * @description make sure data returns object so that the property getters\n   *  will not fail.\n   * @returns {Object}\n   */\n  get data() {\n    return super.data || {};\n  }\n\n  get sequence() {\n    return this.data.sequence;\n  }\n\n  @selector\n  activeCalls = [() => this.data.activeCalls, (calls) => calls || []];\n\n  @selector\n  calls = [\n    () => this.activeCalls,\n    (activeCalls) =>\n      removeInboundRingOutLegs(activeCalls).filter((call) => !isEnded(call)),\n  ];\n\n  @selector\n  sessionIdList = [\n    () => this.calls,\n    (calls) => calls.map((call) => call.sessionId),\n  ];\n\n  get telephonyStatus() {\n    return this.data.telephonyStatus;\n  }\n\n  get dndStatus() {\n    return this.data.dndStatus;\n  }\n\n  get lastNotDisturbDndStatus() {\n    return this.data.lastNotDisturbDndStatus;\n  }\n\n  get userStatus() {\n    return this.data.userStatus;\n  }\n\n  get presenceStatus() {\n    return this.data.presenceStatus;\n  }\n\n  get meetingStatus() {\n    return this.data.meetingStatus;\n  }\n\n  get presenceOption() {\n    // available\n    if (\n      this.data.userStatus === presenceStatus.available &&\n      this.data.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return presenceStatus.available;\n    }\n\n    // busy\n    if (\n      this.data.userStatus === presenceStatus.busy &&\n      this.data.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return presenceStatus.busy;\n    }\n\n    // doNotDisturb\n    if (this.data.dndStatus === dndStatus.doNotAcceptAnyCalls) {\n      return dndStatus.doNotAcceptAnyCalls;\n    }\n\n    // invisible\n    if (\n      this.data.userStatus === presenceStatus.offline &&\n      this.data.dndStatus !== dndStatus.doNotAcceptAnyCalls\n    ) {\n      return presenceStatus.offline;\n    }\n\n    return presenceStatus.available;\n  }\n\n  get _hasPermission() {\n    return this._rolesAndPermissions.hasPresencePermission;\n  }\n}\n"],"file":"index.js"}