{"version":3,"sources":["modules/GenericMeeting/GenericMeetingModule.ts"],"names":["GenericMeeting","deps","meeting","meetingProvider","rcVideo","brand","reducers","extensionInfo","options","actionTypes","_meetingProvider","_meeting","_rcVideo","_brand","_extensionInfo","_eventEmitter","EventEmitter","_reducer","store","subscribe","_onStateChange","_meetingModule","init","reload","usePersonalMeetingId","switchUsePersonalMeetingId","userExtensionId","updateScheduleFor","patch","isRCM","update","isRCV","updateMeetingSettings","config","opener","schedule","result","rcvMeetingInfo","updateMeeting","personalMeeting","id","createMeeting","console","error","emit","MeetingEvents","afterSchedule","close","startMeeting","meetingId","getMeeting","getMeetingServiceInfo","afterUpdate","cb","on","removeListener","password","isSecret","validatePasswordSettings","generateRandomPassword","_shouldInit","_init","_shouldReset","_reset","pending","ready","provider","dispatch","type","initSuccess","resetSuccess","info","Error","delegators","defaultMeetingSetting","defaultVideoSetting","isScheduling","showSaveAsDefault","isPreferencesChanged","name","state","status","showAdminLock","enablePersonalMeeting","enableWaitingRoom","shortId","pmiDefaultSettings","personalVideoSetting","RcModule","background","proxify"],"mappings":"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","sourcesContent":["import EventEmitter from 'events';\nimport RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport Meeting, { RcMMeetingModel } from '../Meeting';\nimport Brand from '../Brand';\nimport ExtensionInfo from '../ExtensionInfo';\nimport proxify from '../../lib/proxy/proxify';\nimport background from '../../lib/background';\n\nimport {\n  IGenericMeeting,\n  MeetingEvents,\n  ScheduleModel,\n  ScheduledCallback,\n} from './interface';\n\nimport MeetingProvider from '../MeetingProvider';\n\nimport { actionTypes } from './actionTypes';\n\nimport { RcVideo } from '../RcVideo';\n\nimport getGenericMeetingReducer from './getGenericMeetingReducer';\nimport { RcVMeetingModel } from '../../interfaces/Rcv.model';\n\n@Module({\n  deps: ['MeetingProvider', 'ExtensionInfo', 'Brand', 'Meeting', 'RcVideo'],\n})\nexport class GenericMeeting extends RcModule implements IGenericMeeting {\n  protected _meetingProvider: MeetingProvider;\n  protected _meeting: Meeting;\n  protected _rcVideo: RcVideo;\n  protected _brand: Brand;\n  protected _extensionInfo: ExtensionInfo;\n  protected _eventEmitter = new EventEmitter();\n\n  constructor({\n    meeting,\n    meetingProvider,\n    rcVideo,\n    brand,\n    reducers,\n    extensionInfo,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: options.actionTypes || actionTypes,\n    });\n    this._reducer = getGenericMeetingReducer(this.actionTypes, reducers);\n    this._meeting = meeting;\n    this._meetingProvider = meetingProvider;\n    this._rcVideo = rcVideo;\n    this._brand = brand;\n    this._extensionInfo = extensionInfo;\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  @background\n  init() {\n    return this._meetingModule.init();\n  }\n\n  @proxify\n  reload() {\n    return this._meetingModule.reload();\n  }\n\n  @proxify\n  switchUsePersonalMeetingId(usePersonalMeetingId: boolean) {\n    this._meetingModule.switchUsePersonalMeetingId(usePersonalMeetingId);\n  }\n\n  @proxify\n  updateScheduleFor(userExtensionId: string | number) {\n    return (\n      this._meetingModule.updateScheduleFor &&\n      this._meetingModule.updateScheduleFor(userExtensionId)\n    );\n  }\n\n  @proxify\n  updateMeetingSettings(meeting: ScheduleModel, patch: boolean = true): void {\n    if (this.isRCM) {\n      this._meeting.update(meeting as RcMMeetingModel);\n    }\n    if (this.isRCV) {\n      this._rcVideo.updateMeetingSettings(meeting as RcVMeetingModel, patch);\n    }\n  }\n\n  @proxify\n  async schedule(\n    meeting: ScheduleModel,\n    config?: { isAlertSuccess?: boolean },\n    opener?: Window,\n  ) {\n    let result;\n    if (this.isRCM) {\n      result = await this._meeting.schedule(meeting as RcMMeetingModel, config);\n    } else if (this.isRCV) {\n      const rcvMeetingInfo = meeting as RcVMeetingModel;\n      if (rcvMeetingInfo.usePersonalMeetingId) {\n        result = await this._rcVideo.updateMeeting(\n          this._rcVideo.personalMeeting.id,\n          rcvMeetingInfo,\n          config,\n        );\n      } else {\n        result = await this._rcVideo.createMeeting(\n          meeting as RcVMeetingModel,\n          config,\n        );\n      }\n    } else {\n      console.error('Unknown meeting provider, please check module runtime');\n      return;\n    }\n    if (result) {\n      this._eventEmitter.emit(MeetingEvents.afterSchedule, result, opener);\n    } else if (opener && opener.close) {\n      opener.close();\n    }\n    return result;\n  }\n\n  @proxify\n  async startMeeting(meeting: ScheduleModel) {\n    if (this.isRCM) {\n      return this._meeting.schedule(meeting as RcMMeetingModel);\n    }\n    if (this.isRCV) {\n      return this._rcVideo.startMeeting(meeting as RcVMeetingModel);\n    }\n    return null;\n  }\n\n  @proxify\n  async getMeeting(meetingId: string) {\n    return this._meetingModule.getMeeting(meetingId);\n  }\n\n  @proxify\n  async getMeetingServiceInfo() {\n    return (\n      this._meetingModule.getMeetingServiceInfo &&\n      this._meetingModule.getMeetingServiceInfo()\n    );\n  }\n\n  @proxify\n  async updateMeeting(\n    meetingId: string,\n    meeting: ScheduleModel,\n    config?: { isAlertSuccess?: boolean },\n    opener?: Window,\n  ) {\n    let result;\n    if (this.isRCM) {\n      result = await this._meeting.updateMeeting(\n        meetingId,\n        meeting as RcMMeetingModel,\n        config,\n      );\n    } else if (this.isRCV) {\n      result = await this._rcVideo.updateMeeting(\n        meetingId,\n        meeting as RcVMeetingModel,\n        config,\n      );\n    } else {\n      console.error('Unknown meeting provider, please check module runtime');\n      return;\n    }\n    if (result) {\n      this._eventEmitter.emit(MeetingEvents.afterUpdate, result, opener);\n    } else if (opener && opener.close) {\n      opener.close();\n    }\n    return result;\n  }\n\n  addScheduledCallBack(cb: ScheduledCallback) {\n    this._eventEmitter.on(MeetingEvents.afterSchedule, cb);\n  }\n\n  removeScheduledCallBack(cb: ScheduledCallback) {\n    this._eventEmitter.removeListener(MeetingEvents.afterSchedule, cb);\n  }\n\n  validatePasswordSettings(password: string, isSecret: boolean): boolean {\n    return this._meetingModule.validatePasswordSettings(password, isSecret);\n  }\n\n  generateRcvMeetingPassword() {\n    return this._rcVideo.generateRandomPassword();\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._init();\n    } else if (this._shouldReset()) {\n      this._reset();\n    }\n  }\n\n  private _shouldInit() {\n    return (\n      this.pending &&\n      this._brand.ready &&\n      this._extensionInfo.ready &&\n      this._meetingProvider.ready &&\n      this._meetingProvider.provider &&\n      this._meetingModule &&\n      this._meetingModule.ready\n    );\n  }\n\n  private _shouldReset() {\n    return (\n      this.ready &&\n      (!this._brand.ready ||\n        !this._extensionInfo.ready ||\n        !this._meetingProvider.ready ||\n        !this._meetingProvider.provider ||\n        (this._meetingModule && !this._meetingModule.ready))\n    );\n  }\n\n  private _init() {\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n\n  private _reset() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  get meetingProviderType() {\n    return this._meetingProvider.provider;\n  }\n\n  get isRCV() {\n    return this._meetingProvider.isRCV;\n  }\n\n  get isRCM() {\n    return this._meetingProvider.isRCM;\n  }\n\n  get extensionInfo() {\n    return this._extensionInfo.info;\n  }\n\n  protected get _meetingModule() {\n    if (this.isRCM) {\n      return this._meeting;\n    }\n    if (this.isRCV) {\n      return this._rcVideo;\n    }\n    throw new Error(\n      'Unknown meeting provider, please check the module runtime',\n    );\n  }\n\n  get meeting() {\n    return this._meetingModule.meeting;\n  }\n\n  get delegators() {\n    return this._meetingModule.delegators;\n  }\n\n  get defaultSetting() {\n    if (this.isRCM) {\n      return this._meeting.defaultMeetingSetting;\n    }\n    if (this.isRCV) {\n      return this._rcVideo.defaultVideoSetting;\n    }\n    return null;\n  }\n\n  get isScheduling() {\n    return !!this._meetingModule.isScheduling;\n  }\n\n  get showSaveAsDefault() {\n    return !!this._meetingModule.showSaveAsDefault;\n  }\n\n  get isPreferencesChanged() {\n    return !!this._meetingModule.isPreferencesChanged;\n  }\n\n  get brandName() {\n    return this._brand.name;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get showAdminLock(): boolean {\n    return !!this._meetingModule.showAdminLock;\n  }\n\n  get enablePersonalMeeting(): boolean {\n    return !!this._meetingModule.enablePersonalMeeting;\n  }\n\n  get enableWaitingRoom(): boolean {\n    if (this.isRCV) {\n      return this._rcVideo.enableWaitingRoom;\n    }\n    return false;\n  }\n\n  get personalMeeting(): any {\n    return this._meetingModule.personalMeeting;\n  }\n\n  get personalMeetingId(): string {\n    return this.personalMeeting?.shortId;\n  }\n\n  get personalMeetingSettings(): any {\n    if (this.isRCM) {\n      return this._meeting.pmiDefaultSettings;\n    }\n    if (this.isRCV) {\n      return this._rcVideo.personalVideoSetting;\n    }\n    return null;\n  }\n}\n"],"file":"GenericMeetingModule.js"}