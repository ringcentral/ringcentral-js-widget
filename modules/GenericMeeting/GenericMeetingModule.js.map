{"version":3,"sources":["modules/GenericMeeting/GenericMeetingModule.ts"],"names":["GenericMeeting","deps","meeting","meetingProvider","rcVideo","brand","reducers","extensionInfo","options","actionTypes","_meetingProvider","_meeting","_rcVideo","_brand","_extensionInfo","_eventEmitter","EventEmitter","_reducer","store","subscribe","_onStateChange","_meetingModule","init","reload","usePersonalMeetingId","switchUsePersonalMeetingId","userExtensionId","updateScheduleFor","patch","fn","update","updateMeetingSettings","call","config","opener","isRCM","schedule","result","isRCV","createMeeting","console","error","emit","MeetingEvents","afterSchedule","close","instantMeeting","meetingId","getMeeting","getMeetingServiceInfo","updateMeeting","args","apply","cb","on","removeListener","password","isSecret","validatePasswordSettings","generateRandomPassword","_shouldInit","_init","_shouldReset","_reset","pending","ready","provider","dispatch","type","initSuccess","resetSuccess","info","Error","assistedUsers","scheduleForUser","defaultMeetingSetting","defaultVideoSetting","isScheduling","showSaveAsDefault","isPreferencesChanged","name","state","status","personalMeeting","RcModule","background","proxify"],"mappings":"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","sourcesContent":["import EventEmitter from 'events';\nimport RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport Meeting from '../Meeting';\nimport Brand from '../Brand';\nimport ExtensionInfo from '../ExtensionInfo';\nimport proxify from '../../lib/proxy/proxify';\nimport background from '../../lib/background';\n\nimport {\n  IGenericMeeting,\n  MeetingEvents,\n  ScheduleModel,\n  ScheduledCallback,\n} from './interface';\n\nimport MeetingProvider from '../MeetingProvider';\n\nimport { actionTypes } from './actionTypes';\n\nimport { RcVideo } from '../RcVideo';\n\nimport getGenericMeetingReducer from './getGenericMeetingReducer';\nimport { RcVMeetingModel } from '../../models/rcv.model';\n\n@Module({\n  deps: ['MeetingProvider', 'ExtensionInfo', 'Brand', 'Meeting', 'RcVideo'],\n})\nexport class GenericMeeting extends RcModule implements IGenericMeeting {\n  protected _meetingProvider: MeetingProvider;\n  protected _meeting: Meeting;\n  protected _rcVideo: RcVideo;\n  protected _brand: Brand;\n  protected _extensionInfo: ExtensionInfo;\n  protected _eventEmitter = new EventEmitter();\n\n  constructor({\n    meeting,\n    meetingProvider,\n    rcVideo,\n    brand,\n    reducers,\n    extensionInfo,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: options.actionTypes || actionTypes,\n    });\n    this._reducer = getGenericMeetingReducer(this.actionTypes, reducers);\n    this._meeting = meeting;\n    this._meetingProvider = meetingProvider;\n    this._rcVideo = rcVideo;\n    this._brand = brand;\n    this._extensionInfo = extensionInfo;\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  @background\n  init() {\n    return this._meetingModule && this._meetingModule.init();\n  }\n\n  @proxify\n  reload() {\n    return this._meetingModule && this._meetingModule.reload();\n  }\n\n  @proxify\n  switchUsePersonalMeetingId(usePersonalMeetingId: boolean) {\n    return (\n      this._meetingModule &&\n      this._meetingModule.switchUsePersonalMeetingId &&\n      this._meetingModule.switchUsePersonalMeetingId(usePersonalMeetingId)\n    );\n  }\n\n  @proxify\n  updateScheduleFor(userExtensionId: string) {\n    return (\n      this._meetingModule &&\n      this._meetingModule.updateScheduleFor &&\n      this._meetingModule.updateScheduleFor(userExtensionId)\n    );\n  }\n\n  /* TODO: any is reserved for RcM */\n  @proxify\n  updateMeetingSettings(\n    meeting: RcVMeetingModel | any,\n    patch: boolean = true,\n  ): void {\n    const fn =\n      this._meetingModule &&\n      (this._meetingModule.update || this._meetingModule.updateMeetingSettings);\n    return fn && (fn as Function).call(this._meetingModule, meeting, patch);\n  }\n\n  @proxify\n  async schedule(\n    meeting: ScheduleModel,\n    config?: { isAlertSuccess: boolean },\n    opener?: Window,\n  ) {\n    let result;\n    if (this.isRCM) {\n      result = await this._meeting.schedule(meeting, config, opener);\n    } else if (this.isRCV) {\n      result = await this._rcVideo.createMeeting(\n        meeting as RcVMeetingModel,\n        config,\n      );\n    } else {\n      console.error('Unknown meeting provider, please check module runtime');\n      return;\n    }\n    if (result) {\n      this._eventEmitter.emit(MeetingEvents.afterSchedule, result, opener);\n    } else if (opener && opener.close) {\n      opener.close();\n    }\n    return result;\n  }\n\n  // TODO: any infer the type of rcm meeting, should be more specific\n  async instantMeeting(meeting: RcVMeetingModel | any) {\n    if (this.isRCV) {\n      return this._rcVideo.instantMeeting(meeting as RcVMeetingModel);\n    }\n    return this._meeting.schedule(meeting);\n  }\n\n  @proxify\n  async getMeeting(meetingId: string) {\n    return this._meetingModule && this._meetingModule.getMeeting(meetingId);\n  }\n\n  @proxify\n  async getMeetingServiceInfo() {\n    return (\n      this._meetingModule &&\n      this._meetingModule.getMeetingServiceInfo &&\n      this._meetingModule.getMeetingServiceInfo()\n    );\n  }\n\n  @proxify\n  async updateMeeting(...args) {\n    const fn = this._meetingModule && this._meetingModule.updateMeeting;\n    return fn && (fn as Function).apply(this._meetingModule, args);\n  }\n\n  addScheduledCallBack(cb: ScheduledCallback) {\n    this._eventEmitter.on(MeetingEvents.afterSchedule, cb);\n  }\n\n  removeScheduledCallBack(cb: ScheduledCallback) {\n    this._eventEmitter.removeListener(MeetingEvents.afterSchedule, cb);\n  }\n\n  validatePasswordSettings(password: string, isSecret: boolean): boolean {\n    return (\n      this._meetingModule &&\n      this._meetingModule.validatePasswordSettings(password, isSecret)\n    );\n  }\n\n  generateRcvMeetingPassword() {\n    return this._rcVideo.generateRandomPassword();\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._init();\n    } else if (this._shouldReset()) {\n      this._reset();\n    }\n  }\n\n  private _shouldInit() {\n    return (\n      this.pending &&\n      this._brand.ready &&\n      this._extensionInfo.ready &&\n      this._meetingProvider.ready &&\n      this._meetingProvider.provider &&\n      this._meetingModule &&\n      this._meetingModule.ready\n    );\n  }\n\n  private _shouldReset() {\n    return (\n      this.ready &&\n      (!this._brand.ready ||\n        !this._extensionInfo.ready ||\n        !this._meetingProvider.ready ||\n        !this._meetingProvider.provider ||\n        (this._meetingModule && !this._meetingModule.ready))\n    );\n  }\n\n  private _init() {\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n\n  private _reset() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  get meetingProviderType() {\n    return this._meetingProvider.provider;\n  }\n\n  get isRCV() {\n    return this._meetingProvider.isRCV;\n  }\n\n  get isRCM() {\n    return this._meetingProvider.isRCM;\n  }\n\n  get extensionInfo() {\n    return this._extensionInfo.info;\n  }\n\n  protected get _meetingModule() {\n    if (this.isRCM) {\n      return this._meeting;\n    }\n    if (this.isRCV) {\n      return this._rcVideo;\n    }\n    throw new Error(\n      'Unknown meeting provider, please check the module runtime',\n    );\n  }\n\n  get meeting() {\n    return this._meetingModule && this._meetingModule.meeting;\n  }\n\n  /** TODO: assistedUsers and scheduleForUser are\n   *  used for 'Schedule For' Feature\n   * Now it only applies to RCM\n   */\n  get assistedUsers() {\n    return this._meetingModule && this._meetingModule.assistedUsers;\n  }\n\n  get scheduleForUser() {\n    return this._meetingModule && this._meetingModule.scheduleForUser;\n  }\n\n  get defaultSetting() {\n    if (this.isRCM) {\n      return this._meeting.defaultMeetingSetting;\n    }\n    if (this.isRCV) {\n      return this._rcVideo.defaultVideoSetting;\n    }\n    return null;\n  }\n\n  get isScheduling() {\n    return !!(this._meetingModule && this._meetingModule.isScheduling);\n  }\n\n  get showSaveAsDefault() {\n    return !!(this._meetingModule && this._meetingModule.showSaveAsDefault);\n  }\n\n  get isPreferencesChanged() {\n    return !!(this._meetingModule && this._meetingModule.isPreferencesChanged);\n  }\n\n  get brandName() {\n    return this._brand.name;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get personalMeeting() {\n    return this._meetingModule && this._meetingModule.personalMeeting;\n  }\n}\n"],"file":"GenericMeetingModule.js"}