{"version":3,"sources":["modules/GenericMeeting/genericMeeting.ts"],"names":["GenericMeeting","deps","meeting","meetingProvider","rcVideo","brand","reducers","extensionInfo","options","actionTypes","_meetingProvider","_meeting","_rcVideo","_brand","_extensionInfo","_eventEmitter","EventEmitter","_reducer","store","subscribe","_onStateChange","_meetingModule","init","reload","patch","fn","update","updateMeetingSettings","call","config","opener","isRCM","schedule","result","isRCV","createMeeting","console","error","emit","MeetingEvents","afterSchedule","close","instantMeeting","meetingId","getMeeting","updateMeeting","args","apply","cb","on","removeListener","password","isSecret","validatePasswordSettings","generateRandomPassword","_shouldInit","_init","_shouldReset","_reset","pending","ready","meetingProviderType","dispatch","type","initSuccess","resetSuccess","provider","meetingProviderTypes","video","none","info","Error","defaultMeetingSetting","defaultVideoSetting","isScheduling","showSaveAsDefault","name","state","status","personalMeeting","RcModule","background","proxify"],"mappings":"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","sourcesContent":["import EventEmitter from 'events';\nimport { contains } from 'ramda';\nimport RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport Meeting from '../Meeting';\nimport Brand from '../Brand';\nimport ExtensionInfo from '../ExtensionInfo';\nimport proxify from '../../lib/proxy/proxify';\nimport background from '../../lib/background';\n\nimport {\n  IGenericMeeting,\n  MeetingEvents,\n  ScheduleModel,\n  ScheduledCallback,\n} from './interface';\n\nimport { meetingProviderTypes } from '../MeetingProvider/interface';\nimport MeetingProvider from '../MeetingProvider';\n\nimport actionTypes from './actionTypes';\n\nimport { RcVideo } from '../RcVideo';\n\nimport getGenericMeetingReducer from './getGenericMeetingReducer';\nimport { RcVMeetingModel } from '../../models/rcv.model';\n\n@Module({\n  deps: ['MeetingProvider', 'ExtensionInfo', 'Brand', 'Meeting', 'RcVideo'],\n})\nexport class GenericMeeting extends RcModule implements IGenericMeeting {\n  private _meetingProvider: MeetingProvider;\n  private _meeting: Meeting;\n  private _rcVideo: RcVideo;\n  private _brand: Brand;\n  private _extensionInfo: ExtensionInfo;\n  private _eventEmitter = new EventEmitter();\n\n  constructor({\n    meeting,\n    meetingProvider,\n    rcVideo,\n    brand,\n    reducers,\n    extensionInfo,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: options.actionTypes || actionTypes,\n    });\n    this._reducer = getGenericMeetingReducer(this.actionTypes, reducers);\n    this._meeting = meeting;\n    this._meetingProvider = meetingProvider;\n    this._rcVideo = rcVideo;\n    this._brand = brand;\n    this._extensionInfo = extensionInfo;\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  @background\n  init() {\n    return this._meetingModule && this._meetingModule.init();\n  }\n\n  @proxify\n  reload() {\n    return this._meetingModule && this._meetingModule.reload();\n  }\n\n  /* TODO: any is reserved for RcM */\n  @proxify\n  updateMeetingSettings(\n    meeting: RcVMeetingModel | any,\n    patch: boolean = true,\n  ): void {\n    const fn =\n      this._meetingModule &&\n      (this._meetingModule.update || this._meetingModule.updateMeetingSettings);\n    return fn && (fn as Function).call(this._meetingModule, meeting, patch);\n  }\n\n  @proxify\n  async schedule(\n    meeting: ScheduleModel,\n    config?: { isAlertSuccess: boolean },\n    opener?: Window,\n  ) {\n    let result;\n    if (this.isRCM) {\n      result = await this._meeting.schedule(meeting, config, opener);\n    } else if (this.isRCV) {\n      result = await this._rcVideo.createMeeting(meeting, config);\n    } else {\n      console.error('Unknown meeting provider, please check module runtime');\n      return;\n    }\n    if (result) {\n      this._eventEmitter.emit(MeetingEvents.afterSchedule, result, opener);\n    } else if (opener && opener.close) {\n      opener.close();\n    }\n    return result;\n  }\n\n  // TODO: any infer the type of rcm meeting, should be more specific\n  async instantMeeting(meeting: RcVMeetingModel | any) {\n    if (this.isRCV) {\n      return this._rcVideo.instantMeeting(meeting as RcVMeetingModel);\n    }\n    return this._meeting.schedule(meeting);\n  }\n\n  @proxify\n  async getMeeting(meetingId: string) {\n    return this._meetingModule && this._meetingModule.getMeeting(meetingId);\n  }\n\n  @proxify\n  async updateMeeting(...args) {\n    const fn = this._meetingModule && this._meetingModule.updateMeeting;\n    return fn && (fn as Function).apply(this._meetingModule, args);\n  }\n\n  addScheduledCallBack(cb: ScheduledCallback) {\n    this._eventEmitter.on(MeetingEvents.afterSchedule, cb);\n  }\n\n  removeScheduledCallBack(cb: ScheduledCallback) {\n    this._eventEmitter.removeListener(MeetingEvents.afterSchedule, cb);\n  }\n\n  validatePasswordSettings(password: string, isSecret: boolean): boolean {\n    // TODO: Currently NOT support RCM, use only when RCV\n    return this._rcVideo.validatePasswordSettings(password, isSecret);\n  }\n\n  generateRcvMeetingPassword() {\n    return this._rcVideo.generateRandomPassword();\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._init();\n    } else if (this._shouldReset()) {\n      this._reset();\n    }\n  }\n\n  private _shouldInit() {\n    return (\n      this.pending &&\n      this._brand.ready &&\n      this._extensionInfo.ready &&\n      this._meetingProvider.ready &&\n      this.meetingProviderType &&\n      this._meetingModule &&\n      this._meetingModule.ready\n    );\n  }\n\n  private _shouldReset() {\n    return (\n      this.ready &&\n      ((this._meetingModule && !this._meetingModule.ready) ||\n        !this._meetingProvider.ready ||\n        !this._brand.ready ||\n        !this._extensionInfo.ready ||\n        !this.meetingProviderType)\n    );\n  }\n\n  private _init() {\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n  }\n\n  private _reset() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  get meetingProviderType() {\n    return this._meetingProvider.provider || null;\n  }\n\n  get isRCV() {\n    return this.meetingProviderType === meetingProviderTypes.video;\n  }\n\n  get isRCM() {\n    return contains(this.meetingProviderType, [\n      meetingProviderTypes.meeting,\n      meetingProviderTypes.none,\n    ]);\n  }\n\n  get extensionInfo() {\n    return this._extensionInfo.info;\n  }\n\n  private get _meetingModule() {\n    if (this.isRCM) {\n      return this._meeting;\n    }\n    if (this.isRCV) {\n      return this._rcVideo;\n    }\n    throw new Error(\n      'Unknown meeting provider, please check the module runtime',\n    );\n  }\n\n  get meeting() {\n    return this._meetingModule && this._meetingModule.meeting;\n  }\n\n  get defaultSetting() {\n    if (this.isRCM) {\n      return this._meeting.defaultMeetingSetting;\n    }\n    if (this.isRCV) {\n      return this._rcVideo.defaultVideoSetting;\n    }\n    return null;\n  }\n\n  get isScheduling() {\n    return !!(this._meetingModule && this._meetingModule.isScheduling);\n  }\n\n  get showSaveAsDefault() {\n    return !!(this._meetingModule && this._meetingModule.showSaveAsDefault);\n  }\n\n  get brandName() {\n    return this._brand.name;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get personalMeeting() {\n    return this._meetingModule && this._meetingModule.personalMeeting;\n  }\n}\n"],"file":"genericMeeting.js"}