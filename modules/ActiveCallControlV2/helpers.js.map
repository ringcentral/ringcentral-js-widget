{"version":3,"sources":["modules/ActiveCallControlV2/helpers.ts"],"names":["isHangUp","code","callResults","disconnected","isRejectCode","direction","callDirections","inbound","activeCallControlStatus","setUp","proceeding","isOnRecording","recordings","length","recording","active","normalizeSession","session","party","creationTime","sessionId","partyId","id","from","to","status","muted","formatValue","telephonySessionId","phoneNumber","fromNumber","fromUserName","name","toNumber","toUserName","callStatus","startTime","Date","getTime","isOnMute","isForwarded","isOnFlip","isOnHold","hold","isOnTransfer","isReplied","isToVoicemail","lastHoldingTime","minimized","recordStatus","idle","removed","isReject","conflictError","error","conflictErrRgx","conflictMsgRgx","test","message","errorCode","isRinging","telephonySession","PartyStatusCode","setup","isHolding","isRecording","isForwardedToVoiceMail","isOnSetupStage"],"mappings":"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","sourcesContent":["import { CallRecording, Error } from '@rc-ex/core/definitions';\nimport {\n  SessionData,\n  Party,\n  PartyStatusCode,\n} from 'ringcentral-call-control/lib/Session';\n// eslint-disable-next-line import/no-named-as-default\nimport recordStatus from '../Webphone/recordStatus';\n// eslint-disable-next-line import/no-named-as-default\nimport callResults from '../../enums/callResults';\nimport callDirections from '../../enums/callDirections';\n// eslint-disable-next-line import/no-named-as-default\nimport activeCallControlStatus from '../../enums/activeCallControlStatus';\nimport { mapTelephonyStatus } from '../CallMonitor/callMonitorHelper';\n\nexport interface ActiveCallControlSessionData extends SessionData {\n  party: Party;\n}\n\nexport function isHangUp(code: string) {\n  return code === callResults.disconnected;\n}\n\nexport function isRejectCode({\n  direction,\n  code,\n}: {\n  direction: string;\n  code: string;\n}) {\n  return (\n    direction === callDirections.inbound &&\n    (code === activeCallControlStatus.setUp ||\n      code === activeCallControlStatus.proceeding)\n  );\n}\n\nexport function isOnRecording(recordings: Array<CallRecording>) {\n  if (!recordings || recordings.length === 0) {\n    return false;\n  }\n  const recording = recordings[0];\n  return recording.active;\n}\n\n// TODO: add call type in callMonitor module\nexport function normalizeSession({\n  session,\n}: {\n  session: ActiveCallControlSessionData;\n}) {\n  const { party, creationTime, sessionId } = session;\n  const { id: partyId, direction, from, to, status, recordings, muted } = party;\n\n  const formatValue = {\n    telephonySessionId: session.id,\n    partyId,\n    direction,\n    from: from?.phoneNumber,\n    fromNumber: from?.phoneNumber,\n    fromUserName: from?.name,\n    to: to?.phoneNumber,\n    toNumber: to?.phoneNumber,\n    toUserName: to?.name,\n    id: session.id,\n    sessionId,\n    callStatus: mapTelephonyStatus(status?.code),\n    startTime: new Date(creationTime).getTime(),\n    creationTime,\n    isOnMute: muted,\n    isForwarded: false,\n    isOnFlip: false,\n    isOnHold: status?.code === activeCallControlStatus.hold,\n    isOnTransfer: false,\n    isReplied: false,\n    isToVoicemail: false,\n    lastHoldingTime: 0,\n    minimized: false,\n    recordStatus: isOnRecording(recordings)\n      ? recordStatus.recording\n      : recordStatus.idle,\n    removed: false,\n    isReject: isRejectCode({ direction, code: status?.code }),\n  };\n  return formatValue;\n}\n\nexport async function conflictError(error: Error): Promise<boolean> {\n  const conflictErrRgx = /409/g;\n  const conflictMsgRgx = /Incorrect State/g;\n  return !!(\n    conflictErrRgx.test(error.message) && conflictMsgRgx.test(error.errorCode)\n  );\n}\n\nexport function isRinging(telephonySession: any) {\n  return (\n    telephonySession &&\n    (telephonySession.status === PartyStatusCode.proceeding ||\n      telephonySession.status === PartyStatusCode.setup) &&\n    telephonySession.direction === callDirections.inbound\n  );\n}\n\nexport function isHolding(telephonySession: any) {\n  return telephonySession.status === PartyStatusCode.hold;\n}\n\nexport function isRecording(session: ActiveCallControlSessionData) {\n  const { party } = session;\n  return isOnRecording(party.recordings);\n}\n\nexport function isForwardedToVoiceMail(session: any) {\n  // TODO: fix this for call control js\n  // return session.status === PartyStatusCode.voicemail;\n  return session.status === 'Voicemail';\n}\n\nexport function isOnSetupStage(session: any) {\n  return session.status === PartyStatusCode.setup;\n}\n"],"file":"helpers.js"}