{"version":3,"sources":["modules/RcVideoV2/videoHelper.ts"],"names":["meetingProviderTypes","meeting","video","RcVideoTypes","call","RCV_PASSWORD_REGEX","RCV_WAITTING_ROOM_API_KEYS","RCV_CREATE_API_KEYS","RCV_PREFERENCES_IDS","RCV_PREFERENCES_KEYS","getDefaultChars","DEFAULT_PASSWORD_CHARSET","validateRandomPassword","pwd","test","generateRandomPassword","length","charset","charLen","retVal","i","charAt","Math","floor","random","validatePasswordSettings","meetingPassword","isMeetingSecret","getVideoSettings","data","name","params","settings","type","expiresIn","getDefaultVideoSettings","topic","startTime","accountId","extensionId","allowJoinBeforeHost","muteAudio","muteVideo","isOnlyAuthUserJoin","isOnlyCoworkersJoin","allowScreenSharing","waitingRoomMode","RCV_WAITING_ROOM_MODE","off","settingLock","duration","saveAsDefault","isMeetingPasswordValid","usePersonalMeetingId","getTopic","extensionName","brandName","currentLocale","i18n","getString","pruneMeetingObject","transformPreferences","preferences","isInstantMeeting","join_before_host","password_instant","password_scheduled","guest_join","join_authenticated_from_account_only","screen_sharing_host_only","waiting_room","waiting_room_guests_only","transformSettingLocks","settingLocks","reversePreferences","result","RCV_WAITING_ROOM_MODE_REVERSE","prunePreferencesObject","comparePreferences","preferencesChanged","Object","keys","key","settingKey","assignValue","a","b","assignObject","getLockedPreferences","lockedPreferences","entries","locked","getAvaliableWaitingRoomOpions","all","notcoworker","patchWaitingRoomRelated","isUpdatingMode","processedSettings","includes"],"mappings":"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","sourcesContent":["import { pick } from 'ramda';\nimport formatMessage from 'format-message';\nimport i18n from './i18n';\nimport {\n  MeetingProviderTypesProps,\n  RcVideoTypesProps,\n  RcVMeetingModel,\n  RcvGSuiteMeetingModel,\n  RcVideoAPI,\n  RcVSettingId,\n  RcVPreferencesGET,\n  RcVSettingLocksGET,\n  RcVSettingKey,\n  RcVPreferences,\n  RcVSettingLocks,\n} from '../../interfaces/Rcv.model';\nimport {\n  RCV_WAITING_ROOM_MODE,\n  RCV_WAITING_ROOM_MODE_REVERSE,\n} from './constants';\n\n/* TODO: this meetingProviderTypes is only used for calender-addon\n * if you want to use meetingProviderTypes\n * please turn to use MeetingProvider/interface\n */\nconst meetingProviderTypes: MeetingProviderTypesProps = {\n  meeting: 'RCMeetings',\n  video: 'RCVideo',\n};\n\nconst RcVideoTypes: RcVideoTypesProps = {\n  meeting: 0, // schedule\n  call: 1, // instant meeting\n};\n\nconst RCV_PASSWORD_REGEX = /^[A-Za-z0-9]{1,10}$/;\nconst RCV_WAITTING_ROOM_API_KEYS = 'waitingRoomMode';\nconst RCV_CREATE_API_KEYS: Array<keyof RcVideoAPI> = [\n  'name',\n  'type',\n  'startTime',\n  'expiresIn',\n  'duration',\n  'accountId',\n  'extensionId',\n  'allowJoinBeforeHost',\n  'muteAudio',\n  'muteVideo',\n  'isMeetingSecret',\n  'meetingPassword',\n  'isOnlyAuthUserJoin',\n  'isOnlyCoworkersJoin',\n  'allowScreenSharing',\n  RCV_WAITTING_ROOM_API_KEYS,\n];\n\nconst RCV_PREFERENCES_IDS: Array<RcVSettingId> = [\n  'join_before_host',\n  // 'join_video_off',\n  // 'join_audio_mute',\n  'password_scheduled',\n  'password_instant',\n  'guest_join',\n  'join_authenticated_from_account_only',\n  'screen_sharing_host_only',\n  'waiting_room_guests_only',\n  'waiting_room',\n];\nconst RCV_PREFERENCES_KEYS: Array<RcVSettingKey> = [\n  'allowJoinBeforeHost',\n  // 'muteVideo',\n  // 'muteAudio',\n  'isMeetingSecret',\n  'isOnlyAuthUserJoin',\n  'isOnlyCoworkersJoin',\n  'allowScreenSharing',\n  RCV_WAITTING_ROOM_API_KEYS,\n];\n\n/* RCINT-14566\n * Exclude characters that are hard to visually differentiate [\"0\", \"o\", \"O\", \"I\", \"l\"]\n */\nfunction getDefaultChars(): string {\n  const DEFAULT_PASSWORD_CHARSET =\n    'abcdefghijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ123456789';\n  return DEFAULT_PASSWORD_CHARSET;\n}\n\nfunction validateRandomPassword(pwd: string): boolean {\n  return /^(?=.*\\d)(?=.*[A-Z])(?=.*[a-z])[A-Za-z0-9]*$/.test(pwd);\n}\n\nfunction generateRandomPassword(length: number = 10): string {\n  const charset = getDefaultChars();\n  const charLen = charset.length;\n  let retVal = '';\n  for (let i = 0; i < length; i++) {\n    retVal += charset.charAt(Math.floor(Math.random() * charLen));\n  }\n  if (!validateRandomPassword(retVal)) {\n    return generateRandomPassword(length);\n  }\n  return retVal;\n}\n\nfunction validatePasswordSettings(\n  meetingPassword: string,\n  isMeetingSecret: boolean,\n): boolean {\n  if (!isMeetingSecret) {\n    return true;\n  }\n  if (meetingPassword && RCV_PASSWORD_REGEX.test(meetingPassword)) {\n    return true;\n  }\n  return false;\n}\n\n// gsuite\nfunction getVideoSettings(data: RcVideoAPI): RcvGSuiteMeetingModel {\n  const {\n    name = 'Scheduled meeting',\n    isMeetingSecret,\n    meetingPassword,\n    ...params\n  } = data;\n  const settings: RcvGSuiteMeetingModel = {\n    ...params,\n    name,\n    type: RcVideoTypes.meeting,\n    expiresIn: 31536000,\n  };\n\n  if (isMeetingSecret) {\n    settings.isMeetingSecret = true;\n    settings.meetingPassword = meetingPassword;\n  } else {\n    settings.isMeetingSecret = false;\n    settings.meetingPassword = '';\n  }\n\n  return settings;\n}\n\nfunction getDefaultVideoSettings({\n  topic,\n  startTime,\n  accountId,\n  extensionId,\n}: {\n  topic: string;\n  startTime: Date;\n  accountId: string;\n  extensionId: string;\n}): RcVMeetingModel {\n  return {\n    // api fields\n    accountId,\n    extensionId,\n    name: topic,\n    type: RcVideoTypes.meeting,\n    expiresIn: 31536000,\n    allowJoinBeforeHost: false,\n    muteAudio: false,\n    muteVideo: false,\n    isMeetingSecret: true,\n    meetingPassword: '',\n    isOnlyAuthUserJoin: false,\n    isOnlyCoworkersJoin: false,\n    allowScreenSharing: true,\n    waitingRoomMode: RCV_WAITING_ROOM_MODE.off,\n    settingLock: {\n      allowJoinBeforeHost: false,\n      // muteVideo: false,\n      // muteAudio: false,\n      isMeetingSecret: false,\n      isOnlyAuthUserJoin: false,\n      isOnlyCoworkersJoin: false,\n      allowScreenSharing: false,\n      waitingRoomMode: false,\n    },\n    // ui fields\n    startTime,\n    duration: 60,\n    saveAsDefault: false,\n    isMeetingPasswordValid: false,\n    usePersonalMeetingId: false,\n  };\n}\n\nfunction getTopic(\n  extensionName: string,\n  brandName: string,\n  currentLocale: string,\n) {\n  if (brandName === 'RingCentral') {\n    return formatMessage(i18n.getString('videoMeeting', currentLocale), {\n      extensionName,\n    });\n  }\n  return formatMessage(i18n.getString('videoMeetingWithBrand', currentLocale), {\n    extensionName,\n    brandName,\n  });\n}\n\n/**\n * Remove client side properties before sending to RCV API\n */\nfunction pruneMeetingObject(meeting: RcVMeetingModel): RcVideoAPI {\n  return pick(RCV_CREATE_API_KEYS, meeting);\n}\n\nfunction transformPreferences(\n  preferences: RcVPreferencesGET,\n  isInstantMeeting = false,\n): RcVPreferences {\n  return {\n    allowJoinBeforeHost: preferences.join_before_host,\n    // muteVideo: preferences.join_video_off,\n    // muteAudio: preferences.join_audio_mute,\n    isMeetingSecret: isInstantMeeting\n      ? preferences.password_instant\n      : preferences.password_scheduled,\n    isOnlyAuthUserJoin: preferences.guest_join,\n    isOnlyCoworkersJoin: preferences.guest_join\n      ? preferences.join_authenticated_from_account_only === 'only_co_workers'\n      : false,\n    allowScreenSharing: preferences.screen_sharing_host_only === 'all',\n    waitingRoomMode: preferences.waiting_room\n      ? RCV_WAITING_ROOM_MODE[preferences.waiting_room_guests_only]\n      : RCV_WAITING_ROOM_MODE.off,\n  };\n}\n\nfunction transformSettingLocks(\n  settingLocks: RcVSettingLocksGET,\n  isInstantMeeting = false,\n): RcVSettingLocks {\n  return {\n    allowJoinBeforeHost: settingLocks.join_before_host,\n    // muteVideo: settingLocks.join_video_off,\n    // muteAudio: settingLocks.join_audio_mute,\n    isMeetingSecret: isInstantMeeting\n      ? settingLocks.password_instant\n      : settingLocks.password_scheduled,\n    isOnlyAuthUserJoin: settingLocks.guest_join,\n    isOnlyCoworkersJoin: settingLocks.join_authenticated_from_account_only,\n    allowScreenSharing: settingLocks.screen_sharing_host_only,\n    waitingRoomMode: settingLocks.waiting_room,\n  };\n}\n\nfunction reversePreferences(\n  preferences: RcVPreferences,\n  isInstantMeeting = false,\n): Partial<RcVPreferencesGET> {\n  const result: Partial<RcVPreferencesGET> = {\n    join_before_host: preferences.allowJoinBeforeHost,\n    // join_video_off: preferences.muteVideo,\n    // join_audio_mute: preferences.muteAudio,\n    guest_join: preferences.isOnlyAuthUserJoin,\n    join_authenticated_from_account_only: preferences.isOnlyCoworkersJoin\n      ? 'only_co_workers'\n      : 'anyone_signed_into_rc',\n    screen_sharing_host_only: preferences.allowScreenSharing ? 'all' : 'host',\n    waiting_room: !!preferences.waitingRoomMode,\n    waiting_room_guests_only:\n      RCV_WAITING_ROOM_MODE_REVERSE[preferences.waitingRoomMode],\n  };\n  if (isInstantMeeting) {\n    result.password_instant = preferences.isMeetingSecret;\n  } else {\n    result.password_scheduled = preferences.isMeetingSecret;\n  }\n  return result;\n}\n\n/**\n * Reserve only preferences fields\n */\nfunction prunePreferencesObject(meeting: RcVMeetingModel): RcVPreferences {\n  return pick(RCV_PREFERENCES_KEYS, meeting);\n}\n\nfunction comparePreferences(\n  preferences: RcVPreferences,\n  meeting: RcVMeetingModel,\n): boolean {\n  let preferencesChanged = false;\n  if (preferences && meeting) {\n    for (const key of Object.keys(preferences)) {\n      const settingKey = key as RcVSettingKey;\n      if (preferences[settingKey] !== meeting[settingKey]) {\n        preferencesChanged = true;\n        break;\n      }\n    }\n  }\n  return preferencesChanged;\n}\n\nfunction assignValue<T, K extends keyof T>(a: T, b: T, key: K) {\n  a[key] = b[key];\n}\n\nfunction assignObject<T, P extends T[K], K extends keyof T>(\n  a: T,\n  b: P,\n  key: K,\n) {\n  a[key] = b;\n}\n\nfunction getLockedPreferences(\n  settingLocks: RcVSettingLocks,\n  preferences: RcVPreferences,\n): Partial<RcVPreferences> {\n  const lockedPreferences: Partial<RcVPreferences> = {};\n  for (const [key, locked] of Object.entries(settingLocks)) {\n    if (locked) {\n      const settingKey = key as RcVSettingKey;\n      assignValue(lockedPreferences, preferences, settingKey);\n    }\n  }\n  return lockedPreferences;\n}\n\nfunction getAvaliableWaitingRoomOpions(\n  isOnlyCoworkersJoin: boolean,\n): Array<number> {\n  return isOnlyCoworkersJoin\n    ? [RCV_WAITING_ROOM_MODE.off, RCV_WAITING_ROOM_MODE.all]\n    : [\n        RCV_WAITING_ROOM_MODE.off,\n        RCV_WAITING_ROOM_MODE.all,\n        RCV_WAITING_ROOM_MODE.notcoworker,\n      ];\n}\n\nfunction patchWaitingRoomRelated(\n  settings: RcVMeetingModel,\n  { waitingRoomMode }: RcVPreferences,\n  isUpdatingMode: boolean = false,\n): Partial<RcVMeetingModel> {\n  const processedSettings: Partial<RcVMeetingModel> = {};\n  if (settings.isOnlyAuthUserJoin) {\n    // for pmi setting, waitingRoom, joinAfterMe option maybe not avaliable\n    if (\n      !getAvaliableWaitingRoomOpions(settings.isOnlyCoworkersJoin).includes(\n        settings.waitingRoomMode,\n      )\n    ) {\n      processedSettings.waitingRoomMode = isUpdatingMode\n        ? RCV_WAITING_ROOM_MODE.all\n        : waitingRoomMode;\n    }\n  }\n  // when waitingRoom is 'everyone', joinAfterMe should be always checked\n  if (\n    (processedSettings.waitingRoomMode === RCV_WAITING_ROOM_MODE.all ||\n      settings.waitingRoomMode === RCV_WAITING_ROOM_MODE.all) &&\n    settings.allowJoinBeforeHost\n  ) {\n    processedSettings.allowJoinBeforeHost = false;\n  }\n  return processedSettings;\n}\n\n// TODO: will remove this when google app script could support export seperately\n// export together because google app script not fully support export\nexport {\n  RCV_PASSWORD_REGEX,\n  RCV_PREFERENCES_IDS,\n  RCV_PREFERENCES_KEYS,\n  RCV_WAITTING_ROOM_API_KEYS,\n  RcVideoTypes,\n  meetingProviderTypes,\n  RCV_WAITING_ROOM_MODE,\n  assignObject,\n  getDefaultChars,\n  validateRandomPassword,\n  generateRandomPassword,\n  validatePasswordSettings,\n  getVideoSettings,\n  getDefaultVideoSettings,\n  getTopic,\n  pruneMeetingObject,\n  transformPreferences,\n  reversePreferences,\n  prunePreferencesObject,\n  comparePreferences,\n  transformSettingLocks,\n  getLockedPreferences,\n  patchWaitingRoomRelated,\n};\n"],"file":"videoHelper.js"}