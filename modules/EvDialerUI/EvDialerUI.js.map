{"version":3,"sources":["modules/EvDialerUI/EvDialerUI.ts"],"names":["EvDialerUI","name","deps","dep","optional","that","_deps","evCall","dialoutStatus","evIntegratedSoftphone","connectingAlertId","enableCache","storageKey","value","toNumber","latestDialoutNumber","evCallMonitor","calls","call","isPendingDisposition","evWorkingState","id","callLogsIds","evClient","encodeUii","session","evAgentSession","isConfigTab","routerInteraction","push","currentLocale","locale","size","environment","isWide","hasDialer","evAuth","agentPermissions","allowManualCalls","dialButtonDisabled","setToNumber","dialout","setLatestDialoutNumber","goToManualDialSettings","checkOnCall","hangup","evSettings","isManualOffhook","offhookTerm","RcUIModuleV2","storage","state","action"],"mappings":"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","sourcesContent":["import {\n  action,\n  computed,\n  RcUIModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\nimport { Module } from 'ringcentral-integration/lib/di';\n\nimport {\n  EvDialerUIFunctions,\n  EvDialerUIProps,\n} from '../../interfaces/EvDialerUI.interface';\nimport { Deps, DialerUI } from './EvDialerUI.interface';\n\n@Module({\n  name: 'EvDialerUI',\n  deps: [\n    'EvCall',\n    'Locale',\n    'Storage',\n    'EvAuth',\n    'RouterInteraction',\n    'EvSettings',\n    'EvClient',\n    'EvCallMonitor',\n    'EvWorkingState',\n    'EvAgentSession',\n    'EvIntegratedSoftphone',\n    'Environment',\n    { dep: 'EvDialerUIOptions', optional: true },\n  ],\n})\nclass EvDialerUI extends RcUIModuleV2<Deps> implements DialerUI {\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvDialerUI',\n    });\n  }\n\n  @storage\n  @state\n  toNumber = '';\n\n  @storage\n  @state\n  latestDialoutNumber = '';\n\n  @action\n  setToNumber(value: string) {\n    this.toNumber = value;\n  }\n\n  @action\n  setLatestDialoutNumber() {\n    this.latestDialoutNumber = this.toNumber;\n  }\n\n  @computed((that: EvDialerUI) => [\n    that._deps.evCall.dialoutStatus,\n    that._deps.evIntegratedSoftphone.connectingAlertId,\n  ])\n  get dialButtonDisabled() {\n    return (\n      this._deps.evCall.dialoutStatus === 'dialing' ||\n      !!this._deps.evIntegratedSoftphone.connectingAlertId\n    );\n  }\n\n  checkOnCall() {\n    // onCall or not yet disposed call, it should navigate to the `activityCallLog/:id` router.\n    const [call] = this._deps.evCallMonitor.calls;\n    const { isPendingDisposition } = this._deps.evWorkingState;\n    let id: string;\n    if (isPendingDisposition) {\n      id = this._deps.evCallMonitor.callLogsIds[0];\n    }\n    if (call) {\n      id = this._deps.evClient.encodeUii(call.session);\n    }\n    if (id && this._deps.evAgentSession.isConfigTab) {\n      this._deps.routerInteraction.push(`/activityCallLog/${id}`);\n    }\n  }\n\n  getUIProps(): EvDialerUIProps {\n    return {\n      toNumber: this.toNumber,\n      currentLocale: this._deps.locale.currentLocale,\n      size: this._deps.environment.isWide ? 'medium' : 'small',\n      dialoutStatus: this._deps.evCall.dialoutStatus,\n      hasDialer: this._deps.evAuth.agentPermissions.allowManualCalls,\n      dialButtonDisabled: this.dialButtonDisabled,\n    };\n  }\n\n  getUIFunctions(): EvDialerUIFunctions {\n    return {\n      setToNumber: (value: string) => this.setToNumber(value),\n      dialout: async () => {\n        if (this.toNumber) {\n          this.setLatestDialoutNumber();\n          await this._deps.evCall.dialout(this.toNumber);\n        } else {\n          this.setToNumber(this.latestDialoutNumber);\n        }\n      },\n      goToManualDialSettings: () => {\n        this._deps.routerInteraction.push('/manualDialSettings');\n      },\n      checkOnCall: () => this.checkOnCall(),\n      hangup: () => {\n        if (!this._deps.evSettings.isManualOffhook) {\n          this._deps.evClient.offhookTerm();\n        }\n      },\n    };\n  }\n}\n\nexport { EvDialerUI };\n"],"file":"EvDialerUI.js"}