{"version":3,"sources":["modules/Conversations/index.js"],"names":["mergeMessages","messages","oldMessages","tmp","currentMessages","forEach","element","push","id","getEarliestTime","newTime","Date","now","message","creationTime","getTime","getUniqueNumbers","conversations","output","numberMap","addIfNotExist","number","from","direction","messageDirection","inbound","fromNumber","phoneNumber","extensionNumber","to","length","outbound","toNumber","toPhoneNumber","DEFAULT_PER_PAGE","DEFAULT_DAY_SPAN","Conversations","deps","dep","optional","alert","auth","client","messageSender","extensionInfo","messageStore","rolesAndPermissions","contactMatcher","conversationLogger","regionSettings","perPage","daySpan","enableLoadOldMessages","showMMSAttachment","options","actionTypes","_auth","ensureExist","_alert","_client","_messageSender","_extensionInfo","_messageStore","_rolesAndPermissions","_contactMatcher","_conversationLogger","_regionSettings","_reducer","_promise","_lastProcessedNumbers","_perPage","_daySpan","_olderDataExsited","_olderMessagesExsited","_enableLoadOldMessages","_showMMSAttachment","_lastConversaionList","on","send","toNumbers","addEntities","addQuerySource","getQueriesFn","uniqueNumbers","readyCheckFn","ready","store","subscribe","_onStateChange","_shouldInit","_init","_shouldReset","_reset","allUniqueNumbers","_lastProcessedPage","currentPage","_lastTypeFilter","typeFilter","_lastSearchString","effectiveSearchString","triggerMatch","allConversations","oldConversations","dispatch","type","cleanOldConversatioans","loggedIn","pending","init","initSuccess","_hasPermission","fetchOldConversations","resetSuccess","input","updateSearchInput","updateTypeFilter","pagingConversations","loadNextPage","loadingOldConversations","fetchOldConverstaions","dateFrom","setDate","getDate","dateTo","earliestTime","params","distinctConversations","toISOString","messageTypes","text","messageType","sms","pager","all","account","extension","list","records","recordsLength","isIncreaseCurrentPage","filteredConversations","fetchOldConverstaionsSuccess","fetchOldConverstaionsError","increaseCurrentPage","resetCurrentPage","conversationId","currentConversationId","updateCurrentConversationId","loadingOldMessages","fetchOldMessages","currentConversation","fetchOldMessagesSuccess","fetchOldMessagesError","ttlConfig","messageSenderMessages","noAreaCode","ttl","warning","_alertWarning","textTooLong","updateMessageText","reply","_getFromNumber","_getToNumbers","replyOnMessageId","_getReplyOnMessageId","responses","pushMessage","replySuccess","removeMessageText","_onReplyError","error","replyError","messageList","lastMessage","senderNumber","recipients","map","recipient","conversationStore","deleteConversationMessages","conversation","find","c","deleteCoversation","deleteMessageApi","deleteConversation","console","entities","entity","removeEntity","addResponses","removeResponse","correspondentMatch","countryCode","areaCode","formattedCorrespondentMatch","item","formatted","rawId","correspondentResponse","logConversation","state","status","searchInput","fetchConversationsStatus","fetchMessagesStatus","fetching","conversationStatus","pushing","hasReadMessagesPermission","RcModule","proxify","selector","newConversations","conversationMap","pushConversation","cid","filter","messageIsTextMessage","voiceMail","messageIsVoicemail","fax","messageIsFax","readTextPermissions","voicemailPermissions","readFaxPermissions","typeFilteredConversations","dataMapping","loggingMap","accessToken","contactMapping","conversationLogMapping","self","correspondents","selfNumber","selfMatches","correspondentMatches","reduce","matches","contact","concat","conversationLogId","getConversationLogId","isLogging","conversationMatches","voicemailAttachment","faxAttachment","unreadCounts","mmsAttachment","subject","lastMatchedCorrespondentEntity","getLastMatchedCorrespondentEntity","formatedConversations","searchResults","cleanRegex","searchString","toLowerCase","searchNumber","replace","cleanedNumber","indexOf","matchOrder","name","matchedMessage","sort","sortSearchResults","pageNumber","lastIndex","slice","allMessages","m","reverse","myExtensionNumber","myNumber","messageTexts","res","msg"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AAcA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,SAASA,aAAT,CAAuBC,QAAvB,EAAiCC,WAAjC,EAA8C;AAC5C,MAAMC,GAAG,GAAG,EAAZ;AACA,MAAMC,eAAe,GAAG,EAAxB;AACAH,EAAAA,QAAQ,CAACI,OAAT,CAAiB,UAACC,OAAD,EAAa;AAC5BF,IAAAA,eAAe,CAACG,IAAhB,CAAqBD,OAArB;AACAH,IAAAA,GAAG,CAACG,OAAO,CAACE,EAAT,CAAH,GAAkB,CAAlB;AACD,GAHD;AAKAN,EAAAA,WAAW,CAACG,OAAZ,CAAoB,UAACC,OAAD,EAAa;AAC/B,QAAI,CAACH,GAAG,CAACG,OAAO,CAACE,EAAT,CAAR,EAAsB;AACpBJ,MAAAA,eAAe,CAACG,IAAhB,CAAqBD,OAArB;AACD;AACF,GAJD;AAKA,SAAOF,eAAP;AACD;;AAED,SAASK,eAAT,CAAyBR,QAAzB,EAAmC;AACjC,MAAIS,OAAO,GAAGC,IAAI,CAACC,GAAL,EAAd;AACAX,EAAAA,QAAQ,CAACI,OAAT,CAAiB,UAACQ,OAAD,EAAa;AAC5B,QAAMC,YAAY,GAAG,IAAIH,IAAJ,CAASE,OAAO,CAACC,YAAjB,EAA+BC,OAA/B,EAArB;;AACA,QAAID,YAAY,GAAGJ,OAAnB,EAA4B;AAC1BA,MAAAA,OAAO,GAAGI,YAAV;AACD;AACF,GALD;AAMA,SAAOJ,OAAP;AACD;;AAED,SAASM,gBAAT,CAA0BC,aAA1B,EAAyC;AACvC,MAAMC,MAAM,GAAG,EAAf;AACA,MAAMC,SAAS,GAAG,EAAlB;;AACA,WAASC,aAAT,CAAuBC,MAAvB,EAA+B;AAC7B,QAAIA,MAAM,IAAI,CAACF,SAAS,CAACE,MAAD,CAAxB,EAAkC;AAChCH,MAAAA,MAAM,CAACX,IAAP,CAAYc,MAAZ;AACAF,MAAAA,SAAS,CAACE,MAAD,CAAT,GAAoB,IAApB;AACD;AACF;;AACDJ,EAAAA,aAAa,CAACZ,OAAd,CAAsB,UAACQ,OAAD,EAAa;AACjC,QAAIA,OAAO,CAACS,IAAR,IAAgBT,OAAO,CAACU,SAAR,KAAsBC,6BAAiBC,OAA3D,EAAoE;AAClE,UAAMC,UAAU,GACdb,OAAO,CAACS,IAAR,CAAaK,WAAb,IAA4Bd,OAAO,CAACS,IAAR,CAAaM,eAD3C;AAEAR,MAAAA,aAAa,CAACM,UAAD,CAAb;AACD;;AACD,QACEb,OAAO,CAACgB,EAAR,IACAhB,OAAO,CAACgB,EAAR,CAAWC,MAAX,GAAoB,CADpB,IAEAjB,OAAO,CAACU,SAAR,KAAsBC,6BAAiBO,QAHzC,EAIE;AACAlB,MAAAA,OAAO,CAACgB,EAAR,CAAWxB,OAAX,CAAmB,UAAC2B,QAAD,EAAc;AAC/B,YAAI,CAACA,QAAL,EAAe;AACb;AACD;;AACD,YAAMC,aAAa,GAAGD,QAAQ,CAACL,WAAT,IAAwBK,QAAQ,CAACJ,eAAvD;AACAR,QAAAA,aAAa,CAACa,aAAD,CAAb;AACD,OAND;AAOD;AACF,GAnBD;AAoBA,SAAOf,MAAP;AACD;;AAED,IAAMgB,gBAAgB,GAAG,EAAzB;AACA,IAAMC,gBAAgB,GAAG,EAAzB;IAgBqBC,a,WAfpB,gBAAO;AACNC,EAAAA,IAAI,EAAE,CACJ,OADI,EAEJ,MAFI,EAGJ,QAHI,EAIJ,eAJI,EAKJ,eALI,EAMJ,cANI,EAOJ,qBAPI,EAQJ;AAAEC,IAAAA,GAAG,EAAE,gBAAP;AAAyBC,IAAAA,QAAQ,EAAE;AAAnC,GARI,EASJ;AAAED,IAAAA,GAAG,EAAE,gBAAP;AAAyBC,IAAAA,QAAQ,EAAE;AAAnC,GATI,EAUJ;AAAED,IAAAA,GAAG,EAAE,oBAAP;AAA6BC,IAAAA,QAAQ,EAAE;AAAvC,GAVI,EAWJ;AAAED,IAAAA,GAAG,EAAE,sBAAP;AAA+BC,IAAAA,QAAQ,EAAE;AAAzC,GAXI;AADA,CAAP,C;;;;;AAgBC,+BAgBG;AAAA;;AAAA;;AAAA,QAfDC,KAeC,QAfDA,KAeC;AAAA,QAdDC,IAcC,QAdDA,IAcC;AAAA,QAbDC,MAaC,QAbDA,MAaC;AAAA,QAZDC,aAYC,QAZDA,aAYC;AAAA,QAXDC,aAWC,QAXDA,aAWC;AAAA,QAVDC,YAUC,QAVDA,YAUC;AAAA,QATDC,mBASC,QATDA,mBASC;AAAA,QARDC,cAQC,QARDA,cAQC;AAAA,QAPDC,kBAOC,QAPDA,kBAOC;AAAA,QANDC,cAMC,QANDA,cAMC;AAAA,4BALDC,OAKC;AAAA,QALDA,OAKC,6BALShB,gBAKT;AAAA,4BAJDiB,OAIC;AAAA,QAJDA,OAIC,6BAJShB,gBAIT;AAAA,qCAHDiB,qBAGC;AAAA,QAHDA,qBAGC,sCAHuB,KAGvB;AAAA,qCAFDC,iBAEC;AAAA,QAFDA,iBAEC,sCAFmB,KAEnB;AAAA,QADEC,OACF;;AAAA;;AACD,yGACKA,OADL;AAEEC,MAAAA,WAAW,EAAXA;AAFF;;AADC;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAKD,UAAKC,KAAL,GAAa,2CAAMC,uBAAN,iBAAkBhB,IAAlB,EAAwB,MAAxB,CAAb;AACA,UAAKiB,MAAL,GAAc,2CAAMD,uBAAN,iBAAkBjB,KAAlB,EAAyB,OAAzB,CAAd;AACA,UAAKmB,OAAL,GAAe,2CAAMF,uBAAN,iBAAkBf,MAAlB,EAA0B,QAA1B,CAAf;AACA,UAAKkB,cAAL,GAAsB,2CAAMH,uBAAN,iBAAkBd,aAAlB,EAAiC,eAAjC,CAAtB;AACA,UAAKkB,cAAL,GAAsB,2CAAMJ,uBAAN,iBAAkBb,aAAlB,EAAiC,eAAjC,CAAtB;AACA,UAAKkB,aAAL,GAAqB,2CAAML,uBAAN,iBAAkBZ,YAAlB,EAAgC,cAAhC,CAArB;AACA,UAAKkB,oBAAL,GAA4B,2CAAMN,uBAAN,iBAC1BX,mBAD0B,EAE1B,qBAF0B,CAA5B;AAIA,UAAKkB,eAAL,GAAuBjB,cAAvB;AACA,UAAKkB,mBAAL,GAA2BjB,kBAA3B;AACA,UAAKkB,eAAL,GAAuBjB,cAAvB;AAEA,UAAKkB,QAAL,GAAgB,4BAAW,MAAKZ,WAAhB,CAAhB;AAEA,UAAKa,QAAL,GAAgB,IAAhB;AACA,UAAKC,qBAAL,GAA6B,IAA7B;AACA,UAAKC,QAAL,GAAgBpB,OAAhB;AACA,UAAKqB,QAAL,GAAgBpB,OAAhB;AACA,UAAKqB,iBAAL,GAAyB,IAAzB;AACA,UAAKC,qBAAL,GAA6B,IAA7B;AACA,UAAKC,sBAAL,GAA8BtB,qBAA9B;AACA,UAAKuB,kBAAL,GAA0BtB,iBAA1B;AACA,UAAKuB,oBAAL,GAA4B,EAA5B;;AAEA,UAAKhB,cAAL,CAAoBiB,EAApB,CACE,MAAKjB,cAAL,CAAoBL,WAApB,CAAgCuB,IADlC,EAEE,iBAAmB;AAAA,UAAhBC,SAAgB,SAAhBA,SAAgB;;AACjB,YAAKC,WAAL,CAAiBD,SAAjB;AACD,KAJH;;AAOA,QAAI,MAAKf,eAAT,EAA0B;AACxB,YAAKA,eAAL,CAAqBiB,cAArB,CAAoC;AAClCC,QAAAA,YAAY,EAAE;AAAA,iBAAM,MAAKC,aAAX;AAAA,SADoB;AAElCC,QAAAA,YAAY,EAAE;AAAA,iBAAM,MAAKtB,aAAL,CAAmBuB,KAAzB;AAAA;AAFoB,OAApC;AAID;;AA3CA;AA4CF;;;;iCAEY;AAAA;;AACX,WAAKC,KAAL,CAAWC,SAAX,CAAqB;AAAA,eAAM,MAAI,CAACC,cAAL,EAAN;AAAA,OAArB;AACD;;;qCAEgB;AACf,UAAI,KAAKC,WAAL,EAAJ,EAAwB;AACtB,aAAKC,KAAL;AACD,OAFD,MAEO,IAAI,KAAKC,YAAL,EAAJ,EAAyB;AAC9B,aAAKC,MAAL;AACD,OAFM,MAEA,IACL,KAAKvB,qBAAL,KAA+B,KAAKwB,gBAApC,IACA,KAAKC,kBAAL,KAA4B,KAAKC,WADjC,IAEA,KAAKC,eAAL,KAAyB,KAAKC,UAF9B,IAGA,KAAKC,iBAAL,KAA2B,KAAKC,qBAJ3B,EAKL;AACA,aAAK9B,qBAAL,GAA6B,KAAKwB,gBAAlC;AACA,aAAKC,kBAAL,GAA0B,KAAKC,WAA/B;AACA,aAAKC,eAAL,GAAuB,KAAKC,UAA5B;AACA,aAAKC,iBAAL,GAAyB,KAAKC,qBAA9B;;AACA,YAAI,KAAKnC,eAAT,EAA0B;AACxB,eAAKA,eAAL,CAAqBoC,YAArB;AACD;AACF,OAbM,MAaA,IACL,KAAKxB,oBAAL,CAA0B9C,MAA1B,GACA,KAAKgC,aAAL,CAAmBuC,gBAAnB,CAAoCvE,MAF/B,EAGL;AACA,aAAK8C,oBAAL,GAA4B,KAAKd,aAAL,CAAmBuC,gBAA/C;;AACA,YAAI,KAAKC,gBAAL,CAAsBxE,MAA1B,EAAkC;AAChC,eAAKwD,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,YAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBkD;AADL,WAApB;AAGA,eAAKjC,iBAAL,GAAyB,IAAzB;AACD;AACF,OAXM,MAWA,IACL,KAAKI,oBAAL,CAA0B9C,MAA1B,GACA,KAAKgC,aAAL,CAAmBuC,gBAAnB,CAAoCvE,MAF/B,EAGL;AACA,aAAK8C,oBAAL,GAA4B,KAAKd,aAAL,CAAmBuC,gBAA/C;AACD;AACF;;;kCAEa;AACZ,aACE,KAAK7C,KAAL,CAAWkD,QAAX,IACA,KAAK7C,cAAL,CAAoBwB,KADpB,IAEA,KAAKzB,cAAL,CAAoByB,KAFpB,IAGA,KAAKvB,aAAL,CAAmBuB,KAHnB,IAIA,KAAKtB,oBAAL,CAA0BsB,KAJ1B,KAKC,CAAC,KAAKrB,eAAN,IAAyB,KAAKA,eAAL,CAAqBqB,KAL/C,MAMC,CAAC,KAAKpB,mBAAN,IAA6B,KAAKA,mBAAL,CAAyBoB,KANvD,KAOA,KAAKsB,OARP;AAUD;;;mCAEc;AACb,aACE,CAAC,CAAC,KAAKnD,KAAL,CAAWkD,QAAZ,IACC,CAAC,KAAK7C,cAAL,CAAoBwB,KADtB,IAEC,CAAC,KAAKzB,cAAL,CAAoByB,KAFtB,IAGC,CAAC,KAAKtB,oBAHP,IAIC,CAAC,KAAKD,aAAL,CAAmBuB,KAJrB,IAKE,KAAKrB,eAAL,IAAwB,CAAC,KAAKA,eAAL,CAAqBqB,KALhD,IAME,KAAKpB,mBAAL,IAA4B,CAAC,KAAKA,mBAAL,CAAyBoB,KANzD,KAOA,KAAKA,KARP;AAUD;;;4BAEO;AACN,WAAKC,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBqD;AADL,OAApB;;AAGA,UAAI,KAAK5C,eAAT,EAA0B;AACxB,aAAKA,eAAL,CAAqBoC,YAArB;AACD;;AACD,WAAKd,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBsD;AADL,OAApB;AAGA,WAAKjC,oBAAL,GAA4B,KAAKd,aAAL,CAAmBuC,gBAA/C;;AACA,UACE,KAAKA,gBAAL,CAAsBvE,MAAtB,IAAgC,KAAKwC,QAArC,IACA,KAAKI,sBADL,IAEA,KAAKoC,cAHP,EAIE;AACA,aAAKC,qBAAL;AACD;AACF;;;6BAEQ;AACP,WAAK1C,qBAAL,GAA6B,IAA7B;AACA,WAAKG,iBAAL,GAAyB,IAAzB;AACA,WAAKC,qBAAL,GAA6B,IAA7B;AACA,WAAKa,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiByD;AADL,OAApB;AAGD;;;sCAGuBC,K;;;;;AACtB,mBAAK3B,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiB2D,iBADL;AAElBD,gBAAAA,KAAK,EAALA;AAFkB,eAApB;;;;;;;;;;;qCAOqBT,I;;;;;oBACjB,KAAKP,UAAL,KAAoBO,I;;;;;;;;AAGxB,mBAAKlB,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiB4D,gBADL;AAElBlB,gBAAAA,UAAU,EAAEO;AAFM,eAApB;AAIA,mBAAKhC,iBAAL,GAAyB,IAAzB;AACA,mBAAKC,qBAAL,GAA6B,IAA7B;;AACA,kBAAI,KAAK2C,mBAAL,CAAyBtF,MAAzB,IAAmC,KAAKwC,QAA5C,EAAsD;AACpD,qBAAK+C,YAAL;AACD;;;;;;;;;;;;;;;;;;kBAKI,KAAK7C,iB;;;;;;;;mBAGN,KAAK8C,uB;;;;;;;;AAGT,mBAAKhC,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBgE;AADL,eAApB;AAGIC,cAAAA,Q,GAAW,IAAI7G,IAAJ,E;AACf6G,cAAAA,QAAQ,CAACC,OAAT,CAAiBD,QAAQ,CAACE,OAAT,KAAqB,KAAKnD,QAA3C;AACMoD,cAAAA,M,GAAS,IAAIhH,IAAJ,CAAS,KAAKiH,YAAd,C;;AACf,kBAAID,MAAM,CAAC5G,OAAP,KAAmByG,QAAQ,CAACzG,OAAT,EAAvB,EAA2C;AACzCyG,gBAAAA,QAAQ,GAAG,IAAI7G,IAAJ,CAASgH,MAAM,CAAC5G,OAAP,KAAmB,OAAO,IAAP,GAAc,EAA1C,CAAX;AACD;;AACKkF,cAAAA,U,GAAa,KAAKA,U;AAClBF,cAAAA,W,GAAc,KAAKA,W;AACnB8B,cAAAA,M,GAAS;AACbC,gBAAAA,qBAAqB,EAAE,IADV;AAEb5E,gBAAAA,OAAO,EAAE,KAAKoB,QAFD;AAGbkD,gBAAAA,QAAQ,EAAEA,QAAQ,CAACO,WAAT,EAHG;AAIbJ,gBAAAA,MAAM,EAAEA,MAAM,CAACI,WAAP;AAJK,e;;AAMf,kBAAI9B,UAAU,KAAK+B,yBAAaC,IAAhC,EAAsC;AACpCJ,gBAAAA,MAAM,CAACK,WAAP,GAAqB,CAACF,yBAAaG,GAAd,EAAmBH,yBAAaI,KAAhC,CAArB;AACD,eAFD,MAEO,IACLnC,UAAU,IACVA,UAAU,KAAK,EADf,IAEAA,UAAU,KAAK+B,yBAAaK,GAHvB,EAIL;AACAR,gBAAAA,MAAM,CAACK,WAAP,GAAqBjC,UAArB;AACD;;;;8CAE2B,KAAKtC,OAAL,CACvB2E,OADuB,GAEvBC,SAFuB,GAGvB1F,YAHuB,GAIvB2F,IAJuB,CAIlBX,MAJkB,C;;;;AAAlBY,cAAAA,O,SAAAA,O;AAKFC,cAAAA,a,GAAgBD,OAAO,CAAC3G,M;AAC9B,mBAAK0C,iBAAL,GAAyBkE,aAAa,KAAK,KAAKpE,QAAhD;;AACA,kBAAI2B,UAAU,KAAK,KAAKA,UAApB,IAAkCF,WAAW,KAAK,KAAKA,WAA3D,EAAwE;AAChE4C,gBAAAA,qBADgE,GAEpED,aAAa,IACb,KAAKpE,QAAL,GAAgB,KAAKyB,WAArB,GACE2C,aAAa,GAAG,KAAKE,qBAAL,CAA2B9G,MAJuB;AAKtE,qBAAKwD,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBsF,4BADL;AAElBJ,kBAAAA,OAAO,EAAPA,OAFkB;AAGlBE,kBAAAA,qBAAqB,EAArBA;AAHkB,iBAApB;AAKD;;;;;;;;;AAED,kBAAI1C,UAAU,KAAK,KAAKA,UAApB,IAAkCF,WAAW,KAAK,KAAKA,WAA3D,EAAwE;AACtE,qBAAKT,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBuF;AADL,iBAApB;AAGD;;;;;;;;;;;;;;;;;AAMG/C,cAAAA,W,GAAc,KAAKA,W;;oBACrBA,WAAW,GAAG,KAAKzB,QAAnB,GAA8B,KAAKsE,qBAAL,CAA2B9G,M;;;;;AAC3D,mBAAKwD,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBwF;AADL,eAApB;;;;oBAKE,KAAK5C,qBAAL,KAA+B,E;;;;;;;;oBAG/B,CAAC,KAAKzB,sBAAN,IAAgC,CAAC,KAAKoC,c;;;;;;;;;8CAGpC,KAAKC,qBAAL,E;;;;;;;;;;;;;;;;AAKN,mBAAKzB,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiByF;AADL,eAApB;;;;;;;;;;;qCAMqBC,c;;;;;oBACjBA,cAAc,KAAK,KAAKC,qB;;;;;;;;AAG5B,mBAAK5D,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiB4F,2BADL;AAElBF,gBAAAA,cAAc,EAAdA;AAFkB,eAApB;;;;;;;;;;;;;;;;AAQA,mBAAK3D,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiB4F,2BADL;AAElBF,gBAAAA,cAAc,EAAE;AAFE,eAApB;AAIA,mBAAKxE,qBAAL,GAA6B,IAA7B;;;;;;;;;;;;;;;;;;;;;;;;;;AAIqBvB,cAAAA,O,8DAAU,KAAKoB,Q;;kBAC/B,KAAKI,sB;;;;;;;;kBAGL,KAAKoC,c;;;;;;;;kBAGL,KAAKrC,qB;;;;;;;;mBAGN,KAAK2E,kB;;;;;;;;kBAGJ,KAAKF,qB;;;;;;;;AAGV,mBAAK5D,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiB8F;AADL,eAApB;AAGMJ,cAAAA,c,GAAiB,KAAKC,qB;AACtB1B,cAAAA,Q,GAAW,IAAI7G,IAAJ,E;AACjB6G,cAAAA,QAAQ,CAACC,OAAT,CAAiBD,QAAQ,CAACE,OAAT,KAAqB,KAAKnD,QAA3C;AACMqD,cAAAA,Y,GAAenH,eAAe,CAAC,KAAK6I,mBAAL,CAAyBrJ,QAA1B,C;AAC9B0H,cAAAA,M,GAAS,IAAIhH,IAAJ,CAASiH,YAAT,C;;AACf,kBAAID,MAAM,CAAC5G,OAAP,KAAmByG,QAAQ,CAACzG,OAAT,EAAvB,EAA2C;AACzCyG,gBAAAA,QAAQ,CAACC,OAAT,CAAiBD,QAAQ,CAACE,OAAT,KAAqB,CAAtC;AACD;;AACKG,cAAAA,M,GAAS;AACboB,gBAAAA,cAAc,EAAdA,cADa;AAEb/F,gBAAAA,OAAO,EAAPA,OAFa;AAGbsE,gBAAAA,QAAQ,EAAEA,QAAQ,CAACO,WAAT,EAHG;AAIbJ,gBAAAA,MAAM,EAAEA,MAAM,CAACI,WAAP;AAJK,e;;;8CAOa,KAAKpE,OAAL,CACvB2E,OADuB,GAEvBC,SAFuB,GAGvB1F,YAHuB,GAIvB2F,IAJuB,CAIlBX,MAJkB,C;;;;AAAlBY,cAAAA,O,SAAAA,O;AAKR,mBAAKhE,qBAAL,GAA6BgE,OAAO,CAAC3G,MAAR,KAAmBoB,OAAhD;;AACA,kBAAI+F,cAAc,KAAK,KAAKC,qBAA5B,EAAmD;AACjD,qBAAK5D,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBgG,uBADL;AAElBd,kBAAAA,OAAO,EAAPA;AAFkB,iBAApB;AAID;;;;;;;;;AAED,kBAAIQ,cAAc,KAAK,KAAKC,qBAA5B,EAAmD;AACjD,qBAAK5D,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBiG;AADL,iBAApB;AAGD;;;;;;;;;;;kCAIS3I,O,EAAS;AACrB,UAAIA,OAAJ,EAAa;AACX,YAAM4I,SAAS,GACb5I,OAAO,KAAK6I,kCAAsBC,UAAlC,GAA+C;AAAEC,UAAAA,GAAG,EAAE;AAAP,SAA/C,GAA4D,IAD9D;;AAEA,aAAKlG,MAAL,CAAYmG,OAAZ;AACEhJ,UAAAA,OAAO,EAAPA;AADF,WAEK4I,SAFL;;AAIA,eAAO,IAAP;AACD;;AACD,aAAO,KAAP;AACD;;;sCAGuBxB,I;;;;;oBAClBA,IAAI,CAACnG,MAAL,GAAc,I;;;;;iDACT,KAAKgI,aAAL,CAAmBJ,kCAAsBK,WAAzC,C;;;iDAEF,KAAKzE,KAAL,CAAWiB,QAAX,CAAoB;AACzBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiByG,iBADE;AAEzB/B,gBAAAA,IAAI,EAAJA,IAFyB;AAGzBgB,gBAAAA,cAAc,EAAE,KAAKC;AAHI,eAApB,C;;;;;;;;;;;qCAQcjB,I;;;;;;AACrB,mBAAK3C,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiB0G;AADL,eAApB;;;8CAI0B,KAAKrG,cAAL,CAAoBkB,IAApB,CAAyB;AAC/CpD,gBAAAA,UAAU,EAAE,KAAKwI,cAAL,EADmC;AAE/CnF,gBAAAA,SAAS,EAAE,KAAKoF,aAAL,EAFoC;AAG/ClC,gBAAAA,IAAI,EAAJA,IAH+C;AAI/CmC,gBAAAA,gBAAgB,EAAE,KAAKC,oBAAL;AAJ6B,eAAzB,C;;;AAAlBC,cAAAA,S;;oBAMFA,SAAS,IAAIA,SAAS,CAAC,CAAD,C;;;;;AACxB,mBAAKxG,aAAL,CAAmByG,WAAnB,CAA+BD,SAAS,CAAC,CAAD,CAAxC;;AACA,mBAAKhF,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBiH;AADL,eAApB;AAGA,mBAAKlF,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBkH,iBADL;AAElBxB,gBAAAA,cAAc,EAAE,KAAKC;AAFH,eAApB;iDAIOoB,SAAS,CAAC,CAAD,C;;;AAElB,mBAAKI,aAAL;;iDACO,I;;;;;;AAEP,mBAAKA,aAAL;;;;;;;;;;;;;kCAKUC,K,EAAO;AACnB,WAAKrF,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBqH,UADL;AAElBD,QAAAA,KAAK,EAALA;AAFkB,OAApB;AAID;;;2CAEsB;AACrB,UAAME,WAAW,GAAG,KAAKvB,mBAAL,CAAyBrJ,QAA7C;AACA,UAAM6K,WAAW,GACfD,WAAW,IACXA,WAAW,CAAC/I,MAAZ,GAAqB,CADrB,IAEA+I,WAAW,CAACA,WAAW,CAAC/I,MAAZ,GAAqB,CAAtB,CAHb;;AAIA,UAAIgJ,WAAW,IAAIA,WAAW,CAACtK,EAA/B,EAAmC;AACjC,eAAOsK,WAAW,CAACtK,EAAnB;AACD;;AACD,aAAO,IAAP;AACD;;;qCAEgB;AACf,UAAMuK,YAAY,GAAG,KAAKzB,mBAAL,CAAyByB,YAA9C;;AACA,UAAI,CAACA,YAAL,EAAmB;AACjB,eAAO,IAAP;AACD;;AACD,aAAOA,YAAY,CAACnJ,eAAb,IAAgCmJ,YAAY,CAACpJ,WAApD;AACD;;;oCAEe;AACd,UAAMqJ,UAAU,GAAG,KAAK1B,mBAAL,CAAyB0B,UAA5C;AACA,aAAOA,UAAU,CAACC,GAAX,CACL,UAACC,SAAD;AAAA,eAAeA,SAAS,CAACtJ,eAAV,IAA6BsJ,SAAS,CAACvJ,WAAtD;AAAA,OADK,CAAP;AAGD;;;sCAGuBsH,c;;;;;;kBACjBA,c;;;;;;;;mBAGD,KAAKnF,aAAL,CAAmBqH,iBAAnB,CAAqClC,cAArC,C;;;;;;8CACI,KAAKnF,aAAL,CAAmBsH,0BAAnB,CAA8CnC,cAA9C,C;;;;;;AAGFoC,cAAAA,Y,GAAe,KAAKhF,gBAAL,CAAsBiF,IAAtB,CACnB,UAACC,CAAD;AAAA,uBAAOA,CAAC,CAACtC,cAAF,KAAqBA,cAA5B;AAAA,eADmB,C;;kBAGhBoC,Y;;;;;;;;mBAGD,yCAAqBA,YAArB,C;;;;;;8CACI,KAAKvH,aAAL,CAAmB0H,iBAAnB,CAAqCvC,cAArC,C;;;;;;;;8CAIA,KAAKnF,aAAL,CAAmB2H,gBAAnB,CAAoCxC,cAApC,C;;;AACN,mBAAK3D,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBmI,kBADL;AAElBzC,gBAAAA,cAAc,EAAdA;AAFkB,eAApB;;;;;;;AAKA0C,cAAAA,OAAO,CAAChB,KAAR;;;;;;;;;;;gCAgZQiB,Q,EAAU;AACpB,WAAKtG,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiByB,WADL;AAElB4G,QAAAA,QAAQ,EAARA;AAFkB,OAApB;AAID;;;iCAEYC,M,EAAQ;AACnB,WAAKvG,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBuI,YADL;AAElBD,QAAAA,MAAM,EAANA;AAFkB,OAApB;AAID;;;iCAEYvB,S,EAAW;AACtB,WAAKhF,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiBwI,YADL;AAElBzB,QAAAA,SAAS,EAATA;AAFkB,OAApB;AAID;;;mCAEc3I,W,EAAa;AAC1B,WAAK2D,KAAL,CAAWiB,QAAX,CAAoB;AAClBC,QAAAA,IAAI,EAAE,KAAKjD,WAAL,CAAiByI,cADL;AAElBrK,QAAAA,WAAW,EAAXA;AAFkB,OAApB;AAID;;;8CAEyB2I,S,EAAW;AAAA;;AACnC,UACE,CAAC,KAAKtG,eAAN,IACA,CAAC,KAAKC,mBADN,IAEA,CAAC,KAAKgI,kBAAL,CAAwBnK,MAH3B,EAIE;AACA;AACD;;AACD,WAAKiK,YAAL,CAAkBzB,SAAlB;AARmC,kCASD,KAAKpG,eATJ;AAAA,UAS3BgI,WAT2B,yBAS3BA,WAT2B;AAAA,UASdC,QATc,yBASdA,QATc;AAUnC,UAAMC,2BAA2B,GAAG,KAAKH,kBAAL,CAAwBhB,GAAxB,CAA4B,UAACoB,IAAD,EAAU;AACxE,YAAMC,SAAS,GAAG,iCAAgB;AAChC3K,UAAAA,WAAW,EAAE0K,IAAI,CAAC1K,WADc;AAEhCuK,UAAAA,WAAW,EAAXA,WAFgC;AAGhCC,UAAAA,QAAQ,EAARA;AAHgC,SAAhB,CAAlB;AAKA,eAAO;AACLxK,UAAAA,WAAW,EAAE2K,SADR;AAEL9L,UAAAA,EAAE,EAAE6L,IAAI,CAACE;AAFJ,SAAP;AAID,OAVmC,CAApC;AAWAH,MAAAA,2BAA2B,CAAC/L,OAA5B,CAAoC,UAACgM,IAAD,EAAU;AAAA,YACpC1K,WADoC,GACpB0K,IADoB,CACpC1K,WADoC;AAE5C,YAAMsH,cAAc,GAAG,MAAI,CAACuD,qBAAL,CAA2B7K,WAA3B,CAAvB;;AACA,QAAA,MAAI,CAACsC,mBAAL,CAAyBwI,eAAzB,CAAyC;AACvCZ,UAAAA,MAAM,EAAEQ,IAD+B;AAEvCpD,UAAAA,cAAc,EAAdA;AAFuC,SAAzC;;AAIA,QAAA,MAAI,CAAC6C,YAAL,CAAkBO,IAAlB;;AACA,QAAA,MAAI,CAACL,cAAL,CAAoBrK,WAApB;AACD,OATD;AAUD;;;wBAvHY;AACX,aAAO,KAAK+K,KAAL,CAAWC,MAAlB;AACD;;;wBAEiB;AAChB,aAAO,KAAKD,KAAL,CAAWE,WAAlB;AACD;;;wBAEgB;AACf,aAAO,KAAKF,KAAL,CAAWzG,UAAlB;AACD;;;wBAEiB;AAChB,aAAO,KAAKyG,KAAL,CAAW3G,WAAlB;AACD;;;wBAEsB;AACrB,aAAO,KAAK2G,KAAL,CAAWpG,gBAAlB;AACD;;;wBAE8B;AAC7B,aAAO,KAAKoG,KAAL,CAAWG,wBAAlB;AACD;;;wBAE2B;AAC1B,aAAO,KAAKH,KAAL,CAAWxD,qBAAlB;AACD;;;wBAEyB;AACxB,aAAO,KAAKwD,KAAL,CAAWI,mBAAlB;AACD;;;wBAEiB;AAChB,aAAO,KAAKJ,KAAL,CAAWxM,WAAlB;AACD;;;wBAE6B;AAC5B,aAAO,KAAK2M,wBAAL,KAAkCF,mBAAOI,QAAhD;AACD;;;wBAEwB;AACvB,aAAO,KAAKD,mBAAL,KAA6BH,mBAAOI,QAA3C;AACD;;;wBAEa;AACZ,aAAO,KAAKL,KAAL,CAAWM,kBAAX,KAAkCL,mBAAOM,OAAhD;AACD;;;wBAEoB;AACnB,aAAO,KAAKlJ,oBAAL,CAA0BmJ,yBAAjC;AACD;;;wBAEwB;AACvB,aAAO,KAAKR,KAAL,CAAWT,kBAAlB;AACD;;;wBAE2B;AAC1B,aAAO,KAAKS,KAAL,CAAWF,qBAAlB;AACD;;;;EA51BwCW,qB,+EA+JxCC,mB,kKAQAA,mB,sKAgBAA,mB,kKA8DAA,mB,6JAkBAA,mB,iKAOAA,mB,mKAWAA,mB,mKASAA,mB,kKAqEAA,mB,kKAYAA,mB,kKAiEAA,mB,gLA8BAC,kB;;;;;;;WACkB,CACjB;AAAA,aAAM,MAAI,CAACvJ,aAAL,CAAmBuC,gBAAzB;AAAA,KADiB,EAEjB;AAAA,aAAM,MAAI,CAACC,gBAAX;AAAA,KAFiB,EAGjB,UAACrF,aAAD,EAAgBqF,gBAAhB,EAAqC;AACnC,UAAIA,gBAAgB,CAACxE,MAAjB,KAA4B,CAAhC,EAAmC;AACjC,eAAOb,aAAP;AACD;;AACD,UAAMqM,gBAAgB,GAAG,EAAzB;AACA,UAAMC,eAAe,GAAG,EAAxB;;AACA,UAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACjC,CAAD,EAAO;AAC9B;AACA,YAAMkC,GAAG,GAAGlC,CAAC,CAACtC,cAAF,IAAoBsC,CAAC,CAAC/K,EAAlC;;AACA,YAAI+M,eAAe,CAACE,GAAD,CAAnB,EAA0B;AACxB;AACD;;AACDH,QAAAA,gBAAgB,CAAC/M,IAAjB,CAAsBgL,CAAtB;AACAgC,QAAAA,eAAe,CAACE,GAAD,CAAf,GAAuB,CAAvB;AACD,OARD;;AASAxM,MAAAA,aAAa,CAACZ,OAAd,CAAsBmN,gBAAtB;AACAlH,MAAAA,gBAAgB,CAACjG,OAAjB,CAAyBmN,gBAAzB;AACA,aAAOF,gBAAP;AACD,KArBgB,C;;kFAwBlBD,kB;;;;;;;WACe,CAAC;AAAA,aAAM,MAAI,CAACjG,mBAAX;AAAA,KAAD,EAAiCpG,gBAAjC,C;;qFAEfqM,kB;;;;;;;WACkB,CAAC;AAAA,aAAM,MAAI,CAAChH,gBAAX;AAAA,KAAD,EAA8BrF,gBAA9B,C;;0FAElBqM,kB;;;;;;;WACuB,CACtB;AAAA,aAAM,MAAI,CAACX,KAAL,CAAWE,WAAjB;AAAA,KADsB,EAEtB,UAAC3F,KAAD,EAAW;AACT,UAAIA,KAAK,CAACnF,MAAN,IAAgB,CAApB,EAAuB,OAAOmF,KAAP;AACvB,aAAO,EAAP;AACD,KALqB,C;;8FAQvBoG,kB;;;;;;;WAC2B,CAC1B;AAAA,aAAM,MAAI,CAAChH,gBAAX;AAAA,KAD0B,EAE1B;AAAA,aAAM,MAAI,CAACJ,UAAX;AAAA,KAF0B,EAG1B,UAACI,gBAAD,EAAmBJ,UAAnB,EAAkC;AAChC,cAAQA,UAAR;AACE,aAAK+B,yBAAaC,IAAlB;AACE,iBAAO5B,gBAAgB,CAACqH,MAAjB,CAAwBC,mCAAxB,CAAP;;AACF,aAAK3F,yBAAa4F,SAAlB;AACE,iBAAOvH,gBAAgB,CAACqH,MAAjB,CAAwBG,iCAAxB,CAAP;;AACF,aAAK7F,yBAAa8F,GAAlB;AACE,iBAAOzH,gBAAgB,CAACqH,MAAjB,CAAwBK,2BAAxB,CAAP;;AACF;AACE,iBAAO1H,gBAAgB,CAACqH,MAAjB,CACL,UAACrC,YAAD;AAAA,mBACE,CAAC,MAAI,CAACtH,oBAAL,CAA0BiK,mBAA1B,IACC,CAAC,yCAAqB3C,YAArB,CADH,MAEC,MAAI,CAACtH,oBAAL,CAA0BkK,oBAA1B,IACC,CAAC,uCAAmB5C,YAAnB,CAHH,MAIC,MAAI,CAACtH,oBAAL,CAA0BmK,kBAA1B,IACC,CAAC,iCAAa7C,YAAb,CALH,CADF;AAAA,WADK,CAAP;AARJ;AAkBD,KAtByB,C;;0FAyB3BgC,kB;;;;;;;WACuB,CACtB;AAAA,aAAM,MAAI,CAACc,yBAAX;AAAA,KADsB,EAEtB;AAAA,aAAM,MAAI,CAACtK,cAAL,CAAoBjC,eAA1B;AAAA,KAFsB,EAGtB;AAAA,aAAM,MAAI,CAACoC,eAAL,IAAwB,MAAI,CAACA,eAAL,CAAqBoK,WAAnD;AAAA,KAHsB,EAItB;AAAA,aAAM,MAAI,CAACnK,mBAAL,IAA4B,MAAI,CAACA,mBAAL,CAAyBoK,UAA3D;AAAA,KAJsB,EAKtB;AAAA,aAAM,MAAI,CAACpK,mBAAL,IAA4B,MAAI,CAACA,mBAAL,CAAyBmK,WAA3D;AAAA,KALsB,EAMtB;AAAA,aAAM,MAAI,CAAC5K,KAAL,CAAW8K,WAAjB;AAAA,KANsB,EAOtB,UACErN,aADF,EAEEW,eAFF;AAAA,UAGE2M,cAHF,uEAGmB,EAHnB;AAAA,UAIEF,UAJF,uEAIe,EAJf;AAAA,UAKEG,sBALF,uEAK2B,EAL3B;AAAA,UAMEF,WANF;AAAA,aAQErN,aAAa,CAACgK,GAAd,CAAkB,UAACpK,OAAD,EAAa;AAAA,oCACI,0CAAsB;AACrDe,UAAAA,eAAe,EAAfA,eADqD;AAErDf,UAAAA,OAAO,EAAPA;AAFqD,SAAtB,CADJ;AAAA,YACrB4N,IADqB,yBACrBA,IADqB;AAAA,YACfC,cADe,yBACfA,cADe;;AAK7B,YAAMC,UAAU,GAAGF,IAAI,KAAKA,IAAI,CAAC9M,WAAL,IAAoB8M,IAAI,CAAC7M,eAA9B,CAAvB;AACA,YAAMgN,WAAW,GAAID,UAAU,IAAIJ,cAAc,CAACI,UAAD,CAA7B,IAA8C,EAAlE;AACA,YAAME,oBAAoB,GAAGH,cAAc,CAACI,MAAf,CAC3B,UAACC,OAAD,EAAUC,OAAV,EAAsB;AACpB,cAAM3N,MAAM,GACV2N,OAAO,KAAKA,OAAO,CAACrN,WAAR,IAAuBqN,OAAO,CAACpN,eAApC,CADT;AAEA,iBAAOP,MAAM,IACXkN,cAAc,CAAClN,MAAD,CADT,IAELkN,cAAc,CAAClN,MAAD,CAAd,CAAuBS,MAFlB,GAGHiN,OAAO,CAACE,MAAR,CAAeV,cAAc,CAAClN,MAAD,CAA7B,CAHG,GAIH0N,OAJJ;AAKD,SAT0B,EAU3B,EAV2B,CAA7B;AAYA,YAAMG,iBAAiB,GAAG,MAAI,CAACjL,mBAAL,GACtB,MAAI,CAACA,mBAAL,CAAyBkL,oBAAzB,CAA8CtO,OAA9C,CADsB,GAEtB,IAFJ;AAGA,YAAMuO,SAAS,GAAG,CAAC,EACjBF,iBAAiB,IAAIb,UAAU,CAACa,iBAAD,CADd,CAAnB;AAGA,YAAMG,mBAAmB,GACvBb,sBAAsB,CAACU,iBAAD,CAAtB,IAA6C,EAD/C;AAEA,YAAII,mBAAmB,GAAG,IAA1B;;AACA,YAAI,uCAAmBzO,OAAnB,CAAJ,EAAiC;AAC/ByO,UAAAA,mBAAmB,GAAG,2CAAuBzO,OAAvB,EAAgCyN,WAAhC,CAAtB;AACD;;AACD,YAAIiB,aAAa,GAAG,IAApB;;AACA,YAAI,iCAAa1O,OAAb,CAAJ,EAA2B;AACzB0O,UAAAA,aAAa,GAAG,qCAAiB1O,OAAjB,EAA0ByN,WAA1B,CAAhB;AACD;;AACD,YAAIkB,YAAY,GAAG3O,OAAO,CAAC2O,YAA3B;;AACA,YAAI,OAAOA,YAAP,KAAwB,WAA5B,EAAyC;AACvCA,UAAAA,YAAY,GAAG,oCAAgB3O,OAAhB,IAA2B,CAA3B,GAA+B,CAA9C;AACD;;AACD,YAAI4O,aAAa,GAAG,IAApB;;AACA,YACE,yCAAqB5O,OAArB,KACA,yBAAQA,OAAO,CAAC6O,OAAhB,CADA,IAEA,MAAI,CAAC/K,kBAHP,EAIE;AACA8K,UAAAA,aAAa,GAAG,qCAAiB5O,OAAjB,CAAhB;AACD;;AACD,iCACKA,OADL;AAEE2O,UAAAA,YAAY,EAAZA,YAFF;AAGEf,UAAAA,IAAI,EAAJA,IAHF;AAIEG,UAAAA,WAAW,EAAXA,WAJF;AAKEF,UAAAA,cAAc,EAAdA,cALF;AAMEG,UAAAA,oBAAoB,EAApBA,oBANF;AAOEK,UAAAA,iBAAiB,EAAjBA,iBAPF;AAQEE,UAAAA,SAAS,EAATA,SARF;AASEC,UAAAA,mBAAmB,EAAnBA,mBATF;AAUEC,UAAAA,mBAAmB,EAAnBA,mBAVF;AAWEC,UAAAA,aAAa,EAAbA,aAXF;AAYEE,UAAAA,aAAa,EAAbA,aAZF;AAaEE,UAAAA,8BAA8B,EAC3B,MAAI,CAAC1L,mBAAL,IACC,MAAI,CAACA,mBAAL,CAAyB2L,iCAAzB,CACE/O,OADF,CADF,IAIA;AAlBJ;AAoBD,OAnED,CARF;AAAA,KAPsB,C;;0FAqFvBwM,kB;;;;;;;WACuB,CACtB;AAAA,aAAM,OAAI,CAACwC,qBAAX;AAAA,KADsB,EAEtB;AAAA,aAAM,OAAI,CAAC1J,qBAAX;AAAA,KAFsB,EAGtB,UAAClF,aAAD,EAAgBkF,qBAAhB,EAA0C;AACxC,UAAIA,qBAAqB,KAAK,EAA9B,EAAkC;AAChC,eAAOlF,aAAP;AACD;;AACD,UAAM6O,aAAa,GAAG,EAAtB;AACA,UAAMC,UAAU,GAAG,aAAnB;AACA,UAAMC,YAAY,GAAG7J,qBAAqB,CAAC8J,WAAtB,EAArB;AACA,UAAMC,YAAY,GAAG/J,qBAAqB,CAACgK,OAAtB,CAA8BJ,UAA9B,EAA0C,EAA1C,CAArB;AACA9O,MAAAA,aAAa,CAACZ,OAAd,CAAsB,UAACQ,OAAD,EAAa;AACjC,YAAIqP,YAAY,KAAK/J,qBAArB,EAA4C;AAC1C,cAAMiK,aAAa,GAAG,6BAAYjK,qBAAZ,CAAtB;;AACA,cACEtF,OAAO,CAAC6N,cAAR,CAAuBpD,IAAvB,CACE,UAAC0D,OAAD;AAAA,mBACE,6BACEA,OAAO,CAACrN,WAAR,IAAuBqN,OAAO,CAACpN,eAA/B,IAAkD,EADpD,EAEEyO,OAFF,CAEUD,aAFV,IAE2B,CAAC,CAH9B;AAAA,WADF,CADF,EAOE;AACA;AACAN,YAAAA,aAAa,CAACvP,IAAd,mBACKM,OADL;AAEEyP,cAAAA,UAAU,EAAE;AAFd;AAIA;AACD;AACF;;AACD,YAAIzP,OAAO,CAACgO,oBAAR,CAA6B/M,MAAjC,EAAyC;AACvC,cACEjB,OAAO,CAACgO,oBAAR,CAA6BvD,IAA7B,CACE,UAACO,MAAD;AAAA,mBACE,CAACA,MAAM,CAAC0E,IAAP,IAAe,EAAhB,EAAoBN,WAApB,GAAkCI,OAAlC,CAA0CL,YAA1C,IAA0D,CAAC,CAD7D;AAAA,WADF,CADF,EAKE;AACA;AACAF,YAAAA,aAAa,CAACvP,IAAd,mBACKM,OADL;AAEEyP,cAAAA,UAAU,EAAE;AAFd;AAIA;AACD;AACF,SAdD,MAcO,IACLzP,OAAO,CAAC6N,cAAR,CAAuBpD,IAAvB,CACE,UAAC0D,OAAD;AAAA,iBACE,CAACA,OAAO,CAACuB,IAAR,IAAgB,EAAjB,EAAqBN,WAArB,GAAmCI,OAAnC,CAA2CL,YAA3C,IAA2D,CAAC,CAD9D;AAAA,SADF,CADK,EAKL;AACAF,UAAAA,aAAa,CAACvP,IAAd,mBACKM,OADL;AAEEyP,YAAAA,UAAU,EAAE;AAFd;AAIA;AACD,SA5CgC,CA8CjC;;;AACA,YAAI,CAACzP,OAAO,CAAC6O,OAAR,IAAmB,EAApB,EAAwBO,WAAxB,GAAsCI,OAAtC,CAA8CL,YAA9C,IAA8D,CAAC,CAAnE,EAAsE;AACpEF,UAAAA,aAAa,CAACvP,IAAd,mBACKM,OADL;AAEEyP,YAAAA,UAAU,EAAE;AAFd;AAIA;AACD;;AACD,YAAMzF,WAAW,GACf,OAAI,CAAC/G,aAAL,CAAmBqH,iBAAnB,CAAqCtK,OAAO,CAACoI,cAA7C,KAAgE,EADlE;AAEA,YAAMuH,cAAc,GAAG3F,WAAW,CAACS,IAAZ,CACrB,UAACe,IAAD;AAAA,iBACE,CAACA,IAAI,CAACqD,OAAL,IAAgB,EAAjB,EAAqBO,WAArB,GAAmCI,OAAnC,CAA2CL,YAA3C,IAA2D,CAAC,CAD9D;AAAA,SADqB,CAAvB;;AAIA,YAAIQ,cAAJ,EAAoB;AAClBV,UAAAA,aAAa,CAACvP,IAAd,mBACKM,OADL;AAEE2P,YAAAA,cAAc,EAAdA,cAFF;AAGEF,YAAAA,UAAU,EAAE;AAHd;AAKD;AACF,OAnED;AAoEA,aAAOR,aAAa,CAACW,IAAd,CAAmBC,gCAAnB,CAAP;AACD,KAhFqB,C;;wFAmFvBrD,kB;;;;;;;WACqB,CACpB;AAAA,aAAM,OAAI,CAACzE,qBAAX;AAAA,KADoB,EAEpB;AAAA,aAAM,OAAI,CAAC7C,WAAX;AAAA,KAFoB,EAGpB,UAAC9E,aAAD,EAAgB0P,UAAhB,EAA+B;AAC7B,UAAMC,SAAS,GAAGD,UAAU,GAAG,OAAI,CAACrM,QAApC;AACA,aAAOrD,aAAa,CAAC4P,KAAd,CAAoB,CAApB,EAAuBD,SAAvB,CAAP;AACD,KANmB,C;;iFASrBvD,kB;;;;;;;WACc,CAAC;AAAA,aAAM,OAAI,CAACc,yBAAX;AAAA,KAAD,EAAuC1N,eAAvC,C;;yFAEd4M,kB;;;;;;;WACqB,CACpB;AAAA,aAAM,OAAI,CAACnE,qBAAX;AAAA,KADoB,EAEpB;AAAA,aAAM,OAAI,CAACrF,cAAL,CAAoBjC,eAA1B;AAAA,KAFoB,EAGpB;AAAA,aAAM,OAAI,CAACoC,eAAL,IAAwB,OAAI,CAACA,eAAL,CAAqBoK,WAAnD;AAAA,KAHoB,EAIpB;AAAA,aAAM,OAAI,CAAClO,WAAX;AAAA,KAJoB,EAKpB;AAAA,aAAM,OAAI,CAAC4D,aAAL,CAAmBqH,iBAAzB;AAAA,KALoB,EAMpB;AAAA,aAAM,OAAI,CAAC9E,gBAAX;AAAA,KANoB,EAOpB;AAAA,aAAM,OAAI,CAAC7C,KAAL,CAAW8K,WAAjB;AAAA,KAPoB,EAQpB;AAAA,aAAM,OAAI,CAACrK,mBAAL,IAA4B,OAAI,CAACA,mBAAL,CAAyBmK,WAA3D;AAAA,KARoB,EASpB;AAAA,aAAM,OAAI,CAACnK,mBAAL,IAA4B,OAAI,CAACA,mBAAL,CAAyBoK,UAA3D;AAAA,KAToB,EAUpB,UACEpF,cADF,EAEErH,eAFF,EAGE2M,cAHF,EAIErO,WAJF,EAKEiL,iBALF,EAMElK,aANF,EAOEqN,WAPF,EAUK;AAAA,UAFHE,sBAEG,uEAFsB,EAEtB;AAAA,UADHH,UACG;AACH,UAAMhD,YAAY,GAAGpK,aAAa,CAACqK,IAAd,CACnB,UAACC,CAAD;AAAA,eAAOA,CAAC,CAACtC,cAAF,KAAqBA,cAA5B;AAAA,OADmB,CAArB;AAGA,UAAMhJ,QAAQ,GAAG,GAAGgP,MAAH,CAAU9D,iBAAiB,CAAClC,cAAD,CAAjB,IAAqC,EAA/C,CAAjB;;AACA,UAAMK,mBAAmB,qBACpB+B,YADoB,CAAzB;;AAGA,UAAMyF,WAAW,GAAG9Q,aAAa,CAACC,QAAD,EAAWC,WAAX,CAAb,CAAqC+K,GAArC,CAAyC,UAAC8F,CAAD,EAAO;AAClE,YAAI,CAAC,OAAI,CAACpM,kBAAV,EAA8B;AAC5B,iBAAOoM,CAAP;AACD;;AACD,YAAMtB,aAAa,GAAG,qCAAiBsB,CAAjB,EAAoBzC,WAApB,CAAtB;AACA,iCACKyC,CADL;AAEEtB,UAAAA,aAAa,EAAbA;AAFF;AAID,OATmB,CAApB;;AARG,mCAkB6B,0CAAsB;AACpD7N,QAAAA,eAAe,EAAfA,eADoD;AAEpDf,QAAAA,OAAO,EAAEwK;AAF2C,OAAtB,CAlB7B;AAAA,0DAkBKqD,cAlBL;AAAA,UAkBKA,cAlBL,uCAkBsB,EAlBtB;;AAsBH,UAAMG,oBAAoB,GAAGH,cAAc,CAACI,MAAf,CAAsB,UAACC,OAAD,EAAUC,OAAV,EAAsB;AACvE,YAAM3N,MAAM,GACV2N,OAAO,KAAKA,OAAO,CAACrN,WAAR,IAAuBqN,OAAO,CAACpN,eAApC,CADT;AAEA,eAAOP,MAAM,IAAIkN,cAAc,CAAClN,MAAD,CAAxB,IAAoCkN,cAAc,CAAClN,MAAD,CAAd,CAAuBS,MAA3D,GACHiN,OAAO,CAACE,MAAR,CAAeV,cAAc,CAAClN,MAAD,CAA7B,CADG,GAEH0N,OAFJ;AAGD,OAN4B,EAM1B,EAN0B,CAA7B;AAOA,UAAMG,iBAAiB,GAAG,OAAI,CAACjL,mBAAL,GACtB,OAAI,CAACA,mBAAL,CAAyBkL,oBAAzB,CAA8C9D,YAA9C,CADsB,GAEtB,IAFJ;AAGA,UAAMgE,mBAAmB,GACvBb,sBAAsB,CAACU,iBAAD,CAAtB,IAA6C,EAD/C;AAEA5F,MAAAA,mBAAmB,CAACoF,cAApB,GAAqCA,cAArC;AACApF,MAAAA,mBAAmB,CAACuF,oBAApB,GAA2CA,oBAA3C;AACAvF,MAAAA,mBAAmB,CAAC+F,mBAApB,GAA0CA,mBAA1C;AACA/F,MAAAA,mBAAmB,CAACrJ,QAApB,GAA+B6Q,WAAW,CAACE,OAAZ,EAA/B;AACA1H,MAAAA,mBAAmB,CAACyB,YAApB,GAAmC,2CAAuB;AACxDlK,QAAAA,OAAO,EAAEwK,YAD+C;AAExD4F,QAAAA,iBAAiB,EAAE,OAAI,CAACpN,cAAL,CAAoBjC;AAFiB,OAAvB,CAAnC;AAIA0H,MAAAA,mBAAmB,CAAC0B,UAApB,GAAiC,mDAA+B;AAC9DnK,QAAAA,OAAO,EAAEwK,YADqD;AAE9D6F,QAAAA,QAAQ,EAAE5H,mBAAmB,CAACyB;AAFgC,OAA/B,CAAjC;AAIAzB,MAAAA,mBAAmB,CAAC8F,SAApB,GAAgC,CAAC,EAC/BF,iBAAiB,IAAIb,UAAU,CAACa,iBAAD,CADA,CAAjC;AAGA,aAAO5F,mBAAP;AACD,KAtEmB,C;;iFAyErB+D,kB;;;;;;;WACa,CACZ;AAAA,aAAM,OAAI,CAACX,KAAL,CAAWyE,YAAjB;AAAA,KADY,EAEZ;AAAA,aAAM,OAAI,CAACjI,qBAAX;AAAA,KAFY,EAGZ,UAACiI,YAAD,EAAelI,cAAf,EAAkC;AAChC,UAAMmI,GAAG,GAAGD,YAAY,CAAC7F,IAAb,CACV,UAAC+F,GAAD;AAAA,eACE,QAAOA,GAAP,MAAe,QAAf,IAA2BA,GAAG,CAACpI,cAAJ,KAAuBA,cADpD;AAAA,OADU,CAAZ;AAIA,aAAOmI,GAAG,GAAGA,GAAG,CAACnJ,IAAP,GAAc,EAAxB;AACD,KATW,C","sourcesContent":["import normalizeNumber from '../../lib/normalizeNumber';\nimport messageDirection from '../../enums/messageDirection';\nimport RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport proxify from '../../lib/proxy/proxify';\nimport messageTypes from '../../enums/messageTypes';\nimport cleanNumber from '../../lib/cleanNumber';\nimport isBlank from '../../lib/isBlank';\nimport { selector } from '../../lib/selector';\nimport messageSenderMessages from '../MessageSender/messageSenderMessages';\n\nimport {\n  getNumbersFromMessage,\n  sortSearchResults,\n  messageIsTextMessage,\n  messageIsVoicemail,\n  getVoicemailAttachment,\n  getFaxAttachment,\n  getMMSAttachment,\n  messageIsFax,\n  getMyNumberFromMessage,\n  getRecipientNumbersFromMessage,\n  messageIsUnread,\n} from '../../lib/messageHelper';\n\nimport actionTypes from './actionTypes';\nimport getReducer from './getReducer';\nimport status from './status';\n\nfunction mergeMessages(messages, oldMessages) {\n  const tmp = {};\n  const currentMessages = [];\n  messages.forEach((element) => {\n    currentMessages.push(element);\n    tmp[element.id] = 1;\n  });\n\n  oldMessages.forEach((element) => {\n    if (!tmp[element.id]) {\n      currentMessages.push(element);\n    }\n  });\n  return currentMessages;\n}\n\nfunction getEarliestTime(messages) {\n  let newTime = Date.now();\n  messages.forEach((message) => {\n    const creationTime = new Date(message.creationTime).getTime();\n    if (creationTime < newTime) {\n      newTime = creationTime;\n    }\n  });\n  return newTime;\n}\n\nfunction getUniqueNumbers(conversations) {\n  const output = [];\n  const numberMap = {};\n  function addIfNotExist(number) {\n    if (number && !numberMap[number]) {\n      output.push(number);\n      numberMap[number] = true;\n    }\n  }\n  conversations.forEach((message) => {\n    if (message.from && message.direction === messageDirection.inbound) {\n      const fromNumber =\n        message.from.phoneNumber || message.from.extensionNumber;\n      addIfNotExist(fromNumber);\n    }\n    if (\n      message.to &&\n      message.to.length > 0 &&\n      message.direction === messageDirection.outbound\n    ) {\n      message.to.forEach((toNumber) => {\n        if (!toNumber) {\n          return;\n        }\n        const toPhoneNumber = toNumber.phoneNumber || toNumber.extensionNumber;\n        addIfNotExist(toPhoneNumber);\n      });\n    }\n  });\n  return output;\n}\n\nconst DEFAULT_PER_PAGE = 20;\nconst DEFAULT_DAY_SPAN = 90;\n@Module({\n  deps: [\n    'Alert',\n    'Auth',\n    'Client',\n    'MessageSender',\n    'ExtensionInfo',\n    'MessageStore',\n    'RolesAndPermissions',\n    { dep: 'RegionSettings', optional: true },\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'ConversationLogger', optional: true },\n    { dep: 'ConversationsOptions', optional: true },\n  ],\n})\nexport default class Conversations extends RcModule {\n  constructor({\n    alert,\n    auth,\n    client,\n    messageSender,\n    extensionInfo,\n    messageStore,\n    rolesAndPermissions,\n    contactMatcher,\n    conversationLogger,\n    regionSettings,\n    perPage = DEFAULT_PER_PAGE,\n    daySpan = DEFAULT_DAY_SPAN,\n    enableLoadOldMessages = false, // disable old message by default\n    showMMSAttachment = false,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = this::ensureExist(auth, 'auth');\n    this._alert = this::ensureExist(alert, 'alert');\n    this._client = this::ensureExist(client, 'client');\n    this._messageSender = this::ensureExist(messageSender, 'messageSender');\n    this._extensionInfo = this::ensureExist(extensionInfo, 'extensionInfo');\n    this._messageStore = this::ensureExist(messageStore, 'messageStore');\n    this._rolesAndPermissions = this::ensureExist(\n      rolesAndPermissions,\n      'rolesAndPermissions',\n    );\n    this._contactMatcher = contactMatcher;\n    this._conversationLogger = conversationLogger;\n    this._regionSettings = regionSettings;\n\n    this._reducer = getReducer(this.actionTypes);\n\n    this._promise = null;\n    this._lastProcessedNumbers = null;\n    this._perPage = perPage;\n    this._daySpan = daySpan;\n    this._olderDataExsited = true;\n    this._olderMessagesExsited = true;\n    this._enableLoadOldMessages = enableLoadOldMessages;\n    this._showMMSAttachment = showMMSAttachment;\n    this._lastConversaionList = [];\n\n    this._messageSender.on(\n      this._messageSender.actionTypes.send,\n      ({ toNumbers }) => {\n        this.addEntities(toNumbers);\n      },\n    );\n\n    if (this._contactMatcher) {\n      this._contactMatcher.addQuerySource({\n        getQueriesFn: () => this.uniqueNumbers,\n        readyCheckFn: () => this._messageStore.ready,\n      });\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._init();\n    } else if (this._shouldReset()) {\n      this._reset();\n    } else if (\n      this._lastProcessedNumbers !== this.allUniqueNumbers ||\n      this._lastProcessedPage !== this.currentPage ||\n      this._lastTypeFilter !== this.typeFilter ||\n      this._lastSearchString !== this.effectiveSearchString\n    ) {\n      this._lastProcessedNumbers = this.allUniqueNumbers;\n      this._lastProcessedPage = this.currentPage;\n      this._lastTypeFilter = this.typeFilter;\n      this._lastSearchString = this.effectiveSearchString;\n      if (this._contactMatcher) {\n        this._contactMatcher.triggerMatch();\n      }\n    } else if (\n      this._lastConversaionList.length >\n      this._messageStore.allConversations.length\n    ) {\n      this._lastConversaionList = this._messageStore.allConversations;\n      if (this.oldConversations.length) {\n        this.store.dispatch({\n          type: this.actionTypes.cleanOldConversatioans,\n        });\n        this._olderDataExsited = true;\n      }\n    } else if (\n      this._lastConversaionList.length <\n      this._messageStore.allConversations.length\n    ) {\n      this._lastConversaionList = this._messageStore.allConversations;\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.loggedIn &&\n      this._extensionInfo.ready &&\n      this._messageSender.ready &&\n      this._messageStore.ready &&\n      this._rolesAndPermissions.ready &&\n      (!this._contactMatcher || this._contactMatcher.ready) &&\n      (!this._conversationLogger || this._conversationLogger.ready) &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (!this._auth.loggedIn ||\n        !this._extensionInfo.ready ||\n        !this._messageSender.ready ||\n        !this._rolesAndPermissions ||\n        !this._messageStore.ready ||\n        (this._contactMatcher && !this._contactMatcher.ready) ||\n        (this._conversationLogger && !this._conversationLogger.ready)) &&\n      this.ready\n    );\n  }\n\n  _init() {\n    this.store.dispatch({\n      type: this.actionTypes.init,\n    });\n    if (this._contactMatcher) {\n      this._contactMatcher.triggerMatch();\n    }\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n    this._lastConversaionList = this._messageStore.allConversations;\n    if (\n      this.allConversations.length <= this._perPage &&\n      this._enableLoadOldMessages &&\n      this._hasPermission\n    ) {\n      this.fetchOldConversations();\n    }\n  }\n\n  _reset() {\n    this._lastProcessedNumbers = null;\n    this._olderDataExsited = true;\n    this._olderMessagesExsited = true;\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  @proxify\n  async updateSearchInput(input) {\n    this.store.dispatch({\n      type: this.actionTypes.updateSearchInput,\n      input,\n    });\n  }\n\n  @proxify\n  async updateTypeFilter(type) {\n    if (this.typeFilter === type) {\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.updateTypeFilter,\n      typeFilter: type,\n    });\n    this._olderDataExsited = true;\n    this._olderMessagesExsited = true;\n    if (this.pagingConversations.length <= this._perPage) {\n      this.loadNextPage();\n    }\n  }\n\n  @proxify\n  async fetchOldConversations() {\n    if (!this._olderDataExsited) {\n      return;\n    }\n    if (this.loadingOldConversations) {\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.fetchOldConverstaions,\n    });\n    let dateFrom = new Date();\n    dateFrom.setDate(dateFrom.getDate() - this._daySpan);\n    const dateTo = new Date(this.earliestTime);\n    if (dateTo.getTime() < dateFrom.getTime()) {\n      dateFrom = new Date(dateTo.getTime() - 1000 * 3600 * 24);\n    }\n    const typeFilter = this.typeFilter;\n    const currentPage = this.currentPage;\n    const params = {\n      distinctConversations: true,\n      perPage: this._perPage,\n      dateFrom: dateFrom.toISOString(),\n      dateTo: dateTo.toISOString(),\n    };\n    if (typeFilter === messageTypes.text) {\n      params.messageType = [messageTypes.sms, messageTypes.pager];\n    } else if (\n      typeFilter &&\n      typeFilter !== '' &&\n      typeFilter !== messageTypes.all\n    ) {\n      params.messageType = typeFilter;\n    }\n    try {\n      const { records } = await this._client\n        .account()\n        .extension()\n        .messageStore()\n        .list(params);\n      const recordsLength = records.length;\n      this._olderDataExsited = recordsLength === this._perPage;\n      if (typeFilter === this.typeFilter && currentPage === this.currentPage) {\n        const isIncreaseCurrentPage =\n          recordsLength &&\n          this._perPage * this.currentPage <\n            recordsLength + this.filteredConversations.length;\n        this.store.dispatch({\n          type: this.actionTypes.fetchOldConverstaionsSuccess,\n          records,\n          isIncreaseCurrentPage,\n        });\n      }\n    } catch (e) {\n      if (typeFilter === this.typeFilter && currentPage === this.currentPage) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchOldConverstaionsError,\n        });\n      }\n    }\n  }\n\n  @proxify\n  async loadNextPage() {\n    const currentPage = this.currentPage;\n    if (currentPage * this._perPage < this.filteredConversations.length) {\n      this.store.dispatch({\n        type: this.actionTypes.increaseCurrentPage,\n      });\n      return;\n    }\n    if (this.effectiveSearchString !== '') {\n      return;\n    }\n    if (!this._enableLoadOldMessages || !this._hasPermission) {\n      return;\n    }\n    await this.fetchOldConversations();\n  }\n\n  @proxify\n  async resetCurrentPage() {\n    this.store.dispatch({\n      type: this.actionTypes.resetCurrentPage,\n    });\n  }\n\n  @proxify\n  async loadConversation(conversationId) {\n    if (conversationId === this.currentConversationId) {\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentConversationId,\n      conversationId,\n    });\n  }\n\n  @proxify\n  async unloadConversation() {\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentConversationId,\n      conversationId: null,\n    });\n    this._olderMessagesExsited = true;\n  }\n\n  @proxify\n  async fetchOldMessages(perPage = this._perPage) {\n    if (!this._enableLoadOldMessages) {\n      return;\n    }\n    if (!this._hasPermission) {\n      return;\n    }\n    if (!this._olderMessagesExsited) {\n      return;\n    }\n    if (this.loadingOldMessages) {\n      return;\n    }\n    if (!this.currentConversationId) {\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.fetchOldMessages,\n    });\n    const conversationId = this.currentConversationId;\n    const dateFrom = new Date();\n    dateFrom.setDate(dateFrom.getDate() - this._daySpan);\n    const earliestTime = getEarliestTime(this.currentConversation.messages);\n    const dateTo = new Date(earliestTime);\n    if (dateTo.getTime() < dateFrom.getTime()) {\n      dateFrom.setDate(dateFrom.getDate() - 1);\n    }\n    const params = {\n      conversationId,\n      perPage,\n      dateFrom: dateFrom.toISOString(),\n      dateTo: dateTo.toISOString(),\n    };\n    try {\n      const { records } = await this._client\n        .account()\n        .extension()\n        .messageStore()\n        .list(params);\n      this._olderMessagesExsited = records.length === perPage;\n      if (conversationId === this.currentConversationId) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchOldMessagesSuccess,\n          records,\n        });\n      }\n    } catch (e) {\n      if (conversationId === this.currentConversationId) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchOldMessagesError,\n        });\n      }\n    }\n  }\n\n  _alertWarning(message) {\n    if (message) {\n      const ttlConfig =\n        message !== messageSenderMessages.noAreaCode ? { ttl: 0 } : null;\n      this._alert.warning({\n        message,\n        ...ttlConfig,\n      });\n      return true;\n    }\n    return false;\n  }\n\n  @proxify\n  async updateMessageText(text) {\n    if (text.length > 1000) {\n      return this._alertWarning(messageSenderMessages.textTooLong);\n    }\n    return this.store.dispatch({\n      type: this.actionTypes.updateMessageText,\n      text,\n      conversationId: this.currentConversationId,\n    });\n  }\n\n  @proxify\n  async replyToReceivers(text) {\n    this.store.dispatch({\n      type: this.actionTypes.reply,\n    });\n    try {\n      const responses = await this._messageSender.send({\n        fromNumber: this._getFromNumber(),\n        toNumbers: this._getToNumbers(),\n        text,\n        replyOnMessageId: this._getReplyOnMessageId(),\n      });\n      if (responses && responses[0]) {\n        this._messageStore.pushMessage(responses[0]);\n        this.store.dispatch({\n          type: this.actionTypes.replySuccess,\n        });\n        this.store.dispatch({\n          type: this.actionTypes.removeMessageText,\n          conversationId: this.currentConversationId,\n        });\n        return responses[0];\n      }\n      this._onReplyError();\n      return null;\n    } catch (error) {\n      this._onReplyError(error);\n      throw error;\n    }\n  }\n\n  _onReplyError(error) {\n    this.store.dispatch({\n      type: this.actionTypes.replyError,\n      error,\n    });\n  }\n\n  _getReplyOnMessageId() {\n    const messageList = this.currentConversation.messages;\n    const lastMessage =\n      messageList &&\n      messageList.length > 0 &&\n      messageList[messageList.length - 1];\n    if (lastMessage && lastMessage.id) {\n      return lastMessage.id;\n    }\n    return null;\n  }\n\n  _getFromNumber() {\n    const senderNumber = this.currentConversation.senderNumber;\n    if (!senderNumber) {\n      return null;\n    }\n    return senderNumber.extensionNumber || senderNumber.phoneNumber;\n  }\n\n  _getToNumbers() {\n    const recipients = this.currentConversation.recipients;\n    return recipients.map(\n      (recipient) => recipient.extensionNumber || recipient.phoneNumber,\n    );\n  }\n\n  @proxify\n  async deleteCoversation(conversationId) {\n    if (!conversationId) {\n      return;\n    }\n    if (this._messageStore.conversationStore[conversationId]) {\n      await this._messageStore.deleteConversationMessages(conversationId);\n      return;\n    }\n    const conversation = this.allConversations.find(\n      (c) => c.conversationId === conversationId,\n    );\n    if (!conversation) {\n      return;\n    }\n    if (messageIsTextMessage(conversation)) {\n      await this._messageStore.deleteCoversation(conversationId);\n      return;\n    }\n    try {\n      await this._messageStore.deleteMessageApi(conversationId);\n      this.store.dispatch({\n        type: this.actionTypes.deleteConversation,\n        conversationId,\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  @selector\n  allConversations = [\n    () => this._messageStore.allConversations,\n    () => this.oldConversations,\n    (conversations, oldConversations) => {\n      if (oldConversations.length === 0) {\n        return conversations;\n      }\n      const newConversations = [];\n      const conversationMap = {};\n      const pushConversation = (c) => {\n        // use conversationId when available, use id for VoiceMail/Fax/etc..\n        const cid = c.conversationId || c.id;\n        if (conversationMap[cid]) {\n          return;\n        }\n        newConversations.push(c);\n        conversationMap[cid] = 1;\n      };\n      conversations.forEach(pushConversation);\n      oldConversations.forEach(pushConversation);\n      return newConversations;\n    },\n  ];\n\n  @selector\n  uniqueNumbers = [() => this.pagingConversations, getUniqueNumbers];\n\n  @selector\n  allUniqueNumbers = [() => this.allConversations, getUniqueNumbers];\n\n  @selector\n  effectiveSearchString = [\n    () => this.state.searchInput,\n    (input) => {\n      if (input.length >= 3) return input;\n      return '';\n    },\n  ];\n\n  @selector\n  typeFilteredConversations = [\n    () => this.allConversations,\n    () => this.typeFilter,\n    (allConversations, typeFilter) => {\n      switch (typeFilter) {\n        case messageTypes.text:\n          return allConversations.filter(messageIsTextMessage);\n        case messageTypes.voiceMail:\n          return allConversations.filter(messageIsVoicemail);\n        case messageTypes.fax:\n          return allConversations.filter(messageIsFax);\n        default:\n          return allConversations.filter(\n            (conversation) =>\n              (this._rolesAndPermissions.readTextPermissions ||\n                !messageIsTextMessage(conversation)) &&\n              (this._rolesAndPermissions.voicemailPermissions ||\n                !messageIsVoicemail(conversation)) &&\n              (this._rolesAndPermissions.readFaxPermissions ||\n                !messageIsFax(conversation)),\n          );\n      }\n    },\n  ];\n\n  @selector\n  formatedConversations = [\n    () => this.typeFilteredConversations,\n    () => this._extensionInfo.extensionNumber,\n    () => this._contactMatcher && this._contactMatcher.dataMapping,\n    () => this._conversationLogger && this._conversationLogger.loggingMap,\n    () => this._conversationLogger && this._conversationLogger.dataMapping,\n    () => this._auth.accessToken,\n    (\n      conversations,\n      extensionNumber,\n      contactMapping = {},\n      loggingMap = {},\n      conversationLogMapping = {},\n      accessToken,\n    ) =>\n      conversations.map((message) => {\n        const { self, correspondents } = getNumbersFromMessage({\n          extensionNumber,\n          message,\n        });\n        const selfNumber = self && (self.phoneNumber || self.extensionNumber);\n        const selfMatches = (selfNumber && contactMapping[selfNumber]) || [];\n        const correspondentMatches = correspondents.reduce(\n          (matches, contact) => {\n            const number =\n              contact && (contact.phoneNumber || contact.extensionNumber);\n            return number &&\n              contactMapping[number] &&\n              contactMapping[number].length\n              ? matches.concat(contactMapping[number])\n              : matches;\n          },\n          [],\n        );\n        const conversationLogId = this._conversationLogger\n          ? this._conversationLogger.getConversationLogId(message)\n          : null;\n        const isLogging = !!(\n          conversationLogId && loggingMap[conversationLogId]\n        );\n        const conversationMatches =\n          conversationLogMapping[conversationLogId] || [];\n        let voicemailAttachment = null;\n        if (messageIsVoicemail(message)) {\n          voicemailAttachment = getVoicemailAttachment(message, accessToken);\n        }\n        let faxAttachment = null;\n        if (messageIsFax(message)) {\n          faxAttachment = getFaxAttachment(message, accessToken);\n        }\n        let unreadCounts = message.unreadCounts;\n        if (typeof unreadCounts === 'undefined') {\n          unreadCounts = messageIsUnread(message) ? 1 : 0;\n        }\n        let mmsAttachment = null;\n        if (\n          messageIsTextMessage(message) &&\n          isBlank(message.subject) &&\n          this._showMMSAttachment\n        ) {\n          mmsAttachment = getMMSAttachment(message);\n        }\n        return {\n          ...message,\n          unreadCounts,\n          self,\n          selfMatches,\n          correspondents,\n          correspondentMatches,\n          conversationLogId,\n          isLogging,\n          conversationMatches,\n          voicemailAttachment,\n          faxAttachment,\n          mmsAttachment,\n          lastMatchedCorrespondentEntity:\n            (this._conversationLogger &&\n              this._conversationLogger.getLastMatchedCorrespondentEntity(\n                message,\n              )) ||\n            null,\n        };\n      }),\n  ];\n\n  @selector\n  filteredConversations = [\n    () => this.formatedConversations,\n    () => this.effectiveSearchString,\n    (conversations, effectiveSearchString) => {\n      if (effectiveSearchString === '') {\n        return conversations;\n      }\n      const searchResults = [];\n      const cleanRegex = /[^\\d*+#\\s]/g;\n      const searchString = effectiveSearchString.toLowerCase();\n      const searchNumber = effectiveSearchString.replace(cleanRegex, '');\n      conversations.forEach((message) => {\n        if (searchNumber === effectiveSearchString) {\n          const cleanedNumber = cleanNumber(effectiveSearchString);\n          if (\n            message.correspondents.find(\n              (contact) =>\n                cleanNumber(\n                  contact.phoneNumber || contact.extensionNumber || '',\n                ).indexOf(cleanedNumber) > -1,\n            )\n          ) {\n            // match by phoneNumber or extensionNumber\n            searchResults.push({\n              ...message,\n              matchOrder: 0,\n            });\n            return;\n          }\n        }\n        if (message.correspondentMatches.length) {\n          if (\n            message.correspondentMatches.find(\n              (entity) =>\n                (entity.name || '').toLowerCase().indexOf(searchString) > -1,\n            )\n          ) {\n            // match by entity's name\n            searchResults.push({\n              ...message,\n              matchOrder: 0,\n            });\n            return;\n          }\n        } else if (\n          message.correspondents.find(\n            (contact) =>\n              (contact.name || '').toLowerCase().indexOf(searchString) > -1,\n          )\n        ) {\n          searchResults.push({\n            ...message,\n            matchOrder: 0,\n          });\n          return;\n        }\n\n        // try match messages of the same conversation\n        if ((message.subject || '').toLowerCase().indexOf(searchString) > -1) {\n          searchResults.push({\n            ...message,\n            matchOrder: 1,\n          });\n          return;\n        }\n        const messageList =\n          this._messageStore.conversationStore[message.conversationId] || [];\n        const matchedMessage = messageList.find(\n          (item) =>\n            (item.subject || '').toLowerCase().indexOf(searchString) > -1,\n        );\n        if (matchedMessage) {\n          searchResults.push({\n            ...message,\n            matchedMessage,\n            matchOrder: 1,\n          });\n        }\n      });\n      return searchResults.sort(sortSearchResults);\n    },\n  ];\n\n  @selector\n  pagingConversations = [\n    () => this.filteredConversations,\n    () => this.currentPage,\n    (conversations, pageNumber) => {\n      const lastIndex = pageNumber * this._perPage;\n      return conversations.slice(0, lastIndex);\n    },\n  ];\n\n  @selector\n  earliestTime = [() => this.typeFilteredConversations, getEarliestTime];\n\n  @selector\n  currentConversation = [\n    () => this.currentConversationId,\n    () => this._extensionInfo.extensionNumber,\n    () => this._contactMatcher && this._contactMatcher.dataMapping,\n    () => this.oldMessages,\n    () => this._messageStore.conversationStore,\n    () => this.allConversations,\n    () => this._auth.accessToken,\n    () => this._conversationLogger && this._conversationLogger.dataMapping,\n    () => this._conversationLogger && this._conversationLogger.loggingMap,\n    (\n      conversationId,\n      extensionNumber,\n      contactMapping,\n      oldMessages,\n      conversationStore,\n      conversations,\n      accessToken,\n      conversationLogMapping = {},\n      loggingMap,\n    ) => {\n      const conversation = conversations.find(\n        (c) => c.conversationId === conversationId,\n      );\n      const messages = [].concat(conversationStore[conversationId] || []);\n      const currentConversation = {\n        ...conversation,\n      };\n      const allMessages = mergeMessages(messages, oldMessages).map((m) => {\n        if (!this._showMMSAttachment) {\n          return m;\n        }\n        const mmsAttachment = getMMSAttachment(m, accessToken);\n        return {\n          ...m,\n          mmsAttachment,\n        };\n      });\n      const { correspondents = [] } = getNumbersFromMessage({\n        extensionNumber,\n        message: conversation,\n      });\n      const correspondentMatches = correspondents.reduce((matches, contact) => {\n        const number =\n          contact && (contact.phoneNumber || contact.extensionNumber);\n        return number && contactMapping[number] && contactMapping[number].length\n          ? matches.concat(contactMapping[number])\n          : matches;\n      }, []);\n      const conversationLogId = this._conversationLogger\n        ? this._conversationLogger.getConversationLogId(conversation)\n        : null;\n      const conversationMatches =\n        conversationLogMapping[conversationLogId] || [];\n      currentConversation.correspondents = correspondents;\n      currentConversation.correspondentMatches = correspondentMatches;\n      currentConversation.conversationMatches = conversationMatches;\n      currentConversation.messages = allMessages.reverse();\n      currentConversation.senderNumber = getMyNumberFromMessage({\n        message: conversation,\n        myExtensionNumber: this._extensionInfo.extensionNumber,\n      });\n      currentConversation.recipients = getRecipientNumbersFromMessage({\n        message: conversation,\n        myNumber: currentConversation.senderNumber,\n      });\n      currentConversation.isLogging = !!(\n        conversationLogId && loggingMap[conversationLogId]\n      );\n      return currentConversation;\n    },\n  ];\n\n  @selector\n  messageText = [\n    () => this.state.messageTexts,\n    () => this.currentConversationId,\n    (messageTexts, conversationId) => {\n      const res = messageTexts.find(\n        (msg) =>\n          typeof msg === 'object' && msg.conversationId === conversationId,\n      );\n      return res ? res.text : '';\n    },\n  ];\n\n  get status() {\n    return this.state.status;\n  }\n\n  get searchInput() {\n    return this.state.searchInput;\n  }\n\n  get typeFilter() {\n    return this.state.typeFilter;\n  }\n\n  get currentPage() {\n    return this.state.currentPage;\n  }\n\n  get oldConversations() {\n    return this.state.oldConversations;\n  }\n\n  get fetchConversationsStatus() {\n    return this.state.fetchConversationsStatus;\n  }\n\n  get currentConversationId() {\n    return this.state.currentConversationId;\n  }\n\n  get fetchMessagesStatus() {\n    return this.state.fetchMessagesStatus;\n  }\n\n  get oldMessages() {\n    return this.state.oldMessages;\n  }\n\n  get loadingOldConversations() {\n    return this.fetchConversationsStatus === status.fetching;\n  }\n\n  get loadingOldMessages() {\n    return this.fetchMessagesStatus === status.fetching;\n  }\n\n  get pushing() {\n    return this.state.conversationStatus === status.pushing;\n  }\n\n  get _hasPermission() {\n    return this._rolesAndPermissions.hasReadMessagesPermission;\n  }\n\n  get correspondentMatch() {\n    return this.state.correspondentMatch;\n  }\n\n  get correspondentResponse() {\n    return this.state.correspondentResponse;\n  }\n\n  addEntities(entities) {\n    this.store.dispatch({\n      type: this.actionTypes.addEntities,\n      entities,\n    });\n  }\n\n  removeEntity(entity) {\n    this.store.dispatch({\n      type: this.actionTypes.removeEntity,\n      entity,\n    });\n  }\n\n  addResponses(responses) {\n    this.store.dispatch({\n      type: this.actionTypes.addResponses,\n      responses,\n    });\n  }\n\n  removeResponse(phoneNumber) {\n    this.store.dispatch({\n      type: this.actionTypes.removeResponse,\n      phoneNumber,\n    });\n  }\n\n  relateCorrespondentEntity(responses) {\n    if (\n      !this._contactMatcher ||\n      !this._conversationLogger ||\n      !this.correspondentMatch.length\n    ) {\n      return;\n    }\n    this.addResponses(responses);\n    const { countryCode, areaCode } = this._regionSettings;\n    const formattedCorrespondentMatch = this.correspondentMatch.map((item) => {\n      const formatted = normalizeNumber({\n        phoneNumber: item.phoneNumber,\n        countryCode,\n        areaCode,\n      });\n      return {\n        phoneNumber: formatted,\n        id: item.rawId,\n      };\n    });\n    formattedCorrespondentMatch.forEach((item) => {\n      const { phoneNumber } = item;\n      const conversationId = this.correspondentResponse[phoneNumber];\n      this._conversationLogger.logConversation({\n        entity: item,\n        conversationId,\n      });\n      this.removeEntity(item);\n      this.removeResponse(phoneNumber);\n    });\n  }\n}\n"],"file":"index.js"}