{"version":3,"sources":["modules/Modal/Modal.tsx"],"names":["Modal","name","deps","getModals","modalIds","modalMapping","map","id","data","open","state","push","_setListItem","filter","modalId","props","_getId","_open","onOK","rest","Promise","resolve","alert","e","onCancel","cancelText","_close","confirm","disableBackdropClick","fullScreen","size","okText","onExited","_removeListItem","uuid","v4","RcModuleV2","storage","action"],"mappings":"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","sourcesContent":["import {\n  action,\n  createSelector,\n  RcModuleState,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport uuid from 'uuid';\n\nimport {\n  AlertModalProps,\n  ConfirmModalProps,\n  DepsModules,\n  ModalItem,\n  ModalMappingType,\n  State,\n} from './Modal.interface';\n\ntype ModalState = RcModuleState<Modal, State>;\n\n@Module({\n  name: 'Modal',\n  deps: [],\n})\nexport class Modal extends RcModuleV2<DepsModules, ModalState> {\n  @storage\n  @state\n  modalIds: string[] = [];\n\n  @state\n  modalMapping: ModalMappingType = {};\n\n  getModals = createSelector(\n    () => this.modalIds,\n    () => this.modalMapping,\n    (modalIds, modalMapping: ModalMappingType) =>\n      modalIds.map((id) => modalMapping[id]),\n  );\n\n  @action\n  private _setListItem(id: string, data: ModalItem) {\n    if (data.open) {\n      this.state.modalIds.push(id);\n    }\n    this.state.modalMapping[id] = data;\n  }\n\n  private _close(id: string) {\n    if (this.modalMapping[id]) {\n      this._setListItem(id, { ...this.modalMapping[id], open: false });\n    }\n  }\n\n  @action\n  private _removeListItem(id: string) {\n    this.state.modalIds = this.state.modalIds.filter(\n      (modalId) => modalId !== id,\n    );\n    delete this.state.modalMapping[id];\n  }\n\n  alert(props: AlertModalProps) {\n    const id = this._getId();\n    return this._open(id, props);\n  }\n\n  /**\n   * ### This will be a `promise method`, resolve when `onOK` complete.\n   */\n  alertSync({ onOK, ...rest }: AlertModalProps) {\n    return new Promise<string>((resolve) => {\n      const id = this.alert({\n        ...rest,\n        onOK: async (e) => {\n          await onOK(e);\n          resolve(id);\n        },\n      });\n    });\n  }\n\n  confirm({ onCancel, ...rest }: ConfirmModalProps) {\n    const id = this._getId();\n    return this._open(id, {\n      cancelText: 'cancel',\n      onCancel: (e) => {\n        if (onCancel) onCancel(e);\n        this._close(id);\n      },\n      ...rest,\n    });\n  }\n\n  /**\n   * ### This will be a `promise method`, resolve when `onOK` or `onCancel` complete.\n   */\n  confirmSync({ onCancel, onOK, ...rest }: ConfirmModalProps) {\n    return new Promise<string>((resolve) => {\n      const id = this.confirm({\n        ...rest,\n        onOK: async (e) => {\n          await onOK(e);\n          resolve(id);\n        },\n        onCancel: (e) => {\n          if (onCancel) onCancel(e);\n          resolve(null);\n        },\n      });\n    });\n  }\n\n  close(id: string) {\n    this._close(id);\n  }\n\n  private _open(id: string, { onOK, ...rest }: ModalItem) {\n    this._setListItem(id, {\n      // default modal props\n      disableBackdropClick: true,\n      fullScreen: false,\n      open: true,\n      size: 'xsmall',\n      okText: 'ok',\n      ...rest,\n      onOK: (e) => {\n        onOK(e);\n        this._close(id);\n      },\n      onExited: () => {\n        this._removeListItem(id);\n      },\n    });\n    return id;\n  }\n\n  private _getId() {\n    return uuid.v4();\n  }\n}\n"],"file":"Modal.js"}