{"version":3,"sources":["modules/LocaleSettings/index.js"],"names":["LocaleSettings","name","deps","dep","optional","globalStorage","locale","supportedLocales","DEFAULT_LOCALE","options","_globalStorage","ensureExist","_locale","_supportedLocales","_storageKey","registerReducer","key","reducer","actionTypes","pending","ready","store","dispatch","type","init","savedLocale","saveLocale","currentLocale","setLocale","initSuccess","Enum","Object","keys","moduleActionTypes","status","state","getItem","RcModule","selector","s","slice","sort","proxify"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAgBqBA,c;AAdrB;;AAEA;;;;OAIC,gBAAO;AACNC,EAAAA,IAAI,EAAE,gBADA;AAENC,EAAAA,IAAI,EAAE,CACJ,eADI,EAEJ,QAFI,EAGJ;AAAEC,IAAAA,GAAG,EAAE,uBAAP;AAAgCC,IAAAA,QAAQ,EAAE;AAA1C,GAHI;AAFA,CAAP,C;;;;;AASC;;;;;AAKA,4BAKQ;AAAA;;AAAA;;AAAA,mFAAJ,EAAI;;AAAA,QAJNC,aAIM,QAJNA,aAIM;AAAA,QAHNC,MAGM,QAHNA,MAGM;AAAA,qCAFNC,gBAEM;AAAA,QAFNA,gBAEM,sCAFa,CAACC,oBAAD,CAEb;AAAA,QADHC,OACG;;AAAA;;AACN,0GACKA,OADL;;AADM;;AAIN,UAAKC,cAAL,GAAsB,2CAAMC,uBAAN,iBAAkBN,aAAlB,EAAiC,eAAjC,CAAtB;AACA,UAAKO,OAAL,GAAe,2CAAMD,uBAAN,iBAAkBL,MAAlB,EAA0B,QAA1B,CAAf;AACA,UAAKO,iBAAL,GAAyBN,gBAAzB;AACA,UAAKO,WAAL,GAAmB,oBAAnB;;AACA,UAAKJ,cAAL,CAAoBK,eAApB,CAAoC;AAClCC,MAAAA,GAAG,EAAE,MAAKF,WADwB;AAElCG,MAAAA,OAAO,EAAE,qCAAsB,MAAKC,WAA3B;AAFyB,KAApC;;AARM;AAYP;;;;;;;;;oBAgBK,KAAKC,OAAL,IAAgB,KAAKT,cAAL,CAAoBU,KAApC,IAA6C,KAAKR,OAAL,CAAaQ,K;;;;;AAC5D,mBAAKC,KAAL,CAAWC,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKL,WAAL,CAAiBM;AADL,eAApB;;kBAGK,KAAKC,W;;;;;AACR,mBAAKC,UAAL,CAAgB,KAAKd,OAAL,CAAae,aAA7B;;;;;oBACS,KAAKF,WAAL,KAAqB,KAAKb,OAAL,CAAae,a;;;;;;8CACrC,KAAKf,OAAL,CAAagB,SAAb,CAAuB,KAAKH,WAA5B,C;;;AAER,mBAAKJ,KAAL,CAAWC,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKL,WAAL,CAAiBW;AADL,eAApB;;;;;;;;;;;+BAkBavB,M;;;;;;8CACT,KAAKM,OAAL,CAAagB,SAAb,CAAuBtB,MAAvB,C;;;AACN,mBAAKe,KAAL,CAAWC,QAAX,CAAoB;AAClBC,gBAAAA,IAAI,EAAE,KAAKL,WAAL,CAAiBQ,UADL;AAElBpB,gBAAAA,MAAM,EAANA;AAFkB,eAApB;;;;;;;;;;;wBA3CiB;AACjB,aAAO,IAAIwB,gBAAJ,8BACDC,MAAM,CAACC,IAAP,CAAYC,oCAAZ,CADC,IAC+B,YAD/B,IAEL,gBAFK,CAAP;AAID;;;wBAEa;AACZ,aAAO,4BAAgB;AACrBC,QAAAA,MAAM,EAAE,wCAAuB,KAAKhB,WAA5B;AADa,OAAhB,CAAP;AAGD;;;wBAkBY;AACX,aAAO,KAAKiB,KAAL,CAAWD,MAAlB;AACD;;;wBAEiB;AAChB,aAAO,KAAKxB,cAAL,CAAoB0B,OAApB,CAA4B,KAAKtB,WAAjC,CAAP;AACD;;;;EA5DyCuB,qB,4FA8DzCC,kB;;;;;;;WACkB,CAAC;AAAA,aAAM,MAAI,CAACzB,iBAAX;AAAA,KAAD,EAA+B,UAAC0B,CAAD;AAAA,aAAOA,CAAC,CAACC,KAAF,GAAUC,IAAV,EAAP;AAAA,KAA/B,C;;gEAElBC,mB","sourcesContent":["import { DEFAULT_LOCALE } from '@ringcentral-integration/i18n';\nimport { combineReducers } from 'redux';\nimport RcModule from '../../lib/RcModule';\nimport Enum from '../../lib/Enum';\nimport { moduleActionTypes } from '../../enums/moduleActionTypes';\nimport proxify from '../../lib/proxy/proxify';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport { selector } from '../../lib/selector';\nimport getModuleStatusReducer from '../../lib/getModuleStatusReducer';\nimport { getSavedLocaleReducer } from './reducers';\n\n/* eslint-disable global-require */\n\n/**\n * @class\n * @description Locale managing module\n */\n@Module({\n  name: 'LocaleSettings',\n  deps: [\n    'GlobalStorage',\n    'Locale',\n    { dep: 'LocaleSettingsOptions', optional: true },\n  ],\n})\nexport default class LocaleSettings extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {String} params.defaultLocale - default 'en-US'\n   */\n  constructor({\n    globalStorage,\n    locale,\n    supportedLocales = [DEFAULT_LOCALE],\n    ...options\n  } = {}) {\n    super({\n      ...options,\n    });\n    this._globalStorage = this::ensureExist(globalStorage, 'globalStorage');\n    this._locale = this::ensureExist(locale, 'locale');\n    this._supportedLocales = supportedLocales;\n    this._storageKey = 'localeSettingsData';\n    this._globalStorage.registerReducer({\n      key: this._storageKey,\n      reducer: getSavedLocaleReducer(this.actionTypes),\n    });\n  }\n\n  get _actionTypes() {\n    return new Enum(\n      [...Object.keys(moduleActionTypes), 'saveLocale'],\n      'localeSettings',\n    );\n  }\n\n  get reducer() {\n    return combineReducers({\n      status: getModuleStatusReducer(this.actionTypes),\n    });\n  }\n\n  async _onStateChange() {\n    if (this.pending && this._globalStorage.ready && this._locale.ready) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      if (!this.savedLocale) {\n        this.saveLocale(this._locale.currentLocale);\n      } else if (this.savedLocale !== this._locale.currentLocale) {\n        await this._locale.setLocale(this.savedLocale);\n      }\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get savedLocale() {\n    return this._globalStorage.getItem(this._storageKey);\n  }\n\n  @selector\n  supportedLocales = [() => this._supportedLocales, (s) => s.slice().sort()];\n\n  @proxify\n  async saveLocale(locale) {\n    await this._locale.setLocale(locale);\n    this.store.dispatch({\n      type: this.actionTypes.saveLocale,\n      locale,\n    });\n  }\n}\n"],"file":"index.js"}