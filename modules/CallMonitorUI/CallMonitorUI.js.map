{"version":3,"sources":["modules/CallMonitorUI/CallMonitorUI.ts"],"names":["CallMonitorUI","name","deps","brand","callMonitor","callLogger","connectivityMonitor","contactMatcher","contactSearch","composeText","dateTimeFormat","locale","rateLimiter","regionSettings","rolesAndPermissions","routerInteraction","webphone","options","_brand","_locale","_callMonitor","_regionSettings","_connectivityMonitor","_rateLimiter","_rolesAndPermissions","_callLogger","_dateTimeFormat","_composeText","_contactMatcher","_routerInteraction","_contactSearch","_webphone","enableContactFallback","active","fullName","title","i18n","getString","currentLocale","calls","areaCode","countryCode","disableLinks","connectivity","throttling","outboundSmsPermission","permissions","OutboundSMS","internalSmsPermission","InternalSMS","loggingMap","showSpinner","ready","autoLog","onViewContact","onCreateContact","dateTimeFormatter","utcTimestamp","formatDateTime","onLogCall","isLoggedContact","composeTextRoute","phoneNumber","contact","hasMatchNumber","ignoreCache","undefined","entityType","forceMatchNumber","call","redirect","logCall","onClickToSms","isDummyContact","push","updateTypingToNumber","search","searchString","addToNumber","typingToNumber","cleanTypingToNumber","webphoneAnswer","answer","webphoneReject","reject","webphoneHangup","hangup","webphoneResume","resume","RcUIModule"],"mappings":"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","sourcesContent":["import { Module } from 'ringcentral-integration/lib/di';\nimport RcUIModule from '../../lib/RcUIModule';\nimport i18n from './i18n';\n\n@Module({\n  name: 'CallMonitorUI',\n  deps: [\n    'Brand',\n    'CallMonitor',\n    'CallLogger',\n    'ConnectivityMonitor',\n    'ContactMatcher',\n    'ContactSearch',\n    'ComposeText',\n    'DateTimeFormat',\n    'Locale',\n    'RateLimiter',\n    'RegionSettings',\n    'RolesAndPermissions',\n    'RouterInteraction',\n    'Webphone',\n  ],\n})\nexport class CallMonitorUI extends RcUIModule {\n  private _brand: any;\n  private _locale: any;\n  private _callMonitor: any;\n  private _regionSettings: any;\n  private _connectivityMonitor: any;\n  private _rateLimiter: any;\n  private _rolesAndPermissions: any;\n  private _callLogger: any;\n  private _dateTimeFormat: any;\n  private _composeText: any;\n  private _contactMatcher: any;\n  private _routerInteraction: any;\n  private _contactSearch: any;\n  private _webphone: any;\n  constructor({\n    brand,\n    callMonitor,\n    callLogger,\n    connectivityMonitor,\n    contactMatcher,\n    contactSearch,\n    composeText,\n    dateTimeFormat,\n    locale,\n    rateLimiter,\n    regionSettings,\n    rolesAndPermissions,\n    routerInteraction,\n    webphone,\n    ...options\n  }) {\n    super({ ...options });\n    this._brand = brand;\n    this._locale = locale;\n    this._callMonitor = callMonitor;\n    this._regionSettings = regionSettings;\n    this._connectivityMonitor = connectivityMonitor;\n    this._rateLimiter = rateLimiter;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._callLogger = callLogger;\n    this._dateTimeFormat = dateTimeFormat;\n    this._composeText = composeText;\n    this._contactMatcher = contactMatcher;\n    this._routerInteraction = routerInteraction;\n    this._contactSearch = contactSearch;\n    this._webphone = webphone;\n  }\n\n  getUIProps({ enableContactFallback = false }) {\n    return {\n      enableContactFallback,\n      active: true,\n      brand: this._brand.fullName,\n      title: i18n.getString('title', this._locale.currentLocale),\n      currentLocale: this._locale.currentLocale,\n      calls: this._callMonitor.calls,\n      areaCode: this._regionSettings.areaCode,\n      countryCode: this._regionSettings.countryCode,\n      disableLinks:\n        !this._connectivityMonitor.connectivity || this._rateLimiter.throttling,\n      outboundSmsPermission: !!(\n        this._rolesAndPermissions.permissions &&\n        this._rolesAndPermissions.permissions.OutboundSMS\n      ),\n      internalSmsPermission: !!(\n        this._rolesAndPermissions.permissions &&\n        this._rolesAndPermissions.permissions.InternalSMS\n      ),\n      loggingMap: this._callLogger && this._callLogger.loggingMap,\n      showSpinner: !(\n        this._locale.ready &&\n        this._callMonitor.ready &&\n        this._regionSettings.ready &&\n        this._connectivityMonitor.ready &&\n        this._dateTimeFormat.ready &&\n        (!this._callLogger || this._callLogger.ready) &&\n        (!this._rolesAndPermissions || this._rolesAndPermissions.ready) &&\n        (!this._composeText || this._composeText.ready)\n      ),\n      autoLog: !!(this._callLogger && this._callLogger.autoLog),\n    };\n  }\n\n  getUIFunctions({\n    onViewContact,\n    onCreateContact,\n    dateTimeFormatter = ({ utcTimestamp }) =>\n      this._dateTimeFormat.formatDateTime({\n        utcTimestamp,\n      }),\n    onLogCall,\n    isLoggedContact,\n    composeTextRoute = '/composeText',\n  }) {\n    return {\n      dateTimeFormatter,\n      onViewContact: onViewContact\n        ? async ({ phoneNumber, contact }) => {\n            const hasMatchNumber = await this._contactMatcher.hasMatchNumber({\n              phoneNumber,\n              ignoreCache: true,\n            });\n            if (hasMatchNumber) {\n              await onViewContact({ phoneNumber, contact });\n            }\n          }\n        : undefined,\n      onCreateContact: onCreateContact\n        ? async ({ phoneNumber, name, entityType }) => {\n            const hasMatchNumber = await this._contactMatcher.hasMatchNumber({\n              phoneNumber,\n              ignoreCache: true,\n            });\n            if (!hasMatchNumber) {\n              await onCreateContact({ phoneNumber, name, entityType });\n              await this._contactMatcher.forceMatchNumber({ phoneNumber });\n            }\n          }\n        : undefined,\n      isLoggedContact,\n      onLogCall:\n        onLogCall ||\n        (this._callLogger &&\n          (async ({ call, contact, redirect = true }) => {\n            await this._callLogger.logCall({\n              call,\n              contact,\n              redirect,\n            });\n          })),\n      onClickToSms: this._composeText\n        ? async (contact, isDummyContact = false) => {\n            if (this._routerInteraction) {\n              this._routerInteraction.push(composeTextRoute);\n            }\n            if (contact.name && contact.phoneNumber && isDummyContact) {\n              this._composeText.updateTypingToNumber(contact.name);\n              this._contactSearch.search({ searchString: contact.name });\n            } else {\n              this._composeText.addToNumber(contact);\n              if (this._composeText.typingToNumber === contact.phoneNumber) {\n                this._composeText.cleanTypingToNumber();\n              }\n            }\n          }\n        : undefined,\n      webphoneAnswer: (...args) =>\n        this._webphone && this._webphone.answer(...args),\n      webphoneReject: (...args) =>\n        this._webphone && this._webphone.reject(...args),\n      webphoneHangup: (...args) =>\n        this._webphone && this._webphone.hangup(...args),\n      webphoneResume: (...args) =>\n        this._webphone && this._webphone.resume(...args),\n    };\n  }\n}\n"],"file":"CallMonitorUI.js"}