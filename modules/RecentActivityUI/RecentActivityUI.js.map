{"version":3,"sources":["modules/RecentActivityUI/RecentActivityUI.ts"],"names":["RecentActivityUI","name","deps","dep","optional","options","currentLocale","_deps","locale","navigateTo","dateTimeFormatter","dateTimeFormat","formatDateTime","getSession","useContact","getContact","showRecentCalls","showRecentMessage","showFax","showVoiceMails","sessionId","currentContact","ready","recentMessages","recentCalls","session","id","contactMatch","contactMapping","contactMatcher","dataMapping","phoneNumber","direction","callDirections","outbound","to","from","entities","length","title","i18n","getString","showSpinner","calls","tabs","getTabs","defaultTab","RcUIModuleV2"],"mappings":"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","sourcesContent":["import {\n  RcUIModuleV2,\n  UIFunctions,\n  UIProps,\n} from '@ringcentral-integration/core';\nimport callDirections from 'ringcentral-integration/enums/callDirections';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport i18n from './i18n';\nimport { getTabs, GetTabsOptions } from './getTabs';\nimport {\n  Deps,\n  RecentActivityContainerProps,\n  RecentActivityPanelProps,\n} from './RecentActivityUI.interface';\n\n@Module({\n  name: 'RecentActivityUI',\n  deps: [\n    'Locale',\n    'DateTimeFormat',\n    'RecentMessages',\n    'RecentCalls',\n    'ContactMatcher',\n    { dep: 'RecentActivityUIOptions', optional: true },\n  ],\n})\nexport class RecentActivityUI<T extends Deps = Deps> extends RcUIModuleV2<T> {\n  constructor(deps: T) {\n    super({\n      deps,\n    });\n  }\n\n  getTabs(options: GetTabsOptions) {\n    return getTabs(options);\n  }\n\n  getUIProps({\n    currentLocale = this._deps.locale.currentLocale,\n    navigateTo,\n    dateTimeFormatter = (...args) =>\n      this._deps.dateTimeFormat.formatDateTime(...args),\n    getSession,\n    useContact = false,\n    getContact,\n    showRecentCalls = true,\n    showRecentMessage = true,\n    showFax = true,\n    showVoiceMails = true,\n  }: RecentActivityContainerProps): UIProps<RecentActivityPanelProps> {\n    let sessionId: string = null;\n    let currentContact = getContact?.();\n    let ready =\n      this._deps.dateTimeFormat.ready &&\n      this._deps.locale.ready &&\n      this._deps.recentMessages.ready &&\n      this._deps.recentCalls.ready;\n    if (!useContact) {\n      const session = getSession();\n      sessionId = session.id;\n      currentContact = session.contactMatch;\n      const contactMapping = this._deps.contactMatcher.dataMapping;\n      const phoneNumber =\n        session.direction === callDirections.outbound\n          ? session.to\n          : session.from;\n      if (!currentContact) {\n        const entities = contactMapping?.[phoneNumber];\n        if (entities?.length >= 1) {\n          currentContact = entities[0];\n        }\n      }\n      ready = ready && this._deps.contactMatcher.ready;\n    }\n    return {\n      currentLocale,\n      title: i18n.getString(\n        'recentActivities',\n        this._deps.locale.currentLocale,\n      ),\n      showSpinner: !ready,\n      currentContact,\n      calls: this._deps.recentCalls.calls ?? {},\n      tabs: this.getTabs({\n        ready,\n        currentLocale,\n        dateTimeFormatter,\n        navigateTo,\n        currentContact,\n        recentMessages: this._deps.recentMessages,\n        recentCalls: this._deps.recentCalls,\n        sessionId,\n        showFax,\n        showRecentCalls,\n        showVoiceMails,\n        showRecentMessage,\n      }),\n      defaultTab: 'recentCalls',\n    };\n  }\n\n  getUIFunctions(): UIFunctions<RecentActivityPanelProps> {\n    return {};\n  }\n}\n"],"file":"RecentActivityUI.js"}