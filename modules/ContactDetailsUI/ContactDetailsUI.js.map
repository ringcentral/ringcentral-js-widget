{"version":3,"sources":["modules/ContactDetailsUI/ContactDetailsUI.js"],"names":["DEFAULT_DIALER_ROUTE","DEFAULT_COMPOSETEXT_ROUTE","ContactDetailsUI","name","deps","dep","optional","routerInteraction","contactSearch","contacts","rolesAndPermissions","rateLimiter","regionSettings","connectivityManager","call","dialerUI","composeText","brand","locale","callingSettings","extensionInfo","composeTextRoute","dialerRoute","options","_routerInteraction","_contactSearch","_contacts","_extensionInfo","_rolesAndPermissions","_rateLimiter","_regionSettings","_connectivityManager","_call","_dialerUI","_composeText","_brand","_locale","_callingSettings","_composeTextRoute","_dialerRoute","id","type","direct","contact","find","push","getProfileImage","getPresence","phoneNumber","recipient","isIdle","store","dispatch","actionTypes","clickToCall","addToNumber","typingToNumber","cleanTypingToNumber","clickToSMS","params","contactId","contactType","currentLocale","getContact","isMultipleSiteEnabled","isClickToDialEnabled","callingEnabled","isCallButtonDisabled","isOfflineMode","isWebphoneUnavailableMode","isWebphoneInitializing","throttling","isClickToTextEnabled","disableLinks","isVoipOnlyMode","showSpinner","ready","outboundSmsPermission","permissions","OutboundSMS","internalSmsPermission","InternalSMS","formatNumber","cleanedNumber","toString","isE164Number","formattedNumber","countryCode","site","code","siteCode","onBackClick","goBack","onClickToDial","handleClickToDial","onClickToSMS","handleClickToSMS","ObjectMap","prefixKeys","RcUIModule","proxify"],"mappings":"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","sourcesContent":["import { Module } from 'ringcentral-integration/lib/di';\nimport { ObjectMap } from '@ringcentral-integration/core/lib/ObjectMap';\nimport {\n  isE164,\n  parseIncompletePhoneNumber,\n} from '@ringcentral-integration/phone-number';\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\nimport proxify from 'ringcentral-integration/lib/proxy/proxify';\nimport { ContactModel } from 'ringcentral-integration/models/Contact.model';\nimport RcUIModule from '../../lib/RcUIModule';\nimport {\n  ContactDetailsViewProps,\n  ContactDetailsViewFunctionProps,\n} from '../../components/ContactDetailsView/ContactDetailsView.interface';\n\nconst DEFAULT_DIALER_ROUTE = '/dialer';\nconst DEFAULT_COMPOSETEXT_ROUTE = '/composeText';\n\n@Module({\n  name: 'ContactDetailsUI',\n  deps: [\n    'RouterInteraction',\n    'ContactSearch',\n    'Contacts',\n    'ExtensionInfo',\n    'RolesAndPermissions',\n    'RateLimiter',\n    'RegionSettings',\n    'ConnectivityManager',\n    'Call',\n    'DialerUI',\n    'ComposeText',\n    'Brand',\n    'Locale',\n    'CallingSettings',\n    {\n      dep: 'ContactDetailsUIOptions',\n      optional: true,\n    },\n  ],\n})\nexport class ContactDetailsUI extends RcUIModule {\n  // for track\n  constructor({\n    routerInteraction,\n    contactSearch,\n    contacts,\n    rolesAndPermissions,\n    rateLimiter,\n    regionSettings,\n    connectivityManager,\n    call,\n    dialerUI,\n    composeText,\n    brand,\n    locale,\n    callingSettings,\n    extensionInfo,\n    composeTextRoute = DEFAULT_COMPOSETEXT_ROUTE,\n    dialerRoute = DEFAULT_DIALER_ROUTE,\n    ...options\n  }) {\n    super({\n      routerInteraction,\n      contactSearch,\n      contacts,\n      rolesAndPermissions,\n      rateLimiter,\n      regionSettings,\n      connectivityManager,\n      call,\n      dialerUI,\n      composeText,\n      brand,\n      locale,\n      callingSettings,\n      ...options,\n    });\n    this._routerInteraction = routerInteraction;\n    this._contactSearch = contactSearch;\n    this._contacts = contacts;\n    this._extensionInfo = extensionInfo;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._rateLimiter = rateLimiter;\n    this._regionSettings = regionSettings;\n    this._connectivityManager = connectivityManager;\n    this._call = call;\n    this._dialerUI = dialerUI;\n    this._composeText = composeText;\n    this._brand = brand;\n    this._locale = locale;\n    this._callingSettings = callingSettings;\n    this._composeTextRoute = composeTextRoute;\n    this._dialerRoute = dialerRoute;\n  }\n\n  get _actionTypes() {\n    return ObjectMap.prefixKeys(\n      [\n        //\n        'clickToSMS',\n        'clickToCall',\n      ],\n      'contactDetails',\n    );\n  }\n\n  @proxify\n  showContactDetails({ id, type, direct = false }) {\n    const contact = this._contacts.find({ id, type });\n    if (contact) {\n      this._routerInteraction.push(\n        `/contacts/${type}/${id}${direct ? '?direct=true' : ''}`,\n      );\n      this._contacts.getProfileImage(contact, false);\n      this._contacts.getPresence(contact, false);\n    }\n  }\n\n  getContact({ id, type }): ContactModel {\n    return this._contacts.find({ id, type });\n  }\n\n  @proxify\n  async handleClickToDial(contact, phoneNumber) {\n    const recipient = {\n      ...contact,\n      phoneNumber,\n    };\n    if (this._call.isIdle) {\n      this._routerInteraction.push(this._dialerRoute);\n      this._dialerUI.call({ recipient });\n      this.store.dispatch({\n        type: this.actionTypes.clickToCall,\n      });\n    }\n  }\n\n  @proxify\n  async handleClickToSMS(contact, phoneNumber) {\n    const recipient = {\n      ...contact,\n      phoneNumber,\n    };\n    if (this._routerInteraction) {\n      this._routerInteraction.push(this._composeTextRoute);\n    }\n\n    this._composeText.addToNumber(recipient);\n    if (this._composeText.typingToNumber === recipient.phoneNumber) {\n      this._composeText.cleanTypingToNumber();\n    }\n    // for tracking\n    this.store.dispatch({\n      type: this.actionTypes.clickToSMS,\n    });\n  }\n\n  getUIProps({ params: { contactId, contactType } }): ContactDetailsViewProps {\n    return {\n      currentLocale: this._locale.currentLocale,\n      contact: this.getContact({\n        id: contactId,\n        type: contactType,\n      }),\n      isMultipleSiteEnabled: this._extensionInfo.isMultipleSiteEnabled ?? false,\n      isClickToDialEnabled: !!(\n        this._dialerUI && this._rolesAndPermissions.callingEnabled\n      ),\n      isCallButtonDisabled: !!(\n        this._connectivityManager.isOfflineMode ||\n        this._connectivityManager.isWebphoneUnavailableMode ||\n        this._connectivityManager.isWebphoneInitializing ||\n        this._rateLimiter.throttling\n      ),\n      isClickToTextEnabled: !!this._composeText,\n      disableLinks: !!(\n        this._connectivityManager.isOfflineMode ||\n        this._connectivityManager.isVoipOnlyMode ||\n        this._rateLimiter.throttling\n      ),\n      showSpinner: !(\n        this._locale.ready &&\n        this._contactSearch.ready &&\n        this._rolesAndPermissions.ready\n      ),\n      outboundSmsPermission: !!(\n        this._rolesAndPermissions.permissions &&\n        this._rolesAndPermissions.permissions.OutboundSMS\n      ),\n      internalSmsPermission: !!(\n        this._rolesAndPermissions.permissions &&\n        this._rolesAndPermissions.permissions.InternalSMS\n      ),\n    };\n  }\n\n  getUIFunctions(): ContactDetailsViewFunctionProps {\n    return {\n      formatNumber: (phoneNumber: string) => {\n        // if the cleaned phone number is not a E164 format\n        // we will show it directly, doesn't format it.\n        const cleanedNumber: string = parseIncompletePhoneNumber(\n          phoneNumber.toString(),\n        );\n        const isE164Number = isE164(cleanedNumber);\n        if (isE164Number) {\n          const formattedNumber: string = formatNumber({\n            phoneNumber,\n            countryCode: this._regionSettings.countryCode,\n          });\n          return formattedNumber;\n        }\n        // if multi-site is enabled then we will try to remove site code with same site\n        if (\n          this._extensionInfo.isMultipleSiteEnabled &&\n          this._extensionInfo.site?.code\n        ) {\n          const formattedNumber: string = formatNumber({\n            phoneNumber,\n            countryCode: this._regionSettings.countryCode,\n            siteCode: this._extensionInfo.site?.code,\n            isMultipleSiteEnabled: this._extensionInfo.isMultipleSiteEnabled,\n          });\n          return formattedNumber;\n        }\n        return phoneNumber;\n      },\n      onBackClick: () => {\n        this._routerInteraction.goBack();\n      },\n      onClickToDial: (contact: ContactModel, phoneNumber: string) =>\n        this.handleClickToDial(contact, phoneNumber),\n      onClickToSMS: (contact: ContactModel, phoneNumber: string) =>\n        this.handleClickToSMS(contact, phoneNumber),\n    };\n  }\n}\n"],"file":"ContactDetailsUI.js"}