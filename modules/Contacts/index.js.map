{"version":3,"sources":["modules/Contacts/index.js"],"names":["DefaultContactListPageSize","Contacts","deps","dep","optional","auth","contactSources","options","actionTypes","_auth","ensureExist","call","_reducer","_contactSources","Map","_sourcesLastStatus","_sourcesUpdatedAt","Date","now","source","addSource","store","subscribe","_onStateChange","_shouldInit","dispatch","type","initSuccess","_shouldReset","_resetModuleStatus","loggedIn","sourceModuleReady","pending","ready","resetSuccess","sourceFilter","searchFilter","updateFilter","sourceName","Error","has","getPresence","getProfileImage","searchContacts","matchPhoneNumber","set","updated","Array","from","keys","get","lastStatus","sourceReady","data","contacts","searchString","sources","values","filter","result","Promise","all","map","promise","resolve","then","concat","error","console","phoneNumber","phoneNumbers","id","contactId","toString","find","x","contact","useCache","sync","state","status","RcModule","proxify","selector","size","_checkSourceUpdated","names","AllContactSourceName","push","filteredContacts","allContacts"],"mappings":"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","sourcesContent":["import { selector } from '../../lib/selector';\nimport RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport isBlank from '../../lib/isBlank';\nimport {\n  uniqueContactItems,\n  sortContactItemsByName,\n  groupByFirstLetterOfName,\n  filterContacts,\n  AllContactSourceName,\n} from '../../lib/contactHelper';\nimport proxify from '../../lib/proxy/proxify';\nimport actionTypes from './actionTypes';\nimport getContactsReducer from './getContactsReducer';\n\nexport const DefaultContactListPageSize = 20;\n\n/**\n * @class\n * @description Contacts managing module\n */\n@Module({\n  deps: [\n    'Auth',\n    { dep: 'ContactSources', optional: true },\n    { dep: 'ContactsOptions', optional: true },\n  ],\n})\nexport default class Contacts extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Auth} params.auth - auth module instance\n   */\n  constructor({ auth, contactSources = [], ...options }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = ensureExist.call(this, auth, 'auth');\n    this._reducer = getContactsReducer(this.actionTypes);\n    this._contactSources = new Map();\n    this._sourcesLastStatus = new Map();\n    this._sourcesUpdatedAt = Date.now();\n\n    for (const source of contactSources) {\n      this.addSource(source);\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this._resetModuleStatus();\n    }\n  }\n\n  _shouldInit() {\n    return this._auth.loggedIn && this.sourceModuleReady && this.pending;\n  }\n\n  _shouldReset() {\n    return (!this._auth.loggedIn || !this.sourceModuleReady) && this.ready;\n  }\n\n  _resetModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  @proxify\n  updateFilter({ sourceFilter, searchFilter }) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFilter,\n      sourceFilter,\n      searchFilter,\n    });\n  }\n\n  /**\n   * @function\n   * @param {Object} source - source module object\n   * @param {String} params.sourceName - source name\n   * @param {Bool} params.ready - source module ready status\n   * @param {Bool} params.sourceReady - source ready status\n   * @param {Array} params.contacts - source contacts data\n   * @param {Function} params.getPresence - get source presence function, optional\n   * @param {Function} params.getProfileImage - get source profile image function, optional\n   * @param {Function} params.sync - sync source data function, optional\n   * @param {Function} params.matchPhoneNumber - get match phoneNumber function, optional\n   */\n  addSource(source) {\n    if (!source.sourceName) {\n      throw new Error('[Contacts > ContactSource > sourceName] is required');\n    }\n    if (this._contactSources.has(source.sourceName)) {\n      throw new Error(\n        `[Contacts > ContactSource(${source.sourceName}) > sourceName] already exists`,\n      );\n    }\n    if (source.getPresence && typeof source.getPresence !== 'function') {\n      throw new Error(\n        `[Contacts > ContactSource(${source.sourceName}) > getPresence] must be a function`,\n      );\n    }\n    if (\n      source.getProfileImage &&\n      typeof source.getProfileImage !== 'function'\n    ) {\n      throw new Error(\n        `[Contacts > ContactSource(${source.sourceName}) > getProfileImage] must be a function`,\n      );\n    }\n    if (source.searchContacts && typeof source.searchContacts !== 'function') {\n      throw new Error(\n        `[Contacts > ContactSource(${source.sourceName}) > searchContacts] must be a function`,\n      );\n    }\n    if (\n      source.matchPhoneNumber &&\n      typeof source.matchPhoneNumber !== 'function'\n    ) {\n      throw new Error(\n        `[Contacts > ContactSource(${source.sourceName}) > matchPhoneNumber] must be a function`,\n      );\n    }\n    this._contactSources.set(source.sourceName, source);\n    this._sourcesLastStatus.set(source.sourceName, {});\n    this._sourcesUpdatedAt = Date.now();\n  }\n\n  _checkSourceUpdated() {\n    let updated = false;\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      const lastStatus = this._sourcesLastStatus.get(sourceName);\n      if (\n        lastStatus.ready !== source.sourceReady ||\n        lastStatus.data !== source.contacts\n      ) {\n        updated = true;\n        this._sourcesLastStatus.set(sourceName, {\n          ready: source.sourceReady,\n          data: source.contacts,\n        });\n      }\n    }\n    if (updated) {\n      this._sourcesUpdatedAt = Date.now();\n    }\n    return this._sourcesUpdatedAt;\n  }\n\n  async searchContacts(searchString) {\n    const sources = Array.from(this._contactSources.values()).filter(\n      (source) => typeof source.searchContacts === 'function',\n    );\n    let result = [];\n    await Promise.all(\n      sources.map((source) => {\n        const promise = Promise.resolve(source.searchContacts(searchString));\n        return promise\n          .then((contacts) => {\n            result = result.concat(contacts);\n          })\n          .catch((error) => {\n            console.error(\n              `[Contacts > ContactSource(${source.sourceName}) > searchContacts] ${error}`,\n            );\n          });\n      }),\n    );\n    return result;\n  }\n\n  async matchPhoneNumber(phoneNumber) {\n    const sources = Array.from(this._contactSources.values()).filter(\n      (source) => typeof source.matchPhoneNumber === 'function',\n    );\n    let result = [];\n    await Promise.all(\n      sources.map((source) => {\n        const promise = Promise.resolve(source.matchPhoneNumber(phoneNumber));\n        return promise\n          .then((contacts) => {\n            result = result.concat(contacts);\n          })\n          .catch((error) => {\n            console.error(\n              `[Contacts > ContactSource(${source.sourceName}) > matchPhoneNumber] ${error}`,\n            );\n          });\n      }),\n    );\n    return result;\n  }\n\n  async matchContacts({ phoneNumbers }) {\n    const result = {};\n    await Promise.all(\n      phoneNumbers.map((phoneNumber) => {\n        const promise = this.matchPhoneNumber(phoneNumber);\n        return promise.then((contacts) => {\n          result[phoneNumber] = contacts;\n        });\n      }),\n    );\n    return result;\n  }\n\n  find({ type, id }) {\n    const contactId = (id || '').toString();\n    const source = this._contactSources.get(type);\n    if (source) {\n      return source.contacts.find((x) => x.id.toString() === contactId);\n    }\n    return null;\n  }\n\n  @proxify\n  async getProfileImage(contact, useCache = true) {\n    const source = this._contactSources.get(contact && contact.type);\n    if (source && source.getProfileImage) {\n      const result = await source.getProfileImage(contact, useCache);\n      return result;\n    }\n    return null;\n  }\n\n  @proxify\n  async getPresence(contact, useCache = true) {\n    const source = this._contactSources.get(contact && contact.type);\n    if (source && source.getPresence) {\n      const result = await source.getPresence(contact, useCache);\n      return result;\n    }\n    return null;\n  }\n\n  @proxify\n  async sync(...args) {\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      if (typeof source.sync === 'function') {\n        await source.sync(...args);\n      }\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get sourceModuleReady() {\n    let ready = true;\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      if (!source.ready) {\n        ready = false;\n      }\n    }\n    return ready;\n  }\n\n  get companyContacts() {\n    const source = this._contactSources.get('company');\n    if (source) {\n      return source.contacts;\n    }\n    return [];\n  }\n\n  get personalContacts() {\n    const source = this._contactSources.get('personal');\n    if (source) {\n      return source.contacts;\n    }\n    return [];\n  }\n\n  get searchFilter() {\n    return this.state.searchFilter;\n  }\n\n  get sourceFilter() {\n    return this.state.sourceFilter;\n  }\n\n  @selector\n  sourceNames = [\n    () => this._contactSources.size,\n    () => this._checkSourceUpdated(),\n    () => {\n      const names = [AllContactSourceName];\n      for (const sourceName of Array.from(this._contactSources.keys())) {\n        const source = this._contactSources.get(sourceName);\n        if (source.sourceReady) {\n          names.push(sourceName);\n        }\n      }\n      return names;\n    },\n  ];\n\n  @selector\n  allContacts = [\n    () => this._checkSourceUpdated(),\n    () => {\n      let contacts = [];\n      for (const sourceName of Array.from(this._contactSources.keys())) {\n        const source = this._contactSources.get(sourceName);\n        if (source.sourceReady) {\n          contacts = contacts.concat(source.contacts);\n        }\n      }\n      return contacts;\n    },\n  ];\n\n  @selector\n  contactGroups = [\n    () => this.filteredContacts,\n    (filteredContacts) =>\n      groupByFirstLetterOfName(\n        sortContactItemsByName(uniqueContactItems(filteredContacts)),\n      ),\n  ];\n\n  @selector\n  filteredContacts = [\n    () => this.searchFilter,\n    () => this.sourceFilter,\n    () => this._checkSourceUpdated(),\n    (searchFilter, sourceFilter) => {\n      let contacts;\n      if (\n        isBlank(searchFilter) &&\n        (sourceFilter === AllContactSourceName || isBlank(sourceFilter))\n      ) {\n        return this.allContacts;\n      }\n      if (sourceFilter !== AllContactSourceName && !isBlank(sourceFilter)) {\n        const source = this._contactSources.get(sourceFilter);\n        if (source && source.sourceReady) {\n          /* eslint { \"prefer-destructuring\": 0 } */\n          contacts = source.contacts;\n        } else {\n          contacts = [];\n        }\n      } else {\n        contacts = this.allContacts;\n      }\n      if (!isBlank(searchFilter)) {\n        contacts = filterContacts(contacts, searchFilter);\n      }\n      return contacts;\n    },\n  ];\n}\n"],"file":"index.js"}