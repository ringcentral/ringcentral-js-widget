{"version":3,"sources":["modules/Contacts/index.js"],"names":["DefaultContactListPageSize","Contacts","deps","dep","optional","auth","contactSources","options","actionTypes","_auth","ensureExist","_reducer","_contactSources","Map","_sourcesLastStatus","_sourcesUpdatedAt","Date","now","source","addSource","store","subscribe","_onStateChange","_shouldInit","dispatch","type","initSuccess","_shouldReset","_resetModuleStatus","loggedIn","sourceModuleReady","pending","ready","resetSuccess","sourceFilter","searchFilter","updateFilter","sourceName","Error","has","getPresence","getProfileImage","matchPhoneNumber","set","updated","Array","from","keys","get","lastStatus","sourceReady","data","contacts","phoneNumber","result","concat","phoneNumbers","forEach","id","contactId","toString","find","x","contact","useCache","sync","state","status","RcModule","proxify","selector","size","_checkSourceUpdated","names","AllContactSourceName","push","filteredContacts","allContacts"],"mappings":"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","sourcesContent":["import { selector } from '../../lib/selector';\nimport RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport isBlank from '../../lib/isBlank';\nimport {\n  uniqueContactItems,\n  sortContactItemsByName,\n  groupByFirstLetterOfName,\n  filterContacts,\n  AllContactSourceName,\n} from '../../lib/contactHelper';\nimport proxify from '../../lib/proxy/proxify';\nimport actionTypes from './actionTypes';\nimport getContactsReducer from './getContactsReducer';\n\nexport const DefaultContactListPageSize = 20;\n\n/**\n * @class\n * @description Contacts managing module\n */\n@Module({\n  deps: [\n    'Auth',\n    { dep: 'ContactSources', optional: true },\n    { dep: 'ContactsOptions', optional: true },\n  ],\n})\nexport default class Contacts extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Auth} params.auth - auth module instance\n   */\n  constructor({ auth, contactSources = [], ...options }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = this::ensureExist(auth, 'auth');\n    this._reducer = getContactsReducer(this.actionTypes);\n    this._contactSources = new Map();\n    this._sourcesLastStatus = new Map();\n    this._sourcesUpdatedAt = Date.now();\n\n    for (const source of contactSources) {\n      this.addSource(source);\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this._resetModuleStatus();\n    }\n  }\n\n  _shouldInit() {\n    return this._auth.loggedIn && this.sourceModuleReady && this.pending;\n  }\n\n  _shouldReset() {\n    return (!this._auth.loggedIn || !this.sourceModuleReady) && this.ready;\n  }\n\n  _resetModuleStatus() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  @proxify\n  updateFilter({ sourceFilter, searchFilter }) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFilter,\n      sourceFilter,\n      searchFilter,\n    });\n  }\n\n  /**\n   * @function\n   * @param {Object} source - source module object\n   * @param {String} params.sourceName - source name\n   * @param {Bool} params.ready - source module ready status\n   * @param {Bool} params.sourceReady - source ready status\n   * @param {Array} params.contacts - source contacts data\n   * @param {Function} params.getPresence - get source presence function, optional\n   * @param {Function} params.getProfileImage - get source profile image function, optional\n   * @param {Function} params.sync - sync source data function, optional\n   * @param {Function} params.matchPhoneNumber - get match phoneNumber function, optional\n   */\n  addSource(source) {\n    if (!source.sourceName) {\n      throw new Error('Contacts: \"sourceName\" is required in Contacts source.');\n    }\n    if (this._contactSources.has(source.sourceName)) {\n      throw new Error(\n        `Contacts: A contact source named \"${source.sourceName}\" already exists`,\n      );\n    }\n    if (source.getPresence && typeof source.getPresence !== 'function') {\n      throw new Error(\"Contacts: source' getPresence must be a function\");\n    }\n    if (\n      source.getProfileImage &&\n      typeof source.getProfileImage !== 'function'\n    ) {\n      throw new Error(\"Contacts: source' getProfileImage must be a function\");\n    }\n    if (\n      source.matchPhoneNumber &&\n      typeof source.matchPhoneNumber !== 'function'\n    ) {\n      throw new Error(\"Contacts: source' matchPhoneNumber must be a function\");\n    }\n    this._contactSources.set(source.sourceName, source);\n    this._sourcesLastStatus.set(source.sourceName, {});\n    this._sourcesUpdatedAt = Date.now();\n  }\n\n  _checkSourceUpdated() {\n    let updated = false;\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      const lastStatus = this._sourcesLastStatus.get(sourceName);\n      if (\n        lastStatus.ready !== source.sourceReady ||\n        lastStatus.data !== source.contacts\n      ) {\n        updated = true;\n        this._sourcesLastStatus.set(sourceName, {\n          ready: source.sourceReady,\n          data: source.contacts,\n        });\n      }\n    }\n    if (updated) {\n      this._sourcesUpdatedAt = Date.now();\n    }\n    return this._sourcesUpdatedAt;\n  }\n\n  matchPhoneNumber(phoneNumber) {\n    let result = [];\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      if (typeof source.matchPhoneNumber === 'function') {\n        result = result.concat(source.matchPhoneNumber(phoneNumber));\n      }\n    }\n    return result;\n  }\n\n  matchContacts({ phoneNumbers }) {\n    const result = {};\n    phoneNumbers.forEach((phoneNumber) => {\n      result[phoneNumber] = this.matchPhoneNumber(phoneNumber);\n    });\n    return result;\n  }\n\n  find({ type, id }) {\n    const contactId = (id || '').toString();\n    const source = this._contactSources.get(type);\n    if (source) {\n      return source.contacts.find((x) => x.id.toString() === contactId);\n    }\n    return null;\n  }\n\n  @proxify\n  async getProfileImage(contact, useCache = true) {\n    const source = this._contactSources.get(contact && contact.type);\n    if (source && source.getProfileImage) {\n      const result = await source.getProfileImage(contact, useCache);\n      return result;\n    }\n    return null;\n  }\n\n  @proxify\n  async getPresence(contact, useCache = true) {\n    const source = this._contactSources.get(contact && contact.type);\n    if (source && source.getPresence) {\n      const result = await source.getPresence(contact, useCache);\n      return result;\n    }\n    return null;\n  }\n\n  @proxify\n  async sync(...args) {\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      if (typeof source.sync === 'function') {\n        await source.sync(...args);\n      }\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get sourceModuleReady() {\n    let ready = true;\n    for (const sourceName of Array.from(this._contactSources.keys())) {\n      const source = this._contactSources.get(sourceName);\n      if (!source.ready) {\n        ready = false;\n      }\n    }\n    return ready;\n  }\n\n  get companyContacts() {\n    const source = this._contactSources.get('company');\n    if (source) {\n      return source.contacts;\n    }\n    return [];\n  }\n\n  get personalContacts() {\n    const source = this._contactSources.get('personal');\n    if (source) {\n      return source.contacts;\n    }\n    return [];\n  }\n\n  get searchFilter() {\n    return this.state.searchFilter;\n  }\n\n  get sourceFilter() {\n    return this.state.sourceFilter;\n  }\n\n  @selector\n  sourceNames = [\n    () => this._contactSources.size,\n    () => this._checkSourceUpdated(),\n    () => {\n      const names = [AllContactSourceName];\n      for (const sourceName of Array.from(this._contactSources.keys())) {\n        const source = this._contactSources.get(sourceName);\n        if (source.sourceReady) {\n          names.push(sourceName);\n        }\n      }\n      return names;\n    },\n  ];\n\n  @selector\n  allContacts = [\n    () => this._checkSourceUpdated(),\n    () => {\n      let contacts = [];\n      for (const sourceName of Array.from(this._contactSources.keys())) {\n        const source = this._contactSources.get(sourceName);\n        if (source.sourceReady) {\n          contacts = contacts.concat(source.contacts);\n        }\n      }\n      return contacts;\n    },\n  ];\n\n  @selector\n  contactGroups = [\n    () => this.filteredContacts,\n    (filteredContacts) =>\n      groupByFirstLetterOfName(\n        sortContactItemsByName(uniqueContactItems(filteredContacts)),\n      ),\n  ];\n\n  @selector\n  filteredContacts = [\n    () => this.searchFilter,\n    () => this.sourceFilter,\n    () => this._checkSourceUpdated(),\n    (searchFilter, sourceFilter) => {\n      let contacts;\n      if (\n        isBlank(searchFilter) &&\n        (sourceFilter === AllContactSourceName || isBlank(sourceFilter))\n      ) {\n        return this.allContacts;\n      }\n      if (sourceFilter !== AllContactSourceName && !isBlank(sourceFilter)) {\n        const source = this._contactSources.get(sourceFilter);\n        if (source && source.sourceReady) {\n          /* eslint { \"prefer-destructuring\": 0 } */\n          contacts = source.contacts;\n        } else {\n          contacts = [];\n        }\n      } else {\n        contacts = this.allContacts;\n      }\n      if (!isBlank(searchFilter)) {\n        contacts = filterContacts(contacts, searchFilter);\n      }\n      return contacts;\n    },\n  ];\n}\n"],"file":"index.js"}