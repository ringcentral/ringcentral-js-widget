{"version":3,"sources":["modules/CallingSettings/index.js"],"names":["CallingSettings","deps","dep","optional","alert","brand","extensionInfo","extensionPhoneNumber","forwardingNumber","storage","rolesAndPermissions","tabManager","onFirstLogin","webphone","callerId","emergencyCallAvailable","defaultRingoutPrompt","options","actionTypes","_alert","_brand","_extensionInfo","_extensionPhoneNumber","_forwardingNumber","_storage","_rolesAndPermissions","_tabManager","_webphone","_callerId","_storageKey","_emergencyCallAvailable","_onFirstLogin","initRingoutPrompt","registerReducer","key","reducer","_reducer","store","subscribe","_onStateChange","_shouldInit","dispatch","type","init","_init","initSuccess","_shouldReset","_reset","_shouldValidate","_ringoutEnabled","ringoutEnabled","_webphoneEnabled","webphoneEnabled","_myPhoneNumbers","myPhoneNumbers","_otherPhoneNumbers","otherPhoneNumbers","_validateSettings","ready","pending","callingEnabled","timestamp","defaultCallWith","callWithOptions","setData","callWith","Date","now","_warningEmergencyCallingNotAvailable","_initFromNumber","resetSuccess","fromNumber","defaultCallerId","fromNumbers","ringOut","phoneNumber","defaultPhoneNumber","phoneInfo","defaultEntry","find","item","updateFromNumber","number","callingOptions","softphone","_hasWebphonePermissionRemoved","_setSoftPhoneToCallWith","danger","message","callingSettingsMessages","webphonePermissionRemoved","ttl","_hasPermissionChanged","permissionChanged","_hasPhoneNumberChanged","myphone","myLocation","phoneNumberChanged","browser","otherphone","customphone","indexOf","info","emergencyCallingNotAvailable","withPrompt","ringoutPrompt","saveSuccessWithSoftphone","saveSuccess","getItem","state","status","moduleStatuses","data","callingMode","callingModes","driver","RcModule","proxify","selector","length","numbers","hasOtherPhone","hasExtensionPhoneNumber","push","directNumbers","mainCompanyNumber","extensionNumber","map","flipNumbers","callerIdNumbers","filterMapping","forEach","filter","sort","a","b","label","phoneNumbers","firstItem","lastItem","usageType"],"mappings":"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","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport {\n  getCallingSettingsReducer,\n  getCallingSettingsStorageReducer,\n} from './getCallingSettingsReducer';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport mapOptionToMode from './mapOptionToMode';\nimport callingOptions from './callingOptions';\nimport callingModes from './callingModes';\nimport callingSettingsMessages from './callingSettingsMessages';\nimport actionTypes from './actionTypes';\nimport proxify from '../../lib/proxy/proxify';\nimport { selector } from '../../lib/selector';\n\n/**\n * @class\n * @description Call setting managing module\n */\n@Module({\n  deps: [\n    'Alert',\n    'Brand',\n    'ExtensionInfo',\n    'ExtensionPhoneNumber',\n    'ForwardingNumber',\n    'Storage',\n    'RolesAndPermissions',\n    { dep: 'CallerId', optional: true },\n    { dep: 'TabManager', optional: true },\n    { dep: 'Webphone', optional: true },\n    { dep: 'CallingSettingsOptions', optional: true },\n  ],\n})\nexport default class CallingSettings extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Alert} params.alert - alert module instance\n   * @param {Brand} params.brand - brand module instance\n   * @param {ExtensionInfo} params.extensionInfo - extensionInfo module instance\n   * @param {ExtensionPhoneNumber} params.extensionPhoneNumber - extensionPhoneNumber module instance\n   * @param {ForwardingNumber} params.forwardingNumber - forwardingNumber module instance\n   * @param {Storage} params.storage - storage module instance\n   * @param {RolesAndPermissions} params.rolesAndPermissions - rolesAndPermissions module instance\n   * @param {TabManager} params.tabManager - tabManager module instance\n   * @param {Webphone} params.webphone - webphone module instance\n   * @param {Function} params.onFirstLogin - func on first login\n   */\n  constructor({\n    alert,\n    brand,\n    extensionInfo,\n    extensionPhoneNumber,\n    forwardingNumber,\n    storage,\n    rolesAndPermissions,\n    tabManager,\n    onFirstLogin,\n    webphone,\n    callerId,\n    emergencyCallAvailable = false,\n    defaultRingoutPrompt,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._alert = alert;\n    this._brand = brand;\n    this._extensionInfo = extensionInfo;\n    this._extensionPhoneNumber = extensionPhoneNumber;\n    this._forwardingNumber = forwardingNumber;\n    this._storage = storage;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._tabManager = tabManager;\n    this._webphone = webphone;\n    this._callerId = callerId;\n    this._storageKey = 'callingSettingsData';\n    this._emergencyCallAvailable = emergencyCallAvailable;\n\n    this._onFirstLogin = onFirstLogin;\n    this.initRingoutPrompt = defaultRingoutPrompt;\n\n    this._storage.registerReducer({\n      key: this._storageKey,\n      reducer: getCallingSettingsStorageReducer(this.actionTypes),\n    });\n\n    this._reducer = getCallingSettingsReducer(this.actionTypes);\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      await this._init();\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this._reset();\n    } else if (this._shouldValidate()) {\n      this._ringoutEnabled = this._rolesAndPermissions.ringoutEnabled;\n      this._webphoneEnabled = this._rolesAndPermissions.webphoneEnabled;\n      this._myPhoneNumbers = this.myPhoneNumbers;\n      this._otherPhoneNumbers = this.otherPhoneNumbers;\n      await this._validateSettings();\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._storage.ready &&\n      this._extensionInfo.ready &&\n      this._extensionPhoneNumber.ready &&\n      this._forwardingNumber.ready &&\n      (!this._callerId || this._callerId.ready) &&\n      this._rolesAndPermissions.ready &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return !!(\n      this.ready &&\n      (!this._storage.ready ||\n        !this._extensionInfo.ready ||\n        !this._extensionPhoneNumber.ready ||\n        !this._forwardingNumber.ready ||\n        !this._rolesAndPermissions.ready ||\n        (this._callerId && !this._callerId.ready))\n    );\n  }\n\n  _shouldValidate() {\n    return (\n      this.ready &&\n      (this._ringoutEnabled !== this._rolesAndPermissions.ringoutEnabled ||\n        this._webphoneEnabled !== this._rolesAndPermissions.webphoneEnabled ||\n        this._myPhoneNumbers !== this.myPhoneNumbers ||\n        this._otherPhoneNumbers !== this.otherPhoneNumbers)\n    );\n  }\n\n  async _init() {\n    if (!this._rolesAndPermissions.callingEnabled) return;\n    this._myPhoneNumbers = this.myPhoneNumbers;\n    this._otherPhoneNumbers = this.otherPhoneNumbers;\n    this._ringoutEnabled = this._rolesAndPermissions.ringoutEnabled;\n    this._webphoneEnabled = this._rolesAndPermissions.webphoneEnabled;\n    if (!this.timestamp) {\n      // first time login\n      const defaultCallWith = this.callWithOptions && this.callWithOptions[0];\n      this.store.dispatch({\n        type: this.actionTypes.setData,\n        callWith: defaultCallWith,\n        timestamp: Date.now(),\n      });\n      if (!this._emergencyCallAvailable) {\n        this._warningEmergencyCallingNotAvailable();\n      }\n      if (typeof this._onFirstLogin === 'function') {\n        this._onFirstLogin();\n      }\n    }\n    await this._validateSettings();\n    await this._initFromNumber();\n  }\n\n  _reset() {\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  @proxify\n  async _initFromNumber() {\n    const fromNumber = this.fromNumber;\n    if (!fromNumber) {\n      let defaultCallerId = this.fromNumbers[0];\n      if (this._callerId?.ringOut) {\n        if (this._callerId.ringOut.type === 'Blocked') {\n          defaultCallerId = { phoneNumber: 'anonymous' };\n        } else if (this._callerId.ringOut.type === 'PhoneNumber') {\n          const defaultPhoneNumber = this._callerId?.ringOut.phoneInfo\n            ?.phoneNumber;\n          const defaultEntry = this.fromNumbers.find(\n            (item) => item.phoneNumber === defaultPhoneNumber,\n          );\n          if (defaultEntry) {\n            defaultCallerId = defaultEntry;\n          }\n        }\n      }\n      await this.updateFromNumber(defaultCallerId);\n    }\n  }\n\n  @proxify\n  async updateFromNumber(number) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFromNumber,\n      number: number && number.phoneNumber,\n    });\n  }\n\n  @proxify\n  async _setSoftPhoneToCallWith() {\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      callWith: callingOptions.softphone,\n      timestamp: Date.now(),\n    });\n  }\n\n  @proxify\n  async _validateSettings() {\n    if (this._hasWebphonePermissionRemoved()) {\n      await this._setSoftPhoneToCallWith();\n      this._alert.danger({\n        message: callingSettingsMessages.webphonePermissionRemoved,\n        ttl: 0,\n      });\n    } else if (this._hasPermissionChanged()) {\n      await this._setSoftPhoneToCallWith();\n      this._alert.danger({\n        message: callingSettingsMessages.permissionChanged,\n        ttl: 0,\n      });\n    } else if (this._hasPhoneNumberChanged()) {\n      this.store.dispatch({\n        type: this.actionTypes.setData,\n        callWith: callingOptions.myphone,\n        myLocation: this._myPhoneNumbers[0],\n        timestamp: Date.now(),\n      });\n      this._alert.danger({\n        message: callingSettingsMessages.phoneNumberChanged,\n        ttl: 0,\n      });\n    }\n  }\n\n  _hasWebphonePermissionRemoved() {\n    return (\n      !(this._webphoneEnabled && this._webphone) &&\n      this.callWith === callingOptions.browser\n    );\n  }\n\n  _hasPermissionChanged() {\n    return (\n      !this._ringoutEnabled &&\n      (this.callWith === callingOptions.myphone ||\n        this.callWith === callingOptions.otherphone ||\n        this.callWith === callingOptions.customphone)\n    );\n  }\n\n  _hasPhoneNumberChanged() {\n    return (\n      (this.callWith === callingOptions.otherphone &&\n        this._otherPhoneNumbers.indexOf(this.myLocation) === -1) ||\n      (this.callWith === callingOptions.myphone &&\n        this._myPhoneNumbers.indexOf(this.myLocation) === -1)\n    );\n  }\n\n  @proxify\n  async _warningEmergencyCallingNotAvailable() {\n    if (this.callWith === callingOptions.browser) {\n      this._alert.info({\n        message: callingSettingsMessages.emergencyCallingNotAvailable,\n        ttl: 0,\n      });\n    }\n  }\n\n  get data() {\n    return this._storage.getItem(this._storageKey);\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.state.status === moduleStatuses.ready;\n  }\n\n  get pending() {\n    return this.state.status === moduleStatuses.pending;\n  }\n\n  get callWith() {\n    return this.data.callWith;\n  }\n\n  get callingMode() {\n    return mapOptionToMode(this.callWith);\n  }\n\n  get ringoutPrompt() {\n    return this.data.ringoutPrompt;\n  }\n\n  get defaultRingoutPrompt() {\n    return this.initRingoutPrompt;\n  }\n\n  get myLocation() {\n    return this.data.myLocation;\n  }\n\n  get timestamp() {\n    return this.data.timestamp;\n  }\n\n  get isWebphoneMode() {\n    return this.callingMode === callingModes.webphone;\n  }\n\n  @selector\n  callWithOptions = [\n    () => this._rolesAndPermissions.ringoutEnabled,\n    () => this._rolesAndPermissions.webphoneEnabled,\n    () => this.otherPhoneNumbers.length > 0,\n    () => this._extensionPhoneNumber.numbers.length > 0,\n    (\n      ringoutEnabled,\n      webphoneEnabled,\n      hasOtherPhone,\n      hasExtensionPhoneNumber,\n    ) => {\n      if (!hasExtensionPhoneNumber) {\n        return [callingOptions.softphone];\n      }\n      const callWithOptions = [];\n      if (this._webphone && webphoneEnabled) {\n        callWithOptions.push(callingOptions.browser);\n      }\n      callWithOptions.push(callingOptions.softphone);\n      if (ringoutEnabled) {\n        callWithOptions.push(callingOptions.myphone);\n        if (hasOtherPhone) {\n          callWithOptions.push(callingOptions.otherphone);\n        }\n        callWithOptions.push(callingOptions.customphone);\n      }\n      return callWithOptions;\n    },\n  ];\n\n  @selector\n  myPhoneNumbers = [\n    () => this._extensionPhoneNumber.directNumbers,\n    () => this._extensionPhoneNumber.mainCompanyNumber,\n    () => this._extensionInfo.extensionNumber,\n    (directNumbers, mainCompanyNumber, extensionNumber) => {\n      const myPhoneNumbers = directNumbers.map((item) => item.phoneNumber);\n      if (mainCompanyNumber && extensionNumber) {\n        myPhoneNumbers.push(\n          `${mainCompanyNumber.phoneNumber}*${extensionNumber}`,\n        );\n      }\n      return myPhoneNumbers;\n    },\n  ];\n\n  @selector\n  otherPhoneNumbers = [\n    () => this._forwardingNumber.flipNumbers,\n    () => this._extensionPhoneNumber.callerIdNumbers,\n    () => this._extensionPhoneNumber.directNumbers,\n    (flipNumbers, callerIdNumbers, directNumbers) => {\n      const filterMapping = {};\n      callerIdNumbers.forEach((item) => {\n        filterMapping[item.phoneNumber] = true;\n      });\n      directNumbers.forEach((item) => {\n        filterMapping[item.phoneNumber] = true;\n      });\n      return flipNumbers\n        .filter((item) => !filterMapping[item.phoneNumber])\n        .sort((a, b) => (a.label === 'Mobile' && a.label !== b.label ? -1 : 1))\n        .map((item) => item.phoneNumber);\n    },\n  ];\n\n  @selector\n  availableNumbers = [\n    () => this.myPhoneNumbers,\n    () => this.otherPhoneNumbers,\n    (myPhoneNumbers, otherPhoneNumbers) => ({\n      [callingOptions.myphone]: myPhoneNumbers,\n      [callingOptions.otherphone]: otherPhoneNumbers,\n    }),\n  ];\n\n  get fromNumber() {\n    return this.data.fromNumber;\n  }\n\n  @selector\n  fromNumbers = [\n    () => this._extensionPhoneNumber.callerIdNumbers,\n    (phoneNumbers) =>\n      phoneNumbers.sort((firstItem, lastItem) => {\n        if (firstItem.usageType === 'DirectNumber') return -1;\n        if (lastItem.usageType === 'DirectNumber') return 1;\n        if (firstItem.usageType === 'MainCompanyNumber') return -1;\n        if (lastItem.usageType === 'MainCompanyNumber') return 1;\n        if (firstItem.usageType < lastItem.usageType) return -1;\n        if (firstItem.usageType > lastItem.usageType) return 1;\n        return 0;\n      }),\n  ];\n\n  @proxify\n  async setData({ callWith, myLocation, ringoutPrompt }, withPrompt) {\n    // TODO validate myLocation\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      callWith,\n      myLocation,\n      ringoutPrompt,\n      timestamp: Date.now(),\n    });\n    if (withPrompt) {\n      if (this.callWith === callingOptions.softphone) {\n        this._alert.info({\n          message: callingSettingsMessages.saveSuccessWithSoftphone,\n        });\n      } else {\n        this._alert.info({\n          message: callingSettingsMessages.saveSuccess,\n        });\n        if (!this._emergencyCallAvailable) {\n          this._warningEmergencyCallingNotAvailable();\n        }\n      }\n    }\n  }\n\n  /* ringtone */\n  get isChangeRingToneAllowed() {\n    return (\n      this._webphone &&\n      (this._storage.driver === 'INDEXEDDB' ||\n        this._storage.driver === 'WEBSQL')\n    );\n  }\n}\n"],"file":"index.js"}