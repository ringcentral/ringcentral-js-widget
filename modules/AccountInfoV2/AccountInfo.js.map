{"version":3,"sources":["modules/AccountInfoV2/AccountInfo.ts"],"names":["AccountInfo","name","deps","dep","optional","data","info","serviceInfo","_source","DataSource","accountInfoOptions","key","fetchFunction","_deps","client","account","get","readyCheckFunction","rolesAndPermissions","ready","permissionCheckFunction","_checkPermission","cleanOnReset","dataFetcherV2","register","permissions","ReadCompanyInfo","auth","loggedIn","logout","alert","danger","message","permissionsMessages","insufficientPrivilege","ttl","servicePlan","id","brand","homeCountry","country","isoCode","mainNumber","DataFetcherV2Consumer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;AAEA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAcaA,W,WAXZ,gBAAO;AACNC,EAAAA,IAAI,EAAE,aADA;AAENC,EAAAA,IAAI,EAAE,CACJ,MADI,EAEJ,QAFI,EAGJ,qBAHI,EAIJ,OAJI,EAKJ,eALI,EAMJ;AAAEC,IAAAA,GAAG,EAAE,oBAAP;AAA6BC,IAAAA,QAAQ,EAAE;AAAvC,GANI;AAFA,CAAP,C,UA6CE,oBAAsB;AAAA,MAAGC,IAAH,QAAGA,IAAH;AAAA,SAAc,CAACA,IAAD,CAAd;AAAA,CAAtB,C,UAKA,oBAAsB;AAAA,MAAGC,IAAH,SAAGA,IAAH;AAAA,SAAc,CAACA,IAAD,CAAd;AAAA,CAAtB,C,UAKA,oBAAsB;AAAA,MAAGC,WAAH,SAAGA,WAAH;AAAA,SAAqB,CAACA,WAAD,CAArB;AAAA,CAAtB,C;;;;;AAxCD,uBAAYL,IAAZ,EAAwB;AAAA;;AAAA;;AACtB,8BAAM;AACJA,MAAAA,IAAI,EAAJA;AADI,KAAN;AAGA,UAAKM,OAAL,GAAe,IAAIC,wBAAJ,iCACVP,IAAI,CAACQ,kBADK;AAEbC,MAAAA,GAAG,EAAE,aAFQ;AAGbC,MAAAA,aAAa;AAAA,qFAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACN,MAAKC,KAAL,CAAWC,MAAX,CAAkBC,OAAlB,GAA4BC,GAA5B,EADM;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA,SAHA;AAKbC,MAAAA,kBAAkB,EAAE;AAAA,eAAM,CAAC,CAAC,MAAKJ,KAAL,CAAWK,mBAAX,CAA+BC,KAAvC;AAAA,OALP;AAMbC,MAAAA,uBAAuB,EAAE;AAAA,eAAM,MAAKC,gBAAL,EAAN;AAAA,OANZ;AAObC,MAAAA,YAAY,EAAE;AAPD,OAAf;;AASA,UAAKT,KAAL,CAAWU,aAAX,CAAyBC,QAAzB,CAAkC,MAAKhB,OAAvC;;AAbsB;AAcvB;;;;uCAE4B;AAC3B,aAAO,CAAC,CAAC,KAAKK,KAAL,CAAWK,mBAAX,CAA+BO,WAA/B,CAA2CC,eAApD;AACD;;;;;;;;;sBAGK,KAAKb,KAAL,CAAWc,IAAX,CAAgBC,QAAhB,IAA4B,KAAKT,KAAjC,IAA0C,CAAC,KAAKE,gBAAL,E;;;;;;uBACvC,KAAKR,KAAL,CAAWc,IAAX,CAAgBE,MAAhB,E;;;AACN,qBAAKhB,KAAL,CAAWiB,KAAX,CAAiBC,MAAjB,CAAwB;AACtBC,kBAAAA,OAAO,EAAEC,yCAAoBC,qBADP;AAEtBC,kBAAAA,GAAG,EAAE;AAFiB,iBAAxB;;;;;;;;;;;;;;;;;;wBAQO;AAAA;;AACT,2BAAO,KAAK9B,IAAZ,mDAAoB,EAApB;AACD;;;wBAGiB;AAAA;;AAChB,sCAAO,KAAKC,IAAL,CAAUC,WAAjB,yEAAgC,EAAhC;AACD;;;wBAGiB;AAAA;;AAChB,sCAAO,KAAKA,WAAL,CAAiB6B,WAAxB,yEAAuC,EAAvC;AACD;;;wBAEQ;AACP,aAAO,KAAK9B,IAAL,CAAU+B,EAAjB;AACD;;;wBAEa;AAAA;;AACZ,sCAAO,KAAK9B,WAAL,CAAiB+B,KAAxB,0DAAO,sBAAwBC,WAA/B;AACD;;;wBAEiB;AAAA;;AAChB,uDAAO,KAAKC,OAAZ,kDAAO,cAAcC,OAArB,yEAAgC,IAAhC;AACD;;;wBAEuB;AACtB,aAAO,KAAKnC,IAAL,CAAUoC,UAAjB;AACD;;;;EA/D8BC,mC","sourcesContent":["import { GetAccountInfoResponse } from '@rc-ex/core/definitions';\nimport { computed } from '@ringcentral-integration/core';\n\nimport { Module } from '../../lib/di';\nimport { DataFetcherV2Consumer, DataSource } from '../DataFetcherV2';\nimport { permissionsMessages } from '../RolesAndPermissions/permissionsMessages';\nimport { Deps } from './AccountInfo.interfaces';\n\n@Module({\n  name: 'AccountInfo',\n  deps: [\n    'Auth',\n    'Client',\n    'RolesAndPermissions',\n    'Alert',\n    'DataFetcherV2',\n    { dep: 'AccountInfoOptions', optional: true },\n  ],\n})\nexport class AccountInfo extends DataFetcherV2Consumer<\n  Deps,\n  GetAccountInfoResponse\n> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n    this._source = new DataSource({\n      ...deps.accountInfoOptions,\n      key: 'accountInfo',\n      fetchFunction: async () =>\n        (await this._deps.client.account().get()) as GetAccountInfoResponse,\n      readyCheckFunction: () => !!this._deps.rolesAndPermissions.ready,\n      permissionCheckFunction: () => this._checkPermission(),\n      cleanOnReset: true,\n    });\n    this._deps.dataFetcherV2.register(this._source);\n  }\n\n  protected _checkPermission() {\n    return !!this._deps.rolesAndPermissions.permissions.ReadCompanyInfo;\n  }\n\n  async onStateChange() {\n    if (this._deps.auth.loggedIn && this.ready && !this._checkPermission()) {\n      await this._deps.auth.logout();\n      this._deps.alert.danger({\n        message: permissionsMessages.insufficientPrivilege,\n        ttl: 0,\n      });\n    }\n  }\n\n  @computed<AccountInfo>(({ data }) => [data])\n  get info() {\n    return this.data ?? {};\n  }\n\n  @computed<AccountInfo>(({ info }) => [info])\n  get serviceInfo() {\n    return this.info.serviceInfo ?? {};\n  }\n\n  @computed<AccountInfo>(({ serviceInfo }) => [serviceInfo])\n  get servicePlan() {\n    return this.serviceInfo.servicePlan ?? {};\n  }\n\n  get id() {\n    return this.info.id;\n  }\n\n  get country() {\n    return this.serviceInfo.brand?.homeCountry;\n  }\n\n  get countryCode() {\n    return this.country?.isoCode ?? 'US';\n  }\n\n  get mainCompanyNumber() {\n    return this.info.mainNumber;\n  }\n}\n"],"file":"AccountInfo.js"}