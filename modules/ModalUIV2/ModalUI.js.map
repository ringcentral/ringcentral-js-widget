{"version":3,"sources":["modules/ModalUIV2/ModalUI.tsx"],"names":["defaultOKRendererID","defaultCancelRendererID","infoTitleRendererID","defaultOKRenderer","currentLocale","i18n","getString","defaultCancelRenderer","infoTitleRenderer","onOK","title","close","ModalUI","name","deps","_modals","_deps","locale","_rendererRegister","Map","_handlerRegister","_promises","registerRenderer","modalState","push","idx","item","id","Error","handlerID","args","get","loading","useLoadingOverlay","showLoadingOverlay","_setLoading","handler","resolve","_removeModal","onCancel","set","renderer","props","handlerIDs","oldProps","key","Object","prototype","hasOwnProperty","call","findIndex","_removeHandler","splice","result","oldID","_registerHandler","_genericHandler","oldState","titleProps","contentProps","footerProps","slice","dehydratedState","_dehydrateFunctions","undefined","usePromise","disableBackdropClick","fullScreen","_getDehydratedState","open","_addModal","resolveFn","promise","Promise","updatedState","_updateModal","okText","cancelText","variant","modals","content","footer","uiProps","_onOK","onExited","_onExited","_onCancel","renderedTitle","_rehydrateFunctions","RcUIModuleV2","state","action","proxify","background"],"mappings":"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","sourcesContent":["import {\n  action,\n  computed,\n  RcUIModuleV2,\n  state,\n} from '@ringcentral-integration/core';\nimport {\n  RcDialogHeader,\n  RcDialogHeaderActions,\n  RcDialogHeaderTitle,\n  RcIconButton,\n} from '@ringcentral/juno';\nimport close from '@ringcentral/juno/icon/Close';\nimport { filter, find, findIndex, map } from 'ramda';\nimport React from 'react';\nimport background from 'ringcentral-integration/lib/background';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport proxify from 'ringcentral-integration/lib/proxy/proxify';\nimport { v4 } from 'uuid';\n\nimport {\n  ModalProps,\n  ModalV2UIFunctions,\n  ModalV2UIProps,\n} from '../../components/ModalV2/interface';\nimport i18n from './i18n';\nimport {\n  AlertModalOptions,\n  ConfirmModalOptions,\n  CustomRenderer,\n  CustomRendererProps,\n  DehydratedModalState,\n  Deps,\n  HandlerFunction,\n  InfoModalOptions,\n  ModalOptions,\n} from './ModalUI.interface';\n\nexport const defaultOKRendererID = 'ModalUI.defaultOKRendererID';\nexport const defaultCancelRendererID = 'ModalUI.defaultCancelRendererID';\nexport const infoTitleRendererID = 'ModalUI.infoTitleRendererID';\n\nexport const defaultOKRenderer: CustomRenderer = ({ currentLocale }) =>\n  i18n.getString('ok', currentLocale);\n\nexport const defaultCancelRenderer: CustomRenderer = ({ currentLocale }) =>\n  i18n.getString('cancel', currentLocale);\n\nexport const infoTitleRenderer: CustomRenderer = ({\n  currentLocale,\n  onOK,\n  title,\n}) => (\n  <RcDialogHeader>\n    <RcDialogHeaderTitle>{title}</RcDialogHeaderTitle>\n    <RcDialogHeaderActions overlapSize={2.5}>\n      <RcIconButton\n        tooltipTitle={i18n.getString('close', currentLocale)}\n        symbol={close}\n        onClick={onOK}\n      />\n    </RcDialogHeaderActions>\n  </RcDialogHeader>\n);\n@Module({\n  name: 'ModalUI',\n  deps: ['Locale'],\n})\nexport class ModalUI extends RcUIModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({\n      deps,\n    });\n    this.registerRenderer(defaultOKRendererID, defaultOKRenderer);\n    this.registerRenderer(defaultCancelRendererID, defaultCancelRenderer);\n    this.registerRenderer(infoTitleRendererID, infoTitleRenderer);\n  }\n\n  @state\n  private _modals: DehydratedModalState[] = [];\n\n  @action\n  private _addModal(modalState: DehydratedModalState) {\n    this._modals.push(modalState);\n  }\n\n  @action\n  private _updateModal(modalState: DehydratedModalState) {\n    const idx = findIndex((item) => item.id === modalState.id, this._modals);\n    if (idx === -1) {\n      throw new Error(`modal id \"${modalState.id} not found`);\n    }\n    this._modals[idx] = modalState;\n  }\n\n  @action\n  private _removeModal(id: string) {\n    this._modals = filter((item) => item.id !== id, this._modals);\n  }\n\n  private _rendererRegister = new Map<string, CustomRenderer<any>>();\n  private _handlerRegister = new Map<string, Map<string, HandlerFunction>>();\n  private _promises = new Map<\n    string,\n    { promise: Promise<boolean>; resolve: (ok: boolean) => void }\n  >();\n\n  @proxify\n  private async _genericHandler(id: string, handlerID: string, ...args: any) {\n    return this._handlerRegister.get(id)?.get(handlerID)?.(...args);\n  }\n\n  @action\n  private _setLoading(id: string, loading: boolean) {\n    const idx = findIndex((item) => item.id === id, this._modals);\n    if (this._modals[idx].useLoadingOverlay) {\n      this._modals[idx].showLoadingOverlay = loading;\n    } else {\n      this._modals[idx].loading = loading;\n    }\n  }\n\n  @proxify\n  private async _onOK(id: string, onOK?: string) {\n    this._setLoading(id, true);\n    const handler = this._handlerRegister.get(id).get(onOK);\n    if (handler && (await handler()) === false) {\n      this._setLoading(id, false);\n      return;\n    }\n    this._promises.get(id).resolve(true);\n    this._promises.delete(id);\n    this.close(id);\n  }\n\n  @proxify\n  private async _onExited(id: string) {\n    this._promises.get(id)?.resolve(false);\n    this._promises.delete(id);\n    this._removeModal(id);\n    this._handlerRegister.delete(id);\n  }\n\n  @proxify\n  private async _onCancel(id: string, onCancel?: string) {\n    this._handlerRegister.get(id).get(onCancel)?.();\n    this.close(id);\n  }\n\n  private _registerHandler(id: string, handler: HandlerFunction) {\n    const handlerID = v4();\n    this._handlerRegister.get(id).set(handlerID, handler);\n    return handlerID;\n  }\n\n  private _removeHandler(id: string, handlerID: string) {\n    this._handlerRegister.get(id).delete(handlerID);\n  }\n\n  registerRenderer<T extends CustomRendererProps = CustomRendererProps>(\n    id: string,\n    renderer: CustomRenderer<T>,\n  ) {\n    this._rendererRegister.set(id, renderer);\n  }\n\n  private _dehydrateFunctions(\n    id: string,\n    props: any,\n    handlerIDs: string[],\n    oldProps?: any,\n  ): any {\n    if (props === null) {\n      // check oldProps for existing handlers and remove them\n      if (oldProps) {\n        for (const key in oldProps) {\n          if (Object.prototype.hasOwnProperty.call(oldProps, key)) {\n            const idx = handlerIDs.findIndex((id) => id === oldProps[key]);\n            if (idx > -1) {\n              this._removeHandler(id, oldProps[key]);\n              handlerIDs.splice(idx, 1);\n            }\n          }\n        }\n      }\n      return null;\n    }\n    const result = { ...oldProps, ...props };\n    for (const key in props) {\n      if (Object.prototype.hasOwnProperty.call(props, key)) {\n        if (typeof props[key] === 'function') {\n          // check if old handler exist\n          const oldID =\n            oldProps &&\n            oldProps[key] &&\n            find((id) => id === oldProps[key], handlerIDs);\n          if (oldID) {\n            // replace oldHandler\n            this._handlerRegister.get(id).set(oldID, props[key]);\n          } else {\n            const handlerID = this._registerHandler(id, props[key]);\n            handlerIDs.push(handlerID);\n            result[key] = handlerID;\n          }\n        } else if (\n          oldProps &&\n          Object.prototype.hasOwnProperty.call(oldProps, key)\n        ) {\n          const idx = handlerIDs.findIndex((id) => id === oldProps[key]);\n          if (idx > -1) {\n            this._removeHandler(id, oldProps[key]);\n            handlerIDs.splice(idx, 1);\n          }\n        }\n      }\n    }\n    return result;\n  }\n\n  private _rehydrateFunctions(id: string, props: any, handlerIDs: string[]) {\n    const result = { ...props };\n    for (const key in props) {\n      if (\n        Object.prototype.hasOwnProperty.call(props, key) &&\n        findIndex((id) => id === props[key], handlerIDs) > -1\n      ) {\n        result[key] = (...args: any) =>\n          this._genericHandler(id, props[key], ...args);\n      }\n    }\n    return result;\n  }\n\n  private _getDehydratedState(\n    {\n      titleProps,\n      contentProps,\n      footerProps,\n      ...props\n    }: Partial<ModalOptions> & {\n      id: string;\n      open?: boolean;\n    },\n    oldState?: DehydratedModalState,\n  ): DehydratedModalState {\n    const handlerIDs = oldState?.handlerIDs?.slice() ?? [];\n    const dehydratedState: DehydratedModalState = {\n      ...this._dehydrateFunctions(props.id, props, handlerIDs, oldState),\n      handlerIDs,\n    };\n    if (titleProps !== undefined) {\n      dehydratedState.titleProps = this._dehydrateFunctions(\n        props.id,\n        titleProps,\n        handlerIDs,\n        oldState?.titleProps,\n      );\n    }\n    if (contentProps !== undefined) {\n      dehydratedState.contentProps = this._dehydrateFunctions(\n        props.id,\n        contentProps,\n        handlerIDs,\n        oldState?.contentProps,\n      );\n    }\n    if (footerProps !== undefined) {\n      dehydratedState.footerProps = this._dehydrateFunctions(\n        props.id,\n        footerProps,\n        handlerIDs,\n        oldState?.footerProps,\n      );\n    }\n    return dehydratedState;\n  }\n\n  public open(props: ModalOptions): string;\n  public open(props: ModalOptions, usePromise: true): Promise<boolean>;\n  @background\n  open(\n    { disableBackdropClick = true, fullScreen = false, ...props }: ModalOptions,\n    usePromise?: boolean,\n  ) {\n    const id = v4();\n    this._handlerRegister.set(id, new Map<string, HandlerFunction>());\n    const dehydratedState = this._getDehydratedState({\n      ...props,\n      id,\n      disableBackdropClick,\n      fullScreen,\n      open: true,\n    });\n\n    this._addModal(dehydratedState);\n    let resolveFn;\n    const promise = new Promise<boolean>((resolve) => {\n      resolveFn = resolve;\n    });\n    this._promises.set(id, {\n      promise,\n      resolve: resolveFn,\n    });\n    return usePromise ? promise : id;\n  }\n\n  /**\n   *\n   * @returns Whether the update is successful.\n   */\n  @background\n  update(props: Partial<ModalOptions> & { id: string }) {\n    const oldState = find((item) => item.id === props.id, this._modals);\n    if (!oldState) {\n      return false;\n    }\n    const updatedState = this._getDehydratedState(props, oldState);\n    this._updateModal(updatedState);\n    return true;\n  }\n\n  @background\n  close(id: string) {\n    const dehydratedState = find((item) => item.id === id, this._modals);\n    if (!dehydratedState) {\n      throw new Error(`modal id \"${id} not found`);\n    }\n    const updatedState = {\n      ...dehydratedState,\n      open: false,\n    };\n    this._updateModal(updatedState);\n  }\n\n  public confirm(props: ConfirmModalOptions): string;\n  public confirm(\n    props: ConfirmModalOptions,\n    usePromise: true,\n  ): Promise<boolean>;\n  @background\n  confirm(props: ConfirmModalOptions = {}, usePromise?: true) {\n    return this.open(\n      {\n        okText: defaultOKRendererID,\n        cancelText: defaultCancelRendererID,\n        ...props,\n        variant: 'confirm',\n      },\n      usePromise,\n    ) as any;\n  }\n\n  public alert(props: AlertModalOptions): string;\n  public alert(props: AlertModalOptions, usePromise: true): Promise<boolean>;\n  @background\n  alert(props: AlertModalOptions = {}, usePromise?: true) {\n    return this.open(\n      {\n        okText: defaultOKRendererID,\n        ...props,\n        variant: 'alert',\n      },\n      usePromise,\n    ) as any;\n  }\n\n  public info(props: InfoModalOptions): string;\n  public info(props: InfoModalOptions, usePromise: true): Promise<boolean>;\n  @background\n  info(props: InfoModalOptions, usePromise?: true) {\n    return this.open(\n      {\n        ...props,\n        variant: 'info',\n      },\n      usePromise,\n    ) as any;\n  }\n\n  @computed<ModalUI>(({ _modals, _deps: { locale: { currentLocale } } }) => [\n    _modals,\n    currentLocale,\n  ])\n  get modals() {\n    const currentLocale = this._deps.locale.currentLocale;\n    return map(\n      ({\n        id,\n        onOK,\n        onCancel,\n        title,\n        content,\n        footer,\n        okText,\n        cancelText,\n        titleProps = {},\n        contentProps = {},\n        footerProps = {},\n        variant,\n        handlerIDs,\n        ...props\n      }) => {\n        const uiProps: ModalProps = {\n          ...props,\n          key: id,\n          onOK: () => this._onOK(id, onOK),\n          onExited: () => this._onExited(id),\n        };\n        if (onCancel || cancelText) {\n          uiProps.onCancel = () => this._onCancel(id, onCancel);\n        }\n        const renderedTitle =\n          this._rendererRegister.get(title)?.({\n            currentLocale,\n            ...this._rehydrateFunctions(id, titleProps, handlerIDs),\n            onOK: uiProps.onOK,\n            onCancel: uiProps.onCancel,\n          }) ?? title;\n        uiProps.title =\n          variant === 'info'\n            ? this._rendererRegister.get(infoTitleRendererID)({\n                title: renderedTitle,\n                onOK: uiProps.onOK,\n                currentLocale,\n              })\n            : renderedTitle;\n\n        uiProps.content =\n          this._rendererRegister.get(content)?.({\n            currentLocale,\n            ...this._rehydrateFunctions(id, contentProps, handlerIDs),\n            onOK: uiProps.onOK,\n            onCancel: uiProps.onCancel,\n          }) ?? content;\n\n        uiProps.footer =\n          variant === 'info'\n            ? null\n            : this._rendererRegister.get(footer)?.({\n                currentLocale,\n                ...this._rehydrateFunctions(id, footerProps, handlerIDs),\n                onOK: uiProps.onOK,\n                onCancel: uiProps.onCancel,\n              }) ?? footer;\n\n        uiProps.okText =\n          (this._rendererRegister.get(okText)?.({\n            currentLocale,\n            onOK: uiProps.onOK,\n            onCancel: uiProps.onCancel,\n          }) as string) ?? okText;\n\n        uiProps.cancelText =\n          (this._rendererRegister.get(cancelText)?.({\n            currentLocale,\n            onOK: uiProps.onOK,\n            onCancel: uiProps.onCancel,\n          }) as string) ?? cancelText;\n\n        return uiProps;\n      },\n      this._modals,\n    );\n  }\n\n  @background\n  getPromise(id: string) {\n    return this._promises.get(id).promise;\n  }\n\n  getUIFunctions(): ModalV2UIFunctions {\n    return {};\n  }\n\n  getUIProps(): ModalV2UIProps {\n    return {\n      modals: this.modals,\n    };\n  }\n}\n"],"file":"ModalUI.js"}