{"version":3,"sources":["modules/MeetingV2/Meeting.ts"],"names":["Meeting","name","deps","dep","optional","that","userSettings","scheduleMeeting","enablePersonalMeeting","enableServiceWebSettings","scheduleUserSettings","usePmiForScheduledMeetings","extensionInfo","info","id","lockedSettings","scheduleLockedSettings","personalMeeting","enableCache","storageKey","_fetchDelegatorsTimeout","_fetchPersonMeetingTimeout","delegators","preferences","isPreferencesChanged","meeting","updatingStatus","lastMeetingSetting","savedDefaultMeetingSetting","isScheduling","_init","_deps","videoConfiguration","isRCM","ready","clearTimeout","getDelegators","records","length","updateDelegators","loginUser","console","error","warn","setTimeout","_initScheduleFor","extensionId","_initPersonalMeeting","_updateServiceWebSettings","_initMeeting","_initMeetingSettings","enableScheduleOnBehalf","update","defaultMeetingSetting","host","updatePreferences","_updatePreferences","_updateIsPreferencesChanged","_meeting","combineWithSettings","finalMeeting","isMeetingPasswordValid","validatePasswordSettings","password","_requireMeetingPassword","updateMeetingState","_comparePreferences","updateIsPreferencesChanged","isSecret","RCM_PASSWORD_REGEX","test","_combineWithSWSettings","usePersonalMeetingId","processedMeeting","allowJoinBeforeHost","requirePasswordForPmiMeetings","lockedRequirePasswordForPmiMeetings","PMIRequirePassword","JBH_ONLY","_pmiPassword","_lockRequireMeetingPassword","fetchPersonalMeeting","meetingInfoResponse","formatPersonalMeeting","updatePersonalMeeting","resetPersonalMeeting","Promise","all","getUserSettings","getLockedSettings","updateUserSettings","updateLockedSettings","pmiDefaultSettings","generalDefaultSettings","formattedMeeting","_format","updateSavedDefaultMeetingSetting","_saved","notShowAgain","isAlertSuccess","schedule","_promise","updateIsScheduling","_validate","showSaveAsDefault","saveAsDefault","saveAsDefaultSetting","postMeeting","getMeetingServiceInfo","resp","serviceInfo","getMeetingInvitation","invitationInfo","updateLastMeetingSetting","_createDialingNumberTpl","result","enableReloadAfterSchedule","externalUserInfo","personalMeetingId","alert","success","message","meetingStatus","scheduledSuccess","_errorHandle","meetingId","_isUpdating","updateMeeting","addUpdatingStatus","putMeeting","updatedSuccess","removeUpdatingStatus","userExtensionId","hostId","user","item","_updateDelegators","_updateUserSettings","_updateLockedSettings","_updatePersonalMeeting","_updateMeetingState","_updateUpdatingStatus","finalStatus","obj","LAST_MEETING_SETTINGS","_updateLastMeetingSetting","savedDefaulteSetting","SAVED_DEFAULT_MEETING_SETTINGS","_updateSavedDefaultMeetingSetting","_updateIsScheduling","getMeeting","Error","client","account","extension","get","post","put","isAlertError","settings","response","clone","json","errorCode","log","isMeetingDeleted","indexOf","danger","meetingIsDeleted","service","platform","res","send","method","url","apiResponse","recording","startParticipantsVideo","startParticipantVideo","restScheduleOptions","processedScheduleMeeting","enableInvitationApi","brand","code","invitation","meetingInfo","shortId","initialMeetingSetting","extensionName","currentHost","MeetingErrors","invalidMeetingInfo","topic","errors","push","emptyTopic","noPassword","durationInMinutes","durationIncorrect","meetingType","startHostVideo","audioOptions","recurrence","formatted","MeetingType","RECURRING","_schedule","timeZone","enableCustomTimezone","UTC_TIMEZONE_ID","startTime","moment","utc","format","until","PMI","SCHEDULED","mobileDialingNumberTpl","dialInNumbers","phoneDialingNumberTpl","warning","permissionName","insufficientPermissions","payload","availabilityMonitor","checkIfHAError","internalError","usePmi","personalMeetingSettings","pmiRequiresPwd","NONE","ALL","pmiRequiresPwdLocked","requirePasswordForSchedulingNewMeetings","lockedRequirePasswordForSchedulingNewMeetings","ASSISTED_USERS_MYSELF","isLoginUser","COMMON_SETTINGS","_initDefaultData","settingLock","defaultLockedSettings","commonUserSettings","commonPersonalMeetingSettings","savedSetting","initialSetting","usePmiDefaultFromSW","meetingName","_getExtensionName","_getHostId","setting","DEFAULT_LOCK_SETTINGS","meetingOptions","RcModuleV2","state","storage","action","background","proxify"],"mappings":"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","sourcesContent":["import { MeetingServiceInfoResource } from '@rc-ex/core/definitions';\nimport {\n  action,\n  computed,\n  RcModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\nimport moment from 'moment';\nimport { filter, find, isEmpty, pick } from 'ramda';\n\nimport {\n  comparePreferences,\n  generateRandomPassword,\n  getDefaultMeetingSettings,\n  getInitializedStartTime,\n  getMobileDialingNumberTpl,\n  getPhoneDialingNumberTpl,\n  MeetingType,\n  prunePreferencesObject,\n  UTC_TIMEZONE_ID,\n} from '../../helpers/meetingHelper';\nimport { IMeeting } from '../../interfaces/Meeting.interface';\nimport background from '../../lib/background';\nimport { Module } from '../../lib/di';\nimport proxify from '../../lib/proxy/proxify';\nimport {\n  ASSISTED_USERS_MYSELF,\n  COMMON_SETTINGS,\n  DEFAULT_LOCK_SETTINGS,\n  LAST_MEETING_SETTINGS,\n  PMIRequirePassword,\n  RCM_PASSWORD_REGEX,\n  SAVED_DEFAULT_MEETING_SETTINGS,\n} from './constants';\nimport {\n  CommonPersonalMeetingSettings,\n  DefaultScheduleLockedSettings,\n  Deps,\n  EffectiveScheduleUserSettings,\n  LastMeetingSetting,\n  LockedSettings,\n  MeetingDelegator,\n  MeetingDelegatorsResponse,\n  MeetingInfoResponse,\n  MeetingInitialExtraData,\n  MeetingScheduleResource,\n  Preferences,\n  RcmInvitationInfo,\n  RcMMeetingModel,\n  SavedDefaultMeetingSetting,\n  ScheduleMeetingLockedSettings,\n  ScheduleMeetingResponse,\n  UpdatingStatus,\n  UserScheduleMeetingSettingResponse,\n  UserSettings,\n} from './Meeting.interface';\nimport { MeetingErrors } from './meetingErrors';\nimport { meetingStatus } from './meetingStatus';\n\n@Module({\n  name: 'Meeting',\n  deps: [\n    'Brand',\n    'Alert',\n    'Client',\n    'ExtensionInfo',\n    'Storage',\n    'VideoConfiguration',\n    { dep: 'AvailabilityMonitor', optional: true },\n    { dep: 'MeetingOptions', optional: true },\n  ],\n})\nexport class Meeting extends RcModuleV2<Deps> implements IMeeting {\n  protected _fetchDelegatorsTimeout: NodeJS.Timeout = null;\n  private _fetchPersonMeetingTimeout: NodeJS.Timeout = null;\n\n  constructor(deps: Deps) {\n    super({ deps, enableCache: true, storageKey: 'Meeting' });\n  }\n\n  @state\n  meeting: RcMMeetingModel = null;\n\n  @state\n  isScheduling: boolean = false;\n\n  @state\n  // including meetingId whose are in updating status\n  updatingStatus: UpdatingStatus = [];\n\n  @storage\n  @state\n  personalMeeting: Partial<RcMMeetingModel> = {};\n\n  @storage\n  @state\n  savedDefaultMeetingSetting: SavedDefaultMeetingSetting = {};\n\n  @storage\n  @state\n  lastMeetingSetting: LastMeetingSetting = {};\n\n  @state\n  delegators: MeetingDelegator[] = [];\n\n  @state\n  userSettings: Partial<UserSettings> = {};\n\n  @state\n  lockedSettings: Partial<LockedSettings> = {};\n\n  @state\n  preferences: Partial<Preferences> = {};\n\n  @state\n  isPreferencesChanged: boolean = false;\n\n  @computed<Meeting>((that) => [that.userSettings?.scheduleMeeting])\n  get scheduleUserSettings(): Partial<UserScheduleMeetingSettingResponse> {\n    return this.userSettings?.scheduleMeeting || {};\n  }\n\n  @computed<Meeting>((that) => [\n    that.enablePersonalMeeting,\n    that.enableServiceWebSettings,\n    that.scheduleUserSettings.usePmiForScheduledMeetings,\n  ])\n  get usePmiDefaultFromSW(): boolean {\n    return (\n      this.enablePersonalMeeting &&\n      this.enableServiceWebSettings &&\n      this.scheduleUserSettings.usePmiForScheduledMeetings\n    );\n  }\n\n  @computed<Meeting>((that) => [that.extensionInfo.info.id])\n  get loginUser(): MeetingDelegator {\n    return {\n      id: `${this.extensionInfo.info.id}`,\n      name: ASSISTED_USERS_MYSELF,\n      isLoginUser: true,\n    };\n  }\n\n  @computed<Meeting>((that) => [that.lockedSettings?.scheduleMeeting])\n  get scheduleLockedSettings(): Partial<ScheduleMeetingLockedSettings> {\n    return this.lockedSettings?.scheduleMeeting || {};\n  }\n\n  @computed<Meeting>((that) => [\n    that.enableServiceWebSettings,\n    that.scheduleLockedSettings,\n  ])\n  get defaultLockedSettings(): DefaultScheduleLockedSettings {\n    if (!this.enableServiceWebSettings || !this.scheduleLockedSettings) {\n      return {};\n    }\n    return pick(COMMON_SETTINGS, this.scheduleLockedSettings);\n  }\n\n  @computed<Meeting>((that) => [\n    that.enableServiceWebSettings,\n    that.scheduleUserSettings,\n  ])\n  get commonUserSettings(): EffectiveScheduleUserSettings {\n    if (!this.enableServiceWebSettings) {\n      return {};\n    }\n    return pick(COMMON_SETTINGS, this.scheduleUserSettings);\n  }\n\n  @computed<Meeting>((that) => [\n    that.enablePersonalMeeting,\n    that.personalMeeting,\n  ])\n  get commonPersonalMeetingSettings(): CommonPersonalMeetingSettings {\n    if (!this.enablePersonalMeeting) {\n      return {};\n    }\n    return pick([...COMMON_SETTINGS, 'password'], this.personalMeeting);\n  }\n\n  // TODO: Add feature toggle showAdminLock\n  get showAdminLock() {\n    return false;\n  }\n\n  get pmiDefaultSettings(): Partial<RcMMeetingModel> {\n    if (!this.enableServiceWebSettings) {\n      return this.personalMeeting;\n    }\n\n    return this._initDefaultData(\n      {\n        ...this.initialMeetingSetting,\n        settingLock: this.defaultLockedSettings,\n      },\n      {\n        userSettings: this.commonUserSettings,\n        personalMeetingSettings: this.commonPersonalMeetingSettings,\n      },\n      true,\n    );\n  }\n\n  get generalDefaultSettings(): Partial<RcMMeetingModel> {\n    if (!this.enableServiceWebSettings) {\n      const savedSetting = this.showSaveAsDefault\n        ? this.savedDefaultMeetingSetting\n        : this.lastMeetingSetting;\n      return {\n        ...this.initialMeetingSetting,\n        ...savedSetting,\n        meetingType: MeetingType.SCHEDULED,\n      };\n    }\n\n    return this._initDefaultData(\n      {\n        ...this.initialMeetingSetting,\n        settingLock: this.defaultLockedSettings,\n      },\n      {\n        userSettings: this.commonUserSettings,\n        personalMeetingSettings: this.commonPersonalMeetingSettings,\n      },\n      false,\n    );\n  }\n\n  get defaultMeetingSetting(): Partial<RcMMeetingModel> {\n    const initialSetting = this.initialMeetingSetting;\n    const usePmi = this.usePmiDefaultFromSW;\n    const userSettings = this.userSettings;\n    const pmiDefaultSettings = this.pmiDefaultSettings;\n    const generalDefaultSettings = this.generalDefaultSettings;\n    const savedSetting = this.showSaveAsDefault\n      ? this.savedDefaultMeetingSetting\n      : this.lastMeetingSetting;\n\n    if (this.enableServiceWebSettings) {\n      if (!isEmpty(userSettings)) {\n        return usePmi ? pmiDefaultSettings : generalDefaultSettings;\n      }\n      return initialSetting;\n    }\n    const meeting = {\n      ...initialSetting,\n      ...savedSetting,\n      meetingType: MeetingType.SCHEDULED,\n    };\n    return meeting;\n  }\n\n  get initialMeetingSetting(): RcMMeetingModel {\n    const meetingName = this._getExtensionName();\n    const startTime = getInitializedStartTime();\n    const hostId = this._getHostId();\n    const setting = getDefaultMeetingSettings(meetingName, startTime, hostId);\n    if (!this.enableServiceWebSettings) {\n      return setting;\n    }\n    return {\n      ...setting,\n      ...DEFAULT_LOCK_SETTINGS,\n      _pmiPassword: '',\n    };\n  }\n\n  get extensionInfo() {\n    return this._deps.extensionInfo;\n  }\n\n  get showSaveAsDefault() {\n    return this._deps.meetingOptions?.showSaveAsDefault ?? false;\n  }\n\n  get enableInvitationApi() {\n    return this._deps.meetingOptions?.enableInvitationApi ?? false;\n  }\n\n  get enablePersonalMeeting() {\n    return this._deps.meetingOptions?.enablePersonalMeeting ?? false;\n  }\n\n  get enableReloadAfterSchedule() {\n    return this._deps.meetingOptions?.enableReloadAfterSchedule ?? true;\n  }\n\n  get enableServiceWebSettings() {\n    return this._deps.meetingOptions?.enableServiceWebSettings ?? false;\n  }\n\n  get enableScheduleOnBehalf() {\n    return this._deps.meetingOptions?.enableScheduleOnBehalf ?? false;\n  }\n\n  get enableCustomTimezone() {\n    return this._deps.meetingOptions?.enableCustomTimezone ?? false;\n  }\n\n  @action\n  protected _updateDelegators(delegators: MeetingDelegator[]) {\n    this.delegators = delegators;\n  }\n\n  @action\n  protected _updateUserSettings(userSettings: UserSettings) {\n    this.userSettings = userSettings;\n  }\n\n  @action\n  protected _updateLockedSettings(lockedSettings: LockedSettings) {\n    this.lockedSettings = lockedSettings;\n  }\n\n  @action\n  protected _updatePersonalMeeting(personalMeeting: Partial<RcMMeetingModel>) {\n    this.personalMeeting = personalMeeting;\n  }\n\n  @action\n  protected _updatePreferences(preferences: Preferences) {\n    this.preferences = preferences;\n  }\n\n  @action\n  protected _updateIsPreferencesChanged(isPreferencesChanged: boolean) {\n    this.isPreferencesChanged = isPreferencesChanged;\n  }\n\n  @action\n  protected _updateMeetingState(meeting: RcMMeetingModel) {\n    this.meeting = meeting;\n  }\n\n  @action\n  protected _updateUpdatingStatus(updatingStatus: UpdatingStatus) {\n    this.updatingStatus = updatingStatus;\n  }\n\n  @action\n  protected _updateLastMeetingSetting(lastMeetingSetting: LastMeetingSetting) {\n    this.lastMeetingSetting = lastMeetingSetting;\n  }\n\n  @action\n  protected _updateSavedDefaultMeetingSetting(\n    savedDefaultMeetingSetting: SavedDefaultMeetingSetting,\n  ) {\n    this.savedDefaultMeetingSetting = savedDefaultMeetingSetting;\n  }\n\n  @action\n  protected _updateIsScheduling(isScheduling: boolean) {\n    this.isScheduling = isScheduling;\n  }\n\n  protected async onInit() {\n    await this._init();\n  }\n\n  _shouldInit() {\n    return super._shouldInit() && this._deps.videoConfiguration.isRCM;\n  }\n\n  _shouldReset() {\n    return (\n      super._shouldReset() ||\n      (this.ready && !this._deps.videoConfiguration.isRCM)\n    );\n  }\n\n  protected async _initScheduleFor() {\n    if (this._fetchDelegatorsTimeout) {\n      clearTimeout(this._fetchDelegatorsTimeout);\n    }\n    try {\n      const { records } = await this.getDelegators();\n      if (!records || records.length === 0) {\n        return;\n      }\n      this.updateDelegators([this.loginUser, ...records]);\n    } catch (e) {\n      console.error('fetch delegators error:', e);\n      console.warn('retry after 10s');\n      this._fetchDelegatorsTimeout = setTimeout(() => {\n        this._initScheduleFor();\n      }, 10000);\n    }\n  }\n\n  protected async _initMeetingSettings(extensionId?: string) {\n    if (this.enablePersonalMeeting) {\n      await this._initPersonalMeeting(extensionId);\n    }\n\n    if (this.enableServiceWebSettings) {\n      await this._updateServiceWebSettings(extensionId);\n    }\n\n    await this._initMeeting(extensionId);\n  }\n\n  /**\n   * Init basic meeting information\n   * also load meeting setting from previous one.\n   */\n  @background\n  init() {\n    this._initMeeting();\n  }\n\n  @proxify\n  async reload() {\n    return this._initMeeting();\n  }\n\n  @proxify\n  async _init() {\n    await this._initMeetingSettings();\n\n    if (this.enableScheduleOnBehalf) {\n      await this._initScheduleFor();\n    }\n  }\n\n  @proxify\n  protected async _initMeeting(extensionId?: string) {\n    this.update({\n      ...this.defaultMeetingSetting,\n      host: {\n        id: extensionId || this.loginUser.id,\n      },\n    });\n\n    this.updatePreferences(prunePreferencesObject(this.meeting));\n  }\n\n  @proxify\n  async updatePreferences(preferences: Preferences) {\n    this._updatePreferences(preferences);\n  }\n\n  @proxify\n  async updateIsPreferencesChanged(isPreferencesChanged: boolean) {\n    this._updateIsPreferencesChanged(isPreferencesChanged);\n  }\n\n  @proxify\n  async update(_meeting: RcMMeetingModel) {\n    let meeting = _meeting;\n    if (this.enableServiceWebSettings) {\n      meeting = this.combineWithSettings(_meeting);\n    }\n    const finalMeeting = {\n      ...meeting,\n      isMeetingPasswordValid: this.validatePasswordSettings(\n        _meeting.password,\n        _meeting._requireMeetingPassword,\n      ),\n    };\n    this.updateMeetingState(finalMeeting);\n    this._comparePreferences(finalMeeting);\n  }\n\n  private _comparePreferences(meeting: RcMMeetingModel) {\n    this.updateIsPreferencesChanged(\n      comparePreferences(this.preferences, meeting),\n    );\n  }\n\n  validatePasswordSettings(password: string, isSecret: boolean): boolean {\n    if (!isSecret) {\n      return true;\n    }\n    if (password && RCM_PASSWORD_REGEX.test(password)) {\n      return true;\n    }\n    return false;\n  }\n\n  combineWithSettings(_meeting: RcMMeetingModel) {\n    return this._combineWithSWSettings(_meeting);\n  }\n\n  _combineWithSWSettings(meeting: RcMMeetingModel): RcMMeetingModel {\n    if (!meeting.usePersonalMeetingId) {\n      return meeting;\n    }\n\n    const processedMeeting = { ...meeting };\n    const { allowJoinBeforeHost } = processedMeeting;\n    const { requirePasswordForPmiMeetings } = this.scheduleUserSettings;\n    const {\n      requirePasswordForPmiMeetings: lockedRequirePasswordForPmiMeetings,\n    } = this.scheduleLockedSettings;\n\n    if (\n      lockedRequirePasswordForPmiMeetings &&\n      requirePasswordForPmiMeetings === PMIRequirePassword.JBH_ONLY\n    ) {\n      if (allowJoinBeforeHost && !processedMeeting._requireMeetingPassword) {\n        processedMeeting._requireMeetingPassword = true;\n        processedMeeting.password =\n          processedMeeting._pmiPassword || generateRandomPassword();\n      }\n      processedMeeting._lockRequireMeetingPassword = allowJoinBeforeHost;\n    }\n    return processedMeeting;\n  }\n\n  @proxify\n  async _initPersonalMeeting(extensionId?: string) {\n    if (this._fetchPersonMeetingTimeout) {\n      clearTimeout(this._fetchPersonMeetingTimeout);\n    }\n    try {\n      const meetingInfoResponse = await this.fetchPersonalMeeting(extensionId);\n      const meeting = this.formatPersonalMeeting(meetingInfoResponse);\n      this.updatePersonalMeeting(meeting);\n    } catch (e) {\n      console.error('fetch personal meeting error:', e);\n      this.resetPersonalMeeting();\n      console.warn('retry after 10s');\n      this._fetchPersonMeetingTimeout = setTimeout(() => {\n        this._initPersonalMeeting(extensionId);\n      }, 10000);\n    }\n  }\n\n  @proxify\n  async _updateServiceWebSettings(extensionId?: string) {\n    try {\n      const [userSettings, lockedSettings] = await Promise.all([\n        this.getUserSettings(extensionId),\n        this.getLockedSettings(),\n      ]);\n      this.updateUserSettings(userSettings);\n      this.updateLockedSettings(lockedSettings);\n    } catch (e) {\n      console.error('error:', e);\n    }\n  }\n\n  @proxify\n  async switchUsePersonalMeetingId(usePersonalMeetingId: boolean) {\n    this.update(\n      usePersonalMeetingId\n        ? this.pmiDefaultSettings\n        : this.generalDefaultSettings,\n    );\n  }\n\n  @proxify\n  async saveAsDefaultSetting(meeting: RcMMeetingModel) {\n    const formattedMeeting = this._format(meeting);\n    this.updateSavedDefaultMeetingSetting({\n      ...formattedMeeting,\n      _saved: meeting.notShowAgain,\n      _requireMeetingPassword: meeting._requireMeetingPassword,\n    });\n  }\n\n  @proxify\n  async schedule(\n    meeting: RcMMeetingModel,\n    { isAlertSuccess = true }: { isAlertSuccess?: boolean } = {},\n  ): Promise<ScheduleMeetingResponse> {\n    if (this.isScheduling) return (this.schedule as any)._promise;\n    meeting = meeting || this.meeting;\n    try {\n      this.updateIsScheduling(true);\n      // Validate meeting\n      this._validate(meeting);\n      const formattedMeeting = this._format(meeting);\n\n      if (this.showSaveAsDefault && meeting.saveAsDefault) {\n        this.saveAsDefaultSetting(meeting);\n      }\n\n      (this.schedule as any)._promise = Promise.all([\n        this.postMeeting(formattedMeeting),\n        this.getMeetingServiceInfo(meeting.host?.id),\n      ]);\n\n      const [resp, serviceInfo] = await (this.schedule as any)._promise;\n      const invitationInfo = await this.getMeetingInvitation(resp.id);\n      this.updateLastMeetingSetting({\n        ...formattedMeeting,\n        _saved: meeting._saved,\n      });\n\n      const result = await this._createDialingNumberTpl(\n        serviceInfo,\n        resp,\n        invitationInfo,\n      );\n\n      // Reload meeting info\n      if (this.enableReloadAfterSchedule) {\n        this._initMeeting();\n      }\n\n      // Update personal meeting setting\n      if (this.enablePersonalMeeting && resp.usePersonalMeetingId) {\n        this.updatePersonalMeeting(\n          this.formatPersonalMeeting(\n            resp,\n            serviceInfo.externalUserInfo.personalMeetingId,\n          ),\n        );\n        if (this.enableServiceWebSettings) {\n          this.update({\n            ...this.meeting,\n            _pmiPassword: resp.password,\n          });\n        }\n      }\n\n      // Notify user the meeting has been scheduled\n      if (isAlertSuccess) {\n        setTimeout(() => {\n          this._deps.alert.success({\n            message: meetingStatus.scheduledSuccess,\n          });\n        }, 50);\n      }\n      return result;\n    } catch (errors) {\n      await this._errorHandle(errors);\n      return null;\n    } finally {\n      delete (this.schedule as any)._promise;\n      this.updateIsScheduling(false);\n    }\n  }\n\n  @proxify\n  async updateMeeting(\n    meetingId: string,\n    meeting: RcMMeetingModel,\n    { isAlertSuccess = false }: { isAlertSuccess?: boolean } = {},\n  ) {\n    if (this._isUpdating(meetingId)) {\n      return (this.updateMeeting as any)._promise;\n    }\n    meeting = meeting || this.meeting;\n    try {\n      this.addUpdatingStatus(meetingId);\n      // Validate meeting\n      this._validate(meeting);\n      const formattedMeeting = this._format(meeting);\n      if (this.showSaveAsDefault && meeting.saveAsDefault) {\n        this.saveAsDefaultSetting(meeting);\n      }\n\n      (this.updateMeeting as any)._promise = Promise.all([\n        this.putMeeting(meetingId, formattedMeeting),\n        this.getMeetingServiceInfo(meeting.host?.id),\n      ]);\n\n      const [resp, serviceInfo] = await (this.updateMeeting as any)._promise;\n      const invitationInfo = await this.getMeetingInvitation(meetingId);\n\n      const result = await this._createDialingNumberTpl(\n        serviceInfo,\n        resp,\n        invitationInfo,\n      );\n\n      // Reload meeting info\n      if (this.enableReloadAfterSchedule) {\n        this._initMeeting();\n      }\n\n      // Update personal meeting setting\n      if (this.enablePersonalMeeting && resp.usePersonalMeetingId) {\n        this.updatePersonalMeeting(\n          this.formatPersonalMeeting(\n            resp,\n            serviceInfo.externalUserInfo.personalMeetingId,\n          ),\n        );\n        if (this.enableServiceWebSettings) {\n          this.update({\n            ...this.meeting,\n            _pmiPassword: resp.password,\n          });\n        }\n      }\n\n      // Notify user the meeting has been updated\n      if (isAlertSuccess) {\n        setTimeout(() => {\n          this._deps.alert.success({\n            message: meetingStatus.updatedSuccess,\n          });\n        }, 50);\n      }\n      return result;\n    } catch (errors) {\n      await this._errorHandle(errors);\n      return null;\n    } finally {\n      delete (this.updateMeeting as any)._promise;\n      this.removeUpdatingStatus(meetingId);\n    }\n  }\n\n  @proxify\n  async updateScheduleFor(userExtensionId: string | number) {\n    if (!userExtensionId || !this.delegators || this.delegators.length === 0) {\n      return;\n    }\n    const hostId = `${userExtensionId}`;\n    const user = find((item) => item.id === hostId, this.delegators);\n\n    if (user) {\n      await this._initMeetingSettings(hostId);\n    }\n  }\n\n  @proxify\n  async updateDelegators(delegators: MeetingDelegator[]) {\n    this._updateDelegators(delegators);\n  }\n\n  @proxify\n  async updateUserSettings(userSettings: UserSettings) {\n    this._updateUserSettings(userSettings);\n  }\n\n  @proxify\n  async updateLockedSettings(lockedSettings: LockedSettings) {\n    this._updateLockedSettings(lockedSettings);\n  }\n\n  @proxify\n  async updatePersonalMeeting(meeting: RcMMeetingModel) {\n    this._updatePersonalMeeting(meeting);\n  }\n\n  @proxify\n  async resetPersonalMeeting() {\n    this._updatePersonalMeeting({});\n  }\n\n  @proxify\n  async updateMeetingState(meeting: RcMMeetingModel) {\n    this._updateMeetingState(meeting);\n  }\n\n  @proxify\n  async addUpdatingStatus(meetingId: string) {\n    this._updateUpdatingStatus([...this.updatingStatus, { meetingId }]);\n  }\n\n  @proxify\n  async removeUpdatingStatus(meetingId: string) {\n    const finalStatus = filter(\n      (obj) => obj.meetingId !== meetingId,\n      this.updatingStatus,\n    );\n    this._updateUpdatingStatus(finalStatus);\n  }\n\n  @proxify\n  async updateLastMeetingSetting(meeting: RcMMeetingModel) {\n    const lastMeetingSetting = pick(LAST_MEETING_SETTINGS, meeting || {});\n    this._updateLastMeetingSetting(lastMeetingSetting);\n  }\n\n  @proxify\n  async updateSavedDefaultMeetingSetting(meeting: RcMMeetingModel) {\n    const savedDefaulteSetting = pick(\n      SAVED_DEFAULT_MEETING_SETTINGS,\n      meeting || {},\n    );\n    this._updateSavedDefaultMeetingSetting(savedDefaulteSetting);\n  }\n\n  @proxify\n  async updateIsScheduling(isScheduling: boolean) {\n    this._updateIsScheduling(isScheduling);\n  }\n\n  @proxify\n  private async fetchPersonalMeeting(extensionId?: string) {\n    const serviceInfo = await this.getMeetingServiceInfo(extensionId);\n    const personalMeetingId = serviceInfo.externalUserInfo.personalMeetingId;\n    const meetingInfoResponse = await this.getMeeting(personalMeetingId);\n    if (!meetingInfoResponse) {\n      throw new Error(\n        `failed to get personal meeting ${personalMeetingId} info`,\n      );\n    }\n    return meetingInfoResponse;\n  }\n\n  @proxify\n  async getMeetingServiceInfo(extensionId?: string) {\n    return this._deps.client\n      .account()\n      .extension(extensionId)\n      .meeting()\n      .serviceInfo()\n      .get();\n  }\n\n  @proxify\n  async postMeeting(formattedMeeting: RcMMeetingModel) {\n    return this._deps.client\n      .account()\n      .extension()\n      .meeting()\n      .post(formattedMeeting);\n  }\n\n  @proxify\n  async putMeeting(meetingId: string, formattedMeeting: RcMMeetingModel) {\n    return this._deps.client\n      .account()\n      .extension()\n      .meeting(meetingId)\n      .put(formattedMeeting);\n  }\n\n  @proxify\n  async getMeeting(meetingId: string, { isAlertError = true } = {}) {\n    try {\n      const settings = await this._deps.client\n        .account()\n        .extension()\n        .meeting(meetingId)\n        .get();\n      return {\n        ...settings,\n        // TODO: can we remove this?\n        _requireMeetingPassword: !!settings.password,\n      };\n    } catch (e) {\n      const { errorCode, message } = await e.response.clone().json();\n      console.log(\n        `failed to get meeting info: ${meetingId}, ${errorCode}, ${message}`,\n      );\n      const isMeetingDeleted =\n        errorCode === 'CMN-102' &&\n        message.indexOf('[meetingId] is not found') > -1;\n      if (isAlertError && isMeetingDeleted) {\n        setTimeout(() => {\n          this._deps.alert.danger({\n            message: meetingStatus.meetingIsDeleted,\n          });\n        }, 50);\n      }\n      throw e;\n    }\n  }\n\n  @proxify\n  async getDelegators(): Promise<MeetingDelegatorsResponse> {\n    const res = await this._deps.client.service\n      .platform()\n      .get(\n        '/restapi/v1.0/account/~/extension/~/meetings-configuration/assisted',\n      );\n    return res.json();\n  }\n\n  @proxify\n  async getUserSettings(extensionId = '~'): Promise<UserSettings> {\n    try {\n      const platform = this._deps.client.service.platform();\n      const apiResponse = await platform.send({\n        method: 'GET',\n        url: `/restapi/v1.0/account/~/extension/${extensionId}/meeting/user-settings`,\n      });\n      return apiResponse.json();\n    } catch (e) {\n      console.warn('failed to get user setting', e);\n      return null;\n    }\n  }\n\n  @proxify\n  async getLockedSettings() {\n    try {\n      const platform = this._deps.client.service.platform();\n      const apiResponse = await platform.send({\n        method: 'GET',\n        url: '/restapi/v1.0/account/~/meeting/locked-settings',\n      });\n      const { recording = {}, scheduleMeeting = {} } = await apiResponse.json();\n      const {\n        startParticipantsVideo,\n        startParticipantVideo,\n        ...restScheduleOptions\n      } = scheduleMeeting;\n      const processedScheduleMeeting = {\n        ...restScheduleOptions,\n        // TODO: update this when api is stable\n        startParticipantsVideo:\n          startParticipantsVideo || startParticipantVideo || false,\n      };\n      return {\n        recording,\n        scheduleMeeting: processedScheduleMeeting,\n      };\n    } catch (e) {\n      console.warn('failed to get lock settings', e);\n      return null;\n    }\n  }\n\n  @proxify\n  async getMeetingInvitation(meetingId: string): Promise<RcmInvitationInfo> {\n    if (!this.enableInvitationApi) {\n      return null;\n    }\n    // only rc brand is supported for now\n    if (this._deps.brand.code !== 'rc') {\n      return null;\n    }\n    try {\n      const platform = this._deps.client.service.platform();\n      const apiResponse = await platform.send({\n        method: 'GET',\n        url: `/restapi/v1.0/account/~/extension/~/meeting/${meetingId}/invitation`,\n      });\n      const { invitation } = await apiResponse.json();\n      return {\n        invitation,\n      };\n    } catch (ex) {\n      console.warn('failed to get invitation', ex);\n      return null;\n    }\n  }\n\n  protected formatPersonalMeeting(\n    meetingInfo: MeetingInfoResponse,\n    shortId?: string, // TODO: do we need this param `shortId`?\n  ): RcMMeetingModel {\n    const settings = {\n      ...this.initialMeetingSetting,\n      ...meetingInfo,\n      shortId: shortId || meetingInfo.id,\n      usePersonalMeetingId: true,\n    };\n    return {\n      ...settings,\n      _requireMeetingPassword: !!settings.password,\n    };\n  }\n\n  _getHostId() {\n    if (\n      this.enableScheduleOnBehalf &&\n      this.meeting &&\n      this.meeting.host &&\n      this.meeting.host.id\n    ) {\n      return `${this.meeting.host.id}`;\n    }\n    return `${this.extensionInfo.info.id}` || '';\n  }\n\n  _getExtensionName() {\n    const extensionName = this.extensionInfo.info.name || '';\n    if (\n      !this.enableScheduleOnBehalf ||\n      !this.meeting ||\n      !this.delegators ||\n      this.delegators.length === 0\n    ) {\n      return extensionName;\n    }\n    const currentHost = `${(this.meeting.host && this.meeting.host.id) || ''}`;\n    const user = find((item) => item.id === currentHost, this.delegators);\n    return user && user.id !== `${this.extensionInfo.info.id}`\n      ? user.name\n      : extensionName;\n  }\n\n  /**\n   * Validate meeting information format.\n   * @param {Object} meeting\n   * @throws\n   */\n  _validate(meeting: RcMMeetingModel) {\n    if (!meeting) {\n      throw new MeetingErrors(meetingStatus.invalidMeetingInfo);\n    }\n    const { topic, password, schedule, _requireMeetingPassword } = meeting;\n    const errors = new MeetingErrors();\n    if (topic.length <= 0) {\n      errors.push(meetingStatus.emptyTopic);\n    }\n    if (_requireMeetingPassword && (!password || password.length <= 0)) {\n      errors.push(meetingStatus.noPassword);\n    }\n    if (schedule) {\n      if (schedule.durationInMinutes < 0) {\n        errors.push(meetingStatus.durationIncorrect);\n      }\n    }\n    if (errors.length > 0) {\n      throw errors;\n    }\n  }\n\n  /**\n   * Format meeting information.\n   * @param {Object} meeting\n   */\n  _format(meeting: RcMMeetingModel): RcMMeetingModel {\n    const {\n      topic,\n      meetingType,\n      allowJoinBeforeHost,\n      startHostVideo,\n      startParticipantsVideo,\n      audioOptions,\n      password,\n      schedule,\n      recurrence,\n      usePersonalMeetingId,\n      _requireMeetingPassword,\n      host,\n    } = meeting;\n    const formatted = {\n      host,\n      topic,\n      meetingType,\n      allowJoinBeforeHost,\n      startHostVideo,\n      startParticipantsVideo,\n      audioOptions,\n      password: _requireMeetingPassword ? password : '',\n      recurrence,\n      usePersonalMeetingId,\n    } as RcMMeetingModel;\n    // Recurring meetings do not have schedule info\n    if (meetingType !== MeetingType.RECURRING) {\n      const _schedule: MeetingScheduleResource = {\n        durationInMinutes: schedule.durationInMinutes,\n        timeZone: {\n          id: this.enableCustomTimezone\n            ? schedule.timeZone.id\n            : UTC_TIMEZONE_ID,\n        },\n      };\n      if (schedule.startTime) {\n        // Format selected startTime to utc standard time\n        // Timezone information is not included here\n        _schedule.startTime = this.enableCustomTimezone\n          ? schedule.startTime\n          : moment.utc(schedule.startTime).format();\n      }\n      formatted.schedule = _schedule;\n\n      if (recurrence && recurrence.until) {\n        formatted.recurrence.until = moment.utc(recurrence.until).format();\n      }\n    }\n\n    // For PMI\n    formatted.meetingType =\n      formatted.meetingType === MeetingType.PMI\n        ? MeetingType.SCHEDULED\n        : formatted.meetingType;\n    return formatted;\n  }\n\n  async _createDialingNumberTpl(\n    serviceInfo: MeetingServiceInfoResource,\n    resp: any,\n    invitationInfo: RcmInvitationInfo,\n  ) {\n    const result = {\n      meeting: resp,\n      serviceInfo: {\n        ...serviceInfo,\n        mobileDialingNumberTpl: getMobileDialingNumberTpl(\n          serviceInfo.dialInNumbers,\n          resp.id,\n        ),\n        phoneDialingNumberTpl: getPhoneDialingNumberTpl(\n          serviceInfo.dialInNumbers,\n        ),\n      },\n      extensionInfo: this.extensionInfo.info,\n      invitationInfo,\n    };\n    return result;\n  }\n\n  async _errorHandle(errors: any) {\n    if (errors instanceof MeetingErrors) {\n      for (const error of errors.all) {\n        this._deps.alert.warning(error);\n      }\n    } else if (errors && errors.response) {\n      const {\n        message,\n        errorCode,\n        permissionName,\n      } = await errors.response.clone().json();\n      if (errorCode === 'InsufficientPermissions' && permissionName) {\n        this._deps.alert.danger({\n          message: meetingStatus.insufficientPermissions,\n          payload: {\n            permissionName,\n          },\n        });\n      } else if (\n        errorCode === 'CMN-102' &&\n        message.indexOf('[meetingId] is not found') > -1\n      ) {\n        this._deps.alert.danger({\n          message: meetingStatus.meetingIsDeleted,\n        });\n      } else if (\n        !this._deps.availabilityMonitor ||\n        !(await this._deps.availabilityMonitor.checkIfHAError(errors))\n      ) {\n        this._deps.alert.danger({ message: meetingStatus.internalError });\n      }\n    } else {\n      console.log('errors:', errors);\n      this._deps.alert.danger({ message: meetingStatus.internalError });\n    }\n  }\n\n  _initDefaultData(\n    meeting: RcMMeetingModel,\n    { userSettings, personalMeetingSettings }: MeetingInitialExtraData,\n    usePmi: boolean,\n  ): RcMMeetingModel {\n    if (!this.enableServiceWebSettings) {\n      return meeting;\n    }\n\n    const processedMeeting = {\n      ...meeting,\n      ...(usePmi ? personalMeetingSettings : userSettings),\n      usePersonalMeetingId: usePmi,\n    };\n\n    // For PMI meetings\n    if (usePmi) {\n      const { allowJoinBeforeHost, password = '' } = processedMeeting;\n      const requirePasswordForPmiMeetings = this.scheduleUserSettings\n        .requirePasswordForPmiMeetings;\n\n      if (password !== '') {\n        processedMeeting._pmiPassword = password;\n      }\n\n      let pmiRequiresPwd;\n      switch (requirePasswordForPmiMeetings) {\n        case PMIRequirePassword.NONE:\n          pmiRequiresPwd = password !== '';\n          break;\n        case PMIRequirePassword.ALL:\n          pmiRequiresPwd = true;\n          break;\n        case PMIRequirePassword.JBH_ONLY:\n          pmiRequiresPwd = allowJoinBeforeHost || password !== '';\n          break;\n        default:\n          pmiRequiresPwd = processedMeeting._requireMeetingPassword;\n      }\n\n      const lockedRequirePasswordForPmiMeetings = this.scheduleLockedSettings\n        .requirePasswordForPmiMeetings;\n      let pmiRequiresPwdLocked = processedMeeting._lockRequireMeetingPassword;\n      if (requirePasswordForPmiMeetings === PMIRequirePassword.JBH_ONLY) {\n        pmiRequiresPwdLocked =\n          lockedRequirePasswordForPmiMeetings && allowJoinBeforeHost;\n      } else if (\n        requirePasswordForPmiMeetings !== PMIRequirePassword.JBH_ONLY\n      ) {\n        pmiRequiresPwdLocked = lockedRequirePasswordForPmiMeetings;\n      }\n\n      processedMeeting._requireMeetingPassword = pmiRequiresPwd;\n      processedMeeting._lockRequireMeetingPassword = pmiRequiresPwdLocked;\n    } else {\n      // For non-PMI meetings\n      const {\n        requirePasswordForSchedulingNewMeetings = false,\n      } = this.scheduleUserSettings;\n      if (requirePasswordForSchedulingNewMeetings) {\n        processedMeeting._requireMeetingPassword = true;\n      }\n      const lockedRequirePasswordForSchedulingNewMeetings = this\n        .scheduleLockedSettings.requirePasswordForSchedulingNewMeetings;\n      if (lockedRequirePasswordForSchedulingNewMeetings) {\n        processedMeeting._lockRequireMeetingPassword = true;\n      }\n    }\n    return {\n      ...processedMeeting,\n      password:\n        processedMeeting._requireMeetingPassword && !processedMeeting.password\n          ? generateRandomPassword()\n          : processedMeeting.password,\n    };\n  }\n\n  // use to check meeting is in updating status or not\n  _isUpdating(meetingId: string) {\n    return (\n      this.updatingStatus &&\n      find((obj: any) => obj.meetingId === meetingId, this.updatingStatus)\n    );\n  }\n}\n"],"file":"Meeting.js"}