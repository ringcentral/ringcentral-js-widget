{"version":3,"sources":["modules/LocaleV2/Locale.ts"],"names":["Locale","name","deps","dep","optional","that","locale","_setLocale","debugMode","setLocale","PSEUDO_LOCALE","_polling","_syncBrowserLocale","_detectBrowser","browserLocale","_defaultLocale","currentLocale","setTimeout","_pollingInterval","I18n","formatMessage","setup","DEFAULT_LOCALE","_toggleDebugMode","_setLocaleSuccess","console","log","_deps","localeOptions","defaultLocale","detectBrowser","polling","pollingInterval","RcModuleV2","state","action","proxify"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AAIA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAOaA,M,WAJZ,gBAAO;AACNC,EAAAA,IAAI,EAAE,QADA;AAENC,EAAAA,IAAI,EAAE,CAAC;AAAEC,IAAAA,GAAG,EAAE,eAAP;AAAwBC,IAAAA,QAAQ,EAAE;AAAlC,GAAD;AAFA,CAAP,C,UAyBE;AAAA,qEACC,iBAAOC,IAAP,EAAqBC,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA8CD,IAAI,CAACE,UAAL,CAAgBD,MAAhB,CAA9C;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GADD;;AAAA;AAAA;AAAA;AAAA,I;;;;;AApBD,kBAAYJ,IAAZ,EAAwB;AAAA;;AAAA;;AACtB,8BAAM;AAAEA,MAAAA,IAAI,EAAJA;AAAF,KAAN;;AADsB;;AAAA;;AAAA;AAEvB;;;;uCA4BkB;AACjB,WAAKM,SAAL,GAAiB,CAAC,KAAKA,SAAvB;;AACA,UAAI,KAAKA,SAAT,EAAoB;AAClB,aAAKC,SAAL,CAAeC,mBAAf;AACD;AACF;;;sCAGiBJ,M,EAAgB;AAChC,WAAKA,MAAL,GAAcA,MAAd;AACD;;;iCAEY;AACX,UAAI,KAAKK,QAAT,EAAmB;AACjB,aAAKC,kBAAL;AACD;AACF;;;;;;;;;;uBAGO,KAAKH,SAAL,CACJ,KAAKI,cAAL,GAAsB,KAAKC,aAA3B,GAA2C,KAAKC,cAD5C,C;;;;;;;;;;;;;;;;;;;;;;;;;;sBAMF,CAAC,KAAKP,SAAN,IAAmB,KAAKM,aAAL,KAAuB,KAAKE,a;;;;;;uBAC3C,KAAKP,SAAL,CAAe,KAAKK,aAApB,C;;;AAERG,gBAAAA,UAAU,CAAC;AAAA,yBAAM,MAAI,CAACL,kBAAL,EAAN;AAAA,iBAAD,EAAkC,KAAKM,gBAAvC,CAAV;;;;;;;;;;;;;;;;;;;kGAGyBZ,M;;;;;;uBACnBa,iBAAKV,SAAL,CAAeH,MAAf,C;;;AACNc,0CAAcC,KAAd,CAAoB;AAClBf,kBAAAA,MAAM,EACJ,KAAKU,aAAL,KAAuBN,mBAAvB,GACIY,oBADJ,GAEI,KAAKN;AAJO,iBAApB;;;;;;;;;;;;;;;;;;;;;;;;AAkBA,qBAAKO,gBAAL;;;;;;;;;;;;;;;;AAGF;AACF;AACA;AACA;AACA;;;;;kGAEkBjB,M;;;;;;;uBAEN,KAAKC,UAAL,CAAgBD,MAAhB,C;;;AACN,qBAAKkB,iBAAL,CAAuBlB,MAAvB;;;;;;;;AAEAmB,gBAAAA,OAAO,CAACC,GAAR;;;;;;;;;;;;;;;;;;wBA3FiB;AAAA;;AACnB,gEAAO,KAAKC,KAAL,CAAWC,aAAlB,2DAAO,uBAA0BC,aAAjC,yEAAkDP,oBAAlD;AACD;;;wBAEoB;AAAA;;AACnB,iEAAO,KAAKK,KAAL,CAAWC,aAAlB,2DAAO,uBAA0BE,aAAjC,2EAAkD,IAAlD;AACD;;;wBAEc;AAAA;;AACb,iEAAO,KAAKH,KAAL,CAAWC,aAAlB,2DAAO,uBAA0BG,OAAjC,2EAA4C,KAA5C;AACD;;;wBAEsB;AAAA;;AACrB,iEAAO,KAAKJ,KAAL,CAAWC,aAAlB,2DAAO,uBAA0BI,eAAjC,2EAAoD,IAApD;AACD;;;wBAqDmB;AAClB,aAAO,KAAK1B,MAAL,IAAe,KAAKS,cAA3B;AACD;;;wBAEmB;AAClB,aAAO,qCAAoB,KAAKA,cAAzB,CAAP;AACD;;;;EA9EyBkB,gB,yFAwBzBC,W;;;;;WACgB,I;;8EAEhBA,W;;;;;WACW,K;;sEAEXC,Y,kKAQAA,Y,iKA0CAC,mB,yJAUAA,mB","sourcesContent":["import { action, RcModuleV2, state } from '@ringcentral-integration/core';\nimport I18n, {\n  DEFAULT_LOCALE,\n  PSEUDO_LOCALE,\n} from '@ringcentral-integration/i18n';\nimport formatMessage from 'format-message';\nimport detectBrowserLocale from '../../lib/detectBrowserLocale';\nimport { Module } from '../../lib/di';\nimport proxify from '../../lib/proxy/proxify';\nimport { proxyState } from '../../lib/proxy/proxyState';\nimport { Deps } from './Locale.interface';\n\n@Module({\n  name: 'Locale',\n  deps: [{ dep: 'LocaleOptions', optional: true }],\n})\nexport class Locale extends RcModuleV2<Deps> {\n  constructor(deps: Deps) {\n    super({ deps });\n  }\n\n  get _defaultLocale() {\n    return this._deps.localeOptions?.defaultLocale ?? DEFAULT_LOCALE;\n  }\n\n  get _detectBrowser() {\n    return this._deps.localeOptions?.detectBrowser ?? true;\n  }\n\n  get _polling() {\n    return this._deps.localeOptions?.polling ?? false;\n  }\n\n  get _pollingInterval() {\n    return this._deps.localeOptions?.pollingInterval ?? 2000;\n  }\n\n  @proxyState(\n    async (that: Locale, locale: string) => await that._setLocale(locale),\n  )\n  @state\n  locale: string = null;\n\n  @state\n  debugMode = false;\n\n  @action\n  _toggleDebugMode() {\n    this.debugMode = !this.debugMode;\n    if (this.debugMode) {\n      this.setLocale(PSEUDO_LOCALE);\n    }\n  }\n\n  @action\n  _setLocaleSuccess(locale: string) {\n    this.locale = locale;\n  }\n\n  onInitOnce() {\n    if (this._polling) {\n      this._syncBrowserLocale();\n    }\n  }\n\n  async onInit() {\n    await this.setLocale(\n      this._detectBrowser ? this.browserLocale : this._defaultLocale,\n    );\n  }\n\n  protected async _syncBrowserLocale() {\n    if (!this.debugMode && this.browserLocale !== this.currentLocale) {\n      await this.setLocale(this.browserLocale);\n    }\n    setTimeout(() => this._syncBrowserLocale(), this._pollingInterval);\n  }\n\n  protected async _setLocale(locale: string) {\n    await I18n.setLocale(locale);\n    formatMessage.setup({\n      locale:\n        this.currentLocale === PSEUDO_LOCALE\n          ? DEFAULT_LOCALE\n          : this.currentLocale,\n    });\n  }\n\n  get currentLocale() {\n    return this.locale || this._defaultLocale;\n  }\n\n  get browserLocale() {\n    return detectBrowserLocale(this._defaultLocale);\n  }\n\n  @proxify\n  async toggleDebugMode() {\n    this._toggleDebugMode();\n  }\n\n  /**\n   *  Sets the desired locale as the current locale. This will also\n   *  set all I18n instances to the same locale, as well as set formatMessage to use\n   *  the same locale.\n   */\n  @proxify\n  async setLocale(locale: string) {\n    try {\n      await this._setLocale(locale);\n      this._setLocaleSuccess(locale);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n}\n"],"file":"Locale.js"}