{"version":3,"sources":["modules/ComposeTextUI/index.js"],"names":["ComposeTextUI","name","deps","phone","brand","locale","composeText","messageSender","connectivityMonitor","rateLimiter","rolesAndPermissions","contactSearch","inputExpandable","supportAttachment","isContentEmpty","messageText","length","attachments","fullName","currentLocale","sendButtonDisabled","ready","idle","toNumbers","typingToNumber","connectivity","throttling","senderNumbers","senderNumbersList","senderNumber","outboundSMS","permissions","OutboundSMS","searchContactList","sortedResult","showSpinner","regionSettings","routerInteraction","messageStore","conversations","formatContactPhone","phoneNumber","areaCode","countryCode","phoneTypeRenderer","phoneSourceNameRenderer","recipientsContactInfoRenderer","recipientsContactPhoneRenderer","send","timeout","setTimeout","currentPath","alertMessageSending","clearTimeout","then","responses","dismissMessageSending","pushMessages","conversationId","conversation","id","push","relateCorrespondentEntity","clean","formatPhone","detectPhoneNumbers","input","promises","split","map","item","validatePhoneNumber","isValid","undefined","Promise","all","results","detectedNumbers","filter","forEach","addToNumber","searchContact","searchString","debouncedSearch","updateSenderNumber","updateTypingToNumber","cleanTypingToNumber","removeToNumber","updateMessageText","addAttachment","removeAttachment","RcUIModule"],"mappings":"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","sourcesContent":["import Module from 'ringcentral-integration/lib/di/decorators/module';\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\n\nimport RcUIModule from '../../lib/RcUIModule';\n\n@Module({\n  name: 'ComposeTextUI',\n  deps: [\n    'Brand',\n    'ComposeText',\n    'ConnectivityMonitor',\n    'ContactSearch',\n    'Conversations',\n    'Locale',\n    'MessageSender',\n    'MessageStore',\n    'RateLimiter',\n    'RegionSettings',\n    'RolesAndPermissions',\n    'RouterInteraction',\n  ],\n})\nexport default class ComposeTextUI extends RcUIModule {\n  getUIProps({\n    phone: {\n      brand,\n      locale,\n      composeText,\n      messageSender,\n      connectivityMonitor,\n      rateLimiter,\n      rolesAndPermissions,\n      contactSearch,\n    },\n    inputExpandable,\n    supportAttachment,\n  }) {\n    const isContentEmpty =\n      composeText.messageText.length === 0 &&\n      (!composeText.attachments || composeText.attachments.length === 0);\n    return {\n      brand: brand.fullName,\n      currentLocale: locale.currentLocale,\n      sendButtonDisabled:\n        !(composeText.ready && messageSender.idle) ||\n        isContentEmpty ||\n        (composeText.toNumbers.length === 0 &&\n          composeText.typingToNumber.length === 0) ||\n        !connectivityMonitor.connectivity ||\n        rateLimiter.throttling,\n      senderNumbers: messageSender.senderNumbersList,\n      senderNumber: composeText.senderNumber,\n      typingToNumber: composeText.typingToNumber,\n      toNumbers: composeText.toNumbers,\n      messageText: composeText.messageText,\n      outboundSMS: rolesAndPermissions.permissions.OutboundSMS,\n      searchContactList: contactSearch.sortedResult,\n      showSpinner: !(\n        composeText.ready &&\n        locale.ready &&\n        messageSender.ready &&\n        rolesAndPermissions.ready &&\n        contactSearch.ready\n      ),\n      inputExpandable,\n      attachments: composeText.attachments,\n      supportAttachment,\n    };\n  }\n\n  getUIFunctions({\n    phone: {\n      regionSettings,\n      routerInteraction,\n      composeText,\n      messageStore,\n      contactSearch,\n      conversations,\n    },\n    formatContactPhone = (phoneNumber) =>\n      formatNumber({\n        phoneNumber,\n        areaCode: regionSettings.areaCode,\n        countryCode: regionSettings.countryCode,\n      }),\n    phoneTypeRenderer,\n    phoneSourceNameRenderer,\n    recipientsContactInfoRenderer,\n    recipientsContactPhoneRenderer,\n  }) {\n    return {\n      send(...args) {\n        let timeout = setTimeout(() => {\n          if (routerInteraction.currentPath === '/composeText') {\n            composeText.alertMessageSending();\n          }\n          if (timeout) {\n            clearTimeout(timeout);\n            timeout = null;\n          }\n        }, 10000);\n        composeText.send(...args).then(\n          (responses) => {\n            if (timeout) {\n              clearTimeout(timeout);\n              timeout = null;\n            }\n            composeText.dismissMessageSending();\n            if (!responses || responses.length === 0) {\n              return null;\n            }\n            messageStore.pushMessages(responses);\n            if (responses.length === 1) {\n              const conversationId =\n                responses[0] &&\n                responses[0].conversation &&\n                responses[0].conversation.id;\n              if (!conversationId) {\n                return null;\n              }\n              routerInteraction.push(`/conversations/${conversationId}`);\n            } else {\n              routerInteraction.push('/messages');\n            }\n            conversations.relateCorrespondentEntity(responses);\n            composeText.clean();\n            return null;\n          },\n          () => {\n            if (timeout) {\n              clearTimeout(timeout);\n              timeout = null;\n            }\n          },\n        );\n      },\n      formatPhone: formatContactPhone,\n      formatContactPhone,\n      async detectPhoneNumbers(input) {\n        const promises = input.split(/,\\s*/g).map(async (item) => {\n          const isValid = await composeText.validatePhoneNumber(item);\n          return isValid ? item : undefined;\n        });\n        const results = await Promise.all(promises);\n        const detectedNumbers = results.filter((item) => !!item);\n        detectedNumbers.forEach((phoneNumber) => {\n          composeText.addToNumber({\n            phoneNumber,\n          });\n        });\n        return detectedNumbers.length > 0;\n      },\n      searchContact: (searchString) =>\n        contactSearch.debouncedSearch({ searchString }),\n      updateSenderNumber: ({ phoneNumber }) =>\n        composeText.updateSenderNumber(phoneNumber),\n      updateTypingToNumber: (...args) =>\n        composeText.updateTypingToNumber(...args),\n      cleanTypingToNumber: (...args) =>\n        composeText.cleanTypingToNumber(...args),\n      addToNumber: (...args) => composeText.addToNumber(...args),\n      removeToNumber: (...args) => composeText.removeToNumber(...args),\n      updateMessageText: (...args) => composeText.updateMessageText(...args),\n      phoneTypeRenderer,\n      phoneSourceNameRenderer,\n      recipientsContactInfoRenderer,\n      recipientsContactPhoneRenderer,\n      addAttachment: (...args) => composeText.addAttachment(...args),\n      removeAttachment: (...args) => composeText.removeAttachment(...args),\n    };\n  }\n}\n"],"file":"index.js"}