{"version":3,"sources":["modules/RcVideo/videoHelper.ts"],"names":["meetingProviderTypes","meeting","video","RcVideoTypes","call","RCV_PASSWORD_REGEX","DEFAULT_JBH","getDefaultChars","DEFAULT_PASSWORD_CHARSET","validateRandomPassword","pwd","test","generateRandomPassword","length","charset","charLen","retVal","i","charAt","Math","floor","random","validatePasswordSettings","meetingPassword","isMeetingSecret","getVideoSettings","data","name","params","settings","type","expiresIn","getDefaultVideoSettings","topic","startTime","duration","allowJoinBeforeHost","muteAudio","muteVideo","saveAsDefault","isMeetingPasswordValid","usePersonalMeetingId","personalMeetingId","getTopic","extensionName","brandName","rcVideoApiPayload","pruneMeetingObject"],"mappings":"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","sourcesContent":["import { pick } from 'ramda';\nimport {\n  MeetingProviderTypesProps,\n  RcVideoTypesProps,\n  RcVMeetingModel,\n  RcvGSuiteMeetingModel,\n  RcVideoAPI,\n} from '../../models/rcv.model';\n\n/* TODO: this meetingProviderTypes is only used for calender-addon\n * if you want to use meetingProviderTypes\n * please turn to use MeetingProvider/interface\n */\nconst meetingProviderTypes: MeetingProviderTypesProps = {\n  meeting: 'RCMeetings',\n  video: 'RCVideo',\n};\n\nconst RcVideoTypes: RcVideoTypesProps = {\n  meeting: 0, // schedule\n  call: 1, // instant meeting\n};\n\nconst RCV_PASSWORD_REGEX = /^[A-Za-z0-9]{1,10}$/;\nconst DEFAULT_JBH = false;\n\n/* RCINT-14566\n * Exclude characters that are hard to visually differentiate [\"0\", \"o\", \"O\", \"I\", \"l\"]\n */\nfunction getDefaultChars() {\n  const DEFAULT_PASSWORD_CHARSET =\n    'abcdefghijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ123456789';\n  return DEFAULT_PASSWORD_CHARSET;\n}\n\nfunction validateRandomPassword(pwd) {\n  return /^(?=.*\\d)(?=.*[A-Z])(?=.*[a-z])[A-Za-z0-9]*$/.test(pwd);\n}\n\nfunction generateRandomPassword(length = 10) {\n  const charset = getDefaultChars();\n  const charLen = charset.length;\n  let retVal = '';\n  for (let i = 0; i < length; i++) {\n    retVal += charset.charAt(Math.floor(Math.random() * charLen));\n  }\n  if (!validateRandomPassword(retVal)) {\n    return generateRandomPassword(length);\n  }\n  return retVal;\n}\n\nfunction validatePasswordSettings(\n  meetingPassword: string,\n  isMeetingSecret: boolean,\n): boolean {\n  if (!isMeetingSecret) {\n    return true;\n  }\n  if (meetingPassword && RCV_PASSWORD_REGEX.test(meetingPassword)) {\n    return true;\n  }\n  return false;\n}\n\n// gsuite\nfunction getVideoSettings(data) {\n  const {\n    name = 'Scheduled meeting',\n    isMeetingSecret,\n    meetingPassword,\n    ...params\n  } = data;\n  const settings: RcvGSuiteMeetingModel = {\n    ...params,\n    name,\n    type: RcVideoTypes.meeting,\n    expiresIn: 31536000,\n  };\n\n  if (isMeetingSecret) {\n    settings.isMeetingSecret = true;\n    settings.meetingPassword = meetingPassword;\n  } else {\n    settings.isMeetingSecret = false;\n    settings.meetingPassword = '';\n  }\n\n  return settings;\n}\n\nfunction getDefaultVideoSettings({\n  topic,\n  startTime,\n}: {\n  topic: string;\n  startTime: Date;\n}): RcVMeetingModel {\n  return {\n    name: topic,\n    type: RcVideoTypes.meeting,\n    startTime,\n    duration: 60,\n    allowJoinBeforeHost: DEFAULT_JBH,\n    muteAudio: false,\n    muteVideo: false,\n    expiresIn: 31536000,\n    saveAsDefault: false,\n    isMeetingSecret: true,\n    meetingPassword: '',\n    isMeetingPasswordValid: false,\n    usePersonalMeetingId: false,\n    personalMeetingId: '',\n  };\n}\n\nfunction getTopic(extensionName: string, brandName: string) {\n  if (brandName === 'RingCentral') {\n    return `${extensionName}'s ${brandName} Video Meeting`;\n  }\n  return `${extensionName}'s ${brandName} Meeting`;\n}\n\nconst rcVideoApiPayload: Array<keyof RcVideoAPI> = [\n  'name',\n  'type',\n  'allowJoinBeforeHost',\n  'muteAudio',\n  'muteVideo',\n  'isMeetingSecret',\n  'meetingPassword',\n  'expiresIn',\n];\n\n/**\n * Remove client side properties before sending to RCV API\n */\nfunction pruneMeetingObject(meeting: RcVMeetingModel): RcVideoAPI {\n  return pick(rcVideoApiPayload, meeting);\n}\n\n// TODO: will remove this when google app script could support export seperately\n// export together because google app script not fully support export\nexport {\n  DEFAULT_JBH,\n  RCV_PASSWORD_REGEX,\n  RcVideoTypes,\n  meetingProviderTypes,\n  getDefaultChars,\n  validateRandomPassword,\n  generateRandomPassword,\n  validatePasswordSettings,\n  getVideoSettings,\n  getDefaultVideoSettings,\n  getTopic,\n  pruneMeetingObject,\n};\n"],"file":"videoHelper.js"}