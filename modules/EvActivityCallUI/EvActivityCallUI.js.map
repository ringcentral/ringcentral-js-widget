{"version":3,"sources":["modules/EvActivityCallUI/EvActivityCallUI.ts"],"names":["EvActivityCallUI","name","deps","dep","optional","that","_deps","evTransferCall","allowTransferCall","evRequeueCall","allowRequeueCall","currentEvMainCall","currentEvCall","callId","evCallDisposition","callsMapping","validated","required","locale","currentLocale","dispositionPickList","evCallMonitor","callIds","otherCallIds","callList","isMultipleCalls","evAuth","agentId","console","warn","enableCache","storageKey","isFirstTimeHandled","pickUpDirectly","goToActivityCallPage","id","routerInteraction","push","goToActivityCallListPage","status","saveStatus","disabled","scrollTo","dispositionId","notes","ready","tabManagerEnabled","tabManager","_checkTabManagerEvent","task","isEvCallDisposition","Object","hasOwnProperty","call","data","setDisposition","gate","gateGroupId","gateId","setStatus","selectedQueueGroupId","selectedGateId","stayOnCall","requeuing","changeTransferType","transferTypes","queue","_redirectTransferCall","type","resetTransferStatus","fetchAgentList","url","reset","evCall","activityCallId","promises","disposeCall","evAgentScript","scriptId","setCurrentCallScript","saveScriptResult","Promise","all","event","tabManagerEvents","CALL_DISPOSITION_SUCCESS","_dispositionSuccess","some","key","saveFields","changeFormStatus","_hasError","changeSavingStatus","_sendTabManager","alert","danger","message","logTypes","CALL_DISPOSITION_FAILURE","ttl","success","setTimeout","goDialer","evWorkingState","setIsPendingDisposition","activeCallControl","value","send","currentLog","activityCallLog","showSmallCallControl","currentEvRawCall","endedCall","callStatus","isInbound","isOnMute","evIntegratedSoftphone","muteActive","isOnHold","isOnActive","isInComingCall","smallCallControlSize","environment","isWide","currentCallControlPermission","disableDispose","disableLinks","disableTransfer","allowTransfer","disableInternalTransfer","allowInternalTransfer","disableHold","allowHoldCall","disableHangup","allowHangupCall","disableMute","evAgentSession","isIntegratedSoftphone","showMuteButton","disableActive","ivrAlertData","goBack","onMute","mute","onUnmute","unmute","onHangup","hangUp","session","sessionId","onReject","reject","onHold","_onHoldOrUnHold","onUnHold","onActive","onUpdateCallLog","_submitData","onCopySuccess","toUpperCase","info","messageTypes","action","goToRequeueCallPage","goToTransferCallPage","transferType","connectivityMonitor","connectivity","rateLimiter","throttling","enable","currentCall","allowHold","allowHangup","outdialDispositions","dispositions","map","item","label","disposition","callDisposition","undefined","callType","dnis","uii","ani","queueDts","fromNumber","toNumber","direction","from","phoneNumber","to","telephonyStatus","telephonySessionId","partyId","startTime","Date","getTime","offset","fromMatches","toMatches","activityMatches","currentSessionId","currentLogCall","isFailed","isAutoSave","isCreated","customLogFields","length","sort","maxLength","error","onChange","placeholder","i18n","getString","picklistOptions","enableScrollError","helperText","currentDisposition","find","noteRequired","requireNote","isHold","getMainCall","getActiveCallList","getIsAgentScript","subject","body","onClick","openAgentScriptTab","baggage","i","ivrAlertSubject","ivrAlertBody","RcUIModuleV2","storage","state"],"mappings":"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","sourcesContent":["import {\n  action,\n  computed,\n  RcUIModuleV2,\n  state,\n  storage,\n} from '@ringcentral-integration/core';\nimport { keys } from 'ramda';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport { CallLogPanelProps } from 'ringcentral-widgets/components/CallLogPanel';\n\nimport {\n  EvTransferType,\n  logTypes,\n  MessageTypes,\n  messageTypes,\n  tabManagerEvents,\n  transferTypes,\n} from '../../enums';\nimport {\n  EvActivityCallUIFunctions,\n  EvActivityCallUIProps,\n  EvCurrentLog,\n} from '../../interfaces/EvActivityCallUI.interface';\nimport { EvIvrData } from '../../interfaces/EvData.interface';\nimport { EvBaggage } from '../../lib/EvClient';\nimport { ActivityCallUI, Deps } from './EvActivityCallUI.interface';\nimport i18n from './i18n';\n\ntype FormState = {\n  validated?: Partial<EvActivityCallUI['validated']>;\n  required?: Partial<EvActivityCallUI['required']>;\n  disabled?: Partial<EvActivityCallUI['disabled']>;\n};\n\n@Module({\n  name: 'EvActivityCallUI',\n  deps: [\n    'Locale',\n    'Alert',\n    'ActiveCallControl',\n    'EvCallMonitor',\n    'EvCall',\n    'EvAgentScript',\n    'EvRequeueCall',\n    'EvTransferCall',\n    'EvCallDisposition',\n    'EvWorkingState',\n    'EvAgentSession',\n    'EvIntegratedSoftphone',\n    'RouterInteraction',\n    'ConnectivityMonitor',\n    'RateLimiter',\n    'Environment',\n    'Storage',\n    'EvAuth',\n    { dep: 'TabManager', optional: true },\n    { dep: 'EvActivityCallUIOptions', optional: true },\n  ],\n})\nclass EvActivityCallUI<T = {}>\n  extends RcUIModuleV2<Deps & T>\n  implements ActivityCallUI {\n  public isFirstTimeHandled = false;\n\n  /** Is the call pick up directly */\n  pickUpDirectly = true;\n\n  protected openAgentScriptTab() {\n    console.warn('this should be implement in extend module');\n  }\n\n  constructor(deps: Deps) {\n    super({\n      deps,\n      enableCache: true,\n      storageKey: 'EvActivityCallUI',\n    });\n  }\n\n  @storage\n  @state\n  validated = {\n    dispositionId: true,\n    notes: true,\n  };\n\n  @storage\n  @state\n  required = {\n    notes: false,\n  };\n\n  @storage\n  @state\n  disabled: any = {};\n\n  @storage\n  @state\n  saveStatus: EvActivityCallUIProps['saveStatus'] = 'submit';\n\n  @storage\n  @state\n  scrollTo: string = null;\n\n  get callId() {\n    return this._deps.evCall.activityCallId;\n  }\n\n  get disableLinks() {\n    return (\n      !this._deps.connectivityMonitor.connectivity ||\n      this._deps.rateLimiter.throttling\n    );\n  }\n\n  get tabManagerEnabled() {\n    return this._deps.tabManager?.enable;\n  }\n\n  get currentEvCall() {\n    return this._deps.evCall.currentCall;\n  }\n\n  // TODO: should check with outbound call\n  get isInComingCall() {\n    return this._deps.evCall.isInbound && !this.pickUpDirectly;\n    // currentSession.callStatus === telephonyStatuses.ringing\n  }\n\n  // transferCall and requeueCall are two parts of transfer menu\n  get allowTransfer() {\n    return (\n      this._deps.evTransferCall.allowTransferCall ||\n      this._deps.evRequeueCall.allowRequeueCall\n    );\n  }\n\n  @computed((that: EvActivityCallUI) => [\n    that._deps.evTransferCall.allowTransferCall,\n    that._deps.evRequeueCall.allowRequeueCall,\n    that.currentEvMainCall,\n  ])\n  get currentCallControlPermission() {\n    return {\n      allowTransferCall: this._deps.evTransferCall.allowTransferCall,\n      allowRequeueCall: this._deps.evRequeueCall.allowRequeueCall,\n      allowHoldCall: this.currentEvMainCall?.allowHold,\n      allowHangupCall: this.currentEvMainCall?.allowHangup,\n    };\n  }\n\n  @computed((that: EvActivityCallUI) => [that.currentEvCall])\n  get dispositionPickList() {\n    return (\n      this.currentEvCall?.outdialDispositions?.dispositions?.map((item) => ({\n        ...item,\n        label: item.disposition,\n        value: item.dispositionId,\n      })) || []\n    );\n  }\n\n  // TODO add `callDisposition` in CallLog\n  @computed((that: EvActivityCallUI) => [\n    that.callId,\n    that.currentEvCall,\n    that._deps.evCallDisposition.callsMapping[that.callId],\n    that.validated,\n    that.required,\n    that._deps.locale.currentLocale,\n    that.dispositionPickList,\n  ])\n  get activityCallLog(): EvCurrentLog {\n    const {\n      callId,\n      currentEvCall: currentCall,\n\n      validated,\n      required,\n    } = this;\n\n    const callDisposition = this._deps.evCallDisposition.callsMapping[\n      this.callId\n    ];\n\n    if (!currentCall) {\n      return undefined;\n    }\n    const { callType, dnis, uii, ani, queueDts, agentId } = currentCall;\n\n    // TODO confirm about  dialDest or dnis?\n    const fromNumber = callType === 'OUTBOUND' ? dnis : ani;\n    // TODO confirm about  dialDest or dnis?\n    const toNumber = callType === 'OUTBOUND' ? ani : dnis;\n    const { dispositionId, notes } = callDisposition || {};\n\n    const dispositionPickList = this.dispositionPickList;\n\n    return {\n      currentEvRawCall: currentCall,\n      // the call which maps for rc component\n      call: {\n        id: uii,\n        direction: callType,\n        from: {\n          phoneNumber: fromNumber,\n          name: fromNumber,\n        },\n        to: {\n          phoneNumber: toNumber,\n          name: toNumber,\n        },\n        telephonyStatus: 'CallConnected', // TODO handle with call state and agent state\n        sessionId: currentCall.session.sessionId,\n        telephonySessionId: uii,\n        partyId: agentId,\n        startTime: new Date(queueDts).getTime(),\n        offset: 0,\n        fromMatches: [],\n        toMatches: [],\n        activityMatches: [],\n      },\n      currentSessionId: callId,\n      // TODO: this will be remove when api can using.\n      currentLogCall: {\n        isFailed: false,\n        isAutoSave: false,\n        isCreated: false,\n      },\n      customLogFields:\n        dispositionPickList.length === 0\n          ? []\n          : [\n              {\n                label: 'Notes',\n                sort: 3,\n                type: 'textarea',\n                value: 'notes',\n                maxLength: 32000,\n                required: required.notes,\n                error: !validated.notes,\n                onChange: (value: string) => {\n                  if (required.notes) {\n                    this.changeFormStatus({ validated: { notes: !!value } });\n                  } else {\n                    this.changeFormStatus({ validated: { notes: true } });\n                  }\n                },\n              },\n              {\n                label: 'Disposition',\n                sort: 5,\n                type: 'picklist',\n                value: 'dispositionId',\n                placeholder: i18n.getString(\n                  'pleaseSelect',\n                  this._deps.locale.currentLocale,\n                ),\n                required: true,\n                picklistOptions: dispositionPickList,\n                enableScrollError: true,\n                error: !validated.dispositionId,\n                helperText: !validated.dispositionId\n                  ? i18n.getString(\n                      'dispositionError',\n                      this._deps.locale.currentLocale,\n                    )\n                  : undefined,\n                onChange: (value: string) => {\n                  const currentDisposition = dispositionPickList.find(\n                    (item) => item.value === value,\n                  );\n\n                  const noteRequired =\n                    currentDisposition && currentDisposition.requireNote;\n\n                  this.changeFormStatus({\n                    validated: {\n                      dispositionId: !!value,\n                      notes: !noteRequired || (noteRequired && !!notes),\n                    },\n                    required: {\n                      notes: noteRequired,\n                    },\n                  });\n                },\n              },\n            ],\n      task: {\n        dispositionId,\n        notes,\n      },\n    };\n  }\n\n  @computed((that: EvActivityCallUI) => [\n    that.currentEvCall,\n    that.currentEvMainCall,\n  ])\n  get callStatus() {\n    let status: EvActivityCallUIProps['status'] = 'active';\n\n    if (this.currentEvCall?.endedCall) {\n      status = 'callEnd';\n    } else if (this.currentEvMainCall?.isHold) {\n      status = 'onHold';\n    }\n    return status;\n  }\n\n  @computed((that: EvActivityCallUI) => [that.currentEvCall])\n  get currentEvMainCall() {\n    return this.currentEvCall\n      ? this._deps.activeCallControl.getMainCall(this.currentEvCall.uii)\n      : null;\n  }\n\n  @computed((that: EvActivityCallUI) => [\n    that.callId,\n    that._deps.evCallMonitor.callIds,\n    that._deps.evCallMonitor.otherCallIds,\n    that._deps.evCallMonitor.callsMapping,\n  ])\n  get callList() {\n    const { callIds, otherCallIds, callsMapping } = this._deps.evCallMonitor;\n\n    return this._deps.evCallMonitor.getActiveCallList(\n      callIds,\n      otherCallIds,\n      callsMapping,\n      this.callId,\n    );\n  }\n\n  @computed((that: EvActivityCallUI) => [that.callList])\n  get isMultipleCalls() {\n    return this.callList.length > 2;\n  }\n\n  @computed((that: EvActivityCallUI) => [\n    that.isMultipleCalls,\n    that.callList,\n    that._deps.evAuth.agentId,\n    that.currentEvMainCall,\n  ])\n  get isOnHold() {\n    const { isMultipleCalls, callList, currentEvMainCall } = this;\n    if (isMultipleCalls) {\n      return !!callList.find(\n        (call) =>\n          !(call.session.agentId === this._deps.evAuth.agentId) &&\n          !!call.isHold,\n      );\n    }\n    return currentEvMainCall?.isHold;\n  }\n\n  @computed((that: EvActivityCallUI) => [that.currentEvCall, that._deps.locale])\n  get ivrAlertData() {\n    const call = this.currentEvCall;\n    const { currentLocale } = this._deps.locale;\n    const ivrAlertData: EvIvrData[] = [];\n\n    if (\n      this._deps.environment.isWide &&\n      this._deps.evAgentScript.getIsAgentScript(call)\n    ) {\n      ivrAlertData.push({\n        subject: i18n.getString('agentScriptTitle', currentLocale),\n        body: i18n.getString('agentScriptContent', currentLocale),\n        onClick: () => this.openAgentScriptTab(),\n      });\n    }\n\n    if (call?.baggage) {\n      for (let i = 1; i <= 3; i++) {\n        const ivrAlertSubject =\n          call.baggage[`ivrAlertSubject_${i}` as keyof EvBaggage];\n        const ivrAlertBody =\n          call.baggage[`ivrAlertBody_${i}` as keyof EvBaggage];\n        if (ivrAlertSubject || ivrAlertBody)\n          ivrAlertData.push({\n            subject: ivrAlertSubject || '',\n            body: ivrAlertBody || '',\n          });\n      }\n    }\n    return ivrAlertData as EvIvrData[];\n  }\n\n  @action\n  changeSavingStatus(status: EvActivityCallUIProps['saveStatus']) {\n    this.saveStatus = status;\n  }\n\n  @action\n  protected changeFormStatus({ validated, required, disabled }: FormState) {\n    if (validated) {\n      this.validated = {\n        ...this.validated,\n        ...validated,\n      };\n    }\n    if (required) {\n      this.required = {\n        ...this.required,\n        ...required,\n      };\n    }\n    if (disabled) {\n      this.disabled = {\n        ...this.disabled,\n        ...disabled,\n      };\n    }\n  }\n\n  @action\n  setScrollTo(id: string) {\n    this.scrollTo = id;\n  }\n\n  @action\n  reset() {\n    this.validated = {\n      dispositionId: true,\n      notes: true,\n    };\n    this.required = {\n      notes: false,\n    };\n    this.disabled = {};\n    this.saveStatus = 'submit';\n  }\n\n  onStateChange() {\n    if (this.ready && this.tabManagerEnabled && this._deps.tabManager.ready) {\n      this._checkTabManagerEvent();\n    }\n  }\n\n  onUpdateCallLog(\n    { task }: Parameters<CallLogPanelProps['onUpdateCallLog']>[0],\n    id: Parameters<CallLogPanelProps['onUpdateCallLog']>[1],\n  ) {\n    const isEvCallDisposition =\n      Object.hasOwnProperty.call(task, 'dispositionId') ||\n      Object.hasOwnProperty.call(task, 'notes');\n    if (isEvCallDisposition) {\n      const data = {\n        ...this._deps.evCallDisposition.callsMapping[id],\n        ...task,\n      };\n      this._deps.evCallDisposition.setDisposition(id, {\n        dispositionId: data.dispositionId,\n        notes: data.notes,\n      });\n    }\n  }\n\n  goToActivityCallPage = (id: string = this.callId) => {\n    this._deps.routerInteraction.push(`/activityCallLog/${id}`);\n  };\n\n  goToActivityCallListPage = (id: string = this.callId) => {\n    this._deps.routerInteraction.push(`/activityCallLog/${id}/activeCallList`);\n  };\n\n  goToRequeueCallPage() {\n    const { gateGroupId, gateId } = this._deps.evCallMonitor.callsMapping[\n      this.callId\n    ].gate;\n    this._deps.evRequeueCall.setStatus({\n      selectedQueueGroupId: gateGroupId,\n      selectedGateId: gateId,\n      stayOnCall: false,\n      requeuing: false,\n    });\n    this._deps.evTransferCall.changeTransferType(transferTypes.queue);\n    this._redirectTransferCall('/transferCall');\n  }\n\n  goToTransferCallPage(type: EvTransferType) {\n    this._deps.evTransferCall.resetTransferStatus();\n    this._deps.evTransferCall.fetchAgentList();\n    this._redirectTransferCall(`/transferCall/${type}`);\n  }\n\n  private _redirectTransferCall(url: string = '') {\n    this._deps.routerInteraction.push(`/activityCallLog/${this.callId}${url}`);\n  }\n\n  goDialer() {\n    this._deps.routerInteraction.push('/dialer');\n    this.reset();\n    this._deps.evCall.activityCallId = null;\n  }\n\n  async disposeCall() {\n    const promises: Promise<any>[] = [\n      this._deps.evCallDisposition.disposeCall(this.callId),\n    ];\n\n    const { evAgentScript } = this._deps;\n    const call = this.currentEvCall;\n    // evAgentScript.isDisplayAgentScript &&\n    if (call.scriptId) {\n      evAgentScript.setCurrentCallScript(null);\n      promises.push(evAgentScript.saveScriptResult(call));\n    }\n\n    await Promise.all(promises);\n  }\n\n  private _checkTabManagerEvent() {\n    const { event } = this._deps.tabManager;\n    if (event) {\n      // const data = event.args[0];\n      switch (event.name) {\n        case tabManagerEvents.CALL_DISPOSITION_SUCCESS:\n          this._dispositionSuccess();\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  private _hasError() {\n    return keys(this.validated).some((key) => {\n      return !this.validated[key];\n    });\n  }\n\n  private async _submitData(id: string) {\n    try {\n      const saveFields = this._deps.evCallDisposition.callsMapping[id];\n      if (saveFields) {\n        this.changeFormStatus({\n          validated: {\n            dispositionId: !!saveFields.dispositionId,\n            notes:\n              !this.required.notes || (saveFields.notes && this.required.notes),\n          },\n        });\n      }\n\n      if (this._hasError()) {\n        return;\n      }\n      this.changeSavingStatus('saving');\n      await this.disposeCall();\n\n      this._sendTabManager(tabManagerEvents.CALL_DISPOSITION_SUCCESS);\n      this._dispositionSuccess();\n    } catch (e) {\n      this._deps.alert.danger({\n        message: logTypes.CALL_DISPOSITION_FAILURE,\n        ttl: 0,\n      });\n      this.changeSavingStatus('submit');\n      throw e;\n    }\n  }\n\n  private _dispositionSuccess() {\n    this.changeSavingStatus('saved');\n\n    this._deps.alert.success({\n      message: logTypes.CALL_DISPOSITION_SUCCESS,\n    });\n    // delay for animation with loading ui.\n    setTimeout(() => this.goDialer(), 1000);\n\n    this._deps.evWorkingState.setIsPendingDisposition(false);\n  }\n\n  private _onHoldOrUnHold(type: 'hold' | 'unhold') {\n    if (this.isMultipleCalls) {\n      return this.goToActivityCallListPage();\n    }\n    this._deps.activeCallControl[type]();\n  }\n\n  private _sendTabManager(event: string, value?: any) {\n    this._deps.tabManager?.send(event, value);\n  }\n\n  getUIProps({ id }: { id: string }): EvActivityCallUIProps {\n    this._deps.evCall.activityCallId = id;\n\n    return {\n      scrollTo: this.scrollTo,\n      currentLog: this.activityCallLog,\n      showSmallCallControl: !this.activityCallLog?.currentEvRawCall?.endedCall,\n      currentLocale: this._deps.locale.currentLocale,\n      currentEvCall: this.currentEvCall,\n      saveStatus: this.saveStatus,\n      status: this.callStatus,\n      isInbound: this._deps.evCall.isInbound,\n      isOnMute: this._deps.evIntegratedSoftphone.muteActive,\n      isOnHold: this.isOnHold,\n      isOnActive: this.isMultipleCalls,\n      isInComingCall: this.isInComingCall,\n      smallCallControlSize: this._deps.environment.isWide ? 'medium' : 'small',\n      currentCallControlPermission: this.currentCallControlPermission,\n      disableDispose: this.disableLinks || this.saveStatus === 'saving',\n      disableTransfer:\n        this.disableLinks || this.isInComingCall || !this.allowTransfer,\n      disableInternalTransfer:\n        this.disableLinks ||\n        this.isInComingCall ||\n        !this.allowTransfer ||\n        !this._deps.evTransferCall.allowInternalTransfer,\n      disableHold:\n        this.disableLinks ||\n        this.isInComingCall ||\n        !this.currentCallControlPermission.allowHoldCall,\n      disableHangup:\n        this.disableLinks || !this.currentCallControlPermission.allowHangupCall,\n      disableMute:\n        !this._deps.evAgentSession.isIntegratedSoftphone || this.disableLinks,\n      showMuteButton: this._deps.evAgentSession.isIntegratedSoftphone,\n      disableActive: this.disableLinks,\n      ivrAlertData: this.ivrAlertData,\n    };\n  }\n\n  getUIFunctions(): EvActivityCallUIFunctions {\n    return {\n      goBack: () => {},\n      onMute: () => this._deps.activeCallControl.mute(),\n      onUnmute: () => this._deps.activeCallControl.unmute(),\n      onHangup: () =>\n        this._deps.activeCallControl.hangUp(\n          this.currentEvCall.session.sessionId,\n        ),\n      onReject: () => this._deps.activeCallControl.reject(),\n      onHold: () => this._onHoldOrUnHold('hold'),\n      onUnHold: () => this._onHoldOrUnHold('unhold'),\n      onActive: () => this.goToActivityCallListPage(),\n      onUpdateCallLog: (data, id) => this.onUpdateCallLog(data, id),\n      disposeCall: async () => {\n        if (this.saveStatus === 'saved') {\n          return this.goDialer();\n        }\n        await this._submitData(this.callId);\n      },\n      onCopySuccess: (name) => {\n        name = name.toUpperCase();\n        this._deps.alert.info({\n          message: messageTypes[`COPY_${name}_SUCCESS` as MessageTypes],\n          action: '',\n        });\n      },\n      goToRequeueCallPage: () => this.goToRequeueCallPage(),\n      goToTransferCallPage: (transferType: EvTransferType) =>\n        this.goToTransferCallPage(transferType),\n    };\n  }\n}\nexport { EvActivityCallUI };\n"],"file":"EvActivityCallUI.js"}