{"version":3,"sources":["components/MessageInput/index.js"],"names":["UIHeightOffset","MessageInput","props","context","onChange","e","_lastValueChange","Date","now","value","currentTarget","newHeight","calculateNewHeight","state","height","onHeightChange","setState","onKeyDown","key","shiftKey","preventDefault","onSend","disabled","onAttachmentIconClick","_fileInputRef","current","click","onSelectAttachment","files","length","addAttachment","file","name","size","minHeight","React","createRef","nextProps","inputExpandable","textArea","style","scrollHeight","maxHeight","currentLocale","maxLength","supportAttachment","attachments","removeAttachment","inputHeight","styles","root","attachmentIcon","attachmentSvg","display","textField","target","i18n","getString","submitField","sendButton","map","attachment","attachmentItem","attachmentRemoveIcon","removeSvg","Component","propTypes","PropTypes","string","isRequired","bool","number","func","array","defaultProps","undefined"],"mappings":"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","sourcesContent":["import PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport React, { Component } from 'react';\nimport attachmentSvg from '@ringcentral-integration/rcui/icons/icon-attachment.svg';\nimport removeSvg from '@ringcentral-integration/rcui/icons/icon-close.svg';\nimport { RcIconButton } from '@ringcentral-integration/rcui';\n\nimport i18n from './i18n';\nimport styles from './styles.scss';\n\nconst UIHeightOffset = 23;\n// the extra height of the entire field with paddings and borders\n\nexport default class MessageInput extends Component {\n  static propTypes = {\n    value: PropTypes.string.isRequired,\n    currentLocale: PropTypes.string.isRequired,\n    disabled: PropTypes.bool,\n    minHeight: PropTypes.number,\n    maxHeight: PropTypes.number,\n    maxLength: PropTypes.number,\n    onSend: PropTypes.func,\n    onChange: PropTypes.func,\n    onHeightChange: PropTypes.func,\n    inputExpandable: PropTypes.bool,\n    supportAttachment: PropTypes.bool,\n    attachments: PropTypes.array,\n    addAttachment: PropTypes.func,\n    removeAttachment: PropTypes.func,\n  };\n\n  static defaultProps = {\n    disabled: false,\n    onSend: undefined,\n    onChange: undefined,\n    onHeightChange: undefined,\n    minHeight: 63,\n    maxHeight: 300,\n    maxLength: 5000,\n    inputExpandable: true,\n    supportAttachment: false,\n    attachments: [],\n    addAttachment: undefined,\n    removeAttachment: undefined,\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      value: props.value,\n      height: props.minHeight,\n    };\n    this._lastValueChange = 0;\n    this._fileInputRef = React.createRef()\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (\n      nextProps.value !== this.state.value &&\n      // ignore value changes from props for 300ms after typing\n      // this is to prevent unnecessary value changes when used in chrome extension\n      // where value pushed back to background and back takes longer\n      Date.now() - this._lastValueChange > 300\n    ) {\n      // use setState(updater, callback) to recaculate height after value has been update to DOM\n      this.setState(\n        () => ({\n          value: nextProps.value,\n        }),\n        () => {\n          const newHeight = this.calculateNewHeight();\n          if (newHeight !== this.state.height) {\n            if (typeof this.props.onHeightChange === 'function') {\n              this.props.onHeightChange(newHeight);\n            }\n            this.setState({\n              height: newHeight,\n            });\n          }\n        },\n      );\n    }\n  }\n\n  componentDidMount() {\n    // do a initial size check in case the component is mounted with multi line value\n    const newHeight = this.calculateNewHeight();\n    if (newHeight !== this.state.height) {\n      if (typeof this.props.onHeightChange === 'function') {\n        this.props.onHeightChange(newHeight);\n      }\n      this.setState({\n        height: newHeight,\n      });\n    }\n  }\n\n  calculateNewHeight() {\n    if (!this.props.inputExpandable) {\n      return this.props.minHeight;\n    }\n    // temperarily set height to 0 to check scrollHeight\n    this.textArea.style.height = 0;\n    const newHeight = this.textArea.scrollHeight + 10 + UIHeightOffset;\n    // set height back to original to avoid messing with react\n    this.textArea.style.height = `${this.state.height - UIHeightOffset}px`;\n    const { minHeight, maxHeight } = this.props;\n    if (newHeight < minHeight) {\n      return minHeight;\n    }\n    if (newHeight > maxHeight) {\n      return maxHeight;\n    }\n    return newHeight;\n  }\n\n  onChange = (e) => {\n    this._lastValueChange = Date.now();\n    const {\n      currentTarget: { value },\n    } = e;\n    const newHeight = this.calculateNewHeight();\n    if (\n      newHeight !== this.state.height &&\n      typeof this.props.onHeightChange === 'function'\n    ) {\n      this.props.onHeightChange(newHeight);\n    }\n    this.setState({\n      value,\n      height: newHeight,\n    });\n    if (typeof this.props.onChange === 'function') {\n      this.props.onChange(value);\n    }\n  };\n\n  onKeyDown = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      this.onSend();\n    }\n  };\n\n  onSend = () => {\n    if (!this.props.disabled && typeof this.props.onSend === 'function') {\n      this.props.onSend();\n    }\n  };\n\n  onAttachmentIconClick = () => {\n    this._fileInputRef.current.click();\n  };\n\n  onSelectAttachment = ({ currentTarget }) => {\n    if (currentTarget.files.length === 0) {\n      return;\n    }\n    const { addAttachment } = this.props;\n    const file = currentTarget.files[0];\n    addAttachment({\n      name: file.name,\n      size: file.size,\n      file,\n    });\n  };\n\n  render() {\n    const {\n      currentLocale,\n      disabled,\n      maxLength,\n      supportAttachment,\n      attachments,\n      removeAttachment,\n    } = this.props;\n    const { value, height } = this.state;\n    const inputHeight = height - UIHeightOffset;\n    return (\n      <div\n        className={classnames(\n          styles.root,\n          supportAttachment && styles.supportAttachment,\n        )}\n      >\n        <div className={styles.attachmentIcon}>\n          <RcIconButton\n            variant=\"round\"\n            size=\"small\"\n            symbol={attachmentSvg}\n            onClick={this.onAttachmentIconClick}\n          />\n          <input\n            type=\"file\"\n            accept=\"image/*\"\n            style={{ display: 'none' }}\n            ref={this._fileInputRef}\n            onChange={this.onSelectAttachment}\n          />\n        </div>\n        <div className={styles.textField}>\n          <textarea\n            data-sign=\"messageInput\"\n            ref={(target) => {\n              this.textArea = target;\n            }}\n            placeholder={i18n.getString('typeMessage', currentLocale)}\n            value={value}\n            maxLength={maxLength}\n            onChange={this.onChange}\n            onKeyPressCapture={this.onKeyDown}\n            style={{\n              height: inputHeight,\n            }}\n          />\n        </div>\n        <div className={styles.submitField}>\n          <input\n            data-sign=\"messageButton\"\n            type=\"button\"\n            value={i18n.getString('send', currentLocale)}\n            onClick={this.onSend}\n            className={styles.sendButton}\n            disabled={disabled}\n          />\n        </div>\n        <div className={styles.attachments}>\n          {attachments.map((attachment) => {\n            return (\n              <div\n                className={styles.attachmentItem}\n                key={attachment.name}\n                title={attachment.name}\n              >\n                {attachment.name}\n                <div className={styles.attachmentRemoveIcon}>\n                  <RcIconButton\n                    size=\"small\"\n                    symbol={removeSvg}\n                    onClick={() => {\n                      removeAttachment(attachment);\n                    }}\n                  />\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n}\n"],"file":"index.js"}