{"version":3,"sources":["components/PlaceholderImage/index.js"],"names":["cache","defaultContainer","x","PlaceholderImage","props","onLoad","src","img","setState","isLoaded","onError","loadImg","Image","onload","onerror","unloadImg","e","console","error","state","isLoading","nextProps","imgSrc","container","placeholder","placeholderContainer","rest","imgProps","Component","propTypes","PropTypes","string","node","func","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nconst cache = {};\nconst defaultContainer = (x) => x;\n\n/**\n * Reference: https://github.com/mbrevda/react-image\n * This component contains too many features we do not need for now\n *\n * @class PlaceholderImage\n * @extends {Component}\n */\nclass PlaceholderImage extends Component {\n  static propTypes = {\n    src: PropTypes.string,\n    // Put default image here\n    placeholder: PropTypes.node,\n    placeholderContainer: PropTypes.func,\n    container: PropTypes.func,\n  };\n\n  static defaultProps = {\n    src: '',\n    placeholder: false,\n    container: defaultContainer,\n    placeholderContainer: defaultContainer,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isLoading: true,\n      isLoaded: false,\n    };\n  }\n\n  onLoad = () => {\n    const { src } = this.props;\n    cache[src] = true;\n    if (this.img) {\n      this.setState({ isLoaded: true });\n    }\n  };\n\n  onError = () => {\n    const { src } = this.props;\n    cache[src] = false;\n\n    if (!this.img) {\n      return false;\n    }\n\n    this.setState({ isLoaded: false });\n  };\n\n  loadImg = () => {\n    const { src } = this.props;\n    this.img = new Image();\n\n    this.img.src = src;\n\n    // TODO: Consider using decode first here\n    this.img.onload = this.onLoad;\n    this.img.onerror = this.onError;\n  };\n\n  unloadImg = () => {\n    delete this.img.onerror;\n    delete this.img.onload;\n\n    try {\n      delete this.img.src;\n    } catch (e) {\n      console.error('Error: error on deleting img src');\n    }\n\n    delete this.img;\n  };\n\n  componentDidMount() {\n    const { isLoading } = this.state;\n    if (isLoading) {\n      this.loadImg();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.img) {\n      this.unloadImg();\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { src: imgSrc } = nextProps;\n    const { src } = this.props;\n\n    if (src !== imgSrc) {\n      // If the source is invalid, just render the placeholder\n      if (!imgSrc) {\n        return this.setState({ isLoading: false, isLoaded: false });\n      }\n\n      this.setState(\n        {\n          isLoaded: false,\n          isLoading: false,\n        },\n        this.loadImg,\n      );\n    }\n  }\n\n  render() {\n    const {\n      container,\n      src,\n      placeholder,\n      placeholderContainer,\n      ...rest\n    } = this.props;\n\n    const { isLoading, isLoaded } = this.state;\n\n    if (isLoaded) {\n      const imgProps = {\n        ...{ src },\n        ...rest,\n      };\n\n      /* eslint-disable-next-line */\n      return container(<img {...imgProps} />);\n    }\n\n    if (!isLoaded && isLoading) {\n      return placeholder ? placeholderContainer(placeholder) : null;\n    }\n\n    return null;\n  }\n}\n\nexport default PlaceholderImage;\n"],"file":"index.js"}