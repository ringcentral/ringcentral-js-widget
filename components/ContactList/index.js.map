{"version":3,"sources":["components/ContactList/index.js"],"names":["CAPTION_HEIGHT","ROW_HEIGHT","NoContacts","currentLocale","styles","noContacts","i18n","getString","propTypes","PropTypes","string","isRequired","ContactList","props","calculateRowHeight","index","state","captionRows","findGroup","item","startIndex","contacts","length","groups","rowGetter","caption","group","onScroll","scrollTop","setState","cellRenderer","rowData","groupCaption","getAvatarUrl","getPresence","onItemSelect","sourceNodeRenderer","type","id","onRowsRendered","groupIndex","captions","previousCaption","currentCaption","headerRenderer","getDerivedStateFromProps","list","React","createRef","prevProps","lastContactGroups","contactGroups","current","recomputeRowHeights","width","height","count","content","renderList","root","nextState","push","rowOffset","Component","arrayOf","shape","ContactItem","contact","func","number","defaultProps","undefined"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Table, Column } from 'react-virtualized';\nimport { reduce, find, findIndex } from 'ramda';\nimport ContactItem from '../ContactItem';\nimport styles from './styles.scss';\nimport i18n from './i18n';\n\nconst CAPTION_HEIGHT = 20;\nconst ROW_HEIGHT = 50;\n\nfunction NoContacts({ currentLocale }) {\n  return (\n    <p className={styles.noContacts}>\n      {i18n.getString('noContacts', currentLocale)}\n    </p>\n  );\n}\nNoContacts.propTypes = {\n  currentLocale: PropTypes.string.isRequired,\n};\n\nexport default class ContactList extends Component {\n  constructor(props) {\n    super(props);\n    this.state = ContactList.getDerivedStateFromProps(props);\n    this.list = React.createRef();\n  }\n\n  static getDerivedStateFromProps(\n    props,\n    state = { scrollTop: 0, currentCaption: '' },\n  ) {\n    if (props.contactGroups !== state.lastContactGroups) {\n      return {\n        ...reduce(\n          (nextState, group) => {\n            nextState.captions.push(group.caption);\n\n            // skip the caption row for the first group\n            const rowOffset = nextState.groups.length !== 0 ? 1 : 0;\n            if (rowOffset) {\n              nextState.captionRows[nextState.count] = group.caption;\n            }\n            nextState.groups.push({\n              ...group,\n              startIndex: nextState.count + rowOffset,\n            });\n            nextState.count += group.contacts.length + rowOffset; // with caption row\n            return nextState;\n          },\n          {\n            ...state,\n            groups: [],\n            captions: [],\n            captionRows: {},\n            count: 0,\n          },\n          props.contactGroups,\n        ),\n        lastContactGroups: props.contactGroups,\n      };\n    }\n    return state;\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.state.lastContactGroups !== prevProps.contactGroups) {\n      if (\n        this.list &&\n        this.list.current &&\n        this.list.current.recomputeRowHeights\n      ) {\n        this.list.current.recomputeRowHeights(0);\n      }\n    }\n  }\n\n  calculateRowHeight = ({ index }) => {\n    if (this.state.captionRows[index]) {\n      return CAPTION_HEIGHT;\n    }\n    return ROW_HEIGHT;\n  };\n\n  findGroup = ({ index }) =>\n    find(\n      (item) =>\n        index >= item.startIndex &&\n        index < item.startIndex + item.contacts.length,\n      this.state.groups,\n    );\n\n  rowGetter = ({ index }) => {\n    if (this.state.captionRows[index]) {\n      return {\n        caption: this.state.captionRows[index],\n      };\n    }\n    const group = this.findGroup({ index });\n    return group.contacts[index - group.startIndex];\n  };\n\n  onScroll = ({ scrollTop }) => {\n    if (scrollTop !== this.state.scrollTop) {\n      this.setState({\n        scrollTop,\n      });\n    }\n  };\n\n  resetScrollTop() {\n    this.setState({\n      scrollTop: 0,\n    });\n  }\n\n  cellRenderer = ({ rowData }) => {\n    if (rowData.caption) {\n      return <div className={styles.groupCaption}>{rowData.caption}</div>;\n    }\n    const {\n      currentLocale,\n      getAvatarUrl,\n      getPresence,\n      onItemSelect,\n      sourceNodeRenderer,\n    } = this.props;\n    return (\n      <div key={`${rowData.type}-${rowData.id}`}>\n        <ContactItem\n          currentLocale={currentLocale}\n          contact={rowData}\n          getAvatarUrl={getAvatarUrl}\n          getPresence={getPresence}\n          onSelect={onItemSelect}\n          sourceNodeRenderer={sourceNodeRenderer}\n        />\n      </div>\n    );\n  };\n\n  onRowsRendered = ({ startIndex }) => {\n    // update header with the correct caption\n    if (this.state.captionRows[startIndex]) {\n      const groupIndex = findIndex(\n        (item) => item === this.state.captionRows[startIndex],\n        this.state.captions,\n      );\n      const previousCaption = this.state.captions[groupIndex - 1];\n      if (previousCaption !== this.state.currentCaption) {\n        this.setState({\n          currentCaption: previousCaption,\n        });\n      }\n    } else {\n      const group = this.findGroup({ index: startIndex });\n      if (group.caption !== this.state.currentCaption) {\n        this.setState({\n          currentCaption: group.caption,\n        });\n      }\n    }\n  };\n\n  headerRenderer = () => (\n    <div className={styles.groupCaption}>{this.state.currentCaption}</div>\n  );\n\n  renderList() {\n    // use table instead of list to allow caption header\n    return (\n      <Table\n        ref={this.list}\n        headerHeight={CAPTION_HEIGHT}\n        width={this.props.width}\n        height={this.props.height}\n        rowCount={this.state.count}\n        rowHeight={this.calculateRowHeight}\n        rowGetter={this.rowGetter}\n        onRowsRendered={this.onRowsRendered}\n        onScroll={this.onScroll}\n        scrollTop={this.state.scrollTop}\n      >\n        <Column\n          dataKey=\"caption\"\n          disableSort\n          flexGrow={1}\n          width={this.props.width}\n          cellRenderer={this.cellRenderer}\n          headerRenderer={this.headerRenderer}\n        />\n      </Table>\n    );\n  }\n\n  render() {\n    const { currentLocale, contactGroups, width, height } = this.props;\n    let content = null;\n    if (width !== 0 && height !== 0) {\n      content = contactGroups.length ? (\n        this.renderList()\n      ) : (\n        <NoContacts currentLocale={currentLocale} />\n      );\n    }\n    return <div className={styles.root}>{content}</div>;\n  }\n}\n\nContactList.propTypes = {\n  currentLocale: PropTypes.string.isRequired,\n  contactGroups: PropTypes.arrayOf(\n    PropTypes.shape({\n      id: PropTypes.string.isRequired,\n      caption: PropTypes.string.isRequired,\n      contacts: PropTypes.arrayOf(ContactItem.propTypes.contact).isRequired,\n    }),\n  ).isRequired,\n  getAvatarUrl: PropTypes.func.isRequired,\n  getPresence: PropTypes.func.isRequired,\n  onItemSelect: PropTypes.func,\n  sourceNodeRenderer: PropTypes.func,\n  width: PropTypes.number.isRequired,\n  height: PropTypes.number.isRequired,\n};\n\nContactList.defaultProps = {\n  onItemSelect: undefined,\n  sourceNodeRenderer: undefined,\n};\n"],"file":"index.js"}